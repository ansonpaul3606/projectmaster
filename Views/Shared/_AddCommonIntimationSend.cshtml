
<style>
    #LeadChecklistTable thead {
        position: sticky;
        top: 0px;
    }
    .btnPerfectDelete {
        color: red;
        border: none
    }

    .DeleteRow2 {
    }

    .tableFixHead {
        overflow: auto;
        height: 500px;
    }

        .tableFixHead thead tr {
            position: sticky;
            top: 0;
            z-index: 1;
        }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        padding: 8px 16px;
    }
</style>
<div class="card ">

    <div class="card-header">
        <div class="col-xl-4">
            <h4 class="card-title col-12">@ViewBag.PageTitle</h4>
        </div>
        @*<span title="To View List" onclick="fn_showListView();"><svg id="Layer_1" class="layer text-right" stroke="currentColor" data-name="Layer 1" height="20" width="20" viewBox="0 0 122.88 122.54"><title>To View List</title><path class="viewlst" d="M4.69,0H46.22a4.71,4.71,0,0,1,4.69,4.69V46a4.69,4.69,0,0,1-4.69,4.69H4.69a4.65,4.65,0,0,1-3.31-1.38l-.09-.09A4.67,4.67,0,0,1,0,46V4.69A4.71,4.71,0,0,1,4.69,0ZM89.44,61.94a26.56,26.56,0,0,1,10.18,2l.07,0a26.61,26.61,0,0,1,15.25,32.16,26.18,26.18,0,0,1-2.7,6.11l10.3,11.24a1.27,1.27,0,0,1-.07,1.8l-7.57,6.9a1.27,1.27,0,0,1-1.79-.07l-9.86-10.85a26.36,26.36,0,0,1-6.1,2.74,26.87,26.87,0,0,1-7.71,1.13,26.51,26.51,0,0,1-10.17-2l-.07,0A26.64,26.64,0,0,1,64.85,78.37l0-.07A26.6,26.6,0,0,1,89.44,61.94Zm15,11.59a21.38,21.38,0,0,0-6.89-4.61l-.06,0a21.22,21.22,0,0,0-23.07,4.64l-.07.07a21.25,21.25,0,0,0-4.54,6.83l0,.06a21.32,21.32,0,0,0-1.58,8.06,21.26,21.26,0,0,0,29.35,19.62,21.54,21.54,0,0,0,6.89-4.61l.07-.07a21.09,21.09,0,0,0,4.54-6.83l0-.06a21.35,21.35,0,0,0,0-16.17,21.34,21.34,0,0,0-4.62-6.9ZM4.69,63.2H46.22a4.71,4.71,0,0,1,4.69,4.7v41.34a4.68,4.68,0,0,1-4.69,4.69H4.69A4.69,4.69,0,0,1,0,109.24V67.9a4.71,4.71,0,0,1,4.69-4.7ZM68.78,0h41.53A4.71,4.71,0,0,1,115,4.69V46a4.71,4.71,0,0,1-4.69,4.69H68.78A4.71,4.71,0,0,1,64.09,46V4.69a4.69,4.69,0,0,1,1.37-3.31l.1-.09A4.67,4.67,0,0,1,68.78,0Z"></path></svg></span>*@
       
        <button id="addcompany_jq_addnewuser" type="button" class="btn  btn-primary btn-sm" name="Search" perfect-css="button" onclick="fn_showFilter()" title="To Filter"><i class="fa fa-filter"></i></button>
    </div>

    <div class="card-body jq_leadgeneration_body ">
        <form id="" class="form-valide" perfect-class="form" action="#" method="post" perfect-onFormSuccess="">
            <div class="leadformSesction" id="common_intimationDiv">
                @Html.AntiForgeryToken()
                <div class="row">

                    <div class="col-sm-4">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Date</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-8">
                                <input type="date" class="form-control perfectValidate_date" name="Date" id="Pdate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" max="2050-01-01" onchange="" />



                            </div>
                        </div>
                    </div>

                    <div class="col-sm-4 ">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Module</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-8">
                                <input type="hidden" value=0 name="ID_CommonPrintingSettings">
                                <select class="form-control perfectValidate_string" name="Module" id="Module" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="onModuleChange(this)">
                                    <option value="">Please Select </option>
                                    @if (!(Model.ModulesList is null))
                                    {
                                        foreach (var i in Model.ModulesList)
                                        {
                                            <option value="@i.ID_Mode">@i.ModeName</option>
                                        }
                                    }
                                </select>

                            </div>
                        </div>
                    </div>

                    <div class="col-sm-4 ">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Branch</span>
                                <span class="text-danger">*</span>
                                <input type="hidden" name="FK_BranchMode" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                            </label>
                            <div class="col-sm-8">

                                <select class="form-control perfectValidate_string" name="Branch" id="BranchID" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="fn_ClearFilterValue(this)" id="Branch">
                                    <option value="">Please Select </option>
                                    @if (!(Model.BranchList is null))
                                    {
                                        foreach (var i in Model.BranchList)
                                        {
                                            <option value="@i.ID_Branch">@i.Name</option>
                                        }
                                    }
                                </select>

                            </div>
                        </div>
                    </div>
                    @*<div class="col-sm-4 ">
                    <div class="form-group row" perfect-class="formGroup">
                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel">Status</span>
                            <span class="text-danger">*</span>
                        </label>
                        <div class="col-sm-8">

                            <select class="form-control perfectValidate_string" name="Status" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="" id="Status">
                                <option value="">Please Select </option>
                                <option value="1">Active Customer</option>
                                <option value="2">Not Closed Customer</option>

                            </select>

                        </div>
                    </div>
                </div>*@

                    <div class="col-sm-4 ">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Channel</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-8">

                                <select class="form-control perfectValidate_string" name="Channel" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="onChannelChange(this)" id="Channel">
                                    <option value="">Please Select </option>
                                    <option value="1">SMS</option>
                                    <option value="2">Email</option>
                                    <option value="3">Whats App</option>
                                </select>

                            </div>
                        </div>
                    </div>

                    <div class="col-sm-4 ">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Scheduled Type</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-8">

                                <select class="form-control perfectValidate_string" name="SheduledType" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="onSheduleType(this)" id="SheduledType">
                                    @*<option value="">Please Select </option>*@
                                    <option value="1" default>Now</option>
                                    <option value="2">Staged</option>

                                </select>

                            </div>
                        </div>
                    </div>

                    <div class="col-sm-4" perfect-class="formGroup" id="AttendedDateDiv">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Scheduled Date</span>
                                <span class="text-danger" id="">*</span>
                            </label>
                            <div class="col-sm-8">
                                <input type="date" class="form-control " id="AttendedDate" name="AttendedDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="2000-01-01" max="2050-01-01" onchange="datecheck(this)">
                            </div>
                            @*perfectValidate_date*@

                        </div>
                    </div>
                    <div class="col-sm-4" id="AttendedTimeDiv">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Scheduled Time</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-8">
                                <input type="time" class="form-control" placeholder="" name="Time" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input">

                            </div>
                        </div>
                    </div>

                    <div class="col-sm-4" id="DLIdDiv">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">DL Id</span>
                                @*<span class="text-danger">*</span>*@
                            </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control " id="DLId" name="DLId" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="20" onkeypress="return /^[0-9a-zA-Z-]+$/i.test(event.key)" onPaste="return false" />

                            </div>
                        </div>
                    </div>

                    <div class="col-sm-4" id="SubjectDiv">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Subject</span>
                                @*<span class="text-danger">*</span>*@
                            </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control " id="Subject" name="Subject" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="200" />

                            </div>
                        </div>
                    </div>

                    @*<div class="col-sm-4">
                    <div class="form-group row" perfect-class="formGroup">

                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel">Unique Code</span>
                        </label>
                        <div class="col-sm-8">
                            <input type="checkbox" class="form-control-check-input" name="UniqueCode" value="MnuLstVisible" perfect-class="formCheckInput" perfect-ctype="checkbox" perfect-css="checkbox" style="margin-top: 11px;">
                        </div>

                    </div>
                </div>*@

                    <div class="col-sm-4">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Browse</span>
                            </label>
                            <div class="col-sm-8">

                                <input type="file" id="files" name="files" multiple="" class="form-control valid" aria-invalid="false" onchange="readURL(); validateFileSize();">
                                <span id="fileSizeError" style="color: red;" class="text-danger"></span>
                                @*<input type="file" id="files" name="files[]" multiple="" class="form-control" accept="image/*">
                                    <span style="font-size: x-small;">(Only allow .jpeg , .jpg and .png files)</span>*@
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group row" perfect-class="formGroup">  
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Message</span>
                            </label>
                            <div class="col-sm-8">
                                <textarea cols="2" class="form-control" id="messagetextArea" name="Message" maxlength="250" oninput="validateTextArea()"></textarea>
                                <span id="validationmessagetextArea" style="color: red;" class="text-danger"></span>
                            </div>
                        
                        </div>
                    </div>
                </div>



            </div>
            @*// lead Section*@<hr />
            <div class="card m-3 p-3 leadSearchDiv" id="leadSearchDiv">
                <div class="row">


                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Lead Source</label>
                            <select id="LeadFrom" class="form-control exptbttontoogle" name="ID_LeadFrom" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="clearleadfrom(this)">
                                <option value="">Please select</option>
                                @if (!(Model.LeadFromList is null))
                                {
                                    foreach (var LeadFrom in Model.LeadFromList)
                                    {
                                        <option value="@LeadFrom.ID_LeadFrom">@LeadFrom.LeadFromName</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-3 DivLeadSource">
                        <div class="form-group">
                            <label>Lead From</label>
                            <div class="input-group">
                                <input type="text" class="form-control LeadThrough exptbttontoogle" placeholder="" name="LeadThrough" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                <div class="input-group-append">
                                    <button id="addLeadBy-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetLeadTrough(this)"></button>
                                </div>
                                <input type="hidden" name="FK_LeadThrough" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>From Date</label>
                            <input type="hidden" name="LeadGenerateID" />
                            <input type="date" class="form-control exptbttontoogle" name="FromDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" />
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>To Date</label>
                            <input type="hidden" name="LeadGenerateID" />
                            <input type="date" class="form-control exptbttontoogle" name="ToDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" />
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Product Type</label>
                            <select class="form-control exptbttontoogle" name="ProdType" perfect-class="formGroupControl" onchange="GetProName(this)" perfect-ctype="select" perfect-css="select">
                                <option value="">Please Select</option>
                                <option value="1">Project</option>
                                <option value="2">Product</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Category</label>
                            <select class="form-control exptbttontoogle" name="FK_Category" perfect-class="formGroupControl" placeholder="Select Catogory" perfect-ctype="select" perfect-css="select">

                                <option value="">Please select</option>
                                @*@if (!(Model.CategoryList is null))
                                {
                                    foreach (var category in Model.CategoryList)
                                    {
                                        <option value="@category.ID_Catg">@category.CatgName</option>
                                    }
                                }*@
                            </select>
                        </div>
                    </div>



                    <div class="col-sm-3">
                        <div class="form-group " perfect-class="formGroup">
                            <label>Project/Product</label>
                            <div class="input-group">
                                <span perfect-class="formGroupLabel"></span>
                                <input type="text" class="form-control ProdNameF exptbttontoogle" name="ProdName" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" onchange="exportbuttonhide()" />
                                <input type="hidden" name="ID_Product" perfect-class="formGroupControl " perfect-ctype="hidden" perfect-css="input" />

                                <div class="input-group-append">

                                    <button id="addEmployee-jq-searchButton3" class="btn btn-primary fa fa-search " name="ProdBtn" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,100,'Product Details',[],Transmd)" Criterea1="FK_Category" Criterea2="0" BindName="ProdName" BindVal="ID_Product" Function="1"></button>
                                </div>


                            </div>

                            <div class="modal fade" perfect-class="formGroupModal">
                                <div class="modal-dialog modal-lg" role="document">
                                    <div class="modal-content  rounded-0">
                                        <div class="modal-header border-0">
                                            <h5 class="modal-title">Search modal</h5>
                                            <button type="button" class="close" data-dismiss="modal">
                                                <span>&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="col-md-12 mt-3" perfect-class="formGroupModalTable">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Assigned To</label>
                            <div class="input-group">

                                @if (!(Model.EmployeeInfoList is null))
                                {
                                    foreach (var EmployeeInfo in Model.EmployeeInfoList)
                                    {
                                        <input type="text" class="form-control perfectValidate_string_nm EmployeeF exptbttontoogle" value="@EmployeeInfo.EmpFName" placeholder="" name="Employee" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled onchange="exportbuttonhide()" />
                                    }
                                }
                                <input type="hidden" name="FK_Employee" class="exptbttontoogle" value="@Model.FK_Employee" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="FK_Emp" class="exptbttontoogle" value="@Model.FK_Employee" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="UserCode" class="exptbttontoogle" value="@Model.UserCode" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <div class="input-group-append">

                                    <button id="EmployeebuttonID" class="btn btn-primary fa fa-search exptbttontoogle" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,61,'Employee Details',[])" Criterea1="0" Criterea2="0" Criterea3="UserCode" BindName="Employee" BindVal="FK_Employee" Function="1"></button>


                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Attended By</label>
                            <div class="input-group">

                                <input type="text" class="form-control exptbttontoogle" name="Collectedby" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" placeholder="Select Collected By" disabled />
                                <input type="hidden" name="Collectedby_ID" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <div class="input-group-append">
                                    <button id="CollectedbyButtonID" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,22,'Employee List',[])" Criterea1="Branch" Criterea2="0" BindName="Collectedby" BindVal="Collectedby_ID" Function="1"></button>
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Area</label>
                            <div class="input-group">

                                <input type="text" class="form-control exptbttontoogle" name="Area" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" placeholder="Select Area" disabled />
                                <input type="hidden" name="Area_ID" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <div class="input-group-append">
                                    <button id="addproduct-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,14,'Area List',[])" Criterea1="0" Criterea2="0" BindName="Area" BindVal="Area_ID" Function="1"></button>
                                </div>


                            </div>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Follow Up Action</label>
                            <select class="form-control exptbttontoogle" id="FK_NetAction" name="FK_NetAction" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                <option value="">Please select</option>
                                @if (!(Model.NxtActionList is null))
                                {
                                    foreach (var NextAction in Model.NxtActionList)
                                    {
                                        <option value="@NextAction.ID_NextAction">@NextAction.NxtActnName</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Follow Up Type</label>
                            <select class="form-control exptbttontoogle" id="FK_ActionType" name="FK_ActionType" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                <option value="">Please select</option>
                                @if (!(Model.Actntyplists is null))
                                {
                                    foreach (var Action in Model.Actntyplists)
                                    {
                                        <option value="@Action.ID_ActionType">@Action.ActnTypeName</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Priority</label>
                            <select class="form-control exptbttontoogle" id="FK_Priority" name="FK_Priority" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                <option value="">Please select</option>
                                <option value="1">Hot</option>
                                <option value="2">Warm</option>
                                <option value="3">Cold</option>

                            </select>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>Lead Details</label>
                            <select class="form-control exptbttontoogle" id="SearchByid" name="SearchBy" onchange="fn_searchByNamePhoneLead(this)" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                <option value="">Please select</option>
                                <option value="1">Customer Name</option>
                                <option value="2">Phone Number</option>
                                <option value="3">Lead Number</option>

                            </select>
                        </div>
                    </div>

                    <div class="col-sm-3 dividsearch">
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <input type='text' class="form-control exptbttontoogle" placeholder="" name="SearchBydetails" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="25" />
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label class="">
                                @*<span perfect-class="formGroupLabel">Customer Wise lead</span>*@
                            </label>

                            <div class="input-group  mt-2">

                                <input type="hidden" class="form-control" name="CustomerLead" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" readonly />
                                <input type="hidden" name="CustomerLead_ID" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="ID_FIELD" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="FK_Customer" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="Address" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="Email" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="MobileNo" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="Customer" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="LeadNo" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="LeadDate" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <div class="input-group-append">
                                    @*<button id="addarea-jq-searchButton3" class="btn btn-primary fa fa-user" title="Customer Wise Lead" type="button" perfect-css="button" onclick="GetCmnPopUpSearchValAssign(this, 161, 'Customer Wise Lead List', [], ['ID_FIELD','FK_Customer','Address','Email','MobileNo','Customer'],Transmd)" criterea1="0" BindName="CustomerLead" BindVal="CustomerLead_ID" Function="2"></button>*@
                                    <button id="addproductstock-jq-searchButton3" class="btn btn-primary fa fa-user" title="Customer Wise Lead" type="button" perfect-css="button" onclick="SearchLeadRequest(this)"></button>


                                </div>
                            </div>
                        </div>
                    </div>


                </div>
                <div class="row">
                    <div class="col-sm-2" style="justify-content:flex-end">

                        @*<button id="addcompany-jq-addnewuser" type="button" class="btn btn-primary" name="search" perfect-css="button" onclick=" fn_search(this,2,tableoptions);"><i class="fa fa-refresh fa-spin loaderclass "></i>search</button>*@

                    </div>
                </div>
            </div>

            <!--Table Sections-->
            <div class="card m-3 p-3"></div>
                <div class="row" id="id_leadGrid" style="display:none;">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-body" style="padding: 0px">
                                <div perfect-class="ModuleContainer" id="leadtable" class="">
                                    <div class="table-responsive tableFixHead">
                                        <table class="table table-hover table-striped text-black">
                                            <thead class="thead-primary">
                                                <tr>
                                                    <th class="text-left" style="display:none">ID_FIELD</th>
                                                    <th class="text-left">Lead No</th>
                                                    <th class="text-left">Lead Date</th>
                                                    <th class="text-left" style="display:none">FK_Customer</th>
                                                    <th class="text-left">Customer</th>
                                                    <th class="text-left">Mobile</th>
                                                    <th class="text-left">Email</th>
                                                    <th class="text-left" style="display:none" >Address</th>
                                                    <th class="text-left">Action</th>

                                                </tr>
                                            </thead>
                                            <tbody id="leadTbody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="text-right col-12" perfect-class="formFooter">

                        <button id="next1" type="button" class="btn btn-primary" href="#profile" name="next1" perfect-css="button" onclick="fn_SaveIntimation(this)"><i class="fa fa-refresh fa-spin loaderClass "></i>Save</button>
                        <button type="button" class="btn btn-light" perfect-css="button" onclick="ResetButton(this)" id="reset" name="reset">Clear</button>
                    </div>

                </div>



        </form>
        @*<div id="GridDiv" style="height: 443px;overflow: auto;">

        </div>*@
        @*<div class="row">
            <div class="text-right col-12" perfect-class="formFooter">


                <button id="next1" type="button" class="btn btn-primary" href="#profile" name="next1" perfect-css="button" onclick="fn_SaveIntimation(this)"><i class="fa fa-refresh fa-spin loaderClass "></i>Save</button>
                <button type="button" class="btn btn-light" perfect-css="button" onclick="ResetButton(this)" id="reset" name="reset">Clear</button>
            </div>

        </div>*@

        @*<div id="table-container">
                <table id="FinalAccountReportList" class="table table-striped dt-responsive nowrap" style="width:100%">
                    <thead class="thead-primary">

                        <tr>
                            <th class="hrow">Sl.No</th> 
                            <th class="hrow">Priority</th>
                            <th class="hrow">Lead No</th>
                            <th class="hrow">Customer</th>
                            <th class="hrow">Product</th>
                        </tr>
                    </thead>
                    <tbody></tbody>

                </table>
            </div>*@

    </div>
</div>

<script>
    var FileUrlObj = {
        FileUrl: '',
        extension:''
    };
    $(document).ready(function () {
        $('#addcompany_jq_addnewuser').hide();
        $('.dividsearch').hide();
        $('[name="LeadThrough"]').attr('readonly', true);
        GetLeadFromdefault();
        //Admincheck();
    });
    function Admincheck() {
        if ('@ViewBag.Manager' == 'True' || '@ViewBag.Admin' == 'True') {
            $('[name="UserCode"]').val('@ViewBag.UserCode');
            $('[name="Employee"]').val('@ViewBag.Employee');
            $('[name="FK_Employee"]').val('@ViewBag.FK_Employee');
            $('[name="FK_Emp"]').val('@ViewBag.FK_Employee');

            $('[name="Collectedby"]').val('@ViewBag.Employee');
            $('[name="Collectedby_ID"]').val('@ViewBag.FK_Employee');
            $("#EmployeebuttonID").attr("disabled", false);
            $("#CollectedbyButtonID").attr("disabled", false);
        }
        else {
            $('[name="UserCode"]').val('@ViewBag.UserCode');
            $('[name="Employee"]').val('@ViewBag.Employee');
            $('[name="FK_Employee"]').val('@ViewBag.FK_Employee');
            $('[name="FK_Emp"]').val('@ViewBag.FK_Employee');

            $('[name="Collectedby"]').val('@ViewBag.Employee');
            $('[name="Collectedby_ID"]').val('@ViewBag.FK_Employee');
            $("#EmployeebuttonID").attr("disabled", "disabled");
            $("#CollectedbyButtonID").attr("disabled", "disabled");
        }
    }

    function onSheduleType(els) {

        debugger
        let $thisForm = $(els).closest('[perfect-class="form"]');
        const value = $thisForm.find('[name="SheduledType"]').val();
        $thisForm.find('[name="AttendedDate"]').val(moment().format('YYYY-MM-DD'));
        $thisForm.find('[name="Time"]').val('');


        if (value == 1) {
            $thisForm.find('#AttendedDateDiv').hide();
            $thisForm.find('#AttendedTimeDiv').hide();
            $thisForm.find('[name="AttendedDate"]').removeClass('perfectValidate_date');
            $thisForm.find('[name="Time"]').removeClass('perfectValidate_time');
        } else if (value == 2){
            $thisForm.find('#AttendedDateDiv').show();
            $thisForm.find('#AttendedTimeDiv').show();
            $thisForm.find('[name="AttendedDate"]').addClass('perfectValidate_date');
            $thisForm.find('[name="Time"]').addClass('perfectValidate_time');
        };
    }
    function ResetButton(els) {
        LoadSendIntimation();
    }
    function fn_SaveIntimation(ele) {

        debugger

        let $thisForm = $(ele).closest('[perfect-class="form"]');

        var LeadTable = $('#leadTbody tr.trvalue');
        var LeadTabDetails = [];
        var isValid = true;
        var GridData = false;

        var ID_LeadFrom, FK_LeadThrough, FromDate, ToDate, FK_Category, ProdType, ID_Product, FK_Employee, Collectedby_ID, Area_ID, FK_NetAction, FK_ActionType, FK_Priority, SearchBy, SearchBydetails;

            ID_LeadFrom = $thisForm.find('[name="ID_LeadFrom"]').val();
        FK_LeadThrough = $thisForm.find('[name="FK_LeadThrough"]').val();
            FromDate = $thisForm.find('[name="FromDate"]').val();
            ToDate = $thisForm.find('[name="ToDate"]').val();
            FK_Category = $thisForm.find('[name="FK_Category"]').val();
            ProdType = $thisForm.find('[name="ProdType"]').val();
            ID_Product = $thisForm.find('[name="ID_Product"]').val();
            FK_Employee = $thisForm.find('[name="FK_Employee"]').val();
            Collectedby_ID = $thisForm.find('[name="Collectedby_ID"]').val();
            Area_ID = $thisForm.find('[name="Area_ID"]').val();
            FK_NetAction = $thisForm.find('[name="FK_NetAction"]').val();
            FK_ActionType = $thisForm.find('[name="FK_ActionType"]').val();
            FK_Priority = $thisForm.find('[name="FK_Priority"]').val();
            SearchBy = $thisForm.find('[name="SearchBy"]').val();
            SearchBydetails = $thisForm.find('[name="SearchBydetails"]').val();

        if (LeadTable.length > 0) {
            ID_LeadFrom = 0 , FK_LeadThrough = 0, FromDate = "", ToDate = "", FK_Category = 0, ProdType = 0 , ID_Product = 0, FK_Employee = 0, Collectedby_ID = 0, Area_ID = 0 , FK_NetAction = 0, FK_ActionType = 0, FK_Priority = 0, SearchBy = "", SearchBydetails=""
            LeadTable.each(function () {
                var ArrItem = {

                    FK_Lead: $(this).find('.FK_Lead').text(),
                    LeadNo: $(this).find('.LeadNo').text(),
                    FK_Customer: $(this).find('.FK_Customer').text(),
                    Mobile: $(this).find('.Mobile').text(),
                    Email: $(this).find('.Email').text(),
                    Address: $(this).find('.Address').text(),
                    LeadDate: $(this).find('.LeadDate').text()

                };
                LeadTabDetails.push(ArrItem);
            });
            GridData = true;
        }


        if ($thisForm.valid() && CustomeValidation(ele) && fileValid) {
            console.log(FileUrlObj,'FileUrlObj>><<<??')
            //var checklist =[]
            //selectedData.forEach((i) => {
            //    checklist.push(i.ID_LeadGenerate);
            //})
            var inputData = {//<---- Input Json : this is the variable we pass to controller
                __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                Date: $thisForm.find('[name=Date]').val(),
                SheduledDate: $thisForm.find('[name=AttendedDate]').val(),
                SheduledTime: $thisForm.find('[name=Time]').val(),
                Module: $thisForm.find('[name=Module]').val(),
                Branch: $thisForm.find('[name=Branch]').val(),
                Channel: $thisForm.find('[name=Channel]').val(),
                SheduledType: $thisForm.find('[name=SheduledType]').val(),
                DLId: $thisForm.find('[name=DLId]').val().trim(),
                Subject: $thisForm.find('[name=Subject]').val().trim(),
                //UniqueCode: $thisForm.find('[name=UniqueCode]').prop('checked'),
                Message: $thisForm.find('[name=Message]').val().trim(),
                FileUrlObj: FileUrlObj,

                ID_LeadFrom, FK_LeadThrough, FromDate, ToDate, FK_Category, ProdType, ID_Product, FK_Employee, Collectedby_ID, Area_ID, FK_NetAction, FK_ActionType, FK_Priority, SearchBy, SearchBydetails,
                LeadDetails: LeadTabDetails,
                GridData: GridData == true ? 1:0
               // Checklist: checklist
            };
            @*var endpoint = "";
            if ($('#Module').val() == 2) {
                  endpoint = "@Url.Action("SaveIntimationLaed", "CommonIntimationSend")";
            } else {*@
                 endpoint = "@Url.Action("SaveIntimation", "CommonIntimationSend")";
           // }



            $.ajax({
                url: endpoint,
                type: "POST",
                data: inputData,//<---- Input json : data passed to controller
                dataType: "json",
                contentType: 'application/x-www-form-urlencoded;charset=utf-8',
                success: function (ajaxOutput) {//<----- if ajax method executed succesfully,  we get the data passed from controller in this variable  => success: function (variable) {
                    debugger
                    if (ajaxOutput.IsProcess) {
                        console.log(ajaxOutput, '---<<<ajaxOutput>>>---');
                        $.each(ajaxOutput.Message, function (key, value) {

                            NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': 'Success' });
                        });
                        //$thisForm.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
                        //$thisForm.find('[perfect-ctype="input"]').val('');
                        //$thisForm.find('[perfect-ctype="digit"]').val('');
                        //let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                        //if (onSuccess) {
                        //    window[onSuccess]($thisForm);
                        //}

                        LoadSendIntimation();
                       // console.log('> Add new Company success data', ajaxOutput);
                    }
                    else {
                        $.each(ajaxOutput.Message, function (key, value) {
                            //toastr.warning(value, "Error");
                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                        });
                    }
                },
                complete: function () {
                    $(ele).prop('disabled', false);
                }

            });

        }




    }
    function readURL() {

            console.log("File selected!");
            debugger
            var file = document.getElementById("files").files[0];

        var extension = file.name.split('.').pop();
            var reader = new FileReader();
            reader.onloadend = function () {

                FileUrlObj['FileUrl']= reader.result;
                FileUrlObj['extension'] = extension;
                console.log(FileUrlObj, '<<<<<FileUrlObj');
        };
        if (file) {
            reader.readAsDataURL(file);  // Start reading the file content
        }

    };
    function CustomeValidation(ele) {
        debugger
        var $Valid = true;
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        //if ($thisForm.find('[name=AttendedDate]').val() == 2) {
        //    if ($thisForm.find('[name=Time]').val() == '' || $thisForm.find('[name=AttendedDate]').val() == '') {
        //        $Valid = false;
        //    }
        //} else
            if ($thisForm.find('[name=Message]').val().trim() == "" && FileUrlObj.FileUrl == "") {
                $Valid = false;
                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message':'Please enter a message or select a file.'});
             };

        return $Valid;
    }
    function onChannelChange(e) {
        debugger
        let $thisForm = $(e).closest('[perfect-class="form"]');
        var SelectedVal = $thisForm.find('[name="Channel"]').val();
        if (SelectedVal == "1") {

            $('#DLIdDiv').show();
            $('#SubjectDiv').hide();
        } else if (SelectedVal == "2") {

            $('#DLIdDiv').hide();
            $('#SubjectDiv').show();
        } else if (SelectedVal == "3") {

            $('#DLIdDiv').hide();
            $('#SubjectDiv').hide();
        }
    }

    function onModuleChange(els) {
        var form = $(els).closest('[perfect-class="form"]');
        var ModuleVal = form.find('[name="Module"]').val();
        $('#common_intimationDiv').show();
        $("#GridDiv").html("");

        var ModuleVal = form.find('[name="Module"]').val();
        if (ModuleVal == 2) {
            //$('#common_intimationDiv').hide();
            $('#addcompany_jq_addnewuser').show();
        } else {

            $('#leadSearchDiv').hide();
            $('#addcompany_jq_addnewuser').hide();
        }
        fn_ClearFilterValue(els);

       
    }

    function fn_showFilter() {
        var form = $('[perfect-class="form"]');
        var ModuleVal = form.find('[name="Module"]').val();

        form.closest('.jq_leadgeneration_body').find('.leadSearchDiv').toggle();
        Admincheck();
        // If you want to check the ModuleVal and show/hide accordingly:
        // if (ModuleVal == 2) {
        //     form.closest('.jq_leadgeneration_body').find('.leadSearchDiv').toggle();
        // } else {
        //     $('#leadSearchDiv').hide();
        // }
    }


    function clearleadfrom(ele) {

        let $container = $(ele).closest('[perfect-class="form"]');
        $container.find('[name=FK_LeadThrough]').val(0);
        $container.find('[name=LeadThrough]').val('');
        let selectedID = parseInt($container.find('[name=ID_LeadFrom]').val());
        switch (selectedID) {
            case 10:
            case 11:
                $('.DivLeadSource').hide();
                $container.find('[name="LeadThrough"]').attr('readonly', false);
                break;
            default:
                $('.DivLeadSource').show();
                $container.find('[name="LeadThrough"]').attr('readonly', true);
                break;
        }
    }

    function fn_searchByNamePhoneLead(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $thisForm.find('[name="SearchBydetails"]').val('');

        let selectedValue = $thisForm.find('[name=SearchBy] option:selected').val();

        if (parseInt(selectedValue) > 0) {
            $('.dividsearch').show();
            switch (parseInt(selectedValue)) {
                case 1:
                case 3:
                    $thisForm.find('[name="SearchBydetails"]').attr("type", "text");
                    break;
                case 2:
                    $thisForm.find('[name="SearchBydetails"]').attr("type", "number");
                    $thisForm.find('[name="SearchBydetails"]').attr("min", "0");
                    break;
                default:
                    $thisForm.find('[name="SearchBydetails"]').attr("type", "text");
                    break;
            }
        }
        else {
            $('.dividsearch').hide();
        }

    }


    @*function fn_LeadSearchbyfilter(ele) {
        debugger
        //$('#Todolist').addClass('active');
        //$('#Todolist').parent().children('li').not(this).removeClass('active');
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $thisForm.find('[name=home]').empty();
        $thisForm.find('[name=profile]').empty();
        $thisForm.find('[name=contact]').empty();
        $thisForm.find('[name=myleads]').empty();
        $thisForm.find('[name=leadRequest]').empty();

        $(".nav-link").removeClass("active"); $('#Todolist').addClass('active');



        let fkProd = 0; let projname = '';

        if ($thisForm.find('[name=ID_Product]').val() > 0) {
            fkProd = $thisForm.find('[name=ID_Product]').val();
            projname = '';
        }
        else {
            projname = $thisForm.find('[name=ProdName]').val().trim();
            fkProd = 0;
        }
        debugger
        let inputData = {//<---- Input Json : this is the variable we pass to controller
            __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
            'FK_LeadFrom': $thisForm.find('[name=ID_LeadFrom]').val().trim(),
            'FK_LeadBy': $thisForm.find('[name=FK_LeadThrough]').val().trim(),
              'FromDate': $thisForm.find('[name=FromDate]').val().trim(),
            'ToDate': $thisForm.find('[name=ToDate]').val(),
            'FK_Product': fkProd,
            'ProjectName': projname,
            'Status': $thisForm.find('[name=Status]').val(),
            'FK_Employee': $thisForm.find('[name=FK_Employee]').val(),
            'FK_Category': $thisForm.find('[name=FK_Category]').val(),
            'Collectedby_ID': $thisForm.find('[name=Collectedby_ID]').val(),
            'Area_ID': $thisForm.find('[name=Area_ID]').val(),
            'FK_NetAction': $thisForm.find('[name=FK_NetAction]').val(),
            'FK_ActionType': $thisForm.find('[name=FK_ActionType]').val(),
            'FK_Priority': $thisForm.find('[name=FK_Priority]').val(),
            'Filterid': 0,
            'SearchBy': $thisForm.find('[name=SearchBy]').val(),
            'SearchBydetails': $thisForm.find('[name=SearchBydetails]').val()

        };

        $.ajax({
                url: "@Url.Action("GetLeadGenList", "LeadManagement")",
              type: "POST",
              data: inputData,//<---- Input json : data passed to controller
                dataType: "json",
              contentType: "application/x-www-form-urlencoded;charset=utf-8",
                success: function (ajaxOutput) {
                    if (ajaxOutput.Process.IsProcess && ajaxOutput.Data[0].Masterid >0) {
                        $('#todobadge').html("" + ajaxOutput.Data[0].Value + "");
                        $('#overduebadge').html("" + ajaxOutput.Data[1].Value + "");
                        $('#tasksbadge').html("" + ajaxOutput.Data[2].Value + "");
                        $('#myleadsbadge').html("" + ajaxOutput.Data[3].Value + "");
                        $('#leadRequestbadge').html("" + ajaxOutput.Data[4].Value + "");
                        $('#Todolist')[0].click();
                        $('html,body').animate({ scrollTop: $($thisForm.closest('.jq_leadgeneration_body').find('.SearchLoadDiv')).offset().top }, 1000);
                        tempEmployee = $thisForm.find('[name=FK_Employee]').val();
                        $thisForm.find('[name=LastID]').val(ajaxOutput.Data[0].LastID);

                    }
                },
                complete: function () {

                }
            });


    }
    tempEmployee = '';
    function fn_search (ele, MasterID, Tableoption) {
 
        $('#common_intimationDiv').show();
 
        let $thisForm = $(ele).closest('[perfect-class="form"]');


        if (tempEmployee.length > 0) {
            $thisForm.find('[name=FK_Employee]').val(tempEmployee)
        }
 
        let fkProd = 0; let projname = '';

        if ($thisForm.find('[name=ID_Product]').val() > 0) {
            fkProd = $thisForm.find('[name=ID_Product]').val();
            projname = '';
        }
        else {
            projname = $thisForm.find('[name=ProdName]').val();
            fkProd = 0;
        }

         
      $('#GridDiv').empty();
 


        let inputData = {
            "TransMode": Transmd,
            'FK_LeadFrom': $thisForm.find('[name=ID_LeadFrom]').val(),
            'FK_LeadBy': $thisForm.find('[name=FK_LeadThrough]').val(),
            'FromDate': $thisForm.find('[name=FromDate]').val(),
            'ToDate': $thisForm.find('[name=ToDate]').val(),
            'FK_Product': fkProd,
            'ProjectName': projname,
            'Status': $thisForm.find('[name=Status]').val(),
            'FK_Employee': $thisForm.find('[name=FK_Employee]').val(),
            'FK_Category': $thisForm.find('[name=FK_Category]').val(),
            'Collectedby_ID': $thisForm.find('[name=Collectedby_ID]').val(),
            'Area_ID': $thisForm.find('[name=Area_ID]').val(),
            'FK_NetAction': $thisForm.find('[name=FK_NetAction]').val(),
            'FK_ActionType': $thisForm.find('[name=FK_ActionType]').val(),
            'FK_Priority': $thisForm.find('[name=FK_Priority]').val(),
            'Filterid': MasterID,
            'SearchBy': $thisForm.find('[name=SearchBy]').val(),
            'SearchBydetails': $thisForm.find('[name=SearchBydetails]').val(),
            'PageSize': 10,
            'PageIndex': 0,
            'ActionType': $thisForm.find('[name=Module]').val(),
        };

        var html = "";
         let pageUrl = '@Url.Action("SelectIntimationSearchSelect", "CommonIntimationSend")';
          $.ajax({
                url: pageUrl,
              type: "POST",
              data: inputData,
                dataType: "json",
              contentType: "application/x-www-form-urlencoded;charset=utf-8",
              success: function (ajaxOutput) {
                  console.log(ajaxOutput, "--ajaxOutput--")
                  if (ajaxOutput.Data != null) {
                      html = '<table id="LeadChecklistTable" class="table mb-0 table-hover table-striped text-black"><thead class="thead-primary"><tr><th class="py-2 pf_tableHeadMaxW">SlNo</th><th class="py-2 pf_tableHeadMaxW">Name</th><th class="py-2 pf_tableHeadMaxW">Mobile</th><th class="py-2 pf_tableHeadMaxW">Item</th><th class="py-2 pf_tableHeadMaxW">Area</th><th class="py-2 pf_tableHeadMaxW">Address</th><th class="py-2 pf_tableHeadMaxW">Email</th><th class="py-2 pf_tableHeadMaxW"><input type="checkbox"></th></tr></thead><tbody>';  

                      if (ajaxOutput.Data.length > 0) {
                          Data = ajaxOutput.Data;

                          var htmlbody = "";
                          $(Data).each(function (i, val) {
                              htmlbody += '<tr><td>' + (i + 1) + '</td><td>' + val.Name + '</td><td>' + val.Mobile + '</td><td>' + val.Item + '</td><td>' + val.Area + '</td><td>' + val.Address + '</td><td>' + val.Email +'</td><td><input type="checkbox" data-id="1"></td>';
                          })
                          html = html + htmlbody + '</tbody>';
                          $("#GridDiv").html(html);
                      }
                      else {
                          html = html + '<tr><td colspan="7">No Records found!!</td>' + '</tbody>';
                          $("#GridDiv").html(html);
                      }
                  }
                  
                  //ShowAssigne(this);

                },
                complete: function () {

                }
            });

    }*@

    @*function returnajaxPagination(ajaxInfo, tableOptions, tableid, title) {
        debugger
        console.log(ajaxInfo, "--ajaxInfo--", title)

        return {
            url: ajaxInfo.apiurl,
            type: "post",
            data: function () {
                var info = tableid.DataTable().page.info();

                let input = {
                    PageSize: info.length,
                    PageIndex: info.page,
                    FK_LeadFrom: ajaxInfo.FK_LeadFrom,
                    FK_LeadBy: ajaxInfo.FK_LeadBy,
                    FromDate: ajaxInfo.FromDate,
                    ToDate: ajaxInfo.ToDate,
                    FK_Product: ajaxInfo.FK_Product,
                    ProjectName: ajaxInfo.ProjectName,
                    Status: ajaxInfo.Status,
                    FK_Employee: ajaxInfo.FK_Employee,
                    FK_Category: ajaxInfo.FK_Category,
                    Collectedby_ID: ajaxInfo.Collectedby_ID,
                    Area_ID: ajaxInfo.Area_ID,
                    FK_NetAction: ajaxInfo.FK_NetAction,
                    FK_ActionType: ajaxInfo.FK_ActionType,
                    FK_Priority: ajaxInfo.FK_Priority,
                    Filterid: ajaxInfo.Filterid

                };

                return input
            },
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            success: function (dtajaxOutput) {
                console.log(dtajaxOutput, "--dtajaxOutput--");
                //if (dtajaxOutput.Process.IsProcess) {
                // if (dtajaxOutput.Data.length>0) { }
                //LeadType = title;
                Data = dtajaxOutput.Data;
                console.log(Data, "--maindata--inside  assign ");
                //};

                let table = tableid.DataTable();
                table.destroy();
                //pft_table_newTableBody(tableid, dtajaxOutput.Data, tableOptions);
                createDynamicTable(ajaxOutput.Data, tableOptionsIP);
                tableid.dataTable({
                    "serverSide": true,
                    "processing": true,
                    "lengthMenu": [
                        [10, 15, 20, 25, 50, 100, dtajaxOutput.totalrecord],
                        ["10", "15", "20", "25", "50", "100", "All"]
                    ],
                    "searching": false,
                    "ordering": false,
                    "deferLoading": dtajaxOutput.totalrecord,
                    "displayStart": dtajaxOutput.PageIndex * dtajaxOutput.PageSize,
                    "pageLength": dtajaxOutput.PageSize,
                    "recordsFiltered": dtajaxOutput.PageSize,
                    "ajax": returnajaxPagination(ajaxInfo, tableOptions, tableid, title)
                })
                fn_setExportTableHead(tableid, title, [0, 2, 3, 4, 5, 6, 7, 8, 9])
            },

        }
    }

    var tableOptionsIP = {

        onlyShowColumn: ['SlNo', 'LeadNo', 'ProdName', 'Preference'],
        hideColumn: ['ID_LeadGenerate'],
        serialNo: false,
        renameHeader: {
            "SlNo": "Sl No", "ProdName": "Product", "Preference": "Priority"}



    };*@

    function GetLeadTrough(ele) {
         let $thisForm = $(ele).closest('[perfect-class="form"]');
         let ID_LeadFrom = {
             __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
             ID_LeadFrom: $thisForm.find('[name="ID_LeadFrom"]').val()
         };
                $.ajax({
                 url: '@Url.Action("GetLeadFromList", "LeadManagement")',
                type: "POST",
                  data: ID_LeadFrom ,
                  dataType: "json",
                    contentType: "application/x-www-form-urlencoded;charset=utf-8",
                    success: function (ajaxOutput) {//<----- if ajax method executed succesfully,  we get the data passed from controller in this variable  => success: function (variable) {
                        console.log("Data--", ajaxOutput);
                        //var Mydata = JSON.parse(ajaxOutput.Data);
                        let table = JSON.parse(ajaxOutput.Data);
                        if (ajaxOutput.Process.IsProcess) {
                            var stateModel = createSelectList({ data: table.dtable, hideColumn: ['ID_FIELD', 'HasSub'], headingText: 'Lead Through Search' });

                            stateModel.then(function (ret) {
                                if (ret) {
                                    console.log('>_ Search button > list click', ret);
                                    $thisForm.find('[name=FK_LeadThrough]').val(ret.ID_FIELD);
                                    $thisForm.find('[name=LeadThrough]').val(ret.Name);
                                }
                                else {
                                    console.log(ret);
                                }
                            });


                        }
                        else {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                            });
                        }





                },


            });
    }


    function GetProName(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $thisForm.find('[name="ID_Product"]').val(0);
        $thisForm.find('[name="ProdName"]').val('');
        let name = $thisForm.find('[name="ProdType"] option:selected').text();

        if (name != 'Please select') {
            $thisForm.find('[name="lblProName"]').text(name + ' Name')
            if (name == 'Project') {
                $thisForm.find('[name="ProdBtn"]').hide();

            }
            else {
                $thisForm.find('[name="ProdBtn"]').show();

            }

        }
        GetCategoryList(ele);
    }

    function SearchLeadRequest() {

        let $thisForm = $('[perfect-class="form"]');

        var ID_LeadFrom, FK_LeadThrough, FromDate, ToDate, FK_Category, ProdType, ID_Product, FK_Employee, Collectedby_ID, Area_ID, FK_NetAction, FK_ActionType, FK_Priority, SearchBy, SearchBydetails, ProdName;

        ID_LeadFrom = $thisForm.find('[name="ID_LeadFrom"]').val();
        FK_LeadThrough = $thisForm.find('[name="FK_LeadThrough"]').val();
        FromDate = $thisForm.find('[name="FromDate"]').val();
        ToDate = $thisForm.find('[name="ToDate"]').val();
        FK_Category = $thisForm.find('[name="FK_Category"]').val();
        ProdType = $thisForm.find('[name="ProdType"]').val();
        ID_Product = $thisForm.find('[name="ID_Product"]').val();
        FK_Employee = $thisForm.find('[name="FK_Employee"]').val();
        Collectedby_ID = $thisForm.find('[name="Collectedby_ID"]').val();
        Area_ID = $thisForm.find('[name="Area_ID"]').val();
        FK_NetAction = $thisForm.find('[name="FK_NetAction"]').val();
        FK_ActionType = $thisForm.find('[name="FK_ActionType"]').val();
        FK_Priority = $thisForm.find('[name="FK_Priority"]').val();
        SearchBy = $thisForm.find('[name="SearchBy"]').val();
        SearchBydetails = $thisForm.find('[name="SearchBydetails"]').val();
       //ProdName = ID_Product > 0 ? $thisForm.find('[name="ProdName"]').val("") : $thisForm.find('[name="ProdName"]').val();
        ProdName = ID_Product > 0 ? "" : $thisForm.find('[name="ProdName"]').val();
        FK_BranchCodeUser = $thisForm.find('[name="Branch"]').val();



        var obj = {
            ID_LeadFrom, FK_LeadThrough, FromDate, ToDate,
            FK_Category, ProdType, ID_Product, FK_Employee,
            Collectedby_ID, Area_ID, FK_NetAction, FK_ActionType,
            FK_Priority, SearchBy, SearchBydetails, ProdName,
            TransMode: Transmd,
            FK_BranchCodeUser


        }
           $.ajax({
                    url:'@Url.Action("GetRequestLeadSearch", "CommonIntimationSend")',
               type: "Get",
               data: obj,
               dataType: "json",

                    contentType: "application/json",
               success: function (successData) {
                        
                   if (successData.Process.IsProcess) {
                       
                       if (successData.searchInfo.Data.length> 0) {
                                var sss = createSelectList({
                                    data: successData.searchInfo.Data,
                                    hideColumn: ['ID_FIELD', 'ID_Name', 'FK_Customer', 'MobileNo', 'Customer', 'TotalCount','Address'],
                                    headingText: 'Customer Wise Lead',
                                    isDateType: [],
                                    renameHeader: { "LeadNo": "Lead No", "LeadDate": "Lead Date", "CustomerName": "Customer Name", "Mobile": "Mobile","Email":"Email" },
                                });

                               
                                sss.then(function (ret) {
                                    
                                    if (ret) {

                                        $thisForm.find('[name=ID_FIELD]').val(ret.ID_FIELD);
                                        $thisForm.find('[name=LeadNo]').val(ret.LeadNo);
                                   

                                        $thisForm.find('[name=LeadDate]').val(moment(ret.LeadDate).format('YYYY-MM-DD'));
                                        $thisForm.find('[name=FK_Customer]').val(ret.FK_Customer);
                                        $thisForm.find('[name=Customer]').val(ret.Customer);
                                        $thisForm.find('[name=MobileNo]').val(ret.Mobile);
                                        $thisForm.find('[name=Email]').val(ret.Email);
                                        $thisForm.find('[name=Address]').val(ret.Address);

                                        //$('#branchid').prop('disabled', true);
                                        //$thisForm.find('[name=BranchIDTo]').val(ret.BranchIDTo).selectpicker('refresh');
                                        //$('#branchidto').prop('disabled', true);
                                        //$thisForm.find('[name=DepartmentID]').val(ret.DepartmentID).selectpicker('refresh');
                                        //$('#departmentid').prop('disabled', true);
                                        //$thisForm.find('[name=DepartmentIDTo]').val(ret.DepartmentIDTo).selectpicker('refresh');
                                        //$('#departmentidto').prop('disabled', true);
                                        //$thisForm.find('[name=EmployeeID]').val(ret.EmployeeID);
                                        //$('#employeefromid').prop('disabled', true);
                                        //$thisForm.find('[name=EmployeeName]').val(ret.EmployeeName);
                                        //$thisForm.find('[name=Employee]').val(ret.Employee);
                                        //$thisForm.find('[name=EmployeeIDTo]').val(ret.EmployeeIDTo);
                                        //$('#addemployeestockto-jq-searchButton3').prop('disabled', true);
                                        //$thisForm.find('[name=EmployeeNameTo]').val(ret.EmployeeNameTo);

                                        fn_getLeadCustomerData(ret.ID_FIELD, this);
                                    }
                                });
                            }
                        }
                        else {
                            $.each(successData.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': 'No Records Found' });
                            });
                        }

                    },
                    complete: function () {
                    }
                });

    }

    function fn_getLeadCustomerData(ret,data) {
        debugger
        let $thisForm = $('[perfect-class="form"]');
        let $LeadVal = $('[name="ID_FIELD"]').val();
        let $LeadNo = $('[name="LeadNo"]').val();
        let $Id_Field = $thisForm.find('[name="ID_FIELD"]').val();
        let $LeadMobile = $thisForm.find('[name="MobileNo"]').val();
        let $LeadEmail = $thisForm.find('[name="Email"]').val();
        let $LeadeCustomer = $thisForm.find('[name="FK_Customer"]').val();
        let $LeadeAddress = $thisForm.find('[name="Address"]').val();
        let $Customer = $thisForm.find('[name="Customer"]').val();
        let $LeadDate = $thisForm.find('[name=LeadDate]').val();


        if ($Id_Field) {

            var ProAl;
            var isValid = true;
            const Arr = [];
            $('#leadTbody tr').each(function () {
                ProAl = $(this).find('.FK_Lead').text();
                leadNo = $(this).find('.LeadNo').text();
                //CUs = $(this).find('.FK_Customer').text();
                //CuNum = $(this).find('.Mobile').text();
                Arr.push(ProAl, leadNo);
            });

            if (Arr.includes($LeadVal || $LeadNo)) {
                isValid = false;

            }

            if (isValid) {

                var itdata = {
                    LeadId: $Id_Field,
                    LeadNo: $LeadNo,
                    Mobile: $LeadMobile,
                    Email: $LeadEmail,
                    FK_Customer: $LeadeCustomer,
                    Address: $LeadeAddress,
                    Customer: $Customer,
                    LeadDate: $LeadDate
                }
                FillGridItem(itdata)
                   
            }
            else {
                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': 'Already Exist' });
            }

        }
    }

    function FillGridItem(data) {

        let $thisForm = $('[perfect-class="form"]');
        if (data) {
            document.getElementById('id_leadGrid').style.display = 'block';

            let $tbody = $thisForm.find('[perfect-class="ModuleContainer"]').find('tbody');
            let rowCount;   //= (i + 1);
            let $row = $('<tr/>', { id: rowCount, class: "trvalue" });

            $row.append($('<td>', { class: "FK_Lead", style: "display:none" }).text(data.LeadId))
                .append($('<td>', { class: "LeadNo" }).text(data.LeadNo))
                .append($('<td>', { class: "LeadDate" }).text(data.LeadDate))
                .append($('<td>', { class: "FK_Customer", style:"display:none" }).text(data.FK_Customer))
                .append($('<td>', { class: "Customer" }).text(data.Customer))
                .append($('<td>', { class: "Mobile" }).text(data.Mobile))
                .append($('<td>', { class: "Email" }).text(data.Email))
                .append($('<td>', { class: "Address", style: "display:none"  }).text(data.Address))
                .append($('<td>', { class: "DeleteRow" }).html(
                    $('<button/>', {
                        type: 'button',
                        class: 'fa fa-trash btnPerfectDelete',
                        text: ''
                    }).on('click', function () {
                        $(this).closest('tr').remove();
                        if ($('#leadTbody tr').length == 0) {
                            document.getElementById('id_leadGrid').style.display = 'none';
                        }
                    })
                ));
            $tbody.append($row);
            $thisForm.find('[name="CustomerLead"]').val('');
            $thisForm.find('[name="CustomerLead_ID"]').val(0);

        }
    }

    function fn_ClearFilterValue(ele) {
        let $thisForm = $('[perfect-class="form"]');
        $thisForm.find('[name="ID_LeadFrom"]').val(0);
        $thisForm.find('[name="ID_LeadFrom"]').val("");
        $thisForm.find('[name="LeadThrough"]').val("");
        $thisForm.find('[name="FK_LeadThrough"]').val(0);

        $thisForm.find('[name="FromDate"]').val('');
        $thisForm.find('[name="ToDate"]').val('');
        $thisForm.find('[name="FK_Category"]').val(0);
        $thisForm.find('[name="FK_Category"]').val("");
        $thisForm.find('[name="ProdType"]').val(0);
        $thisForm.find('[name="ProdType"]').val("");
        $thisForm.find('[name="ID_Product"]').val(0);
        //let emp2 = $thisForm.find('[name="FK_Emp"]').val();
        $thisForm.find('[name="Employee"]').val("");
        $thisForm.find('[name="FK_Employee"]').val(0);
        $thisForm.find('[name="Collectedby_ID"]').val(0);
        $thisForm.find('[name="Collectedby"]').val("");
        $thisForm.find('[name="Area_ID"]').val(0);
        $thisForm.find('[name="Area"]').val("");
        $thisForm.find('[name="FK_NetAction"]').val("");
        $thisForm.find('[name="FK_ActionType"]').val("");
        $thisForm.find('[name="FK_Priority"]').val("");
        $thisForm.find('[name="SearchBy"]').val("");
        $thisForm.find('[name="SearchBydetails"]').val('');
        $thisForm.find('[name="ProdName"]').val("");

        let emp = $thisForm.find('[name="UserCode"]').val();

        $("#leadTbody tr").remove();
        document.getElementById('id_leadGrid').style.display = 'none';


    }

    function getfunction(ele) {

    }

    @*//function createDynamicTable(data, header) {
    //    debugger;
    //    // Create a table element
    //     var table = document.createElement('table');

    //    table.id = 'LeadChecklistTable'; // Assign an ID to the table

    //     table.classList.add('table', 'mb-0', 'table-hover', 'table-striped', 'text-black');

    //     // Create table header
    //     var thead = document.createElement('thead');
    //     thead.classList.add('thead-primary');

    //    var headerRow = document.createElement('tr');



    //    // Add other header columns
    //    for (var i = 0; i < header.onlyShowColumn.length; i++) {
    //        var th = document.createElement('th');
    //        th.classList.add('py-2', 'pf_tableHeadMaxW');
    //        th.textContent = header.onlyShowColumn[i];
    //        headerRow.appendChild(th);
    //    };
    //    if (header.hideColumn.length > 0) {
    //        for (var i = 0; i < header.hideColumn.length; i++) {
    //            var th = document.createElement('th');
    //            th.classList.add('d-none');
    //            th.textContent = header.hideColumn[i];
    //            headerRow.appendChild(th);
    //        }
    //    };

    //    // Add checkboxes column to the header
    //    var checkboxHeader = document.createElement('th');
    //    checkboxHeader.classList.add('py-2', 'pf_tableHeadMaxW');
    //    var checkbox = document.createElement('input');
    //    checkbox.type = 'checkbox';
    //    checkbox.addEventListener('change', function () {
    //        // Handle header checkbox change
    //        handleHeaderCheckboxChange(this, data);
    //    });
    //    checkboxHeader.appendChild(checkbox);
    //    headerRow.appendChild(checkboxHeader);

    //    thead.appendChild(headerRow);
    //    table.appendChild(thead);

    //    // Create table body
    //    var tbody = document.createElement('tbody');

    //    // Add rows to the table
    //    for (var i = 0; i < data.length; i++) {
    //        var row = document.createElement('tr');
    //        //debugger


    //        // Add other data columns based on header
    //        for (var j = 0; j < header.onlyShowColumn.length; j++) {
    //            var td = document.createElement('td');
    //            //td.textContent = data[i][header[j].toLowerCase()];

    //            td.textContent = data[i][header.onlyShowColumn[j]];
    //            row.appendChild(td);
    //        }
    //        for (var k = 0; k < header.hideColumn.length; k++) {
    //            var td = document.createElement('td');
    //            td.classList.add('d-none');


    //            td.textContent = data[i][header.hideColumn[k]];
    //            row.appendChild(td);
    //        }
    //        // Add checkboxes column to each row
    //        var checkboxCell = document.createElement('td');
    //        var checkbox = document.createElement('input');
    //        checkbox.type = 'checkbox';
    //        checkbox.dataset.id = data[i].SlNo;
    //        checkbox.addEventListener('change', function () {
    //            // Handle row checkbox change
    //            handleRowCheckboxChange(this, data);
    //        });
    //        checkboxCell.appendChild(checkbox);
    //        row.appendChild(checkboxCell);


    //        tbody.appendChild(row);
    //    }

    //    table.appendChild(tbody);

    //    var tableContainer= document.getElementById('GridDiv');
    //    // Append the table to the document
    //     tableContainer.appendChild(table);

    //    // Initialize DataTable
    //    $(document).ready(function() {
    //        $('#example').DataTable();
    //    });
    //}

    //function handleHeaderCheckboxChange(headerCheckbox, data) {
    //    selectedData = [];
    //    var rowCheckboxes = document.querySelectorAll('tbody input[type="checkbox"]');
    //    rowCheckboxes.forEach(function (checkbox) {
    //        checkbox.checked = headerCheckbox.checked;
    //        handleRowCheckboxChange(checkbox, data);
    //    });
    //}

    //    function handleRowCheckboxChange(rowCheckbox, data) {
    //        debugger
    //        var dataId = rowCheckbox.dataset.SlNo;
    //;

    //        if (rowCheckbox.checked) {
    //            var selectedDataItem = data.find(item => item.id === dataId);
    //            if (selectedDataItem) {
    //                selectedData.push(selectedDataItem);
    //            }
    //        } else {
    //            var index = selectedData.findIndex(item => item.id === dataId);
    //            if (index !== -1) {
    //                selectedData.splice(index, 1);
    //            }
    //        }

    //        console.log('Selected Data:', selectedData);
    //    }



    //    var selectedData = [];

    //createDynamicTable(tableData, tableOptionsIP);*@

    function validateTextArea() {
        debugger
        var textArea = document.getElementById('messagetextArea');
        var validationMessage = document.getElementById('validationmessagetextArea');

        if (textArea.value.length > 250) {
            validationMessage.textContent = 'Character limit exceeded. Maximum 250 characters allowed.';
        } else {
            validationMessage.textContent = '';
        }
    };

    var fileValid = true;
    function validateFileSize() {

        var fileInput = document.getElementById('files');
        var fileSize = fileInput.files[0].size; // in bytes
        var maxSizeInBytes = 2* 1024 * 1024; // 1 MB (adjust the value as needed)
        var fileSizeError = document.getElementById('fileSizeError');
        if (fileSize > maxSizeInBytes) {
            fileSizeError.innerText = 'File size exceeds the maximum allowed size (2 MB).';
            // Optionally, you can clear the file input to prevent submission
            fileValid = false;
            fileInput.value = '';
        } else {
            fileSizeError.innerText = '';
            fileValid = true;
        }
    }
    
    function GetCategoryList(ele/*,CategoryID,Bomval*/) {
        debugger
        let inputdata = 0;
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let ProductProject= $thisForm.find('[name="ProdType"]').val();
        let ProdType = 0;
        if (ProductProject == 1) {
            ProdType = 1;
        }
        else {
            ProdType = 0;
        }
        inputdata = {
            ProdType: ProdType,
        }

        $.ajax({
            url: '@Url.Action("GetCategoryList", "LeadManagement")',
            type: "POST",
            data: inputdata,//<---- Input json : data passed to controller
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded;charset=utf-8',
            success: function (ajaxOutput) {


                let $menuDropdown = $thisForm.find('[name=FK_Category]');//<--- Will give place select html element

                $menuDropdown.empty().selectpicker('refresh');
                $menuDropdown.append($('<option/>', { "value": "" }).text("Please Select")).selectpicker('refresh')
                if (ajaxOutput.Process.IsProcess) {

                    $.each(ajaxOutput.Data, function (key, value) {
                        $menuDropdown.append($('<option/>', { "value": value.ID_Catg }).text(value.CatgName)).selectpicker('refresh')
                    });

                    if ($menuDropdown.attr('perfect-onloadSelect')) {
                        $menuDropdown.val($menuDropdown.attr('perfect-onloadSelect')).selectpicker('refresh');
                        $menuDropdown.attr('perfect-onloadSelect', '');
                    }
                    //if (Bomval != 0) {
                    //    $thisForm.find('[name="ID_BOMProject"]').val(Bomval).selectpicker('refresh');
                    //}
                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'warning', 'heading': 'warning', 'message': 'Category not found' });
                    });
                }
            },
            complete: function () {


            }
        });

    }

    function GetLeadFromdefault() {
         let $thisForm = $('[perfect-class="form"]');
                $.ajax({
                url: '@Url.Action("GetEmployeeLeadDefault", "ServiceReport")',
                type: "Get",
                dataType: "json",
                contentType: "application/json",
                success: function (ajaxOutput) {//<----- if ajax method executed succesfully,  we get the data passed from controller in this variable  => success: function (variable) {

                 if (ajaxOutput.Process.IsProcess) {
                     //var stateModel = createSelectList({ data: ajaxOutput.Data, hideColumn: ['EmpID'] });
                     $.each(ajaxOutput.Data, function (key, value) {
                         debugger

                         console.log('>_ Search button > list click', value);
                       
                         $thisForm.find('[name=FK_BranchMode]').val(value.FK_BranchMode);
                         $thisForm.find('[name=Branch]').val(value.ID_Branch).selectpicker('refresh');
                         let Mode = $thisForm.find('[name=FK_BranchMode]').val();
                         let user = '@ViewBag.Admin';
                     
                        console.log('user', user);
                        if (parseFloat(Mode) == 1 && user == 'True') {
                        
                             $('#BranchID').prop('disabled', false );
                         }
                         else {
                             $('#BranchID').prop('disabled', true);
                         }
                        
                             

                     });
                 }
                 else {
                     $.each(ajaxOutput.Process.Message, function (key, value) {
                         NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                     });
                 }

             },


         });


    }
</script>