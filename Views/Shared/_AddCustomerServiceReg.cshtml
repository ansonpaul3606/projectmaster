@model PerfectWebERP.Models.CustomerserviceregisterModel.CustomerserviceregisterView

<style>


    .ExpWarning {
        color: red !important;
    }

        .ExpWarning:hover {
            color: red !important;
        }

    .thumbnailpdf {
        height: 40px;
        width: 40px;
    }

    .thumbnail:hover {
        height: 100%; 
    }

    .fa-lg {
        color: #e94560;
    }

    .table2-striped tbody tr:nth-of-type(odd) {
        background-color: white;
    }

    .table2-hover tbody tr:hover td {
        background-color: white !important;
    }

    .table1-hover tbody tr:hover td {
        background-color: #f7f7f7 !important;
    }

    #ChecklistTbody tr td {
        vertical-align: middle;
        border-color: rgb(193, 193, 193);
    }

    #Warrantydetbdy tr td {
        vertical-align: middle;
        border-color: rgb(193, 193, 193);
    }

    .Custominvalid {
        display: none;
        width: 100%;
        margin-top: 0.25rem;
        font-size: 80%;
        color: #FF6746;
    }

    .btn-primary1 {
        background-color: white; /* Green */
        color: #e94560;
        border-color: #e94560;
    }

        .btn-primary1:hover {
            background-color: #e94560;
            color: white;
            border-color: #e94560;
        }

    .btn-primary2 {
        background-color: white; /* Green */
        color: #e94560;
        border-color: white;
    }

        .btn-primary2:hover {
            background-color: white;
            color: white;
            border-color: white;
        }

    .btn-danger1 {
        background-color: white; /* Green */
        color: #ff6746;
        border-color: #ff6746;
    }

        .btn-danger1:hover {
            background-color: #ff6746;
            color: white;
            border-color: #ff6746;
        }

    .btn-danger {
        color: #fff;
        background-color: #e94560;
        border-color: #e94560;
    }

        .btn-danger:hover {
            color: #fff;
            background-color: #e94560;
            border-color: #e94560;
        }

    input[type="checkbox"]:after {
        content: '';
        display: block;
        width: 1rem;
        height: 1rem;
        margin-top: 0px;
        margin-left: -1px;
        border: 1px solid transparent;
        border-radius: 3px;
        background: white;
        line-height: 1.3;
        outline: 2px solid #e94560;
        box-shadow: -10px 1px 12px 0 #0000001f !important;
    }

    .btn1 {
        font-size: 1.2rem;
        padding: 0.2rem 1rem;
        border-radius: 1px;
        font-weight: 500;
    }

    .btn-info {
        color: black;
        background-color: #2398f7;
        border-color: #1792f6;
    }

    .btn-icon-right {
        border-left: 1px solid #f7f7f7;
        padding: 1rem 0 1rem 1.95rem;
    }

        .btn-icon-right:hover {
            border-left: 1px solid #c3bfbf;
            padding: 1rem 0 1rem 1.95rem;
        }

    .table-hover tbody tr:hover td btn-icon-right {
        border-left: 1px solid rebeccapurple;
    }




    .modal-body > .thumbnail {
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
</style>
<div class="card ">
    <div class="card-header">
        <h6 class="card-title col-12">@ViewBag.PageTitle </h6>
        <span title="To View List" onclick="fn_showListView();"><svg id="Layer_1" class="layer" stroke="currentColor" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 122.88 122.54"><title>To View List</title><path class="viewlst" d="M4.69,0H46.22a4.71,4.71,0,0,1,4.69,4.69V46a4.69,4.69,0,0,1-4.69,4.69H4.69a4.65,4.65,0,0,1-3.31-1.38l-.09-.09A4.67,4.67,0,0,1,0,46V4.69A4.71,4.71,0,0,1,4.69,0ZM89.44,61.94a26.56,26.56,0,0,1,10.18,2l.07,0a26.61,26.61,0,0,1,15.25,32.16,26.18,26.18,0,0,1-2.7,6.11l10.3,11.24a1.27,1.27,0,0,1-.07,1.8l-7.57,6.9a1.27,1.27,0,0,1-1.79-.07l-9.86-10.85a26.36,26.36,0,0,1-6.1,2.74,26.87,26.87,0,0,1-7.71,1.13,26.51,26.51,0,0,1-10.17-2l-.07,0A26.64,26.64,0,0,1,64.85,78.37l0-.07A26.6,26.6,0,0,1,89.44,61.94Zm15,11.59a21.38,21.38,0,0,0-6.89-4.61l-.06,0a21.22,21.22,0,0,0-23.07,4.64l-.07.07a21.25,21.25,0,0,0-4.54,6.83l0,.06a21.32,21.32,0,0,0-1.58,8.06,21.26,21.26,0,0,0,29.35,19.62,21.54,21.54,0,0,0,6.89-4.61l.07-.07a21.09,21.09,0,0,0,4.54-6.83l0-.06a21.35,21.35,0,0,0,0-16.17,21.34,21.34,0,0,0-4.62-6.9ZM4.69,63.2H46.22a4.71,4.71,0,0,1,4.69,4.7v41.34a4.68,4.68,0,0,1-4.69,4.69H4.69A4.69,4.69,0,0,1,0,109.24V67.9a4.71,4.71,0,0,1,4.69-4.7ZM68.78,0h41.53A4.71,4.71,0,0,1,115,4.69V46a4.71,4.71,0,0,1-4.69,4.69H68.78A4.71,4.71,0,0,1,64.09,46V4.69a4.69,4.69,0,0,1,1.37-3.31l.1-.09A4.67,4.67,0,0,1,68.78,0Z"></path></svg></span>
    </div>
    <div class="card-body">
        <form id="" class="form-valide" perfect-class="form" action="#" method="post" perfect-onFormSuccess="">

            <input type="hidden" name="ID_Customerserviceregister" />
            <input type="hidden" name="LastID" />
            <input type="hidden" id="TicketNumber" name="TicketNumber" />
            <div class="row">



                <div class="col-sm-4">
                    <div class="form-group row" perfect-class="formGroup">
                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel">Reg.Date</span>
                            <span class="text-danger">*</span>
                        </label>
                        <div class="col-sm-8">
                            <div class="input-group">

                                <input type="date" id="TicketDate" class="form-control perfectValidate_date" name="TicketDate" perfect-class="formGroupControl" perfect-ctype="date" max="2050-01-01" onchange="edatecheck(this)" perfect-css="date" />
                                <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-sm-4">
                    <div class="form-group row" perfect-class="formGroup">
                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel">Time</span>
                        </label>
                        <div class="col-sm-8">
                            <div class="input-group">

                                <input type="time" id="TicketTime" class="form-control" name="TicketTime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />

                            </div>
                        </div>
                    </div>

                </div>


                <div class="col-sm-4">
                    <div class="form-group row" perfect-class="formGroup">
                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel">Customer Name</span>

                        </label>


                        <div class="col-sm-8">
                            <div class="input-group">
                                <input type="text" class="form-control perfectValidate_specialCharName psscapitalize" @*placeholder="Type here or Search"*@ name="CustomeName" id="CustomeName" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" readonly />
                                <input type="hidden" name="ID_FIELD" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <input type="hidden" name="CusMode" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />

                                <div class="input-group-append">
                                    <button id="addCustomer-jq-searchButton3" data-toggle="tooltip" data-html="true" data-placement="top" class="btn btn-primary" name="btnserv" type="button" perfect-css="button" onclick="GetCmnPopUpSearchValAssign(this, 24, 'Customer List', [], ['CustomerMobile','CustomerAddress','CusMode','ID_FIELD','OtherMobile'])" BindName="CustomeName" BindVal="FK_Customer" Function="2"><i class="fa fa-search"></i></button>
                                    <button id="customerbtn" class="btn btn-primary fa fa-user-plus" type="button" perfect-css="button" onclick="fn_customerForm_loadState(this)" title="Add Customer"></button>

                                </div>
                            </div>
                        </div>
                        <div class="md-2 modal fade" perfect-class="formGroupModalcustmrformGroupModalcustmr" id="formGroupModalcustmr">
                            <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
                                <div class="modal-content">
                                    <div class="modal-header border-0">
                                        <h5 class="modal-title">Add  Customer Details</h5>
                                        <button type="button" class="close" data-dismiss="modal">
                                            <span>&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;padding: 1rem;">
                                        <div class="row">

                                            <div class="col-sm-12" id="custmr-sav">
                                                <div class="row">
                                                    <br>



                                                    <div class="col-sm-6">
                                                        <div class="form-group row" perfect-class="formGroup">
                                                            <label class="col-sm-4 col-form-label">
                                                                <span perfect-class="formGroupLabel">Name</span>
                                                                <span class="text-danger">*</span>
                                                            </label>
                                                            <div class="col-sm-8">
                                                                <input type="text" class="form-control perfectValidate_specialCharName_nm" perfect-tempTable-Name="Name" placeholder="" name="Name" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                                <div class="text-danger temptableError"></div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="form-group row" perfect-class="formGroup">
                                                            <label class="col-sm-4 col-form-label">
                                                                <span perfect-class="formGroupLabel">Mobile</span>
                                                                <span class="text-danger">*</span>
                                                            </label>
                                                            <div class="col-sm-8">
                                                                <div class="input-group mb-2">
                                                                    <div class="input-group-prepend">
                                                                        <span class="input-group-text fa fa-phone bg-primary text-white"></span>
                                                                    </div>
                                                                    <input type="text" class="form-control perfectValidate_mobile_nm" perfect-tempTable-Mobile="Mobile" maxlength="15" placeholder="" name="Mobile" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                                    <div class="text-danger temptableError"></div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 Divcontact">

                                                    <div class="daccordion__header">
                                                        <span class="accordion__header--text">Address Details</span>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-12 " perfect-class="TempTableProduct">
                                                            <br>
                                                            <div class="row">

                                                                <div class="col-sm-6">
                                                                    <div class="form-group row" perfect-class="formGroup">
                                                                        <label class="col-sm-4 col-form-label">
                                                                            <span perfect-class="formGroupLabel">House Name</span>

                                                                        </label>
                                                                        <div class="col-sm-8">
                                                                            <input type="text" class="form-control" perfect-tempTable-Address1="Address1" maxlength="500" placeholder="Enter House Name" name="Address1" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />

                                                                        </div>

                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <div class="form-group row" perfect-class="formGroup">
                                                                        <label class="col-sm-4 col-form-label">
                                                                            <span perfect-class="formGroupLabel">Place</span>
                                                                        </label>
                                                                        <div class="col-sm-8">
                                                                            <input type="text" class="form-control perfectValidate_string_nm psscapitalize" autocomplete="off" placeholder="Enter Place" name="Address2" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="150" />
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <div class="form-group row" perfect-class="formGroup">
                                                                        <label class="col-sm-4 col-form-label">
                                                                            <span perfect-class="formGroupLabel">PinCode</span>
                                                                        </label>
                                                                        <div class="col-sm-8">
                                                                            <div class="input-group">
                                                                                <input type="number" class="form-control " maxlength="10" placeholder="Type here and search" name="PinCode" perfect-class="formGroupControl perfectValidate_numeric_nm" perfect-ctype="input" perfect-css="input" min="0" />
                                                                                <div class="input-group-append">
                                                                                    <button id="addpincode-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="searchbtn(this)"></button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <div class="form-group row" perfect-class="formGroup">
                                                                        <label class="col-sm-4 col-form-label">
                                                                            <span perfect-class="formGroupLabel">Country</span>
                                                                            <span class="text-danger">*</span>
                                                                        </label>
                                                                        <div class="col-sm-8">
                                                                            <div class="input-group">
                                                                                <input type="text" class="form-control" name="Country" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled />
                                                                                <input type="hidden" name="CountryID" class="form-control" perfect-class="formGroupControl" perfect-tempTable-CountryID="CountryID" perfect-ctype="hidden" perfect-css="input" />
                                                                                <div class="input-group-append">
                                                                                    @*<button id="addcountry-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="getCountry(this)"></button>*@
                                                                                    <button id="addcountry-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" Form="form" onclick="GetCmnPopUpSearchVal(this,9,'Country List',['','','States','StatesID','DistrictID','District','AreaID','Area','PlaceID','Place','Post','PostID'])" Criterea1="0" Criterea2="0" BindName="Country" BindVal="CountryID"></button>

                                                                                </div>
                                                                                <div class="text-danger temptableError"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <div class="form-group row" perfect-class="formGroup">
                                                                        <label class="col-sm-4 col-form-label">
                                                                            <span perfect-class="formGroupLabel">State</span>
                                                                            <span class="text-danger">*</span>
                                                                        </label>
                                                                        <div class="col-sm-8">
                                                                            <div class="input-group">
                                                                                <input type="text" class="form-control " name="States" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled />
                                                                                <input type="hidden" name="StatesID" class="form-control" perfect-tempTable-StatesID="StatesID" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                                                                <div class="input-group-append">
                                                                                    @*<button id="addstates-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="getStates(this)"></button>*@
                                                                                    <button id="addstates-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" Form="form" onclick="GetCmnPopUpSearchVal(this,10,'State List',['CountryID','Country','DistrictID','District','AreaID','Area','PlaceID','Place','Post','PostID'])" Criterea1="CountryID" Criterea2="0" BindName="States" BindVal="StatesID"></button>
                                                                                </div>
                                                                            </div>
                                                                            <div class="text-danger temptableError"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <div class="form-group row" perfect-class="formGroup">
                                                                        <label class="col-sm-4 col-form-label">
                                                                            <span perfect-class="formGroupLabel">District</span>
                                                                            <span class="text-danger">*</span>
                                                                        </label>
                                                                        <div class="col-sm-8">
                                                                            <div class="input-group">
                                                                                <input type="text" class="form-control " name="District" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled />
                                                                                <input type="hidden" name="DistrictID" class="form-control" perfect-class="formGroupControl" perfect-tempTable-DistrictID="DistrictID" perfect-ctype="hidden" perfect-css="input" />
                                                                                <div class="input-group-append">
                                                                                    @*<button id="adddistrict-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="getDistrict(this)"></button>*@
                                                                                    <button id="adddistrict-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" Form="form" onclick="GetCmnPopUpSearchVal(this,11,'District List',['StatesID','State','AreaID','Area','PlaceID','Place','Post','PostID'])" Criterea1="StatesID" Criterea2="0" BindName="District" BindVal="DistrictID"></button>
                                                                                </div>
                                                                                <div class="text-danger temptableError"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <div class="form-group row" perfect-class="formGroup">
                                                                        <label class="col-sm-4 col-form-label">
                                                                            <span perfect-class="formGroupLabel">Area</span>
                                                                        </label>
                                                                        <div class="col-sm-8">
                                                                            <div class="input-group">
                                                                                <input type="text" class="form-control " autocomplete="off" name="Area" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="150" readonly />
                                                                                <input type="hidden" name="AreaID" class="" perfect-class="formGroupControl perfectValidate_numeric_nm" perfect-ctype="hidden" perfect-css="input" />
                                                                                <div class="input-group-append">
                                                                                    <button id="addarea-jq-searchButton3" name="areas" class="btn btn-primary fa fa-search" type="button" perfect-css="button" form="form" onclick="GetCmnPopUpSearchVal(this,14,'Area List',['DistrictID','District','Post','PostID','PinCode'])" criterea1="DistrictID" criterea2="0" bindname="Area" bindval="AreaID"></button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="col-sm-6">
                                                                    <div class="form-group row" perfect-class="formGroup">
                                                                        <label class="col-sm-4 col-form-label">
                                                                            <span perfect-class="formGroupLabel">Post</span>

                                                                        </label>
                                                                        <div class="col-sm-8">
                                                                            <div class="input-group">
                                                                                <input type="text" class="form-control " name="Post" perfect-tempTable-Info="Post" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled />
                                                                                <input type="hidden" name="PostID" class="perfectValidate_numeric_nm" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                                                                <div class="input-group-append">
                                                                                    <button id="addpincode-jq-searchButton3" name="pst" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,13,'Post List',['AreaID','Area','PinCode'])" Criterea1="AreaID" Criterea2="0" BindName="Post" BindVal="PostID"></button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="modal-footer">
                                                    <button type="button" id="btnSave" onclick="fn_bindcustomerdetails(this);" class="btn btn-primary">Add</button>

                                                    <button type="button" class="btn btn-light1" onclick="fn_cleardetails(this);">Clear</button>
                                                </div>



                                            </div>


                                        </div>

                                    </div>

                                    <div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>


            </div>

            <div class="row">
                <div class="col-sm-4">
                    <div class="form-group row" perfect-class="formGroup">
                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel">Mobile Number</span>
                            <span class="text-danger">*</span>
                        </label>

                        <div class="col-sm-8">
                            <div class="input-group mb-2">
                                <div class="input-group-prepend">
                                    <span class="input-group-text fa fa-phone bg-primary text-white"></span>
                                </div>
                                <input type="text" class="form-control perfectValidate_mobile" placeholder="" name="CustomerMobile" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input"maxlength="15" />

                            </div>
                        </div>
                    </div>


                </div>

                <div class="col-sm-4">
                    <div class="form-group row" perfect-class="formGroup">
                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel">House Name</span>

                        </label>
                        <div class="col-sm-8">
                            <textarea rows="1" class="form-control" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" placeholder="" name="CustomerAddress"></textarea>
                        </div>
                    </div>

                </div>

                <div class="col-sm-4">
                    <div class="form-group row" perfect-class="formGroup">
                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel">Priority</span><span class="text-danger">*</span>
                        </label>
                        <div class="col-sm-8 ">
                            <select class="form-control perfectValidate_string" name="Priority" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                <option value="">Please select</option>
                                <option value="1">High</option>
                                <option value="2">Medium</option>
                                <option value="3" selected>Normal</option>

                            </select>
                        </div>
                    </div>
                </div>


                <div class="col-sm-4">
                    <div class="form-group row" perfect-class="formGroup">
                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel">Channel</span>

                        </label>
                        <div class="col-sm-8">
                            <select id="CSRChannelID" class="form-control" name="CSRChannelID" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="GetName(this)">
                                <option value="">Please select</option>
                                @if (!(Model.ChannelTypes is null))
                                {
                                    foreach (var media in Model.ChannelTypes)
                                    {
                                        <option value="@media.ID_Mode">@media.ModeName</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-sm-4" style="display:none;" id="channel">
                    <div class="form-group row" perfect-class="formGroup">
                        <label class="col-sm-4 col-form-label">
                            <span perfect-class="formGroupLabel" id="SelctName" name="SltName">Channel Through</span>
                            @*<span class="text-danger">*</span>*@
                        </label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="" name="CSRChannelSub" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled/>
                                <input type="hidden" name="CSRChannelSubID" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <div class="input-group-append">
                                    <button id="addLeadBy-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetChannelBy(this)" BindName="CSRChannelSub" BindVal="CSRChannelSubID"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">

            </div>


            <br />
            <div class="col-sm-12">
                <div class="default-tab">

                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">

                            <a class="nav-link active" data-toggle="tab" id="complaintid" href="#Complaint" onclick="complaint(this)"><i class="las la-ticket-alt mr-2"></i>Complaint</a>
                        </li>
                        @*<li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#warranty" onclick="fn_commonlisthistory(this,1,0)"><i class="las la-file-invoice mr-2"></i> Warranty/AMC Details&nbsp;&nbsp;<span><label id="warrantybadge" class="badge badge-circle badge-success">0</label></span></a>
                            </li>*@

                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#serviceslis" onclick="fn_commonlisthistory(this,2,0)"><i class="lab la-product-hunt mr-2"></i>Service History&nbsp;&nbsp;<span><label id="servicebadge" class="badge badge-circle badge-primary">0</label></span></a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#History" onclick="fn_commonlisthistory(this,3,0)"><i class="las la-history mr-2"></i>Sales History&nbsp;&nbsp;<span><label id="productbadge" class="badge badge-circle badge-info">0</label></span></a>
                        </li>

                        @*<li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#AccountBalance"><i class="fa fa-exclamation mr-2"></i>Customer Due&nbsp;&nbsp;<span><label id="accountbadge" class="badge badge-circle badge-warning">0</label></span></a>
                            </li>*@
                    </ul>


                    <div class="tab-content">
                        <div id="Complaint" class="tab-pane active">

                            <div class="row" style="margin-top:1.5rem;">
                                <div class="col-sm-12">
                                    <div class="row">

                                        <div class="col-sm-4">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel">Complaint Category</span><span class="text-danger">*</span>
                                                </label>
                                                <div class="col-sm-8 ">
                                                    <select class="form-control perfectValidate_string" name="Category" id="Category" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="companyshw(this)">
                                                        <option value="">Please select</option>
                                                        @if (!(Model.categorytyps is null))
                                                        {
                                                            foreach (var categorytyp in Model.categorytyps)
                                                            {
                                                                <option value="@categorytyp.ID_Mode">@categorytyp.ModeName</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4" id="comp" style="display:none">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel">Company</span>
                                                </label>
                                                <div class="col-sm-8 ">
                                                    <select class="form-control product" name="company" id="company" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                                        <option value="">Please select</option>
                                                        @if (!(Model.othercompanies is null))
                                                        {
                                                            foreach (var othercompany in Model.othercompanies)
                                                            {
                                                                <option value="@othercompany.ID_OtherCompany">@othercompany.OCName</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">

                                                    <span perfect-class="formGroupLabel">Category</span>
                                                    <span class="text-danger">*</span>
                                                </label>
                                                <div class="col-sm-8">
                                                    <select class="form-control perfectValidate_numeric" name="CategoryID" id="Categoryid" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" data-live-search="true" onchange="clearproduct(this)">

                                                        <option value="">Please Select </option>

                                                        @if (!(Model.CategoryList is null))
                                                        {
                                                            foreach (var categorylist in Model.CategoryList)
                                                            {
                                                                <option value="@categorylist.CategoryID">@categorylist.CategoryName</option>
                                                            }

                                                        }

                                                    </select>

                                                </div>

                                            </div>
                                        </div>
                                        <div class="col-sm-4 subcategory1">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">

                                                    <span perfect-class="formGroupLabel">Sub Category</span>
                                                    @*<span class="text-danger">*</span>*@
                                                </label>
                                                <div class="col-sm-8">
                                                    <input type="hidden" name="FK_SubCategory" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                                    <select class="form-control" name="ID_SubCategory" id="SubCategoryID" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" data-live-search="true">

                                                        @*<option value="0">Please Select </option>*@

                                                        @if (!(Model.SubCategoryList is null))
                                                        {
                                                            foreach (var Subcategorylist in Model.SubCategoryList)
                                                            {
                                                                <option value="@Subcategorylist.ID_SubCategory">@Subcategorylist.SubCatName</option>
                                                            }

                                                        }


                                                    </select>

                                                </div>

                                            </div>
                                        </div>
                                        <div class="col-sm-4 brand1">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">

                                                    <span perfect-class="formGroupLabel">Brand</span>
                                                    @*<span class="text-danger">*</span>*@
                                                </label>
                                                <div class="col-sm-8">
                                                    <select class="form-control" name="BrandID" id="BrandID" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" data-live-search="true">

                                                        <option value="0">Please Select </option>

                                                        @if (!(Model.BrandList is null))
                                                        {
                                                            foreach (var Brand in Model.BrandList)
                                                            {
                                                                <option value="@Brand.BrandID">@Brand.BrandName</option>
                                                            }

                                                        }


                                                    </select>

                                                </div>

                                            </div>
                                        </div>
                                        <div class="col-sm-4 product1" id="compprd" style="display:none">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel">Product</span>

                                                </label>
                                                <div class="col-sm-8 ">
                                                    <div class="input-group">
                                                        <input type="text" class="form-control product" name="ProductName" id="ProductName" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled />
                                                        <input type="hidden" name="FK_Product" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                                        <div class="input-group-append">
                                                            <button id="addCustomer-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this, 26, 'Product List', ['Category','Complaint Category'])" BindName="ProductName" BindVal="FK_Product" Function="1" Criterea1="ID_FIELD" Checkbox="1" Criterea2="CategoryID"></button>

                                                        </div>
                                                        <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4 product2" id="noncomp">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel">Product</span>

                                                </label>
                                                <div class="col-sm-8 ">
                                                    <div class="input-group">

                                                        <input type="text" class="form-control product" name="ProductNameP" id="ProductNameP" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled />
                                                        <input type="hidden" name="FK_ProductP" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                                        <div class="input-group-append">
                                                            <button id="addCustomer-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this, 27, 'Product List', ['Category','Complaint Category'])" BindName="ProductNameP" BindVal="FK_ProductP" Function="1" Checkbox="1" Criterea1="ID_FIELD" Criterea2="CategoryID"></button>

                                                        </div>
                                                        <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4" id="complaint" style="display:none">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel">Complaint</span><span class="text-danger">*</span>
                                                </label>
                                                <div class="col-sm-8 ">
                                                    <select class="form-control product" name="ID_ComplaintList" id="ID_ComplaintList" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="dataedt(this)"></select>
                                                    <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4" id="service" style="display:none">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel">Service</span><span class="text-danger">*</span>
                                                </label>
                                                <div class="col-sm-8 ">
                                                    <select class="form-control product" name="ID_ServiceList" id="ID_ServiceList" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select"onchange="GetExistancy(this)"></select>
                                                    <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel">
                                                        Description
                                                    </span>
                                                </label>
                                                <div class="col-sm-8 ">
                                                    <input type="text" class="form-control" autocomplete="off" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" placeholder="" name="CSRDescription" maxlength="500" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4" id="btncomplaint" style="display:none">
                                            <div class="form-group row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">

                                                </label>
                                                <div class="col-sm-8 ">
                                                    <button type="button" class="btn btn-rounded btn-success" onclick="GetChecklist(this)">
                                                        <span class="btn-icon-left text-success">
                                                            <i class="fa fa-check color-success"></i>
                                                        </span> Checklist
                                                    </button>
                                                </div>
                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>

                        </div>
                        @*<div id="warranty" class="tab-pane">

                                <div class="form-row">
                                    <div class="col-sm-12">
                                        <div class="card" style="height:fit-content;margin-bottom: 0rem;">
                                            <div class="card-body">
                                                <div id="warrntydt" style="display:none"></div>
                                                <div class="row col-md-12" id="warrantyhis"></div>

                                            </div>
                                        </div>

                                        <div class="card" style="height:fit-content; margin-bottom: 0rem;">

                                            <div class="card-header" style="display:none" id="Warrantyheader">
                                                <h4 class=""><span id="invoiceno"></span> </h4>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive" perfect-tempTable="Warrantydet" style="display:none" id="Warrantydet">
                                                    <table class="table table2-hover table-responsive-sm table2-striped  text-black" id="Warrantydetlst">
                                                        <thead class="bg-primary text-white">
                                                            <tr>
                                                                <th>Warranty/AMC Type</th>
                                                                <th>Repl. Warranty/AMC Due Dt</th>
                                                                <th>Serv. Warranty/AMC Renewal Dt</th>
                                                                <th>Doc Type</th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="Warrantydetbdy">
                                                            <tr id="0">
                                                                <td colspan="7" style="text-align:center;">No Records...</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                </div>
                                            </div>
                                        </div>



                                    </div>


                                </div>
                            </div>*@
                        <div id="serviceslis" class="tab-pane">

                            <div class="row">
                                <div class="card-body">
                                    <div id="servdet" style="display:none"></div>
                                    <div class="row col-md-12" id="servicehis"></div>
                                </div>
                            </div>
                        </div>
                        <div id="History" class="tab-pane">
                            <div class="row">
                                <div class="card-body">
                                    <div id="proddet" style="display:none"></div>
                                    <div class="row col-md-12" id="prodhis"></div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="card-body">
                                    <div class="card-header">
                                        <h4 class=""><span>Customer Due</span> </h4>
                                    </div>
                                    <div id="Accountbalancedetails" style="display:none"></div>
                                    <div class="row col-md-12" id="Accountbalancedetailss"></div>
                                </div>

                            </div>

                        </div>
                        @*<div id="AccountBalance" class="tab-pane">
                                <div class="row">
                                    <div class="card-body">
                                        <div id="Accountbalancedetails" style="display:none"></div>
                                        <div class="row col-md-12" id="Accountbalancedetailss"></div>
                                    </div>

                                </div>
                            </div>*@

                    </div>
                </div>


            </div>

            <div class="md-2 modal fade" perfect-class="formGroupModalWarrantyAMCDetails" id="formGroupModalWarrantyAMC">
                <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
                    <div class="modal-content">
                        <div class="modal-header border-0">
                            <h5 class="modal-title">Warranty/AMC Details</h5>

                        </div>
                        <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;padding: 1rem;">
                            <div class="row">

                                <div class="col-sm-12" id="WarrantyAMC-Apply">
                                    <input type="hidden" name="ID_Prdt" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                    <input type="hidden" name="PrdtName" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                    <input type="hidden" name="Cate_ID" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                    <div class="card" id="warrntydtPopUp" style="height:fit-content;margin-bottom: 0rem;">
                                        <div class="card-body">
                                            <div style="display:none"></div>
                                        </div>
                                    </div>

                                    <div class="card" style="height:fit-content; margin-bottom: 0rem;">

                                        <div class="card-header" style="display:none" id="Warrantyheader">
                                            <h4 class=""><span id="invoiceno"></span> </h4>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive" perfect-tempTable="Warrantydet" style="display:none" id="Warrantydet">
                                                <table class="table table2-hover table-responsive-sm table2-striped  text-black" id="Warrantydetlst">
                                                    <thead class="bg-primary text-white">
                                                        <tr>
                                                            <th>Warranty/AMC Type</th>
                                                            <th style="width:20px">Repl. Warranty/AMC Due Dt</th>
                                                            <th>Repl. Status</th>
                                                            <th style="width:20px">Serv. Warranty/AMC Renewal Dt</th>
                                                            <th>Serv. Status</th>
                                                            <th>Doc Type</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="Warrantydetbdy">
                                                        <tr id="0">
                                                            <td colspan="7" style="text-align:center;">No Records...</td>
                                                        </tr>
                                                    </tbody>
                                                </table>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="modal-footer">
                                        <button type="button" id="btnApply" onclick="fn_BindCategoryProduct(this);" class="btn btn-primary">OK</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                        </div>
                    </div>
                </div>

            </div>

            <br />



            <div class="col-sm-12 Divcontact">


                <div class="daccordion__header">

                    <span class="accordion__header--text">CONTACT DETAILS</span>

                </div>
                <div class="row">
                    <div class="col-sm-12 " perfect-class="TempTableProduct">
                        <br />
                        <div class="row">
                            <div class="col-sm-4">
                                <div class="form-group row" perfect-class="formGroup">
                                    <label class="col-sm-4 col-form-label">
                                        <span perfect-class="formGroupLabel">Contact No.</span>
                                    </label>
                                    <div class="col-sm-8">
                                        <div class="input-group mb-2">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text fa fa-phone bg-primary text-white"></span>
                                            </div>
                                            <input type="text" class="form-control perfectValidate_mobile_nm" placeholder="" name="OtherMobile" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="15" />

                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="col-sm-4">
                                <div class="form-group row" perfect-class="formGroup">
                                    <label class="col-sm-4 col-form-label">
                                        <span perfect-class="formGroupLabel">Land mark</span>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control perfectValidate_string_nm" placeholder="" name="Landmark" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="150" />
                                    </div>
                                </div>
                            </div>



                        </div>
                    </div>
                </div>
            </div>




            <div class="col-sm-12 Divcontact">


                @*<div class="daccordion__header">

                        <span class="accordion__header--text">Requested Visit Date and Time</span>

                    </div>

                    <div class="row">
                        <div class="col-sm-12 " perfect-class="TempTableProduct">
                            <br />
                            <div class="row">
                                <div class="col-sm-3">
                                    <div class="form-group row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel">From Date</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <input type="date" id="Servicefromdate" class="form-control" name="Servicefromdate" perfect-class="formGroupControl" perfect-ctype="date" max="2050-01-01" onchange="datecheck(this)" perfect-css="date" />
                                            <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>

                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="form-group row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel">To Date</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <input type="date" id="Servicetodate" class="form-control" name="Servicetodate" perfect-class="formGroupControl" perfect-ctype="date" max="2050-01-01" onchange="datecheck(this)" perfect-css="date" />
                                            <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>

                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="form-group row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel">From Time</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <input type="time" class="form-control" placeholder="" name="Servicefromtime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="form-group row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel">To Time</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <input type="time" class="form-control" placeholder="" name="Servicetotime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>*@
                <div id="accordion-seven" class="accordion accordion-active-header">

                    <div class="accordion__item">
                        <div class="accordion__header collapsed" id="morecont" data-toggle="collapse" data-target="#active-header_collapseseven" aria-expanded="false">
                            <span class="accordion__header--icon"></span>
                            <span class="accordion__header--text">Requested Visit Date and Time</span>
                            <span class="accordion__header--indicator"></span>
                        </div>
                        <div id="active-header_collapseseven" class="accordion__body collapse" data-parent="#accordion-seven" style="">
                            <div class="accordion__body--text">
                                <div class="row">
                                    <div class="col-sm-12 " perfect-class="TempTableProduct">
                                        <br>
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">
                                                        <span perfect-class="formGroupLabel">From Date</span>

                                                    </label>
                                                    <div class="col-sm-8">
                                                        <input type="date" id="Servicefromdate" class="form-control" name="Servicefromdate" perfect-class="formGroupControl" perfect-ctype="date" max="2050-01-01" onchange="datecheck(this)" perfect-css="date" />
                                                        <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-3">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">
                                                        <span perfect-class="formGroupLabel">To Date</span>

                                                    </label>
                                                    <div class="col-sm-8">
                                                        <input type="date" id="Servicetodate" class="form-control" name="Servicetodate" perfect-class="formGroupControl" perfect-ctype="date" max="2050-01-01" onchange="datecheck(this)" perfect-css="date" />
                                                        <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-3">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">
                                                        <span perfect-class="formGroupLabel">From Time</span>

                                                    </label>
                                                    <div class="col-sm-8">
                                                        <input type="time" class="form-control" placeholder="" name="Servicefromtime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-3">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">
                                                        <span perfect-class="formGroupLabel">To Time</span>

                                                    </label>
                                                    <div class="col-sm-8">
                                                        <input type="time" class="form-control" placeholder="" name="Servicetotime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                        <div id="timeValidationMessage" class="text-danger"></div>

                                                    </div>
                                                </div>
                                            </div>



                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



            </div>



            <div class="col-sm-12 Divcontact" hidden>

                <div id="accordion-six" class="accordion accordion-active-header">

                    <div class="accordion__item">
                        <div class="accordion__header collapsed" data-toggle="collapse" data-target="#active-header_collapsesix" aria-expanded="false">
                            <span class="accordion__header--icon"></span>
                            <span class="accordion__header--text">ATTENDED DETAILS</span>
                            <span class="accordion__header--indicator"></span>
                        </div>
                        <div id="active-header_collapsesix" class="accordion__body collapse" data-parent="#accordion-six" style="">
                            <div class="accordion__body--text">
                                <div class="row">
                                    <div class="col-sm-12 " perfect-class="TempTableProduct">
                                        <br>
                                        <div class="row">
                                            <div class="col-sm-4">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">
                                                        <span perfect-class="formGroupLabel">Status</span>

                                                    </label>
                                                    <div class="col-sm-8">
                                                        <select class="form-control" name="NextAction" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">

                                                            <option value="0">Please select</option>
                                                            @if (!(Model.NextActionMode is null))
                                                            {
                                                                foreach (var Mode in Model.NextActionMode)
                                                                {
                                                                    <option value="@Mode.ID_NextAction">@Mode.NxtActnName</option>
                                                                }
                                                            }
                                                        </select>

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-4">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">
                                                        <span perfect-class="formGroupLabel">Attended by</span>

                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-group">
                                                            <input type="text" class="form-control " name="Emp" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled="">
                                                            <input type="hidden" name="EmpId" class="perfectValidate_numeric_nm" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input">
                                                            <div class="input-group-append">
                                                                <button id="addstates-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick=" GetCmnPopUpSearchValAssign(this, 69, 'Employee Details', [], ['Branchs', 'BranchTypeID', 'FK_Departement', 'Department', 'BranchType', 'SLNo'])" bindname="Emp" bindval="EmpId"></button>
                                                            </div>
                                                            <div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade bd-Productservice-modal-sm" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">CHECK LIST</h5>
                            <button type="button" class="close" data-dismiss="modal">
                                <span>×</span>
                            </button>
                        </div>

                        <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;padding: 1rem;">

                            <div class="form-row" id="TopDetails">

                            </div>
                            <div class="form-row">
                                <div class="col-sm-12">
                                    <div class="card" style="margin-bottom: 0rem;">
                                        <div class="card-body" style="padding: 0.1rem;">
                                            <div class="table-responsive" perfect-tempTable="CheckDet">
                                                <table class="table table2-hover table-responsive-sm table2-striped  text-black" id="Checklistbtn">
                                                    <thead class="bg-primary text-white">
                                                        <tr>
                                                            <th>Details</th>
                                                            <th>Output</th>
                                                            <th>Status</th>
                                                            <th></th>
                                                            <th>Remarks</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="ChecklistTbody">
                                                        <tr id="0">
                                                            <td colspan="4" style="text-align:center;">No Records...</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                                <div class="modal-footer">

                                                    <button type="button" id="btnchecklist" onclick="Bindchecklist(this)" class="btn btn-primary" disabled>Submit</button>
                                                    <button type="button" onclick="Clearchecklist(this)" class="btn btn-light">Clear</button>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /# card -->
                                </div>

                            </div>



                        </div>

                    </div>
                </div>
            </div>


            <div class="card-footer text-right" perfect-class="formFooter">

                <button id="" type="button" class="btn btn-primary mr-3 addcompany-jq-addnewuserUpdate d-none" name="update" perfect-css="button" onclick="fn_UpdateCustomerServiceRegister(this)"><i class="fa fa-refresh fa-spin  loaderClass"></i>Update</button>
                <button id="addcompany-jq-addnewuser" type="button" class="btn btn-primary mr-3 " name="add" perfect-css="button" onclick="CreateConfirmationBody(this)" data-target=".bd-example-modal-lg"><i class="fa fa-refresh fa-spin loaderClass "></i>Save</button>
                <button type="button" class="btn btn-light" perfect-css="button" onclick="ResetButton(this)" id="reset" name="reset">Clear</button>
            </div>
            <!--Confirm Modal-->
            <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Confirmation</h5>
                            <button type="button" class="close" data-dismiss="modal">
                                <span>×</span>
                            </button>
                        </div>
                        <div class="modal-body">

                            <div id="ConfirmBody">

                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" onclick="fn_SaveCustomerServiceRegister(this)" class="btn btn-primary">Confirm</button>
                            <button type="button" class="btn btn-danger light" data-dismiss="modal">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade show" id="registration" style="display:none; padding-right: 17px" aria-modal="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">

                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-4"></div>
                                <div class="col-md-4">
                                    <img src="~/Assets/images/success.png" style="height:100px" />
                                </div>
                                <div class="col-md-4"></div>
                            </div>
                            <div id="Registration">

                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="close" data-dismiss="modal" onclick="closeregister(this)">
                                <span style="font-size:15px">Close</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade show" id="imageGrid" style="display:none; padding-right: 17px" aria-modal="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content rounded-0">
                        <div class="modal-header border-0">
                            <h5 class="modal-title text-primary" id="modaltit"></h5>
                            <button type="button" class="close" data-dismiss="modal">
                                <span>×</span>
                            </button>
                        </div>
                        <div class="modal-body" style="padding: 1rem;">
                            <p>
                                <button type="button" class="btn btn-rounded btn-primary2" title="Zoom-in" onclick="zoomin()"><i class="fa fa-search-plus fa-lg"></i></button>
                                <button type="button" class="btn btn-rounded btn-primary2" title="Zoom-out" onclick="zoomout()"><i class="fa fa-search-minus fa-lg"></i></button>
                                <button type="button" class="btn btn-rounded btn-primary2" title="Image view" onclick="actual()"><i class="fa fa-search fa-lg"></i></button>
                                <button type="button" class="btn btn-rounded btn-primary2" title="Download file" onclick="download()"><i class="fa fa-download fa-lg"></i></button>
                            </p>
                            <img id="myImg" onclick="imgzoomin()">
                        </div>

                    </div>
                </div>
            </div>
            <!--End-->
        </form>
    </div>



</div>
@*<script src="~/Scripts/bootstrap-multiselect.js"></script>*@
<script>

    var ProdChange = '';

    $(document).ready(function ()
 {


        initFunctions('form');
        debugger
        let $thisform = $('[perfect-class="form"]');
        var today = new Date();
        var time = today.getHours()+ ":" + today.getMinutes() + ":" + today.getSeconds();

        $thisform.find('[name="TicketTime"]').attr(time );

        if ($thisform.find('[name="add"]').is(":visible")) {

         $thisform.find('[name="CountryID"]').val('@ViewBag.ID_Country');
         $thisform.find('[name="Country"]').val('@ViewBag.CountryName');
         $thisform.find('[name="DistrictID"]').val('@ViewBag.ID_District');
         $thisform.find('[name="District"]').val('@ViewBag.DistrictName');
         $thisform.find('[name="StatesID"]').val('@ViewBag.ID_State');
         $thisform.find('[name="States"]').val('@ViewBag.StateName');
        }
        
        let sub = '@ViewBag.IsSubCategory';
        let Brand = '@ViewBag.IsBrand';
        ProdChange = '@ViewBag.IsProduct';

        if ('@ViewBag.IsSubCategory' === "True") {
            $(".subcategory1").show();
        }
        else {
            $(".subcategory1").hide();
        }
        if ('@ViewBag.IsBrand' === "True") {
            $(".brand1").show();
        }
        else {
          $(".brand1").hide();
        }


 });
    function GetChannelBy(ele) {
                 let $thisForm = $(ele).closest('[perfect-class="form"]');


             let  CSRChannelID= $thisForm.find('[name="CSRChannelID"]').val()


        if (CSRChannelID == 5) {
            GetCmnPopUpSearchValAssign(ele, 69, 'Employee Details', [], ['Branchs', 'BranchTypeID', 'FK_Departement', 'Department', 'BranchType', 'SLNo','FK_Branch'])

            //GetCmnPopUpSearchValAssign(this, 6, 'Employee Details', [], ['Department', 'Code'])
        }
        else if (CSRChannelID == 6){
            GetCmnPopUpSearchVal(ele, 31, 'Media', [])
        }
    }
    function edatecheck(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let upperlimit = $thisForm.find('[name="TicketDate"]').val();
        var enqDate = new Date(upperlimit);

        var today = new Date();


        if (enqDate.getTime() > today.getTime()) {

            console.log('inside limit check if')
            $thisForm.find('[name="TicketDate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Ticket date should be lessthan or equal to Today s date')

        }
        else {
            console.log('inside limit check else')
            $thisForm.find('[name="TicketDate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('')


        }



    }

    function GetName(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $thisForm.find('[name=CSRChannelSub]').val('');
        $thisForm.find('[name=CSRChannelSubID]').val('');
        let name = $thisForm.find('[name="CSRChannelID"] option:selected').text();
        if (name != 'Please select') {
            $thisForm.find('[name="SltName"]').text(name)
        }
        let CSRChannelID = $thisForm.find('[name="CSRChannelID"]').val()



        if (CSRChannelID == 5 || CSRChannelID == 6) {
            document.getElementById("channel").style.display = 'block';
        }
        else  {
            document.getElementById("channel").style.display = 'none';
        }
    }

    function dataedt(ele) {
        debugger
        dataedit = 0;
      
        GetExistancy(ele)
    }

    function download() {
        var imgid;
        var imgnm = $("#myImg").attr('name');
        imgid = $("#myImg").attr('src');
        var a = document.createElement("a"); //Create <a>
        a.href = imgid; //Image Base64 Goes here
        a.download = imgnm; //File name Here
        a.click();
    }
    var iszoom = false;

    function imgzoomin() {



        var myImg = document.getElementById("myImg");
        var currWidth = myImg.clientWidth;


        if (!iszoom) {
            if (currWidth == 1150) {
                iszoom = true;

            } else {
                myImg.style.width = (currWidth + 50) + "px";
            }
        }
        else {

            if (currWidth == 150) {
                iszoom = false;
            } else {
                myImg.style.width = (currWidth - 50) + "px";
            }
        }

    }


    function zoomin() {
        var myImg = document.getElementById("myImg");
        var currWidth = myImg.clientWidth;
        if (currWidth == 1150) {
            alert("Maximum zoom-in level reached");
        } else {
            myImg.style.width = (currWidth + 50) + "px";
        }
    }


    function actual() {
       var myImg = document.getElementById("myImg");
        myImg.style.width = "1000px"
    }


    function zoomout() {
        var myImg = document.getElementById("myImg");
        var currWidth = myImg.clientWidth;
        if (currWidth == 150) {
            alert("Maximum zoom-out level reached");
        } else {
            myImg.style.width = (currWidth - 50) + "px";
        }
    }


    function complaint(ele) {

        $('.Divcontact').show();
    }

    function downloadimg(ele) {

        var text = $(ele).closest('tr').find('.imagename').text();
        var imgname = $(ele).closest('tr').find('.imagemode').text();
        var textval = $(ele).closest('tr').find('.imageval').text();
        var isimage = false;
        var _validFileExtensions = [".jpg", ".jpeg", ".bmp", ".gif", ".png"];
        for (var j = 0; j < _validFileExtensions.length; j++) {
            if (text != null) {
                if (text.includes(_validFileExtensions[j])) {

                    $('#imageGrid').modal('show');
                    $('#modaltit').text(imgname);
                    $("#myImg").attr("src", "data:image/;base64," + textval);
                    $("#myImg").attr("name", text);
                    var myImg = document.getElementById("myImg");

                    myImg.style.width = "350px";



                    isimage = true;
                }
            }


        }
        if (!isimage) {

            var a = document.createElement("a");

            a.href = "data:image/;base64,"+ textval; //Image Base64 Goes here
            a.download = text;//File name Here
            a.click();
        }
    }


    var WarrantytableOptions = {

        onlyShowColumn: [],
        hideColumn: ["ID_CustomerWiseProductDetails"],
        rowClickAction: GetWarrantylist,
        serialNo: true,
        renameHeader: {  }
    };

    var ProducttableOptions = {
        renameHeader: { "Complaint": "Complaint/Service" },
        hideColumn: ["ID_Master", "TransMode"],
        trackInfo: { "TicketNo": "Click to more information" },
        serialNo: true,
    };

    var SalesHistorytableOptions = {
        iconButton: {
            class: "LedgerBalance",
            buttons: [
                {
                    icon: "fa fa-file btnPerfectGridLedger",
                    title:"Customer Balance",
                    action: function () {
                        let savedData = $(this).closest('tr').data('pData');
                        console.log('saved data of sales history', savedData)
                        let $thisForm = $('[perfect-class="form"]');
                        let Bill_ID = savedData.FK_Sales;
                        let ID_Customer =0 ;
                        let CusMode = $thisForm.find('[name="CusMode"]').val();
                        let FK_OtherCustomer = 0;
                        if (CusMode == 1) {
                            FK_OtherCustomer = $thisForm.find('[name="ID_FIELD"]').val();
                        }
                        else {
                            ID_Customer = $thisForm.find('[name="ID_FIELD"]').val();
                        }
                        let Date = $thisForm.find('[name="TicketDate"]').val();

                        let Transmode = ServiceregistrationTransMode;
                        fn_ShowLedgerInfo(ID_Customer, FK_OtherCustomer, Bill_ID, Transmode, Date)
                    }
                },
            ]
        },
        onlyShowColumn: [],
        hideColumn: ["FK_Sales", "FK_Product", "CategoryID", "ID_CustomerWiseProductDetails"],
        rowClickAction: GetWarrantylistPopUp/*fn_BindCategoryProduct*/,
        serialNo: true,
        renameHeader: { },
    };
    function fn_BindCategoryProduct(ele) {
        debugger
        var $crow = $(this).closest('tr');
        let rowData = $crow.data('pData');

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $thisForm.find('[name=FK_ProductP]').val($thisForm.find('[name=ID_Prdt]').val());
        $thisForm.find('[name=ProductNameP]').val($thisForm.find('[name=PrdtName]').val());
        $thisForm.find('[name=CategoryID]').val($thisForm.find('[name=Cate_ID]').val()).selectpicker('refresh');
        GetComplaintList(ele, 0, 0);
       // $("#complaintid").click();

       $('#formGroupModalWarrantyAMC').modal('hide');
    }



 function fn_commonlisthistory(ele,Mode,div)
 {

     fn_GetCustomerAccountBalance(ele);

     if (div == 1) {
         $('.Divcontact').show();
     }
     else {
         $('.Divcontact').hide();
     }
     let $thisForm = $(ele).closest('[perfect-class="form"]');
     let FK_Customer = 0;
     let FK_CustomerOthers = 0;
     let FK_Product = 0;
     let FK_Category = 0;
     if ($thisForm.find('[name=CusMode]').val() != '') {
         if ($thisForm.find('[name=CusMode]').val() == 0) {

             FK_Customer = $thisForm.find('[name=ID_FIELD]').val();

         }
         else
         {
             FK_CustomerOthers = $thisForm.find('[name=ID_FIELD]').val();
         }
     }
     if ($thisForm.find('[name=FK_Product]').val() != '' || $thisForm.find('[name=FK_ProductP]').val()!='') {
         if ($thisForm.find('[name=FK_Product]').val() == 0) {
             FK_Product = $thisForm.find('[name=FK_ProductP]').val();
         }
         else {
             FK_Product = $thisForm.find('[name=FK_Product]').val();
         }
     }
     FK_Category = isNaN(parseInt($thisForm.find('[name=CategoryID]').val())) ? 0 : parseInt($thisForm.find('[name=CategoryID]').val());
     var obj = {
         FK_Customer: FK_Customer,
         FK_CustomerOthers: FK_CustomerOthers,
         FK_Product: FK_Product,
         FK_Category: FK_Category,
         Mode: Mode
     }

         $.ajax({
                 url: "@Url.Action("getBillList", "Service")",
                type: "POST",
                data: obj ,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
                  success: function (ajaxOutput) {

                 if (ajaxOutput.Process.IsProcess) {
                     let table = JSON.parse(ajaxOutput.Data);

                     //if (Mode == 1) {
                     //    $('#warrantyhis').html(pft_table_createtable(table.dtable, WarrantytableOptions))
                     //    document.getElementById("warrntydt").style.display = 'none';
                     //}
                     if (Mode == 2)
                     {

                         $('#servicehis').html(pft_table_createtable(table.dtable, ProducttableOptions))
                         $('#servicebadge').html(table.dtable.length);
                         document.getElementById("servdet").style.display = 'none';
                     }
                     else if (Mode == 3)
                     {
                         $('#prodhis').html(pft_table_createtable(table.dtable, SalesHistorytableOptions))
                         checkemi(this);
                         var tableData = table.dtable;

                         if (tableData.length == 1) {
                             $thisForm.find('[name=FK_ProductP]').val(tableData[0]['FK_Product'])
                             $thisForm.find('[name=ProductNameP]').val(tableData[0]['Product'])
                             $thisForm.find('[name=CategoryID]').val(tableData[0]['CategoryID']).selectpicker('refresh')
                             GetComplaintList(ele, 0, 0)



                         }

                         $('#productbadge').html(table.dtable.length);

                         document.getElementById("proddet").style.display = 'none';
                     }

                 }
                 else {

                     if (Mode == 1) {
                         $('#warrantybadge').html(0);
                         //document.getElementById("warrntydt").style.display = 'block';
                         document.getElementById("Warrantydet").style.display = 'none';
                         document.getElementById("Warrantyheader").style.display = 'none';
                         $('#warrantyhis').html('')
                         $('#warrntydt').html("<p style='text-align:center;' >No Records..</p>");
                     }
                     else if (Mode == 2) {
                         $('#servicehis').html('')
                         $('#servicebadge').html(0);
                         document.getElementById("servdet").style.display = 'block';
                         $('#servdet').html("<p style='text-align:center;' >No Records..</p>");
                     }
                     else {
                         $('#productbadge').html(0);
                         document.getElementById("proddet").style.display = 'block';
                         $('#proddet').html("<p style='text-align:center;' >No Records..</p>");
                         $('#prodhis').html('')
                     }



                 }

             }



         });
    }




    function GetWarrantylist(ele)
    {

            $('.Divcontact').hide();

          let $thisRow = $(this).closest('tr');
          let savedata = $thisRow.data('pData');


     var obj = {

         Mode: 4,
         MasterID: savedata.ID_CustomerWiseProductDetails
         }


         $.ajax({
                 url: "@Url.Action("getwarrantyList", "Service")",
                type: "POST",
                data: obj ,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
                  success: function (ajaxOutput) {
                   if (ajaxOutput.Process.IsProcess) {
                    $('#Warrantydetbdy').empty();

                       $('#invoiceno').html("<b>Invoice No</b>" + ":" + " <b>" + savedata.InvoiceNo + "</b>");
                    let dtable = JSON.parse(ajaxOutput.Data).dtable;
                    console.log('dtable', dtable)
                    if (dtable.length > 0) {

                        var warranty = dtable[dtable.length - 1].ID_WarrantyDetails;

                        a = 1;

                        var pdficon ;
                        var viewicon ;
                        var title ;
                        for (var i = dtable.length - 1; i >= 0; i--)
                        {
                            let $tr = $('<tr/>');

                            let isicon = false;
                            var _validFileExtensions = [".jpg", ".jpeg", ".bmp", ".gif", ".png"];
                            if (dtable[i].ImageName != null) {
                                for (var j = 0; j < _validFileExtensions.length; j++) {

                                    if (dtable[i].ImageName.includes(_validFileExtensions[j])) {
                                        pdficon = "fa fa-file-image-o";
                                        viewicon = "fa fa-eye";
                                        title = "View File";
                                        isicon = true;
                                    }

                                }
                                if (!isicon) {
                                    if (dtable[i].ImageName.includes(".xl")) {
                                        pdficon = "fa fa-file-excel-o";
                                    }
                                    else if (dtable[i].ImageName.includes(".pdf")) {
                                        pdficon = "fa fa-file-pdf-o";
                                    }
                                    else { pdficon = "fa fa-file-o"; }
                                    viewicon = "fa fa-download";
                                    title = "Download file";

                                }
                            }

                            if (i == 0 || warranty != dtable[i - 1].ID_WarrantyDetails) {

                               

                                $tr.append("<td  class='nrs' rowspan=\"" + a + "\">" + dtable[i].WarrantyType + "</td>");
                                $tr.append("<td rowspan=\"" + a + "\">" + dtable[i].ReplacementWarrantyExpireDate + "</td>");
                                $tr.append("<td rowspan=\"" + a + "\">" + dtable[i].ServiceWarrantyExpireDate + "</td>");

                                a = 1;
                                if (i > 0) warranty = dtable[i - 1].ID_WarrantyDetails;

                            }
                            else {
                               a++;
                            }
                            if (dtable[i].ImageName != null) {
                                $tr.append("<td class='imagename' style='display:none'>" + dtable[i].ImageName + "</td>");
                                $tr.append("<td class='imageval' style='display:none'>" + dtable[i].Image + "</td>");

                                $tr.append("<td class='imagemode' >" + dtable[i].ImageMode + "</td>");
                                $tr.append("<td > <button type='button' data-toggle='tooltip' onclick='downloadimg(this)' " +
                                    " class= 'btn btn-rounded btn-primary1' > <span class='btn-icon-left text-primary'><i id='imagei' class='" + pdficon + "'></i></span><i  title='" + title + "' class='" + viewicon + "'></i></button ></td >");
                            }
                            $('#Warrantydetbdy').prepend($tr);

                            document.getElementById("Warrantyheader").style.display = 'block';
                            document.getElementById("Warrantydet").style.display = 'block';
                             }
                    }
                    else
                    {
                                let $tr = $('<tr/>');
                                $tr.append("<th colspan='5' style='text-align:center'>No Data to display</th>");
                               $('#Warrantydetbdy').append($tr);
                          }
                }
                   else
                   {
                      // document.getElementById("warrntydt").style.display = 'block';
                       document.getElementById("Warrantyheader").style.display = 'none';
                          document.getElementById("Warrantydet").style.display = 'none';
                          $('#warrntydt').html("<p style='text-align:center;' >No Records..</p>");
                    //$.each(ajaxOutput.Process.Message, function (key, value) {
                    //    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    //});
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
            }
        });

        }
    function parseDate(dateString) {
        var parts = dateString.split("/");
        return new Date(parts[2], parts[1] - 1, parts[0]);
    } function compareDates(date1, date2) {
        return date1.getTime() - date2.getTime();
    }
    function GetWarrantylistPopUp(ele)
    {
      

        

        $('#formGroupModalWarrantyAMC').modal({ backdrop: 'static', keyboard: false });
        $('[perfect-class="formGroup"]').find('[perfect-class="formGroupModalWarrantyAMCDetails"]').modal('show');

          let $thisRow = $(this).closest('tr');
        let savedata = $thisRow.data('pData');

        let $thisForm = $('[perfect-class="form"]');
        $thisForm.find('[name=ID_Prdt]').val(savedata.FK_Product);
        $thisForm.find('[name=PrdtName]').val(savedata.Product);
        $thisForm.find('[name=Cate_ID]').val(savedata.CategoryID);


        var obj = {

            Mode: 4,
            MasterID: savedata.ID_CustomerWiseProductDetails
        }


         $.ajax({
                 url: "@Url.Action("getwarrantyList", "Service")",
                type: "POST",
                data: obj ,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
             success: function (ajaxOutput) {
                 if (ajaxOutput.Process.IsProcess) {
                     $('#Warrantydetbdy').empty();
                     document.getElementById("warrntydtPopUp").style.display = 'none';
                     $('#invoiceno').html("<b>Invoice No</b>" + ":" + " <b>" + savedata.InvoiceNo + "</b>");
                     let dtable = JSON.parse(ajaxOutput.Data).dtable;
                     console.log('dtable', dtable)
                     if (dtable.length > 0) {

                         var warranty = dtable[dtable.length - 1].ID_WarrantyDetails;
                         var color = "";
                         a = 1;

                         var pdficon;
                         var viewicon;
                         var title;
                         var currentDate = moment();

                         // Format the date as dd/mm/yyyy
                         var formattedDate = currentDate.format('DD/MM/YYYY');

                         for (var i = dtable.length - 1; i >= 0; i--) {
                             let $tr = $('<tr/>');

                             let isicon = false;
                             var _validFileExtensions = [".jpg", ".jpeg", ".bmp", ".gif", ".png"];
                             if (dtable[i].ImageName != null) {
                                 for (var j = 0; j < _validFileExtensions.length; j++) {

                                     if (dtable[i].ImageName.includes(_validFileExtensions[j])) {
                                         pdficon = "fa fa-file-image-o";
                                         viewicon = "fa fa-eye";
                                         title = "View File";
                                         isicon = true;
                                     }

                                 }
                                 if (!isicon) {
                                     if (dtable[i].ImageName.includes(".xl")) {
                                         pdficon = "fa fa-file-excel-o";
                                     }
                                     else if (dtable[i].ImageName.includes(".pdf")) {
                                         pdficon = "fa fa-file-pdf-o";
                                     }
                                     else { pdficon = "fa fa-file-o"; }
                                     viewicon = "fa fa-download";
                                     title = "Download file";

                                 }
                             }

                             if (i == 0 || warranty != dtable[i - 1].ID_WarrantyDetails) {
                                 //var date_ = new Date();
                                 //var expDate_ = new Date(dtable[i].ReplacementWarrantyExpireDate);
                                 var dateEntered = dtable[i].ReplacementWarrantyExpireDate;
                                 var date = dateEntered.substring(0, 2);
                                 var month = dateEntered.substring(3, 5);
                                 var year = dateEntered.substring(6, 10);

                                 var dateToCompare = new Date(year, month - 1, date);
                                 var currentDate = new Date();





                                 //if (currentDate > dateToCompare) {
                                 //    $tr.addClass("ExpWarning");
                                 //}

                                 var specifiedDate = dtable[i].ReplacementWarrantyExpireDate;

                                
                              
                                

                                
                                 // Example usage
                                 var date1String = formattedDate;
                                 var date2String = specifiedDate;

                                 var date1 = parseDate(date1String);
                                 var date2 = parseDate(date2String);

                                 var result = compareDates(date1, date2);


                                 $tr.append("<td  class='nrs' rowspan=\"" + a + "\">" + dtable[i].WarrantyType + "</td>");
                                 if (result > 0) {
                                     $tr.append("<td rowspan=\"" + a + "\" style='color:red !important'  >" + dtable[i].ReplacementWarrantyExpireDate + "</td>");
                                 }
                                 else {
                                     $tr.append("<td rowspan=\"" + a + "\" >" + dtable[i].ReplacementWarrantyExpireDate + "</td>");
                                 }
                                 $tr.append("<td rowspan=\"" + a + "\" style='width:200px'>" + dtable[i].ReplacementWarrantyStatus + "</td>");

                                 specifiedDate = dtable[i].ServiceWarrantyExpireDate;
                                   date2String = specifiedDate;

                                   date1 = parseDate(date1String);
                                   date2 = parseDate(date2String);

                                 result = compareDates(date1, date2);

                                

                                

                                 if (result > 0) {
                                     $tr.append("<td rowspan=\"" + a + "\" style='color:red !important'  >" + dtable[i].ServiceWarrantyExpireDate + "</td>");
                                 }
                                 else {
                                     $tr.append("<td rowspan=\"" + a + "\" >" + dtable[i].ServiceWarrantyExpireDate + "</td>");
                                 }

                               
                                 $tr.append("<td rowspan=\"" + a + "\" style='width:200px'>" + dtable[i].ServiceWarrantyStatus + "</td>");
                                 a = 1;
                                 if (i > 0) warranty = dtable[i - 1].ID_WarrantyDetails;

                             }
                             else {
                                 a++;
                             }
                             if (dtable[i].ImageName != null) {
                                 $tr.append("<td class='imagename' style='display:none'>" + dtable[i].ImageName + "</td>");
                                 $tr.append("<td class='imageval' style='display:none'>" + dtable[i].Image + "</td>");

                                 $tr.append("<td class='imagemode' >" + dtable[i].ImageMode + "</td>");
                                 $tr.append("<td > <button type='button' data-toggle='tooltip' onclick='downloadimg(this)' " +
                                     " class= 'btn btn-rounded btn-primary1' > <span class='btn-icon-left text-primary'><i id='imagei' class='" + pdficon + "'></i></span><i  title='" + title + "' class='" + viewicon + "'></i></button ></td >");
                             }
                             //if (color == "red") {
                             //    $tr.prop("style", "color:red");
                             //}

                             $('#Warrantydetbdy').prepend($tr);

                             document.getElementById("Warrantyheader").style.display = 'block';
                             document.getElementById("Warrantydet").style.display = 'block';
                         }
                     }
                     else {
                         let $tr = $('<tr/>');
                         $tr.append("<th colspan='7' style='text-align:center'>No Data to display</th>");
                         $('#Warrantydetbdy').append($tr);
                     }
                 }
                 else {
                     document.getElementById("warrntydtPopUp").style.display = 'block';
                     document.getElementById("Warrantyheader").style.display = 'none';
                     document.getElementById("Warrantydet").style.display = 'none';
                     $('#warrntydtPopUp').html("<p style='text-align:center;' >No Warranty/AMC Details Found..</p>");

                 }
             },
            complete: function () {
                $(ele).prop('disabled', false);
            }
        });

    }



    function fn_commonlistbadge(ele, Mode, FK_Customer, FK_CustomerOthers, FK_Product, FK_Category) {
     debugger
     if (ele != '') {

         let $thisForm = $(ele).closest('[perfect-class="form"]');


         if ($thisForm.find('[name=CusMode]').val() != '') {
             if ($thisForm.find('[name=CusMode]').val() == 0) {

                 FK_Customer = $thisForm.find('[name=ID_FIELD]').val();

             }
             else {
                 FK_CustomerOthers = $thisForm.find('[name=ID_FIELD]').val();
             }
         }
         if ($thisForm.find('[name=FK_Product]').val() != '' || $thisForm.find('[name=FK_ProductP]').val() != '') {
             if ($thisForm.find('[name=FK_Product]').val() == 0)
             {
                 FK_Product = $thisForm.find('[name=FK_ProductP]').val();
             }
             else
             {
                 FK_Product = $thisForm.find('[name=FK_Product]').val();
             }
         }

         FK_Category = $thisForm.find('[name=CategoryID]').val();
     }

     var obj = {

         FK_Customer: FK_Customer,
         FK_CustomerOthers: FK_CustomerOthers,
         FK_Product: FK_Product,
         FK_Category: FK_Category,
         Mode: Mode
         }

         $.ajax({
                 url: "@Url.Action("getBillList", "Service")",
                type: "POST",
                data: obj ,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
                  success: function (ajaxOutput) {
                 console.log('sfsdv',ajaxOutput)
                      if (ajaxOutput.Process.IsProcess) {

                          let table = JSON.parse(ajaxOutput.Data).dtable;
                          if (Mode == 1) {

                              $('#warrantybadge').html("" + table.length + "");
                          }
                          else if (Mode == 2) {

                              $('#servicebadge').html("" + table.length + "");
                          }

                          else if (Mode == 3) {
                              $('#productbadge').html("" + table.length + "");
                          }


                      }
                      else {

                          if (Mode == 1) {

                              $('#warrantybadge').html(0);
                          }
                          else if (Mode == 2) {

                              $('#servicebadge').html(0);
                          }

                          else if (Mode == 3) {
                              $('#productbadge').html(0);
                          }
                      }
               }

         });
    }





    $(document).ready(function () {
        //set initial state.

        $("#Checklistbtn").on('change', "input[type='checkbox']", function (e) {



            if ($("input[type='checkbox']:checked").length > 0)
            {
                    document.getElementById("btnchecklist").disabled = false;
            }
            else
            {
                    document.getElementById("btnchecklist").disabled = true;
            }

        });


    });

    function ResetButton(ele) {
        $('.dataTable tr').removeClass("SelectForDelete");
        fn_ServiceRegister_LoadRegistrationForm();
            }


    function datecheck(ele) {
        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        //invalid-feedback
        let upperlimit = $thisForm.find('[name="Servicefromdate"]').val();
        let lowerlimit = $thisForm.find('[name="Servicetodate"]').val();

        var enqDate = new Date(upperlimit);
        enqDate.setHours(0, 0, 0, 0)
        var nxtDate = new Date(lowerlimit);
        nxtDate.setHours(0, 0, 0, 0)
        var today = new Date();
        today.setHours(0, 0, 0, 0)
        if (enqDate > nxtDate) {

            console.log('inside limit check if')
            $thisForm.find('[name="Servicetodate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('To date should be greaterthan or equal to From date')
        }
        else {

            $thisForm.find('[name="Servicetodate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('')
        }

        if (enqDate < today) {

            console.log('inside limit check if')
            $thisForm.find('[name="Servicefromdate"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
            $thisForm.find('[name="Servicefromdate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('From date should be greaterthan or equal to Todays date')
            isvalid = false;

        }



    }


    function CreateConfirmationBody(ele) {

        $("#complaintid").click();
        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        var isvalid = true;
        if ($thisForm.valid()) {
            //invalid-feedback
            let upperlimit = $thisForm.find('[name="Servicefromdate"]').val();
            let lowerlimit = $thisForm.find('[name="Servicetodate"]').val();

            var enqDate = new Date(upperlimit);
            enqDate.setHours(0, 0, 0, 0)
            var nxtDate = new Date(lowerlimit);
            nxtDate.setHours(0, 0, 0, 0)
            var today = new Date();
            today.setHours(0, 0, 0, 0)

            let upperlimits = $thisForm.find('[name="TicketDate"]').val();
            var enqDates = new Date(upperlimits);

            var todays = new Date();


            if (enqDates.getTime() > todays.getTime()) {

                console.log('inside limit check if')
                $thisForm.find('[name="TicketDate"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                $thisForm.find('[name="TicketDate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Ticket date should be lessthan or equal to Todays date')
                isvalid = false;

            }
            else {}

            let category = $thisForm.find('[name=Category]').val()
            //if (category == 2 || category == 4) {

            //    if ($thisForm.find('[name="FK_Product"]').val() == null || $thisForm.find('[name="FK_Product"]').val() == '') {
            //        isvalid = false;
            //        $thisForm.find('[name="FK_Product"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
            //        $thisForm.find('[name="FK_Product"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please select product')

            //    }

            //}
            //else {

            //    if ($thisForm.find('[name="FK_ProductP"]').val() == null || $thisForm.find('[name="FK_ProductP"]').val() == '') {
            //        isvalid = false;
            //        $thisForm.find('[name="FK_ProductP"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
            //        $thisForm.find('[name="FK_ProductP"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please select product')
            //    }

            //}
            if (category == 1 || category == 2) {


                if ($thisForm.find('[name="ID_ServiceList"]').val() == null || $thisForm.find('[name="ID_ServiceList"]').val() == '') {

                    isvalid = false;
                    $thisForm.find('[name="ID_ServiceList"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                    $thisForm.find('[name="ID_ServiceList"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please select service')
                }

            }
            else {

                if ($thisForm.find('[name="ID_ComplaintList"]').val() == null || $thisForm.find('[name="ID_ComplaintList"]').val() == '') {
                    isvalid = false;
                    $thisForm.find('[name="ID_ComplaintList"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                    $thisForm.find('[name="ID_ComplaintList"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please select complaint')
                }

            }


            if (enqDate > nxtDate) {
                $thisForm.find('[name="Servicetodate"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                $thisForm.find('[name="Servicetodate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('To date should be greaterthan or equal to From date')
                isvalid = false;
            }

            //if (enqDate < today) {


            //    $thisForm.find('[name="Servicefromdate"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
            //    $thisForm.find('[name="Servicefromdate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('From date should be greaterthan or equal to Todays date')
            //    isvalid = false;


            //}
            if (enqDate < today) {

                console.log('inside limit check if')
                $thisForm.find('[name="Servicefromdate"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                $thisForm.find('[name="Servicefromdate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('From date should be greaterthan or equal to Todays date')
                isvalid = false;

            }


                let CompServ = '';
                let CompName = '';
                let ProductName = '';


                if ($thisForm.find('[name=FK_Product]').val() == 0) {
                    ProductName = $thisForm.find('[name=ProductNameP]').val();
                }
                else {
                    ProductName = $thisForm.find('[name=ProductName]').val();
            }
            console.log('dasd', $thisForm.find('[name=ID_ComplaintList]').val());
            if ($thisForm.find('[name=ID_ComplaintList]').val() == 0 || $thisForm.find('[name=ID_ComplaintList]').val() == '' || $thisForm.find('[name=ID_ComplaintList]').val()==null) {
                    CompName = 'Service';
                    CompServ = $thisForm.find('[name="ID_ServiceList"] option:selected').text();
                }
                else {
                    CompName = 'Complaint';
                    CompServ = $thisForm.find('[name="ID_ComplaintList"] option:selected').text();
            }

            if ($thisForm.find('[name=NextAction]').val() == 0 || $thisForm.find('[name=NextAction]').val() == '' || $thisForm.find('[name=NextAction]').val() == null) {

            }
            else {
                if ($thisForm.find('[name=EmpId]').val() == 0 || $thisForm.find('[name=EmpId]').val() == '' || $thisForm.find('[name=EmpId]').val() == null) {
                    $thisForm.find('[name="EmpId"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                    $thisForm.find('[name="EmpId"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please Select Attended by')

                    isvalid = false;
                }
            }
            var fromTime = fromTimeInput.valueAsDate;
            var toTime = toTimeInput.valueAsDate;

            // Check if "To Time" is less than or equal to "From Time"
            if (fromTime && toTime && fromTime >= toTime) {
                // Display a validation message
                validationMessages.textContent = 'To Time should be greater than From Time.';
                toTimeInput.setCustomValidity('To Time should be greater than From Time.'); isvalid = false;
            } else {
                // Clear the validation message and reset validation state
                validationMessages.textContent = '';
                toTimeInput.setCustomValidity('');
            }


                if (isvalid) {
                    let $ConfirmBody = '';

                    $ConfirmBody += "<div class='row'>";
                    $ConfirmBody += "<div class='col-sm-12'>";
                    $ConfirmBody += "<div class='profile-personal-info'><h5 class='text-primary mb-4'>Personal Information</h5>";
                    //$ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>Date<span class='pull-right'>:</span></h6></div>";
                    //$ConfirmBody += "<div class='col-6'><span>" + formatDate(new Date($thisForm.find('[name=TicketDate]').val())) + "</span></div></div>";
                    $ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>Name <span class='pull-right'>:</span></h6></div>";
                    $ConfirmBody += "<div class='col-6'><span>" + $thisForm.find('[name=CustomeName]').val() + "</span></div></div>";
                    $ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>Mobile Number<span class='pull-right'>:</span></h6></div>";
                    $ConfirmBody += "<div class='col-6'><span>" + $thisForm.find('[name=CustomerMobile]').val() + "</span></div></div>";
                    $ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>Alternate No.<span class='pull-right'>:</span></h6></div>";
                    $ConfirmBody += "<div class='col-6'><span>" + $thisForm.find('[name="OtherMobile"]').val() + "</span></div></div>";
                    $ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>Address <span class='pull-right'>:</span></h6></div>";
                    $ConfirmBody += "<div class='col-6'><span>" + $thisForm.find('[name=CustomerAddress]').val() + "</span></div></div>";
                    $ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>Landmark <span class='pull-right'>:</span></h6></div>";
                    $ConfirmBody += "<div class='col-6'><span>" + $thisForm.find('[name=Landmark]').val() + "</span></div></div>";
                    $ConfirmBody += "</div>";
                    $ConfirmBody += "</div>";
                    $ConfirmBody += "<div class='col-sm-12'>";
                    $ConfirmBody += "<div class='profile-personal-info'><h5 class='text-primary mb-4'>" + CompName+" Details</h5>";
                    $ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>Product<span class='pull-right'>:</span></h6></div>";
                    $ConfirmBody += "<div class='col-6'><span>" + ProductName + "</span></div></div>";
                    $ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>" + CompName + " <span class='pull-right'>:</span></h6></div>";
                    $ConfirmBody += "<div class='col-6'><span>" + CompServ + "</span></div></div>";
                    $ConfirmBody += "</div>";
                    $ConfirmBody += "</div>";
                    $ConfirmBody += "<div class='col-sm-12'>";
                    $ConfirmBody += "<div class='profile-personal-info'><h5 class='text-primary mb-4'>Visit Details</h5>";
                    $ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>Visit Date<span class='pull-right'>:</span></h6></div>";
                    $ConfirmBody += "<div class='col-6'><span><b>" + formatDate(new Date($thisForm.find('[name=Servicefromdate]').val())) + "</b> " + ' ' + " - " + ' ' + " <b>" + formatDate(new Date($thisForm.find('[name=Servicetodate]').val())) + "</b></span></div></div>";
                    $ConfirmBody += "<div class='row mb-2'><div class='col-6'><h6 class='f-w-500'>Visit Time<span class='pull-right'>:</span></h6></div>";
                    $ConfirmBody += "<div class='col-6'><span><b>" + TimeConvert($thisForm.find('[name=Servicefromtime]').val()) + "</b>" + " - " + "<b>" + TimeConvert($thisForm.find('[name=Servicetotime]').val()) + "</b></span></div></div>";
                    $ConfirmBody += "</div>";
                    $ConfirmBody += "</div>";

                    $('#ConfirmBody').empty();
                    $('#ConfirmBody').append($ConfirmBody);
                    $('.bd-example-modal-lg').modal('show');



                }
            }
        }


    function padTo2Digits(num) {
        return num.toString().padStart(2, '0');
    }

    function formatDate(date) {
        if (date != 'Invalid Date') {
            return [
                padTo2Digits(date.getDate()),
                padTo2Digits(date.getMonth() + 1),
                date.getFullYear(),
            ].join('/');
        }
        else {
            return '';
        }
    }

    function TimeConvert(time) {
        // Check correct time format and split into components
        time = time.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];

        if (time.length > 1) { // If time format correct
            time = time.slice(1);  // Remove full string match value
            time[5] = +time[0] < 12 ? ' AM' : ' PM'; // Set AM/PM
            time[0] = +time[0] % 12 || 12; // Adjust hours
        }
        return time.join(''); // return adjusted time or original string
    }

    function Productpopupcall(ele,mode) {
        GetCmnPopUpSearchVal(this, mode, 'Product List', ['Category', 'Complaint Category'])
    }

    function getfunction(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let categrory = $thisForm.find('[name=Category]').val()

        if (categrory == 1 || categrory == 2) {

            //GetServiceList(ele, 0, 0)
            ServiceListCall(ele, function () {
                existencycheck(ele, function () {
                    let $thisForm = $('[perfect-class="form"]');
                    let customer = $thisForm.find('[name=ID_FIELD]').val();
                    if (customer != "" || customer !== 0) {
                        badgelist2(ele, function () {
                            badgelist3(ele);
                        });
                    }
                });
            });

        }
        else {
            ComplaintListCall(ele, function () {
                existencycheck(ele, function () {
                    let $thisForm = $('[perfect-class="form"]');
                    let customer = $thisForm.find('[name=ID_FIELD]').val();
                    if (customer != "" || customer !== 0) {
                        badgelist2(ele, function () {
                            badgelist3(ele);
                        });
                    }
                });
            });
            //GetComplaintList(ele, 0, 0)
        }

        //existencycheck(ele, function () {
        //    let $thisForm = $('[perfect-class="form"]');
        //    let customer = $thisForm.find('[name=ID_FIELD]').val();
        //    if (customer != "" || customer !== 0) {
        //        badgelist2(ele, function () {
        //            badgelist3(ele);
        //        });
        //    }
        //});

        //fn_commonlistbadge(ele, 1, 0, 0, 0,0)
        //fn_commonlistbadge(ele, 2,0,0,0,0)
        //fn_commonlistbadge(ele, 3,0,0,0,0)
        //badgelist1();

        dataedit = 0;
        CheckList = [];


    }
    function ServiceListCall(ele, callback) {
        GetServiceList(ele, 0, 0)
        callback();
    }
    function ComplaintListCall(ele, callback) {
        GetComplaintList(ele, 0, 0)
        callback();
    }
    function existencycheck(ele,callback) {
        GetExistancy(ele);
        callback(); 
    }
    function badgelist1(ele,callback) {
        fn_commonlistbadge(ele, 1, 0, 0, 0, 0)
        callback(); 
    }

    function badgelist2(ele, callback) {        
        fn_commonlistbadge(ele, 2, 0, 0, 0, 0)
        callback();
    }

    function badgelist3(ele) {
        fn_commonlistbadge(ele, 3, 0, 0, 0, 0)
        
    }
    function commonlisthistory2(ele, callback) {
        fn_commonlisthistory(ele, 2, 1)
        callback();
    }


    function getfunctionAssign(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $thisForm.find('[name=CustomeName]').attr("readonly", "readonly")
        $thisForm.find('[name=CustomerAddress]').attr("readonly", "readonly")
        if ($thisForm.find('[name=CustomerMobile]').val() == '' || $thisForm.find('[name=CustomerMobile]').val() == null) {

            $thisForm.find('[name=CustomerMobile]').removeAttr("readonly")
            $thisForm.find('[name=CustomeName]').addClass("perfectValidate_string")
        }
        else {
            $thisForm.find('[name=CustomeName]').removeClass("perfectValidate_string")
            $thisForm.find('[name=CustomerMobile]').attr("readonly", "readonly")
        }
        //fn_commonlistbadge(ele, 1, 0, 0, 0,0)
        //fn_commonlistbadge(ele, 2, 0, 0, 0,0)
        //fn_commonlistbadge(ele, 3, 0, 0, 0,0)
        commonlisthistory2(ele, function () {           
            fn_commonlisthistory(ele, 3, 1)
        });
        //fn_commonlisthistory(ele, 1,1)
        //fn_commonlisthistory(ele, 2,1)
        //fn_commonlisthistory(ele, 3,1)

    }

    function GetExistancy(ele) {

        let inputdata = 0;
        debugger
        let $thisForm = 0;

        $thisForm = $(ele).closest('[perfect-class="form"]');
        let mobileno=0;
            let categrory = $thisForm.find('[name=Category]').val()
            if (categrory == 2 || categrory == 4) {
                inputdata = { FK_Product: $thisForm.find('[name="FK_Product"]').val(), Mobile: $thisForm.find('[name="CustomerMobile"]').val(), FK_CustomerServiceRegister: $thisForm.find('[name="ID_Customerserviceregister"]').val()}

            }
            else
            {
                inputdata = { FK_Product: $thisForm.find('[name="FK_ProductP"]').val(), Mobile: $thisForm.find('[name="CustomerMobile"]').val(), FK_CustomerServiceRegister: $thisForm.find('[name="ID_Customerserviceregister"]').val()}

            }


       $.ajax({
            url: '@Url.Action("GetExistancy", "Service")',
            type: "POST",
           data: inputdata ,//<---- Input json : data passed to controller
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded;charset=utf-8',
            success: function (ajaxOutput) {



                if (ajaxOutput.Process.IsProcess) {

                    let dtable = JSON.parse(ajaxOutput.Data).dtable;
                    var tikno = dtable[0].TicketNo.bold()
                    NotificationMessage({ 'type': 'error', 'heading': 'warning', 'message': `${dtable[0].WarnMessage} with Ticket No :${tikno}` });
                    let $thisForm = $(ele).closest('[perfect-class="form"]');
                    $thisForm.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
                    $thisForm.find('[perfect-ctype="input"]').val('');
                    $thisForm.find('[perfect-ctype="date"]').val('');
                    $thisForm.find('[perfect-ctype="hidden"]').val('');
                    CheckList = [];
                    $('#warrantybadge').html(0);
                    $('#servicebadge').html(0);
                    $('#productbadge').html(0);

                    //document.getElementById("warrntydt").style.display = 'block';
                    document.getElementById("Warrantydet").style.display = 'none';
                    document.getElementById("Warrantyheader").style.display = 'none';
                    $('#warrntydt').html("<p style='text-align:center;' >No Records..</p>");
                    $('#servicehis').html('')
                    $('#warrantyhis').html('')
                    $('#prodhis').html('')

                    document.getElementById("servdet").style.display = 'block';
                    $('#servdet').html("<p style='text-align:center;' >No Records..</p>");

                    document.getElementById("proddet").style.display = 'block';
                    $('#proddet').html("<p style='text-align:center;' >No Records..</p>");
                    $thisForm.validate().resetForm();
                  fn_ServiceRegister_LoadRegistrationForm();
                    let confirmationDialogBoxOption = { heading: "Warning", body: dtable[0].WarnMessage + " with Ticket No : " + tikno + "<br/><br/>", cancel: "Cancel"};
                   
                    var confirmBoxObj = ConfirmDialogservice(confirmationDialogBoxOption);
                   
                    confirmBoxObj.then(function (selectedOption) {
                        if (selectedOption) {

                        }
                        else {

                            let $thisForm = $(ele).closest('[perfect-class="form"]');
                                $thisForm.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
                                $thisForm.find('[perfect-ctype="input"]').val('');
                                $thisForm.find('[perfect-ctype="date"]').val('');
                            $thisForm.find('[perfect-ctype="hidden"]').val('');
                            CheckList = [];
                            $('#warrantybadge').html(0);
                            $('#servicebadge').html(0);
                            $('#productbadge').html(0);

                           //document.getElementById("warrntydt").style.display = 'block';
                            document.getElementById("Warrantydet").style.display = 'none';
                            document.getElementById("Warrantyheader").style.display = 'none';
                            $('#warrntydt').html("<p style='text-align:center;' >No Records..</p>");
                            $('#servicehis').html('')
                            $('#warrantyhis').html('')
                            $('#prodhis').html('')

                            document.getElementById("servdet").style.display = 'block';
                            $('#servdet').html("<p style='text-align:center;' >No Records..</p>");

                            document.getElementById("proddet").style.display = 'block';
                            $('#proddet').html("<p style='text-align:center;' >No Records..</p>");
                                $thisForm.validate().resetForm();
                        }
                    });



                    }
                    else {

                    }
            },
            complete: function () {


            }
        });

    }

    function GetSubcategory(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let $placeDropdown = $thisForm.find('[name=ID_SubCategory]');//<--- Will give place select html element
        $placeDropdown.empty();
        $placeDropdown.append($('<option/>', { value: "0" }).text('Please select')).selectpicker('refresh');
        let CategoryID = $(ele).val();
         $.ajax({
                 url: "@Url.Action("GetSubcategory", "Service")",
                type: "POST",
                data: JSON.stringify({ CategoryID: CategoryID}),
                dataType: "json",
                contentType: "application/json",
            success: function (ajaxOutput) {
                debugger
                 if (ajaxOutput.SubCategoryList) {

                             $.each(ajaxOutput.SubCategoryList, function (key, value) {
                                 $placeDropdown.append($('<option/>', { "value": value.ID_SubCategory }).text(value.SubCatName)).selectpicker('refresh')
                             });

                     if ($placeDropdown.attr('perfect-onloadSelect')) {
                         $placeDropdown.val($placeDropdown.attr('perfect-onloadSelect')).selectpicker('refresh')
                     }
                     let b = $thisForm.find('[name="FK_SubCategory"]').val();
                     if ($thisForm.find('[name="FK_SubCategory"]').val() != "0") {
                         $thisForm.find('[name="ID_SubCategory"]').val($thisForm.find('[name="FK_SubCategory"]').val()).selectpicker('refresh');

                     }


                     }
                     else {
                    // $.each(ajaxOutput.Process.Message, function (key, value) {
                             //toastr.warning(value, "Error");
                             //NotificationMessage({ 'type': 'info', 'heading': 'info', 'message': value });
                    // });
                 }
            }

         });

    }


    function GetComplaintList(ele,prid,complval) {

        let inputdata = 0;

        let $thisForm = 0;
        if (prid == 0) {
            $thisForm = $(ele).closest('[perfect-class="form"]');
            let categrory = $thisForm.find('[name=Category]').val()

            if (categrory == 2 || categrory == 4) {
                inputdata = { prdid: $thisForm.find('[name="CategoryID"]').val() }

            }
            else
            {
                inputdata = { prdid: $thisForm.find('[name="CategoryID"]').val() }

            }
        }
        else
        {
             $thisForm = $(ele).find('[perfect-class="form"]');
            inputdata = { prdid: prid}
        }


       $.ajax({
            url: '@Url.Action("GetComplaintList", "Service")',
            type: "POST",
           data: inputdata ,//<---- Input json : data passed to controller
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded;charset=utf-8',
            success: function (ajaxOutput) {

                console.log('ajaxOutput',ajaxOutput)

                let $menuDropdown = $thisForm.find('[name=ID_ComplaintList]');//<--- Will give place select html element
                console.log('$menuDropdown', $menuDropdown)
                    $menuDropdown.empty().selectpicker('refresh');
                    $menuDropdown.append($('<option/>', { "value": "" }).text("Please Select")).selectpicker('refresh')
                    if (ajaxOutput.Process.IsProcess) {

                        $.each(ajaxOutput.Data, function (key, value) {
                            $menuDropdown.append($('<option/>', { "value": value.ID_ComplaintList }).text(value.ComplaintName)).selectpicker('refresh')
                        });

                        if ($menuDropdown.attr('perfect-onSelectLoad')) {
                            $menuDropdown.val($menuDropdown.attr('perfect-onSelectLoad')).selectpicker('refresh');
                            $menuDropdown.attr('perfect-onSelectLoad', '');
                        }
                        if (complval != 0) {
                            $thisForm.find('[name="ID_ComplaintList"]').val(complval).selectpicker('refresh');
                        }
                    }
                    else {
                        $.each(ajaxOutput.Process.Message, function (key, value) {

                            NotificationMessage({ 'type': 'warning', 'heading': 'warning', 'message': 'Complaint Records not found' });
                        });
                    }
            },
            complete: function () {


            }
        });

    }

    function GetServiceList(ele,prid, serval) {
        let inputdata = 0;
        let $thisForm = 0;
        let CategoryId = 0;
        let ProductId=0
        //if (prid == 0) {

        //    $thisForm = $(ele).closest('[perfect-class="form"]');
        //    let categrory = $thisForm.find('[name=Category]').val()
        //    if (categrory == 2 || categrory == 4) {
        //        inputdata = { prdid: $thisForm.find('[name="CategoryID"]').val() }

        //    }
        //    else {
        //        inputdata = { prdid: $thisForm.find('[name="CategoryID"]').val() }

        //    }
        //}
        //else {
        //    $thisForm = $(ele).find('[perfect-class="form"]');
        //    inputdata = { prdid: prid }
        //}
       
        $thisForm = $(ele).closest('[perfect-class="form"]');
      
        ProductId = $thisForm.find('[name="FK_ProductP"]').val();
            CategoryId = $thisForm.find('[name="CategoryID"]').val();
       
        inputdata = { prdid: ProductId, Catid:CategoryId }

       $.ajax({
            url: '@Url.Action("GetServiceList", "Service")',
            type: "POST",
           data: inputdata ,//<---- Input json : data passed to controller
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded;charset=utf-8',
            success: function (ajaxOutput) {

                let $menuDropdown = $thisForm.find('[name=ID_ServiceList]');//<--- Will give place select html element

                    $menuDropdown.empty().selectpicker('refresh');
                    $menuDropdown.append($('<option/>', { "value": "" }).text("Please Select")).selectpicker('refresh')


                    if (ajaxOutput.Process.IsProcess) {

                        $.each(ajaxOutput.Data, function (key, value) {
                            $menuDropdown.append($('<option/>', { "value": value.ID_Services }).text(value.ServicesName)).selectpicker('refresh')
                        });

                        if ($menuDropdown.attr('perfect-onSelectLoad')) {
                            $menuDropdown.val($menuDropdown.attr('perfect-onSelectLoad')).selectpicker('refresh');
                            $menuDropdown.attr('perfect-onSelectLoad', '');
                        }
                        if (serval != 0) {
                            $thisForm.find('[name="ID_ServiceList"]').val(serval).selectpicker('refresh');
                        }

                    }
                    else {
                        $.each(ajaxOutput.Process.Message, function (key, value) {

                            NotificationMessage({ 'type': 'warning', 'heading': 'warning', 'message': 'Service Records not found' });
                        });
                    }
            },
            complete: function () {


            }
        });

    }

    var num1 = 0;
    function companyshw(ele)
    {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let categrory = $thisForm.find('[name=Category]').val()
        debugger
        if (categrory == 1 || categrory == 2)
        {
            document.getElementById("service").style.display = '';
            document.getElementById("complaint").style.display = 'none';
            document.getElementById("btncomplaint").style.display = 'none';
        }
        else
        {
            document.getElementById("service").style.display = 'none';
            document.getElementById("complaint").style.display = '';
            document.getElementById("btncomplaint").style.display = '';
        }
        debugger
        if (ProductFound == "True") {
            
              if ('@ViewBag.IsProduct' === "True") {
                //$(".product1").show();
                $(".product2").show();
              }
              else if ('@ViewBag.IsProduct' === '') {
               $(".product2").show();
              }
              else
              {
                $(".product1").hide();
                $(".product2").hide();
              }


            if (categrory == 2 || categrory == 4) {
                document.getElementById("comp").style.display = '';
                document.getElementById("compprd").style.display = '';
                document.getElementById("noncomp").style.display = 'none';

            }
            else {
                document.getElementById("comp").style.display = 'none';
                document.getElementById("compprd").style.display = 'none';
                document.getElementById("noncomp").style.display = '';

            }
        }
        else {
            $(".product1").hide();
            $(".product2").hide();
            if (categrory == 2 || categrory == 4) {
                document.getElementById("comp").style.display = '';

            }
            else {
                document.getElementById("comp").style.display = 'none';

            }
        }

        $thisForm.find('[name="FK_ProductP"]').val('')
        $thisForm.find('[name="ProductNameP"]').val('')
        $thisForm.find('[name="FK_Product"]').val('')
        $thisForm.find('[name="ProductName"]').val('')
        $thisForm.find('[name="CSRDescription"]').val('')
        $thisForm.find('[name="ID_ComplaintList"]').empty().selectpicker('refresh');
        $thisForm.find('[name="ID_ServiceList"]').empty().selectpicker('refresh');
        $thisForm.find('[name="ID_SubCategory"]').val(0).selectpicker('refresh');
        complaintwisecategory(ele);


    }

    function complaintwisecategory(ele) {

        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let categrory = $thisForm.find('[name=Category]').val()

       $.ajax({
            url: '@Url.Action("GetComplaintwiseCategorylist", "Service")',
            type: "POST",
           data: JSON.stringify({ categrory: categrory}),//<---- Input json : data passed to controller
            dataType: "json",
           contentType: "application/json",
            success: function (ajaxOutput) {

                let $menuDropdown = $thisForm.find('[name=CategoryID]');//<--- Will give place select html element

                    $menuDropdown.empty().selectpicker('refresh');
                    $menuDropdown.append($('<option/>', { "value": "" }).text("Please Select")).selectpicker('refresh')


                    if (ajaxOutput.Process.IsProcess) {

                        $.each(ajaxOutput.Data, function (key, value) {
                            $menuDropdown.append($('<option/>', { "value": value.CategoryID }).text(value.CategoryName)).selectpicker('refresh')
                        });
                    }
                    else {
                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            //toastr.warning(value, "Error");
                            //NotificationMessage({ 'type': 'info', 'heading': 'info', 'message': value });
                        });
                    }
            }

        });



    }

    var CheckList;

    function Bindchecklist(ele)
    {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
         CheckList = [];
        var trs = $("#ChecklistTbody tr");
        if (trs.length > 0) {

            $('#ChecklistTbody tr').each(function (index, ele) {

                if ($($(ele).find("input[type='checkbox']")).is(":checked") == true)
                {

                    let remarks = '';

                    if ($(ele).find("input[type='textbox']").val() !== '') { remarks = $(ele).find("input[type='textbox']").val() }

                    var CheckListData = {
                        CheckListDetails: $(ele).find('.jq_ID_CkeckListDetails').text(),
                        Remarks: remarks.trim()
                    };
                    CheckList.push(CheckListData);
                }
                //if ($(ele).find("input[type='text']").val().trim() != '') {
                //    var CheckListData = { CheckListDetails:  $(ele).find('.jq_ID_CkeckListDetails').text(), Remarks: $(ele).find("input[type='text']").val().trim() };
                //    CheckList.push(CheckListData);
                //}
            });
            console.log('CheckList', CheckList);
        }
        $('.bd-Productservice-modal-sm').modal('hide');
    }

    function Clearchecklist(ele) {

        CheckList = [];
        var trs = $("#ChecklistTbody tr");
        if (trs.length > 0) {

            $('#ChecklistTbody tr').each(function (index, ele) {

                $(ele).find("input[type='checkbox']").prop('checked', false);
            $(ele).find("input[type='textbox']").val('');


            });

        }


            if ($("input[type='checkbox']:checked").length > 0) {

                document.getElementById("btnchecklist").disabled = false;
            }
            else {

                document.getElementById("btnchecklist").disabled = true;
            }


    }

    var dataedit = 0;


    function GetChecklist(ele) {


        let  $thisForm = $(ele).closest('[perfect-class="form"]');

        let categrory = $thisForm.find('[name=Category]').val()
        let Critre1;
        let Critre2 = $thisForm.find('[name="ID_ComplaintList"]').val();

        if (categrory == 2 || categrory == 4) {
            Critre1 = $thisForm.find('[name="FK_Product"]').val();

        }
        else {
            Critre1 = $thisForm.find('[name="FK_ProductP"]').val();

        }

        if (Critre1 == '' || Critre1 == null) {
            NotificationMessage({ 'message': 'Please Select Category' });

        }
        else
        {

            if (Critre2 == '' || Critre2 == null)
            {
                NotificationMessage({ 'message': 'Please Select Complaint' });
            }
            else
            {
                InputData = {
                    Pagemode: 25,
                    Critrea1: Critre1,
                    Critrea2: Critre2,
                    Critrea3: "",
                    Critrea4: "",
                    PageSize: 0,
                    PageIndex: 0,
                    Name: ""
                };


                $.ajax({
                    url: "@Url.Action("GetCmnPopList", "CommonPopupSearch")",
                    type: "Get",
                    data: InputData,
                    dataType: "json",
                    contentType: "application/json",
                    success: function (ajaxOutputclick) {
                        var ajaxOutput;
                        if (dataedit != 0) {
                            ajaxOutput = dataedit;
                        }
                        else {

                            ajaxOutput = ajaxOutputclick;
                        }
                        if (ajaxOutput != null) {
                            $('#ChecklistTbody').empty();
                            // var ProductData = ajaxOutput.Data;
                            console.log('ajaxOutput', ajaxOutput)
                            console.log('dataedit', dataedit)
                            if (ajaxOutput.Process.IsProcess) {
                                let dtable = JSON.parse(ajaxOutput.Data).dtable;
                                if (dtable.length > 0) {

                                    console.log('dtable', dtable)
                                    var oldValue = dtable[dtable.length - 1].ID_ComplaintCheckList,

                                        c = 1;
                                    console.log('oldValue', oldValue)
                                    for (var i = dtable.length - 1; i >= 0; i--) {
                                        let $tr = $('<tr/>');
                                        if (i == 0 || oldValue != dtable[i - 1].ID_ComplaintCheckList) {
                                            $tr.append("<td rowspan=\"" + c + "\"><b>" + dtable[i].Condition + "</b></td>");
                                            c = 1;
                                            if (i > 0) oldValue = dtable[i - 1].ID_ComplaintCheckList;
                                        } else {
                                            c++;
                                        }

                                        if (CheckList != '') {
                                            $.each(CheckList, function (key, value) {

                                                if (value.CheckListDetails == dtable[i].ID_CkeckListDetails) {

                                                    dtable[i].Remarks = value.Remarks;

                                                }

                                            });

                                        }


                                        console.log('CheckList  ', dtable[i].CurrentStatus);
                                        $tr.append("<td class='jq_ID_CkeckListDetails'Style='Display:none' >" + dtable[i].ID_CkeckListDetails + "</td>");
                                        $tr.append("<td class='jq_Output' >" + dtable[i].Output + "</td>");
                                        $tr.append("<td class='jq_Status' >" + dtable[i].Status + "</td>");
                                        if (dataedit !== 0 && dtable[i].CurrentStatus == 1) {
                                            $tr.append("<td class='jq_CurrentStatus' ><input id='chk" + i + "' type='checkbox'   checked/></td>");
                                        }
                                        else {
                                            $tr.append("<td class='jq_CurrentStatus' ><input id='chk" + i + "'class='chkbtn' type='checkbox'   /></td>");
                                        }

                                        $tr.append("<td class='jq_Remarks' ><input type='textbox' maxlength='100' class='form-control' value='" + dtable[i].Remarks + "' /></td>");
                                        $('#ChecklistTbody').prepend($tr);

                                        if (CheckList != '') {
                                            $.each(CheckList, function (key, value) {

                                                if (value.CheckListDetails == dtable[i].ID_CkeckListDetails) {

                                                    document.getElementById('chk' + i).checked = true;

                                                }


                                            });

                                        }


                                    }
                                }
                            }
                            else {
                                let $tr = $('<tr/>');
                                $tr.append("<th colspan='5' style='text-align:center'>No Data to display</th>");
                                $('#ChecklistTbody').append($tr);
                            }

                            if ($("input[type='checkbox']:checked").length > 0) {

                                document.getElementById("btnchecklist").disabled = false;
                            }
                            else {

                                document.getElementById("btnchecklist").disabled = true;
                            }

                            $('.bd-Productservice-modal-sm').modal('show');
                        }
                        else {
                            $.each(ajaxOutputclick.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': 'No Data Found' });
                            });
                        }
                    },
                    complete: function () {
                        $(ele).prop('disabled', false);
                    }
                });
            }
        }

     }

    //Save temp service details
    function fn_SaveCustomerServiceRegister(ele) {

        $(ele).prop('disabled', true);
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.valid()) {

            //$(ele).prop('disabled', true);
            let FK_Customer = 0;
            let FK_CustomerOthers = 0;
            let FK_Product = 0;

            if ($thisForm.find('[name=CusMode]').val() == 0) {
                FK_Customer = $thisForm.find('[name=ID_FIELD]').val();
            }
            else {
                FK_CustomerOthers = $thisForm.find('[name=ID_FIELD]').val();
            }
            if ($thisForm.find('[name=FK_Product]').val() == 0) {
                FK_Product = $thisForm.find('[name=FK_ProductP]').val();
            }
            else {
                FK_Product = $thisForm.find('[name=FK_Product]').val();
            }
            console.log('LastID_Serviceregistration', LastID_Serviceregistration);
            var inputData =
            {
                __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                'TicketNumber': 0,
                'CustomerMobile': $thisForm.find('[name=CustomerMobile]').val().trim(),
                'CustomeName': $thisForm.find('[name=CustomeName]').val().trim(),
                'CustomerAddress': $thisForm.find('[name=CustomerAddress]').val().trim(),
                'Category': $thisForm.find('[name=Category]').val(),
                'company': $thisForm.find('[name=company]').val(),
                'FK_Customer': FK_Customer,
                'FK_CustomerOthers': FK_CustomerOthers,
                'FK_Product': FK_Product,
                'ID_ComplaintList': $thisForm.find('[name=ID_ComplaintList]').val(),
                'ID_ServiceList': $thisForm.find('[name=ID_ServiceList]').val(),
                'CSRDescription': $thisForm.find('[name=CSRDescription]').val().trim(),
                'Landmark': $thisForm.find('[name=Landmark]').val().trim(),
                'OtherMobile': $thisForm.find('[name=OtherMobile]').val().trim(),
                'Priority': $thisForm.find('[name=Priority]').val(),
                'CSRChannelID': $thisForm.find('[name=CSRChannelID]').val(),
                'CSRChannelSubID': $thisForm.find('[name=CSRChannelSubID]').val(),
                'TicketDate': $thisForm.find('[name=TicketDate]').val().trim(),
                'Servicefromdate': $thisForm.find('[name=Servicefromdate]').val().trim(),
                'Servicetodate': $thisForm.find('[name=Servicetodate]').val().trim(),
                'Servicefromtime': $thisForm.find('[name=Servicefromtime]').val().trim(),
                'Servicetotime': $thisForm.find('[name=Servicetotime]').val().trim(),
                'NextAction': $thisForm.find('[name=NextAction]').val(),
                'EmpId': $thisForm.find('[name=EmpId]').val(),
                'CheckList': CheckList,
                'TicketTime': $thisForm.find('[name=TicketTime]').val().trim(),
                'CategoryID': $thisForm.find('[name=CategoryID]').val(),
                'DistrictID': $thisForm.find('[name=DistrictID]').val(),
                'StatesID': $thisForm.find('[name=StatesID]').val(),
                'CountryID': $thisForm.find('[name=CountryID]').val(),
                'AreaID': $thisForm.find('[name=AreaID]').val(),
                'PostID': $thisForm.find('[name=PostID]').val(),
                'Address2': $thisForm.find('[name=Address2]').val(),
                'LastID': LastID_Serviceregistration,
                'TransMode': ServiceregistrationTransMode,
                'FK_Brand': $thisForm.find('[name="BrandID"]').val(),
                'FK_SubCategory': $thisForm.find('[name="ID_SubCategory"]').val()
            }
        }

            $.ajax({
                url: "@Url.Action("AddCustomerservicerequest","Service")",
                type: "POST",
                data: inputData,
                dataType: "json",
                contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                success: function (ajaxOutput) {


                    if (ajaxOutput.Process.IsProcess) {
                        $('#ConfirmBody').empty();
                        $('.bd-example-modal-lg').modal('hide');

                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            //toastr.success(value, "Success");
                            // NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': value });
                            //let $modal = createSearchModalDOM();

                            // let $message = '<span><b> ' + value + '</b></span>';
                            //$modal.modal.find('.modal-body')
                            //    .addClass('text-black')
                            //    .html($message);
                            //$modal.modal.find('.modal-title')
                            //    .addClass('text-primary')
                            //    .text('Confirmation');

                            //$modal.modal.show();
                            let $register = '';

                            $register += "<br/><div class='row'>";

                            $register += "<div class='col-2'></div>";
                            $register += "<div class='col-10'><span><h3>Registered Successfully</h3></span></div></div>";
                            $register += "</div>";
                            $register += "<br/><div class='row'>";


                            $register += "<div class='col-12'><span style='text-align:center'><h5>" + value + "</h5></span></div></div>";
                            $register += "</div>";

                            $('#Registration').empty();
                            $('#Registration').append($register);
                            $('#registration').modal({ backdrop: 'static', keyboard: false })
                            $('#registration').modal('show');

                        });
                    }
                    else {
                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                        });
                    }
                },
                complete: function () {
                    $(ele).prop('disabled', false);
                }
            });
        }
    //    else {
    //        $(ele).prop('disabled', false);
    //    }
    //}
    //}

    function closeregister(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $thisForm.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
        $thisForm.find('[perfect-ctype="input"]').val('');

        $thisForm.find('[perfect-ctype="hidden"]').val('');
        $thisForm.find('[perfect-ctype="date"]').val('');
        let onSuccess = $thisForm.attr('perfect-onFormSuccess')
        if (onSuccess) {
            window[onSuccess]();
        }
    }
    function fn_UpdateCustomerServiceRegister(ele) {
        $("#complaintid").click();

        $(ele).prop('disabled', true);
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        var isvalid = true;
        if ($thisForm.valid()) {
            //invalid-feedback
            let upperlimit = $thisForm.find('[name="Servicefromdate"]').val();
            let lowerlimit = $thisForm.find('[name="Servicetodate"]').val();

            var enqDate = new Date(upperlimit);
            enqDate.setHours(0, 0, 0, 0)
            var nxtDate = new Date(lowerlimit);
            nxtDate.setHours(0, 0, 0, 0)
            var today = new Date();
            today.setHours(0, 0, 0, 0)

            let upperlimits = $thisForm.find('[name="TicketDate"]').val();
            var enqDates = new Date(upperlimits);

            var todays = new Date();


            if (enqDates.getTime() > todays.getTime()) {

                console.log('inside limit check if')
                $thisForm.find('[name="TicketDate"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                $thisForm.find('[name="TicketDate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Ticket date should be lessthan or equal to Todays date')
                isvalid = false;

            }
            else { }
            let category = $thisForm.find('[name=Category]').val()
            if (category == 2 || category == 4) {

                if ($thisForm.find('[name="FK_Product"]').val() == null || $thisForm.find('[name="FK_Product"]').val() == '') {
                    isvalid = false;
                    $thisForm.find('[name="FK_Product"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                    $thisForm.find('[name="FK_Product"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please select product')

                }

            }
            else {

                if ($thisForm.find('[name="FK_ProductP"]').val() == null || $thisForm.find('[name="FK_ProductP"]').val() == '') {
                    isvalid = false;
                    $thisForm.find('[name="FK_ProductP"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                    $thisForm.find('[name="FK_ProductP"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please select product')
                }

            }
            if (category == 1 || category == 2) {


                if ($thisForm.find('[name="ID_ServiceList"]').val() == null || $thisForm.find('[name="ID_ServiceList"]').val() == '') {

                    isvalid = false;
                    $thisForm.find('[name="ID_ServiceList"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                    $thisForm.find('[name="ID_ServiceList"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please select service')
                }

            }
            else {

                if ($thisForm.find('[name="ID_ComplaintList"]').val() == null || $thisForm.find('[name="ID_ComplaintList"]').val() == '') {
                    isvalid = false;
                    $thisForm.find('[name="ID_ComplaintList"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                    $thisForm.find('[name="ID_ComplaintList"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please select complaint')
                }

            }


            if (enqDate > nxtDate) {
                $thisForm.find('[name="Servicetodate"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                $thisForm.find('[name="Servicetodate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('To date should be greaterthan or equal to From date')
                isvalid = false;
            }

            if (enqDate < today) {

                console.log('inside limit check if')
                $thisForm.find('[name="Servicefromdate"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                $thisForm.find('[name="Servicefromdate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('From date should be greaterthan or equal to Todays date')
                isvalid = false;

            }

            if ($thisForm.find('[name=NextAction]').val() == 0 || $thisForm.find('[name=NextAction]').val() == '' || $thisForm.find('[name=NextAction]').val() == null) {

            }
            else {
                if ($thisForm.find('[name=EmpId]').val() == 0 || $thisForm.find('[name=EmpId]').val() == '' || $thisForm.find('[name=EmpId]').val() == null) {
                    $thisForm.find('[name="EmpId"]').closest('[perfect-class="formGroup"]').find('.limit-check').attr("style", "display:block")
                    $thisForm.find('[name="EmpId"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Please Select Attended by')

                    isvalid = false;
                }
            }


            let CompServ = '';
            let CompName = '';
            let ProductName = '';


            if ($thisForm.find('[name=FK_Product]').val() == 0) {
                ProductName = $thisForm.find('[name=ProductNameP]').val();
            }
            else {
                ProductName = $thisForm.find('[name=ProductName]').val();
            }
            console.log('dasd', $thisForm.find('[name=ID_ComplaintList]').val());
            if ($thisForm.find('[name=ID_ComplaintList]').val() == 0 || $thisForm.find('[name=ID_ComplaintList]').val() == '' || $thisForm.find('[name=ID_ComplaintList]').val() == null) {
                CompName = 'Service';
                CompServ = $thisForm.find('[name="ID_ServiceList"] option:selected').text();
            }
            else {
                CompName = 'Complaint';
                CompServ = $thisForm.find('[name="ID_ComplaintList"] option:selected').text();
            }

            if (isvalid) {

                let FK_Customer = 0;
                let FK_CustomerOthers = 0;
                let FK_Product = 0;

                if ($thisForm.find('[name=CusMode]').val() == 0) {
                    FK_Customer = $thisForm.find('[name=ID_FIELD]').val();
                }
                else {
                    FK_CustomerOthers = $thisForm.find('[name=ID_FIELD]').val();
                }

                if ($thisForm.find('[name=FK_Product]').val() == 0) {
                    FK_Product = $thisForm.find('[name=FK_ProductP]').val();
                }
                else {
                    FK_Product = $thisForm.find('[name=FK_Product]').val();
                }


                var inputData =
                {
                    __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                    'ID_Customerserviceregister': $thisForm.find('[name="ID_Customerserviceregister"]').val(),
                    'TicketNumber': $thisForm.find('[name="TicketNumber"]').val(),
                    'CustomerMobile': $thisForm.find('[name=CustomerMobile]').val().trim(),
                    'CustomeName': $thisForm.find('[name=CustomeName]').val().trim(),
                    'CustomerAddress': $thisForm.find('[name=CustomerAddress]').val().trim(),
                    'Category': $thisForm.find('[name=Category]').val(),
                    'company': $thisForm.find('[name=company]').val(),
                    'FK_Customer': FK_Customer,
                    'FK_CustomerOthers': FK_CustomerOthers,
                    'FK_Product': FK_Product,
                    'ID_ComplaintList': $thisForm.find('[name=ID_ComplaintList]').val(),
                    'ID_ServiceList': $thisForm.find('[name=ID_ServiceList]').val(),
                    'CSRDescription': $thisForm.find('[name=CSRDescription]').val().trim(),
                    'Landmark': $thisForm.find('[name=Landmark]').val().trim(),
                    'OtherMobile': $thisForm.find('[name=OtherMobile]').val().trim(),
                    'Priority': $thisForm.find('[name=Priority]').val(),
                    'CSRChannelID': $thisForm.find('[name=CSRChannelID]').val(),
                    'CSRChannelSubID': $thisForm.find('[name=CSRChannelSubID]').val(),
                    'Servicefromdate': $thisForm.find('[name=Servicefromdate]').val().trim(),
                    'Servicetodate': $thisForm.find('[name=Servicetodate]').val().trim(),
                    'Servicefromtime': $thisForm.find('[name=Servicefromtime]').val().trim(),
                    'TicketDate': $thisForm.find('[name=TicketDate]').val().trim(),
                    'Servicetotime': $thisForm.find('[name=Servicetotime]').val().trim(),
                    'NextAction': $thisForm.find('[name=NextAction]').val(),
                    'EmpId': $thisForm.find('[name=EmpId]').val(),
                    'CheckList': CheckList,
                    'TransMode': ServiceregistrationTransMode,
                    'TicketTime': $thisForm.find('[name=TicketTime]').val().trim(),
                    'CategoryID': $thisForm.find('[name=CategoryID]').val(),
                    'DistrictID': $thisForm.find('[name=DistrictID]').val(),
                    'StatesID': $thisForm.find('[name=StatesID]').val(),
                    'CountryID': $thisForm.find('[name=CountryID]').val(),
                    'AreaID': $thisForm.find('[name=AreaID]').val(),
                    'PostID': $thisForm.find('[name=PostID]').val(),
                    'Address2': $thisForm.find('[name=Address2]').val(),
                    'TransMode': ServiceregistrationTransMode,
                    'FK_Brand': $thisForm.find('[name="BrandID"]').val(),
                    'FK_SubCategory': $thisForm.find('[name="ID_SubCategory"]').val()
            }
                }

                $.ajax({
                    url: "@Url.Action("UpdateCustomerservicerequest", "Service")",
                    type: "POST",
                    data: inputData,
                    dataType: "json",
                    contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                    success: function (ajaxOutput) {


                        if (ajaxOutput.Process.IsProcess) {

                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                //toastr.success(value, "Success");
                                NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': value });
                            });


                            let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                            if (onSuccess) {

                                window[onSuccess]();
                            }


                        }
                        else {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                            });
                        }
                    },
                    complete: function () {
                        $(ele).prop('disabled', false);
                    }
                });
            }

        }



            function fn_customerForm_loadState(ele)
            {



               $('#formGroupModalcustmr').modal('show');


               let $savimgContainer = $('#custmr-sav');




          }
    function fn_scustomerIndex_initialLoad() {

        $('#formGroupModalcustmr').modal('hide');

    }





    function fn_bindcustomerdetails(ele) {

        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let popcusname = $thisForm.find('[name=Name]').val();
        let popcusmobile = $thisForm.find('[name=Mobile]').val();
        let popcusaddress = $thisForm.find('[name=Address1]').val();
        let popcountry = $thisForm.find('[name=CountryID]').val();
        let popstate = $thisForm.find('[name=StatesID]').val();
        let popdistrict = $thisForm.find('[name=DistrictID]').val();

        let _isValid = false;
        $thisForm.find('[perfect-tempTable-Name="Name"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('');
        $thisForm.find('[perfect-tempTable-Mobile="Mobile"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('');
       // $thisForm.find('[perfect-tempTabl-Address1="Address1"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('');
        $thisForm.find('[perfect-tempTabl-CountryID="CountryID"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('');
        $thisForm.find('[perfect-tempTable-StatesID="StatesID"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('');

        if (popcusname != "") {
            if (popcusmobile != "") {

                    if (popcountry != 0) {
                        if (popstate != 0) {
                            if (popdistrict != 0) {
                                _isValid = true;
                            }
                            else {
                                _isValid = false;
                                $thisForm.find('[perfect-tempTable-DistrictID="DistrictID"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('Please Enter District');
                            }
                        }
                        else {
                            _isValid = false;
                            $thisForm.find('[perfect-tempTable-StatesID="StatesID"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('Please Enter State');
                        }
                    }
                    else {
                        _isValid = false;
                        $thisForm.find('[perfect-tempTable-CountryID="CountryID"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('Please Enter Country');
                    }
                }


            else {
                _isValid = false;
                $thisForm.find('[perfect-tempTable-Mobile="Mobile"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('Please Enter Mobile Number');
            }
        }
        else {
            _isValid = false;
            $thisForm.find('[perfect-tempTable-Name="Name"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('Please Enter Name');

        }
        if (popcusmobile.length< 10) {
            _isValid = false;
            $thisForm.find('[perfect-tempTable-Mobile="Mobile"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('Please Enter a Valid Mobile Number');

        }


        if (_isValid) {


            $thisForm.find('[name=CustomeName]').val(popcusname);


            $thisForm.find('[name=CustomerMobile]').val(popcusmobile);

            $thisForm.find('[name=CustomerAddress]').val(popcusaddress);


            $('#formGroupModalcustmr').modal('hide');
        }
        else {
            $('#formGroupModalcustmr').modal('show');
        }

    }


    function clearproduct(ele) {


        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');


        let updatebut = $thisForm.find('[name="update"]');
        if (!updatebut.hasClass('d-none') && num1 == 0) {

            //getfunction(ele);
            //fn_commonlisthistory(ele, 1, 1)
            //fn_commonlisthistory(ele, 2, 1)
            //fn_commonlisthistory(ele, 3, 1)
            GetSubcategory(ele);


        } else {


            $thisForm.find('[name=FK_ProductP]').val(0);
            $thisForm.find('[name=ProductNameP]').val('');
            $thisForm.find('[name=FK_Product]').val(0);
            $thisForm.find('[name=ProductName]').val('');
            $thisForm.find('[name="CSRDescription"]').val('')
            //getfunction(ele); add callback instead of this
            getfunctioncallback(ele, function () {
                //alert(5)
                GetSubcategorycallback(ele);
            });
            //fn_commonlisthistory(ele, 1, 1)
            //fn_commonlisthistory(ele, 2, 1)
            //fn_commonlisthistory(ele, 3, 1)
            //GetSubcategory(ele);
        };
        num1++;



    }
    function getfunctioncallback(ele,callback) {
        getfunction(ele);
        callback();
    }
    function GetSubcategorycallback(ele) {
        GetSubcategory(ele);
    }

        
    function Getproductwisepervioushistroy(ele, Mode, div) {

     if (div == 1) {
         $('.Divcontact').show();
     }
     else {
         $('.Divcontact').hide();
     }
     let $thisForm = $(ele).closest('[perfect-class="form"]');
     let FK_Customer = 0;
     let FK_CustomerOthers = 0;
     let FK_Product = 0;
     let FK_Category = 0;
     if ($thisForm.find('[name=CusMode]').val() != '') {
         if ($thisForm.find('[name=CusMode]').val() == 0) {

             FK_Customer = $thisForm.find('[name=ID_FIELD]').val();

         }
         else
         {
             FK_CustomerOthers = $thisForm.find('[name=ID_FIELD]').val();
         }
     }
     if ($thisForm.find('[name=FK_Product]').val() != '' || $thisForm.find('[name=FK_ProductP]').val()!='') {
         if ($thisForm.find('[name=FK_Product]').val() == 0) {
             FK_Product = $thisForm.find('[name=FK_ProductP]').val();
         }
         else {
             FK_Product = $thisForm.find('[name=FK_Product]').val();
         }
     }
     FK_Category = $thisForm.find('[name=CategoryID]').val();
     var obj = {

         FK_Customer: FK_Customer,
         FK_CustomerOthers: FK_CustomerOthers,
         FK_Product: FK_Product,
         FK_Category: FK_Category,
         Mode: Mode
         }

         $.ajax({
                 url: "@Url.Action("getBillList", "Service")",
                type: "POST",
                data: obj ,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
                  success: function (ajaxOutput) {
                 console.log(ajaxOutput)
                 if (ajaxOutput.Process.IsProcess) {

                     let table = JSON.parse(ajaxOutput.Data);
                     if (Mode == 1) {
                         $('#warrantyhis').html(pft_table_createtable(table.dtable, WarrantytableOptions))
                         document.getElementById("warrntydt").style.display = 'none';
                     }
                     if (Mode == 2)
                     {
                         $('#servicehis').html(pft_table_createtable(table.dtable, ProducttableOptions))
                         document.getElementById("servdet").style.display = 'none';
                     }
                     else if (Mode == 3)
                     {
                         $('#prodhis').html(pft_table_createtable(table.dtable, { serialNo: true }))

                         document.getElementById("proddet").style.display = 'none';
                     }


                 }
                 else {

                     if (Mode == 1) {
                         $('#warrantybadge').html(0);
                       //  document.getElementById("warrntydt").style.display = 'block';
                         document.getElementById("Warrantydet").style.display = 'none';
                         document.getElementById("Warrantyheader").style.display = 'none';
                         $('#warrantyhis').html('')
                         $('#warrntydt').html("<p style='text-align:center;' >No Records..</p>");
                     }
                     else if (Mode == 2) {
                         $('#servicehis').html('')
                         $('#servicebadge').html(0);
                         document.getElementById("servdet").style.display = 'block';
                         $('#servdet').html("<p style='text-align:center;' >No Records..</p>");
                     }
                     else {
                         $('#productbadge').html(0);
                         document.getElementById("proddet").style.display = 'block';
                         $('#proddet').html("<p style='text-align:center;' >No Records..</p>");
                         $('#prodhis').html('')
                     }
                     //$.each(ajaxOutput.Process.Message, function (key, value) {
                     //    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                     //});
                 }

               }

         });
}
     function searchbtn(ele) {

        console.log('Search function run')
     let $thisForm = $(ele).closest('[perfect-class="form"]');
        let searchPin = { Pincode: $thisForm.find('[name="PinCode"]').val() };
       $.ajax({
            url: '@Url.Action("GetPinCodedetails", "Organization")',
            type: "POST",
            data: searchPin ,//<---- Input json : data passed to controller
           dataType: "json",
           contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            success: function (ajaxOutput) {
                console.log('> Search button click success', ajaxOutput);

                if (ajaxOutput.Process.IsProcess) {


                    var selectedList = createSelectList({ data: ajaxOutput.Data, hideColumn: ["StatesID", "DistrictID", "CountryID", "PlaceID", "PostID", "AreaID"], settings: { size: "modal-lg" }, headingText: 'Pincode List'  });
                    selectedList.then(function (ret) {
                        if (ret) {
                            //__RequestVerificationToken: $('[name="__RequestVerificationToken"]').val();

                             $thisForm.find('[name="CountryID"]').val(ret['CountryID']);
                            $thisForm.find('[name="Country"]').val(ret['Country']);
                            $thisForm.find('[name="StatesID"]').val(ret['StatesID']);
                            $thisForm.find('[name="States"]').val(ret['States']);
                            $thisForm.find('[name="DistrictID"]').val(ret['DistrictID']);
                            $thisForm.find('[name="District"]').val(ret['District']);
                            $thisForm.find('[name="AreaID"]').val(ret['AreaID']);
                            $thisForm.find('[name="Area"]').val(ret['Area']);
                            $thisForm.find('[name="PlaceID"]').val(ret['PlaceID']);
                            $thisForm.find('[name="Place"]').val(ret['Place']);
                            $thisForm.find('[name="PostID"]').val(ret['PostID']);
                            $thisForm.find('[name="Post"]').val(ret['Post']);
                           $thisForm.find('[name="PinCode"]').val(ret['PinCode']);
                        }
                        else {
                            console.log(ret);
                        }
                    });

                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        //toastr.warning(value, "Error");
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }




            },
            complete: function () {

                //a.find('.dataTables_wrapper').css('width', '100%');
            }
        });

    }
    function fn_cleardetails(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');

       $thisForm.find('[name=Name]').val('');
       $thisForm.find('[name=Mobile]').val('');
        $thisForm.find('[name=Address1]').val('');
        $thisForm.find('[name=PostID]').val('');
        $thisForm.find('[name=Post]').val('');
        $thisForm.find('[name=AreaID]').val('');
        $thisForm.find('[name=Area]').val('');
        $thisForm.find('[name=PinCode]').val('');
        $thisForm.find('[name=Address2]').val('');
        $thisForm.find('[name=CustomerAddress]').val('');
        $thisForm.find('[name=CustomerMobile]').val('');
        $thisForm.find('[name=CusMode]').val('');
        $thisForm.find('[name=ID_FIELD]').val('');
        $thisForm.find('[name=CustomeName]').val('');
        $thisForm.find('[name=CountryID]').val('@ViewBag.ID_Country');
        $thisForm.find('[name=Country]').val('@ViewBag.CountryName');
        $thisForm.find('[name=StatesID]').val('@ViewBag.ID_State');
         $thisForm.find('[name=States]').val('@ViewBag.StateName');

        $thisForm.find('[name=DistrictID]').val('@ViewBag.ID_District');
        $thisForm.find('[name=District]').val('@ViewBag.DistrictName');





    }
    function fn_GetCustomerAccountBalance(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let FK_Customer = 0;

        if ($thisForm.find('[name=CusMode]').val() != '') {
            if ($thisForm.find('[name=CusMode]').val() == 0) {
                FK_Customer = $thisForm.find('[name=ID_FIELD]').val();
            }
            else {
                FK_CustomerOthers = $thisForm.find('[name=ID_FIELD]').val();
            }
        }


        var obj = {
            FK_Customer: FK_Customer,
            TransDate: $thisForm.find('[name=TicketTime]').val(),
        }

        $.ajax({
            url: "@Url.Action("getGetCustomerAccountBalance", "Service")",
            type: "POST",
            data: obj,
            dataType: "json",
            contentType: "application/x-www-form-urlencoded;charset=utf-8",
            success: function (ajaxOutput) {

                if (ajaxOutput.Process.IsProcess) {

                    let table = JSON.parse(ajaxOutput.Data);
                    $('#Accountbalancedetailss').html(pft_table_createtable(table.dtable, { serialNo: true }))
                    document.getElementById("Accountbalancedetails").style.display = 'none';
                    var dataTable = table.dtable;
                    $('#accountbadge').html(dataTable.length);
                }
                else {


                    $('#accountbadge').html(0);
                    document.getElementById("Accountbalancedetails").style.display = 'block';
                       $('#Accountbalancedetails').html("<p style='text-align:center;' >No Records..</p>");
                    $('#Accountbalancedetailss').html('')
                    }
            }

        });

    }
    function clearcustomerchange(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');

        $thisForm.find('[name= FK_Product]').val(0);
        $thisForm.find('[name= FK_ProductP]').val(0);
        $thisForm.find('[name=ProductNameP]').val('');
        $thisForm.find('[name=ProductName]').val('');
        $thisForm.find('[name=CategoryID]') .val('').selectpicker('refresh')


    }
    function checkemi(ele,bill_id) {
        //let $thisForm = $(ele).closest('[perfect-class="form"]');
        let FK_sales;

        $('#prodhis').find('tbody tr').each(function (index, ele) {

            FK_sales = $(ele).find('.InvoiceNo').text()


            if (FK_sales !="") {
                $('.LedgerBalance').eq(index).show();
            }
            else {
                $('.LedgerBalance').eq(index).removeClass('d-flex')
                $('.LedgerBalance').eq(index).hide();
            }

        });
    }

    var fromTimeInput = document.querySelector('input[name="Servicefromtime"]');
    var toTimeInput = document.querySelector('input[name="Servicetotime"]');

    // Get reference to the validation message element
    var validationMessages = document.getElementById('timeValidationMessage');

    // Add an event listener to the "To Time" input to perform validation on change
    toTimeInput.addEventListener('change', function () {
        // Get the values of the "From Time" and "To Time" inputs
        var fromTime = fromTimeInput.valueAsDate;
        var toTime = toTimeInput.valueAsDate;

        // Check if "To Time" is less than or equal to "From Time"
        if (fromTime && toTime && fromTime >= toTime) {
            // Display a validation message
            validationMessages.textContent = 'To Time should be greater than From Time.';
            toTimeInput.setCustomValidity('To Time should be greater than From Time.');
        } else {
            // Clear the validation message and reset validation state
            validationMessages.textContent = '';
            toTimeInput.setCustomValidity('');
        }
    });
</script>





