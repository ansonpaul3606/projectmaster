

@model PerfectWebERP.Models.PickUpandDelivery.DeliveryPickupassignView


<style>
    .switch {
        position: relative;
        display: inline-block;
        width: 45px;
        height: 20px;
        vertical-align: middle;
        margin-top: 8px;
    }

        .switch input {
            display: none;
        }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #A1A6AB;
        -webkit-transition: .4s;
        transition: .4s;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 14px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

    input:checked + .slider {
        background-color: #2aa2ad;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
    }
    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

        .slider.round:before {
            border-radius: 50%;
        }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }




    form .error {
        color: #ff0000;
    }

    .tableFixHead {
        overflow: auto;
        height: 242px;
    }

        .tableFixHead thead tr {
            position: sticky;
            top: 0;
            z-index: 1;
        }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        padding: 8px 16px;
    }

    th {
        background: var(--perfect-primary);
    }

</style>


<div class="card">
    <div class="card-header">
        <div class="col-xl-4">
            <h4 class="card-title col-12">PickUp and Delivery</h4>

        </div>

        <div class="col-xl-4 text-right">
            <button id="refreshDeliveryPickup" type="button" class="btn btn-primary btn-sm" name="Search" title="To Refresh" perfect-css="button" onclick="fn_LoadDeliveryPickup()"><i class="fa fa-refresh"></i></button>
            <button id="deliverypickfilter" type="button" class="btn btn-primary btn-sm" name="Search" title="To Filter" onclick="fn_showFilter()"><i class="fa fa-filter"></i></button>
            @*&nbsp; &nbsp; &nbsp; <span title="To View List" onclick="fn_showListView();"><svg id="Layer_1" class="layer" stroke="currentColor" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 122.88 122.54"><title>To View List</title><path class="viewlst" d="M4.69,0H46.22a4.71,4.71,0,0,1,4.69,4.69V46a4.69,4.69,0,0,1-4.69,4.69H4.69a4.65,4.65,0,0,1-3.31-1.38l-.09-.09A4.67,4.67,0,0,1,0,46V4.69A4.71,4.71,0,0,1,4.69,0ZM89.44,61.94a26.56,26.56,0,0,1,10.18,2l.07,0a26.61,26.61,0,0,1,15.25,32.16,26.18,26.18,0,0,1-2.7,6.11l10.3,11.24a1.27,1.27,0,0,1-.07,1.8l-7.57,6.9a1.27,1.27,0,0,1-1.79-.07l-9.86-10.85a26.36,26.36,0,0,1-6.1,2.74,26.87,26.87,0,0,1-7.71,1.13,26.51,26.51,0,0,1-10.17-2l-.07,0A26.64,26.64,0,0,1,64.85,78.37l0-.07A26.6,26.6,0,0,1,89.44,61.94Zm15,11.59a21.38,21.38,0,0,0-6.89-4.61l-.06,0a21.22,21.22,0,0,0-23.07,4.64l-.07.07a21.25,21.25,0,0,0-4.54,6.83l0,.06a21.32,21.32,0,0,0-1.58,8.06,21.26,21.26,0,0,0,29.35,19.62,21.54,21.54,0,0,0,6.89-4.61l.07-.07a21.09,21.09,0,0,0,4.54-6.83l0-.06a21.35,21.35,0,0,0,0-16.17,21.34,21.34,0,0,0-4.62-6.9ZM4.69,63.2H46.22a4.71,4.71,0,0,1,4.69,4.7v41.34a4.68,4.68,0,0,1-4.69,4.69H4.69A4.69,4.69,0,0,1,0,109.24V67.9a4.71,4.71,0,0,1,4.69-4.7ZM68.78,0h41.53A4.71,4.71,0,0,1,115,4.69V46a4.71,4.71,0,0,1-4.69,4.69H68.78A4.71,4.71,0,0,1,64.09,46V4.69a4.69,4.69,0,0,1,1.37-3.31l.1-.09A4.67,4.67,0,0,1,68.78,0Z"></path></svg></span>*@

        </div>

    </div>

    <div class="card-body jq_deliverypickup_body">
        <form id="idfrm" class="form-valide" perfect-class="formassign" action="#" method="post" perfect-onFormSuccess="">
            <div class="deliverypickform">
                @Html.AntiForgeryToken()
                <div class="row">

                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>From Date</label>
                            <input type="hidden" name="frmDate" />
                            <input type="date" class="form-control " id="FrmDate" name="FromDate" perfect-class="formGroupControl" title="From Date" perfect-ctype="date" perfect-css="date" />
                            @*<div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>*@
                            <div class="invalid-feedback d-block" id="dateError"></div>
                            

                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>To Date</label>
                            <input type="hidden" name="LeadGenerateID" />
                            <input type="date" class="form-control " name="ToDate" perfect-class="formGroupControl" title="To Date" perfect-ctype="date" perfect-css="date" />
                         
                        </div>
                    </div>
                    <div class="col-sm-3 mt-4 pt-1">
                        <div class="form-group">
                            <div class="input-group">
                                <input type="text" class="form-control" name="AreaName" perfect-class="formGroupControl" placeholder=" Select Area" perfect-ctype="input" perfect-css="input" perfect-tempTable-cstatus="Area" disabled />
                                <input type="hidden" name="AreaID" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" perfect-tempTable-cstatus="Area ID" />
                                <div class="input-group-append">
                                    <button id="addproduct-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,14,'Area List',[])" form="formassign" Criterea1="0" Criterea2="0" BindName="AreaName" BindVal="AreaID"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3 mt-4 pt-1">
                        <div class="input-group">

                            @if (!(Model.EmployeeInfoList is null))
                            {
                                foreach (var EmployeeInfo in Model.EmployeeInfoList)
                                {
                                    <input type="text" class="form-control " name="EmployeeSearch" perfect-class="formGroupControl" placeholder="Select Employee" perfect-ctype="input" perfect-css="input" disabled value="@EmployeeInfo.EmpFName" />

                                }
                            }


                            <input type="hidden" name="FK_EmployeeSearch" class="form-control " perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" value="@ViewBag.FK_Employee" />
                            <input type="hidden" name="UserCode" class="exptbttontoogle" value="@Model.UserCode" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                            <div class="input-group-append">

                                <button id="addarea-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,61,'Employee List',[])" form="formassign" Criterea1="0" Criterea2="0" Criterea3="UserCode" BindName="EmployeeSearch" BindVal="FK_EmployeeSearch"></button>
                                @*<button id="addarea-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,6,'Employee List',[])" form="formassign" Criterea1="0" BindName="EmployeeSearch" BindVal="FK_EmployeeSearch"></button>*@
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <input type="text" name="Customer" class="form-control" placeholder="Enter Customer">
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Customer Mobile</label>*@
                            <input type="text" name="Mobile" class="form-control" placeholder="Customer Mobile" onkeypress="return isNumberKey(event)">
                        </div>
                    </div>

                    <div class="col-sm-3" style="display:none;">
                        <div class="form-group">
                            @*<label>Product</label>*@
                            <div class="input-group">
                                <input type="text" class="form-control" name="ProductName" perfect-class="formGroupControl" placeholder=" Select Product" perfect-ctype="input" perfect-css="input" disabled />
                                <input type="hidden" name="ProductID" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <div class="input-group-append">
                                    <button id="addproduct-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,18,'Product List',[])" form="formassign" Criterea1="0" Criterea2="0" BindName="ProductName" BindVal="ProductID"></button>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Status</label>*@
                            <select class="form-control" name="Complaintstatus">
                                <option value="1">Select Status</option>
                                <option value="1">Pending</option>
                                <option value="2">Completed</option>


                            </select>
                        </div>
                    </div>


                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Ticket Number</label>*@
                            <input type="text" name="Ticket" class="form-control" placeholder="Ticket Number">
                        </div>
                    </div>

                    <div class="col-sm-2">
                        <input type="hidden" name="filt" />
                        <input type="hidden" name="md" />
                        <button id="deliverypickfilter" type="button" class="btn btn-primary btn-sm" href="#profile" name="Search" perfect-css="button" onclick="fn_DeliverySearchbyfilter(this)"><i class="fa fa-refresh fa-spin loaderClass"></i>Search</button>
                        <button id="deliverypickfilterClear" type="button" class="btn btn-light btn-sm " name="Clearfilter" perfect-css="button" onclick="FilterReset(this)"><i class="fa fa-refresh fa-spin loaderClass "></i>Clear</button>

                    </div>
                    @*<div class="col-sm-1">
                            <button id="deliverypickfilterClear" type="button" class="btn btn-light btn-sm " name="Clearfilter" perfect-css="button" onclick="FilterReset (this)"><i class="fa fa-refresh fa-spin loaderClass "></i>Clear</button>
                        </div>*@

                </div>
            </div>

            <br />

            <!--// TAB TABLES //-->

            <div class="row">
                <div class="col-xl-12">
                    <div class="default-tab">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="Pickupnav" data-toggle="tab" href="#home" onclick="fn_Delivery_Pickup_tab(this, 1, '#pickupid', pickupTableOptions)"><i class="fa fa-truck mr-2"></i> Pick Up &nbsp;&nbsp;<span><label id="togPickup" class="badge badge-circle badge-info">0</label></span></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="deliverynav" data-toggle="tab" href="#profile" onclick="fn_Delivery_Pickup_tab(this, 2, '#deliveryid', deliveryTableOptions)"><i class="fa fa-truck mr-2"></i> Delivery &nbsp;&nbsp;<span><label id="togdelivery" class="badge badge-circle badge-info">0</label></span></a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade active show" id="home" role="tabpanel">
                                <br />
                                <div class="row">
                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv" id="pickupid">
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="profile">
                                <br />
                                <div class="row">
                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv" id="deliveryid"></div>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>

        </form>

    </div>


    <div class="modal fade bd-del-modal-sm" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-xl" id="delmodalid">



            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title Deliveryassign">Update Delivery Status</h5>
                    <h5 class="modal-title Editassigndel" style="display:none">Edit Assign</h5>
                    <button type="button" class="close" data-dismiss="modal" onclick="resetdelmodal(this)">
                        <span>×</span>
                    </button>
                </div>
                <form class="form-valide" perfect-class="form" id="delformid" action="#" method="post" perfect-onFormSuccess="">
                    <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh -200px); overflow-y: auto;">

                        <div class="form-group row" id="TopInfoDetails"></div>
                        <div class="form-group row" id="TopInfoDetails2"></div>

                        <input type="hidden" id="Pick_ID_ProductDeliveryAssign" />
                        <input type="hidden" name="FK_Customerserviceregister" />
                        <input type="hidden" id="PickEmployee" value="" />

                        <div class="row">





                            <div class="col-sm-4">

                                <div class="profile-personal-info">


                                    <h4 class='text-primary mb-4'>Ticket Details</h4>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Ticket Number:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="CSRTickno" perfect-ctype="input" perfect-css="input"><span id="spanCSRTickno"></span></label>

                                        </div>

                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Registered On:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" type="date" perfect-class="formGroupControl" name="CSRRegDate" perfect-ctype="input" perfect-css="input"><span id="spanCSRRegDate"></span></label>

                                        </div>

                                    </div>


                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="profile-personal-info">


                                    <h4 class='text-primary mb-4'>Customer Details</h4>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Customer Name:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Customer" perfect-ctype="input" perfect-css="input"><span id="spanCustomer"></span></label>

                                        </div>

                                    </div>
                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Address:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address1" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanAddress1"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Area" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanArea"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address2" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanAddress2"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="District" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanDistrict"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="State" perfect-ctype="input" perfect-css="input"><sapn id="spanState"></sapn></label>

                                        </div>

                                    </div>

                                </div>
                            </div>


                            <div class="col-sm-4">

                                <div class="profile-personal-info">


                                    <h4 class='text-primary mb-4'>Product Details</h4>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Product:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Product" perfect-ctype="input" perfect-css="input"><span id="spanProduct"></span></label>

                                        </div>

                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Category:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" type="date" perfect-class="formGroupControl" name="Category" perfect-ctype="input" perfect-css="input"><span id="spanCategory"></span></label>

                                        </div>

                                    </div>


                                </div>
                            </div>


                        </div>

                        <div class="form-group row">
                            <div class="col-md-3" perfect-class="formGroup" id="Deliverydate">
                                <label>Delivery Date</label>&nbsp;<span class="text-danger">*</span>
                                <input type="date" class="form-control perfectValidate_date" name="PdAssignedDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="2000-01-01" max="2050-01-01" onchange="deldatecheck(this)">
                                <span id='delit' class='error'></span>
                                <div class="invalid-feedback animated fadeInUp temptableErrors"></div>
                            </div>
                            <div class="col-md-3" id="Deliverytime">
                                <label>Delivery Time</label>&nbsp;@*<span class="text-danger">*</span>*@

                                <input type="time" class="form-control perfectValidate_time" placeholder="" name="PdAssignedTime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                @*<span id='deltme' class='error'></span>*@
                            </div>

                            @*<div class="col-md-3" id="Priority">
                                    <label>Priority</label>&nbsp;<span class="text-danger">*</span>
                                    <select class="form-control perfectValidate_string" name="CSAPriority">
                                        <option value="">Please select</option>
                                        <option value="1">High</option>
                                        <option value="2">Medium</option>
                                        <option value="3">Low</option>

                                    </select>
                                </div>*@
                            <div class="col-md-3" id="Remarks">
                                <label>Remark</label>&nbsp;
                                <input type="text" name="PdVehicleDetails" class="form-control" perfect-class="formGroupControl" oninput="this.value = this.value.replace(/[^A-Za-z0-9,. ()&]/g, '').replace(/\*(?=\.)*/g, '$1');" perfect-ctype="input" maxlength="250" perfect-css="input" />
                            </div>
                        </div>



                        <div class="form-group row">

                            <div class="card">
                                <div class="profile-personal-info" style="margin-bottom:-14px;">
                                    <h4 class='text-primary mb-4'>Product Information</h4>
                                </div>
                                <div class="card-body" style="padding:0px">
                                    <div class="table-responsive-sm tableFixHead" id="replaceproducttable">
                                        <table class="table table-hover table-responsive-sm table-striped  text-black" id="ProductDetailsdel">
                                            <thead class="bg-primary text-white">
                                                <tr>

                                                    <th style="display:none"> </th>

                                                    <th></th>
                                                    <th>Product Name</th>
                                                    <th>Quantity</th>
                                                    <th>Return Standby</th>
                                                    <th>StandBy Product</th>
                                                    <th>StandBy Quantity</th>
                                                    <th hidden>StandBy Amount</th>
                                                    <th>Remarks</th>


                                                </tr>
                                            </thead>
                                            <tbody id="ProductDetailsTbodyP">
                                                <tr id="0">
                                                    <td colspan="8" style="text-align:center;">No Records...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group row">

                            <div class="col-md-3" id="status">
                                <label>Follow Up Status</label> <span class="text-danger">*</span>&nbsp;
                                <select class="form-control perfectValidate_string" name="CSAstatus" onchange="ShowDeliveryStatus(this)">
                                    <option value="">Please select</option>
                                    <option value="1">Open</option>
                                    <option value="2">Closed</option>


                                </select> <span id="delCsta" class="error"></span>
                            </div>
                            <div class="col-md-3" id="divdeliverystatus">
                                <label>Delivery Status</label> <span class="text-danger">*</span>&nbsp;
                                <select class="form-control perfectValidate_string" name="Pickupstatus">
                                    <option value="">Please select</option>
                                    <option value="1">Open</option>
                                    <option value="2">Closed</option>


                                </select> <span id="delCsta1" class="error"></span>
                            </div>

                            <div class="col-md-3" id="status" hidden>

                                <label>Ticket Status</label><span class="text-danger">*</span>


                                <select class="form-control perfectValidate_string" name="ID_NextAction" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">

                                    <option value="">Please select</option>
                                    @if (!(Model.StatusList is null))
                                    {
                                        foreach (var Mode in Model.StatusList)
                                        {
                                            <option value="@Mode.ID_NextAction">@Mode.NxtActnName</option>
                                        }
                                    }
                                </select>
                                <span id="delsta" class="error"></span>


                            </div>
                            <div class="col-sm-3" hidden>
                                <label><span>Stand By Total</span></label>
                                <input type="text" class="form-control  text-right" readonly="readonly" placeholder="" name="StandByTotalAmounts" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" onchange="Checkstandbyamount(this)" />
                            </div>

                            <div class="col-sm-3" hidden>
                                <div class="form-group row" perfect-class="formGroup">
                                    <label>Payment Method</label>
                                    <div class="input-group">

                                        <div class="input-group-append">
                                            &nbsp;<button id="addcountry-jq-searchButton3" class="btn btn-primary fa fa-money" type="button" perfect-css="button" title="Add Payment Method" onclick="GetPaymentlists(this,1)"></button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal fade" perfect-class="formGroupModalpayment2" id="formGroupModalpayment2">
                                <div class="modal-dialog  modal-dialog-centered modal-md" role="document" id="paymentmodal2">
                                    <div class="modal-content">
                                        <div class="modal-header border-0">
                                            <h5 class="modal-title">Payment Method</h5>
                                            <button type="button" class="close" onclick="Hidepaymentmethod2(this)">
                                                <span>&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;padding: 1rem;">
                                            <div class="row">


                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">
                                                        <label class="col-sm-4 col-form-label">Method <span class="text-danger">*</span></label>
                                                        <div class="col-sm-8">
                                                            <div class="input-group">
                                                                <select class="form-control" perfect-tempTable-Payment="PaymentMethod" name="PaymentMethod" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                                                    <option value="">Please Select </option>


                                                                    @if (!(Model.PaymentView is null))
                                                                    {
                                                                        foreach (var Module in Model.PaymentView)
                                                                        {
                                                                            <option value="@Module.PaymentmethodID">@Module.Name</option>
                                                                        }
                                                                    }
                                                                </select>


                                                            </div>
                                                            <div class="text-danger temptableError"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">
                                                        <label class="col-sm-4 col-form-label">
                                                            <span perfect-class="formGroupLabel">Ref No.</span>

                                                        </label>
                                                        <div class="col-sm-8">

                                                            <div class="input-group">
                                                                <input type="text" class="form-control " perfect-tempTable-Payment="Refno" name="Refno" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="250" />

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">
                                                        <label class="col-sm-4 col-form-label">
                                                            <span perfect-class="formGroupLabel">Amount</span>
                                                            <span class="text-danger">*</span>
                                                        </label>
                                                        <div class="col-sm-8">
                                                            <div class="input-group">
                                                                <input type="text" class="form-control text-right" perfect-tempTable-Payment="PAmount" id="PAmount" name="PAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" oninput="decimalpnt(this,'PAmount',3)" onchange="Pamount(this)" maxlength="12" />

                                                            </div>
                                                            <div class="text-danger temptableError"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-9">


                                                </div>
                                                <div class="col-sm-3 text-right">
                                                    <div class="input-group">

                                                        <div class="input-group-append">
                                                            <div>
                                                                <button type="button" class="btn btn-primary1 " onclick="createtable(this,'Payment',['PaymentMethod'],paytableOptionsTempOut,1)"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                                                <button class="btn btn-light1" type="button" onclick="productclear(this, 'Payment')"><i class="fa fa-refresh" aria-hidden="true"></i></button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">
                                                        <label class="col-sm-4 col-form-label">
                                                            <span perfect-class="formGroupLabel" style="font-weight:500;">Bal. Amount :</span>

                                                        </label>
                                                        <div class="col-sm-8">
                                                            <div class="input-group">

                                                                <label class="col-form-label">
                                                                    <span perfect-class="formGroupLabel" style="font-weight:500;" name="BalAmts"></span>
                                                                </label>
                                                                @*<input type="text" class="form-control" perfect-temptable-payment="BalAmt" name="BalAmt" perfect-class="" perfect-ctype="input" perfect-css="input" readonly="" style="border:white;background:white;font-weight: 500;">*@
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">

                                                        <div class="table-responsive" perfect-tempTable-Payment="" perfect-tempTable="Payment" id="Paymentdetheads" perfect-tempTable-lastindex="0" perfect-tempTable-action="0"></div>
                                                        <div class="text-danger temptableError"></div>

                                                    </div>
                                                </div>


                                            </div>
                                            <div class="modal-footer">
                                                @*<button type="button" onclick="CreateProductCheckDescription(this);" class="btn btn-primary">Add</button>*@
                                                <button type="button" class="btn btn-primary light" onclick="Billttlnetchck(this,1)">Apply</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>

                    <div class="modal-footer">
                        <button type="button" id="btnUpdatedel" onclick="fn_Savedeldetails(this);" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-light1" data-dismiss="modal" onclick="resetdelmodal(this)">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>




    <!-- Sales Delivery Status -->

    <div class="modal fade bd-sales-modal-sm" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-xl" id="salemodalid">



            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title SaleDeliveryassign">Delivery Assignment Status</h5>
                    <h5 class="modal-title Editassigndel" style="display:none">Edit Assign</h5>
                    <button type="button" class="close" data-dismiss="modal" onclick="resetsalelmodal(this)">
                        <span>×</span>
                    </button>
                </div>
                <form class="form-valide" perfect-class="form" id="saleformid" action="#" method="post" perfect-onFormSuccess="">
                    <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh -200px); overflow-y: auto;">

                        <div class="form-group row" id="TopInfoDetails"></div>
                        <div class="form-group row" id="TopInfoDetails2"></div>

                        <input type="hidden" id="Sale_ID_ProductDeliveryAssign" />
                        <input type="hidden" id="SaleEmployee" value="" />

                        <div class="row">
                            <div class="col-sm-4">

                                <div class="profile-personal-info">


                                    <h4 class='text-primary mb-4'>Sales Details</h4>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Reference No:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="ReferenceNo" perfect-ctype="input" perfect-css="input"><span id="spanReferenceNo"></span></label>

                                        </div>

                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Registered On:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" type="date" perfect-class="formGroupControl" name="BillDate" perfect-ctype="input" perfect-css="input"><span id="spanBillDate"></span></label>

                                        </div>

                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Customer Name:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Customer" perfect-ctype="input" perfect-css="input"><span id="spansaleCustomer"></span></label>

                                        </div>

                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold"> Mobile No:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="MobileNo" perfect-ctype="input" perfect-css="input"><span id="spanMobileNo"></span></label>

                                        </div>

                                    </div>


                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="profile-personal-info">


                                    <h4 class='text-primary mb-4'>Delivery Address</h4>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Name:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="DelName" perfect-ctype="input" perfect-css="input"><span id="spanDelName"></span></label>

                                        </div>

                                    </div>
                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Address:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="DelAddress1" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanDelAddress1"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="DelAddress2" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanDelAddress2"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Area" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spansaleArea"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Post" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spansalePost"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="PinCode" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spansalePinCode"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="District" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spansaleDistrict"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="State" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><sapn id="spansaleState"></sapn></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Country" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><sapn id="spansaleCountry"></sapn></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="DelMobileNo" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><sapn id="spanDelMobileNo"></sapn></label>

                                        </div>

                                    </div>

                                </div>
                            </div>


                            <div class="col-sm-4">

                                <div class="profile-personal-info">


                                    <h4 class='text-primary mb-4'>Delivery Details</h4>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Vehicle No:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="DelVehicleNo" perfect-ctype="input" perfect-css="input"><span id="spanDelVehicleNo"></span></label>

                                        </div>

                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Driver Name:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="DelDriverName" perfect-ctype="input" perfect-css="input"><span id="spanDelDriverName"></span></label>

                                        </div>

                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Mobile No:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="DelDriverMobileNo" perfect-ctype="input" perfect-css="input"><span id="spanDelDriverMobileNo"></span></label>
                                        </div>
                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">EWay BillNo:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="PdEWayBillNo" perfect-ctype="input" perfect-css="input"><span id="spanPdEWayBillNo"></span></label>
                                        </div>
                                    </div>

                                </div>
                            </div>


                        </div>

                        <div class="form-group row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="profile-personal-info" style="margin-bottom:-14px;">
                                        <h4 class='text-primary mb-4'>Product Information</h4>
                                    </div>
                                    <div class="card-body" style="padding:0px">
                                        <div class="table-responsive-sm tableFixHead" id="replaceproducttable">
                                            <table class="table table-hover table-responsive-sm table-striped  text-black" id="ProductDetailsSales">
                                                <thead class="bg-primary text-white">
                                                    <tr class="btn-reveal-trigger" role="row">
                                                        <th style="display:none"></th>
                                                        <th style="display:none"></th>
                                                        <th style="width: 18%;">Product Name</th>
                                                        <th style="width: 10%;">Qty</th>
                                                        <th style="width: 10%;">Compl. Reg</th>
                                                        <th style="width: 14%;">Priority</th>
                                                        <th style="width: 10%;">Compl. Qty</th>
                                                        <th style="width: 20%;">Compl. Type</th>
                                                        <th style="width: 18%;">Description</th>

                                                    </tr>
                                                </thead>
                                                <tbody id="ProductDetailsSalesTbodyP">
                                                    <tr id="0">
                                                        <td colspan="8" style="text-align:center;">No Records...</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>



                        <div class="form-group row">

                            <div class="col-md-3" perfect-class="formGroup" id="Deliverydate">
                                <label>Delivery Date</label>&nbsp;<span class="text-danger">*</span>
                                <input type="date" class="form-control perfectValidate_date" name="PdAssignedDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="2000-01-01" max="2050-01-01" onchange="saledatecheck(this)">
                                <span id='Selit' class='error'></span>
                                <div class="invalid-feedback animated fadeInUp temptableErrors"></div>
                            </div>

                            <div class="col-md-3" id="Deliverytime">
                                <label>Delivery Time</label>&nbsp;

                                <input type="time" class="form-control perfectValidate_time" placeholder="" name="PdAssignedTime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />

                            </div>

                            <div class="col-md-3" id="Remarks">

                                <label>Remark</label>&nbsp;
                                <input type="text" name="PdVehicleDetails" class="form-control" perfect-class="formGroupControl" oninput="this.value = this.value.replace(/[^A-Za-z0-9,. ()&]/g, '').replace(/\*(?=\.)*/g, '$1');" perfect-ctype="input" maxlength="250" perfect-css="input" />
                            </div>


                            <div class="col-md-3" id="status">
                                <label>Status</label> <span class="text-danger">*</span>&nbsp;
                                <select class="form-control perfectValidate_string" name="CSAstatus">
                                    <option value="">Please select</option>
                                    <option value="1">Open</option>
                                    <option value="2">Closed</option>


                                </select> <span id="SelCsta" class="error"></span>
                            </div>

                            <div class="col-md-3" id="status" hidden>

                                <label>Ticket Status</label><span class="text-danger">*</span>


                                <select class="form-control perfectValidate_string" name="ID_NextAction" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">

                                    <option value="">Please select</option>
                                    @if (!(Model.StatusList is null))
                                    {
                                        foreach (var Mode in Model.StatusList)
                                        {
                                            <option value="@Mode.ID_NextAction">@Mode.NxtActnName</option>
                                        }
                                    }
                                </select>
                                <span id="delsta" class="error"></span>
                            </div>
                        </div>

                    </div>

                    <div class="modal-footer">
                        <button type="button" id="btnUpdatedel" onclick="fn_SaveSalesdetails(this);" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-light1" data-dismiss="modal" onclick="resetsalelmodal(this)">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Pick Up status Update-->

    <div class="modal fade bd-Pick-modal-sm clspickmodalid" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true" id="pickupmodal">
        <div class="modal-dialog modal-xl" id="pickmodalid">



            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title Deliveryassign">Update PickUp Status</h5>
                    <h5 class="modal-title Editassigndel" style="display:none">Edit Assign</h5>
                    <button type="button" class="close" data-dismiss="modal" onclick="resetmoal(this)">
                        <span>×</span>
                    </button>
                </div>
                <form class="form-valide" perfect-class="form" id="pickformid" action="#" method="post" perfect-onFormSuccess="">
                    <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh -200px); overflow-y: auto;">



                        <input type="hidden" id="Delpick_ID_ProductDeliveryAssign" />
                        <input type="hidden" name="FK_Customerserviceregister" />
                        <input type="hidden" id="DelpickEmployee" value="" />


                        <div class="row">

                            <div class="col-sm-4">

                                <div class="profile-personal-info">


                                    <h4 class='text-primary mb-4'>Ticket Details</h4>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Ticket Number:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="CSRTickno" perfect-ctype="input" perfect-css="input"><span id="sspanCSRTickno"></span></label>

                                        </div>

                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Registered On:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" type="date" perfect-class="formGroupControl" name="CSRRegDate" perfect-ctype="input" perfect-css="input"><span id="sspanCSRRegDate"></span></label>

                                        </div>

                                    </div>


                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="profile-personal-info">


                                    <h4 class='text-primary mb-4'>Customer Details</h4>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Customer Name:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Customer" perfect-ctype="input" perfect-css="input"><span id="sspanCustomer"></span></label>

                                        </div>

                                    </div>
                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Address:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address1" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="sspanAddress1"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Area" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="sspanArea"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address2" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="sspanAddress2"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="District" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="sspanDistrict"></span></label>
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="State" perfect-ctype="input" perfect-css="input"><sapn id="sspanState"></sapn></label>

                                        </div>

                                    </div>

                                </div>
                            </div>


                            <div class="col-sm-4">

                                <div class="profile-personal-info">


                                    <h4 class='text-primary mb-4'>Product Details</h4>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Product:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Product" perfect-ctype="input" perfect-css="input"><span id="sspanProduct"></span></label>

                                        </div>

                                    </div>

                                    <div class="form-group2 row" perfect-class="formGroup">
                                        <label class="col-sm-4 col-form-label">
                                            <span perfect-class="formGroupLabel" class="font-weight-bold">Category:</span>

                                        </label>
                                        <div class="col-sm-8">
                                            <label class="col-sm-8 col-form-label" type="date" perfect-class="formGroupControl" name="Category" perfect-ctype="input" perfect-css="input"><span id="sspanCategory"></span></label>

                                        </div>

                                    </div>


                                </div>
                            </div>


                        </div>

                        <div class="form-group row">
                            <div class="col-md-3" perfect-class="formGroup" id="Deliverydate">
                                <label>Pick Up Date</label>&nbsp;<span class="text-danger">*</span>
                                <input type="date" id="pickvaldate" class="form-control" name="PdAssignedDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="2000-01-01" max="2050-01-01" onchange="pickdatecheck(this)">
                                <span id='it' class="invalid-feedback animated fadeInUp"></span>
                                <div class="invalid-feedback animated fadeInUp temptableErrors"></div>
                            </div>
                            <div class="col-md-3" id="Deliverytime">
                                <label>Pick up Time</label>&nbsp;@*<span class="text-danger">*</span>*@
                                <input type="time" class="form-control " placeholder="" name="PdAssignedTime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                @*<span id='itime' class='error'></span>*@
                            </div>


                            <div class="col-md-3" id="Remarks">
                                <label>Remarks</label>&nbsp;
                                <input type="text" name="PdVehicleDetails" oninput="this.value = this.value.replace(/[^A-Za-z0-9,. ()&]/g, '').replace(/\*(?=\.)*/g, '$1');" class="form-control" perfect-class="formGroupControl" perfect-ctype="input" maxlength="250" perfect-css="input" />
                            </div>
                        </div>



                        <div class="form-group row">

                            <div class="card">
                                <div class="profile-personal-info" style="margin-bottom:-14px;">

                                    <h4 class='text-primary mb-4'>Product Information</h4>
                                </div>
                                <div class="card-body" style="padding:0px">
                                    <div class="table-responsive-sm tableFixHead" id="replaceproducttable">
                                        <table class="table table-hover table-responsive-sm table-striped  text-black" id="ProductDetails">
                                            <thead class="bg-primary text-white">
                                                <tr>
                                                    <th style="display:none"> </th>
                                                    <th></th>
                                                    <th>Product Name</th>
                                                    <th>Quantity</th>
                                                    <th>Provide Standby</th>
                                                    <th>StandBy Product</th>
                                                    <th>StandBy Quantity</th>
                                                    <th>StandBy Amount</th>
                                                    <th>Remarks</th>
                                                </tr>
                                            </thead>
                                            <tbody id="ProductDetailsTbody">
                                                <tr id="0">
                                                    <td colspan="4" style="text-align:center;">No Records...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="float-right">
                                        <button type="button" class="btn btn-primary" perfect-css="button" id="pickupaddmore" onclick="GetCmnPopUpSearchValAssign(this,40,'Product Details',[],[],PickUpTransMode)" Criterea1="0" Criterea2="0" Function="1"> Add Product</button>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <div class="form-group row">
                            <div class="col-sm-3">
                                <label>Follow Up Status</label><span class="text-danger">*</span>&nbsp;
                                <select class="form-control" name="CSAstatus" onchange="Showpickupstatus(this)">
                                    <option value="">Please select</option>
                                    <option value="1">Open</option>
                                    <option value="2">Closed</option>


                                </select><span id="picCsta" class="invalid-feedback animated fadeInUp"></span>
                            </div>
                            <div class="col-md-3" id="divpickupstatus">
                                <label>Pick Up Status</label> 
                                <select class="form-control perfectValidate_string" name="Pickupstatus">
                                    <option value="">Please select</option>
                                    <option value="1">Open</option>
                                    <option value="2">Closed</option>


                                </select> <span id="picCsta1"class="invalid-feedback animated fadeInUp"></span>
                            </div>

                            <div class="col-sm-3">
                                <label><span>Stand By Total</span></label>
                                <input type="text" class="form-control  text-right" readonly="readonly" placeholder="" name="StandByTotalAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" onchange="Checkstandbyamount(this)" />
                            </div>

                            <div class="col-sm-3 DivBillType">
                                <label>Bill Type</label>
                                <select class="form-control " name="BillTypeID" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                    <option value="">Please Select </option>
                                    @if (!(Model.BillTypeListView is null))
                                    {
                                        foreach (var BillType in Model.BillTypeListView)
                                        {
                                            <option value="@BillType.BillTypeID">@BillType.BillType</option>
                                        }
                                    }
                                </select>
                                <span id="BillTypeVald" class="invalid-feedback animated fadeInUp"></span>
                            </div>
                            <div class="col-sm-3 DivPaymentMethod">
                                <label>Payment Method</label>
                                <div class="input-group">

                                    <div class="input-group-append">
                                        &nbsp;<button id="addcountry-jq-searchButton3" class="btn btn-primary fa fa-money" type="button" perfect-css="button" title="Add Payment Method" onclick="GetPaymentlists(this)"></button>

                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-3" id="status" hidden>

                                <label>Ticket Status</label> <span class="text-danger">*</span>


                                <select class="form-control perfectValidate_string" name="ID_NextAction" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">

                                    <option value="">Please select</option>
                                    @if (!(Model.StatusList is null))
                                    {
                                        foreach (var Mode in Model.StatusList)
                                        {
                                            <option value="@Mode.ID_NextAction">@Mode.NxtActnName</option>
                                        }
                                    }
                                </select>
                                <span id='itstap' class="invalid-feedback animated fadeInUp"></span>


                            </div>
                            <div class="modal fade" perfect-class="formGroupModalpayment" id="formGroupModalpayment">
                                <div class="modal-dialog  modal-dialog-centered modal-md" role="document" id="paymentmodal">
                                    <div class="modal-content">
                                        <div class="modal-header border-0">
                                            <h5 class="modal-title">Payment Method</h5>
                                            <button type="button" class="close" onclick="Hidepaymentmethod(this)">
                                                <span>&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;padding: 1rem;">
                                            <div class="row">


                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">
                                                        <label class="col-sm-4 col-form-label">Method <span class="text-danger">*</span></label>
                                                        <div class="col-sm-8">
                                                            <div class="input-group">
                                                                <select class="form-control" perfect-tempTable-Payment="PaymentMethod" name="PaymentMethod" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                                                    <option value="">Please Select </option>


                                                                    @if (!(Model.PaymentView is null))
                                                                    {
                                                                        foreach (var Module in Model.PaymentView)
                                                                        {
                                                                            <option value="@Module.PaymentmethodID">@Module.Name</option>
                                                                        }
                                                                    }
                                                                </select>


                                                            </div>
                                                            <div class="text-danger temptableError"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">
                                                        <label class="col-sm-4 col-form-label">
                                                            <span perfect-class="formGroupLabel">Ref No.</span>

                                                        </label>
                                                        <div class="col-sm-8">

                                                            <div class="input-group">
                                                                <input type="text" class="form-control " perfect-tempTable-Payment="Refno" name="Refno" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="250" />

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">
                                                        <label class="col-sm-4 col-form-label">
                                                            <span perfect-class="formGroupLabel">Amount</span>
                                                            <span class="text-danger">*</span>
                                                        </label>
                                                        <div class="col-sm-8">
                                                            <div class="input-group">
                                                                <input type="text" class="form-control text-right" perfect-tempTable-Payment="PAmount" id="PAmount" name="PAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" oninput="decimalpnt(this,'PAmount',3)" onchange="Pamount(this)" maxlength="12" />

                                                            </div>
                                                            <div class="text-danger temptableError"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-9">


                                                </div>
                                                <div class="col-sm-3 text-right">
                                                    <div class="input-group">

                                                        <div class="input-group-append">
                                                            <div>
                                                                <button type="button" class="btn btn-primary1 " onclick="createtable(this,'Payment',['PaymentMethod'],paytableOptionsTempOut)"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                                                <button class="btn btn-light1" type="button" onclick="productclear(this, 'Payment')"><i class="fa fa-refresh" aria-hidden="true"></i></button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">
                                                        <label class="col-sm-4 col-form-label">
                                                            <span perfect-class="formGroupLabel" style="font-weight:500;">Bal. Amount :</span>

                                                        </label>
                                                        <div class="col-sm-8">
                                                            <div class="input-group">

                                                                <label class="col-form-label">
                                                                    <span perfect-class="formGroupLabel" style="font-weight:500;" name="BalAmt"></span>
                                                                </label>
                                                                @*<input type="text" class="form-control" perfect-temptable-payment="BalAmt" name="BalAmt" perfect-class="" perfect-ctype="input" perfect-css="input" readonly="" style="border:white;background:white;font-weight: 500;">*@
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="col-sm-12">
                                                    <div class="form-group row" perfect-class="formGroup">

                                                        <div class="table-responsive" perfect-tempTable-Payment="" perfect-tempTable="Payment" id="Paymentdethead" perfect-tempTable-lastindex="0" perfect-tempTable-action="0"></div>
                                                        <div class="text-danger temptableError"></div>

                                                    </div>
                                                </div>


                                            </div>
                                            <div class="modal-footer">
                                                @*<button type="button" onclick="CreateProductCheckDescription(this);" class="btn btn-primary">Add</button>*@
                                                <button type="button" class="btn btn-primary light" onclick="Billttlnetchck(this)">Apply</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

            </div>

            <div class="modal-footer">
                <button type="button" id="btnUpdatedel" onclick="fn_SavePickdetails(this);" class="btn btn-primary">Update</button>
                <button type="button" class="btn btn-light1" data-dismiss="modal" onclick="resetmoal(this)">Cancel</button>
            </div>
            </form>
        </div>
    </div>
</div>

<!-- Pick Up Status for Emi Recovery-->
<div class="modal fade bd-PickEmi-modal-sm clspickmodalid" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true" id="pickupmodalEmi">
    <div class="modal-dialog modal-xl" id="pickmodalidEmi">



        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title Deliveryassign">Update PickUp Status</h5>
                <h5 class="modal-title Editassigndel" style="display:none">Edit Assign</h5>
                <button type="button" class="close" data-dismiss="modal" onclick="resetmoal(this)">
                    <span>×</span>
                </button>
            </div>
            <form class="form-valide" perfect-class="form" id="pickformid" action="#" method="post" perfect-onFormSuccess="">
                <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh -200px); overflow-y: auto;">



                    <input type="hidden" id="Delpick_ID_ProductDeliveryAssign" />
                    <input type="hidden" name="FK_Customerserviceregister" />
                    <input type="hidden" id="DelpickEmployee" value="" />

                    <div class="col-sm-12">
                        <div class="profile-personal-info">
                            <h4 class='text-primary mb-4'>Customer Details</h4>
                            <div class="col-md-4">


                                <div class="form-group row" perfect-class="formGroup">
                                    <label class="col-sm-4 col-form-label">
                                        <span perfect-class="formGroupLabel" class="font-weight-bold">Customer Name:</span>

                                    </label>
                                    <div class="col-sm-8">
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Customer" perfect-ctype="input" perfect-css="input"><span id="sspanCustomerEmi"></span></label>

                                    </div>

                                </div>
                                <div class="form-group row" perfect-class="formGroup">
                                    <label class="col-sm-4 col-form-label">
                                        <span perfect-class="formGroupLabel" class="font-weight-bold">Address:</span>

                                    </label>
                                    <div class="col-sm-8">
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address1" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="sspanAddress1Emi"></span></label>
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Area" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="sspanAreaEmi"></span></label>
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address2" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="sspanAddress2Emi"></span></label>
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="District" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="sspanDistrictEmi"></span></label>
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="State" perfect-ctype="input" perfect-css="input"><sapn id="sspanStateEmi"></sapn></label>

                                    </div>

                                </div>

                            </div>



                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group row">
                            <div class="col-md-3" perfect-class="formGroup" id="DeliverydateEmi">
                                <label>Pick Up Date</label>&nbsp;<span class="text-danger">*</span>
                                <input type="date" id="pickvaldate" class="form-control" name="PdAssignedDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="2000-01-01" max="2050-01-01" onchange="pickdatecheck(this)">
                                <span id='itEmi' class="invalid-feedback animated fadeInUp"></span>
                                <div class="invalid-feedback animated fadeInUp temptableErrors"></div>
                            </div>
                            <div class="col-md-3" id="DeliverytimeEmi">
                                <label>Pick up Time</label>&nbsp;@*<span class="text-danger">*</span>*@
                                <input type="time" class="form-control " placeholder="" name="PdAssignedTime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                @*<span id='itime' class='error'></span>*@
                            </div>


                            <div class="col-md-3" id="Remarks">
                                <label>Remarks</label>&nbsp;
                                <input type="text" name="PdVehicleDetails" oninput="this.value = this.value.replace(/[^A-Za-z0-9,. ()&]/g, '').replace(/\*(?=\.)*/g, '$1');" class="form-control" perfect-class="formGroupControl" perfect-ctype="input" maxlength="250" perfect-css="input" />
                            </div>
                        </div>
                    </div>



                    <div class="col-md-12">

                        <div class="form-group row">

                            <div class="card col-md-12">
                                <div class="profile-personal-info" style="margin-bottom:-14px;">

                                    <h4 class='text-primary mb-4'>Product Information</h4>
                                </div>
                                <div class="card-body" style="padding:0px">
                                    <div class="table-responsive-sm tableFixHead" id="replaceproducttable">
                                        <table class="table table-hover table-responsive-sm table-striped  text-black" id="ProductDetailsEmi">
                                            <thead class="bg-primary text-white">
                                                <tr>
                                                    <th style="display:none"> </th>
                                                    <th></th>
                                                    <th>Product Name</th>
                                                    <th>Quantity</th>
                                                    <th>Remarks</th>
                                                </tr>
                                            </thead>
                                            <tbody id="ProductDetailsEmiTbody">
                                                <tr id="0">
                                                    <td colspan="4" style="text-align:center;">No Records...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="col-md-12">
                        <div class="form-group row">
                            <div class="col-sm-3">
                                <label>Status</label><span class="text-danger">*</span>&nbsp;
                                <select class="form-control" name="CSAstatus">
                                    <option value="">Please select</option>
                                    <option value="1">Open</option>
                                    <option value="2">Closed</option>


                                </select><span id="picCstaEmi" class="invalid-feedback animated fadeInUp"></span>
                            </div>

                        </div>
                    </div>


                </div>

                <div class="modal-footer">
                    <button type="button" id="btnUpdatedel" onclick="fn_SavePickdetailsEmi(this);" class="btn btn-primary">Update</button>
                    <button type="button" class="btn btn-light1" data-dismiss="modal" onclick="resetmoal(this)">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>



    <!--Standby Recovey Delivery-->
<div class="modal fade bd-del_stby-modal-sm" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-xl" id="delmodalid_stby">



        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title Deliveryassign">Update Standby Delivery Status</h5>
                <h5 class="modal-title Editassigndel" style="display:none">Edit Assign</h5>
                <button type="button" class="close" data-dismiss="modal" onclick="resetmodalstby(this)">
                    <span>×</span>
                </button>
            </div>
            <form class="form-valide" perfect-class="form" id="delformid_stby" action="#" method="post" perfect-onFormSuccess="">
                <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh -200px); overflow-y: auto;">

                    <div class="form-group row" id="TopInfoDetails"></div>
                    <div class="form-group row" id="TopInfoDetails2"></div>

                    <input type="hidden" id="Pick_ID_ProductDeliveryAssign_stby" />
                    <input type="hidden" name="FK_Customerserviceregister" />
                    <input type="hidden" id="PickEmployee_stby" value="" />

                    <div class="row">

                        <div class="col-sm-6">

                            <div class="profile-personal-info">


                                <h4 class='text-primary mb-4'>Sales Bill Details</h4>

                                <div class="form-group2 row" perfect-class="formGroup">
                                    <label class="col-sm-4 col-form-label">
                                        <span perfect-class="formGroupLabel" class="font-weight-bold">Bill Number:</span>

                                    </label>
                                    <div class="col-sm-8">
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="CSRTickno" perfect-ctype="input" perfect-css="input"><span id="spanCSRTickno_stby"></span></label>

                                    </div>

                                </div>

                                <div class="form-group2 row" perfect-class="formGroup">
                                    <label class="col-sm-4 col-form-label">
                                        <span perfect-class="formGroupLabel" class="font-weight-bold">Registered On:</span>

                                    </label>
                                    <div class="col-sm-8">
                                        <label class="col-sm-8 col-form-label" type="date" perfect-class="formGroupControl" name="CSRRegDate" perfect-ctype="input" perfect-css="input"><span id="spanCSRRegDate_stby"></span></label>

                                    </div>

                                </div>


                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="profile-personal-info">


                                <h4 class='text-primary mb-4'>Customer Details</h4>

                                <div class="form-group2 row" perfect-class="formGroup">
                                    <label class="col-sm-4 col-form-label">
                                        <span perfect-class="formGroupLabel" class="font-weight-bold">Customer Name:</span>

                                    </label>
                                    <div class="col-sm-8">
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Customer" perfect-ctype="input" perfect-css="input"><span id="spanCustomer_stby"></span></label>

                                    </div>

                                </div>
                                <div class="form-group2 row" perfect-class="formGroup">
                                    <label class="col-sm-4 col-form-label">
                                        <span perfect-class="formGroupLabel" class="font-weight-bold">Address:</span>

                                    </label>
                                    <div class="col-sm-8">
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address1" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanAddress1_stby"></span></label>
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Area" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanArea_stby"></span></label>
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address2" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanAddress2_stby"></span></label>
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="District" perfect-ctype="input" perfect-css="input" style="margin-bottom: -14px;"><span id="spanDistrict_stby"></span></label>
                                        <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="State" perfect-ctype="input" perfect-css="input"><sapn id="spanState_stby"></sapn></label>

                                    </div>

                                </div>

                            </div>
                        </div>


                    </div>

                    <div class="form-group row">
                        <div class="col-md-3" perfect-class="formGroup" id="Deliverydate_stby">
                            <label>Delivery Date</label>&nbsp;<span class="text-danger">*</span>
                            <input type="date" class="form-control perfectValidate_date" name="PdAssignedDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="2000-01-01" max="2050-01-01" onchange="deldatecheck(this)">
                            <span id='delit_stby' class='error'></span>
                            <div class="invalid-feedback animated fadeInUp temptableErrors"></div>
                        </div>
                        <div class="col-md-3" id="Deliverytime">
                            <label>Delivery Time</label>&nbsp;@*<span class="text-danger">*</span>*@

                            <input type="time" class="form-control perfectValidate_time_stby" placeholder="" name="PdAssignedTime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                            @*<span id='deltme' class='error'></span>*@
                        </div>

                        <div class="col-md-3" id="Remarks_stby">
                            <label>Remark</label>&nbsp;
                            <input type="text" name="PdVehicleDetails" class="form-control" perfect-class="formGroupControl" oninput="this.value = this.value.replace(/[^A-Za-z0-9,. ()&]/g, '').replace(/\*(?=\.)*/g, '$1');" perfect-ctype="input" maxlength="250" perfect-css="input" />
                        </div>
                    </div>



                    <div class="form-group row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="profile-personal-info" style="margin-bottom:-14px;">
                                    <h4 class='text-primary mb-4'>Product Information</h4>
                                </div>
                                <div class="card-body" style="padding:0px">
                                    <div class="table-responsive-sm tableFixHead" id="replaceproducttable">
                                        <table class="table table-hover table-responsive-sm table-striped  text-black" id="ProductDetailsdel_stby">
                                            <thead class="bg-primary text-white">
                                                <tr>

                                                    <th style="display:none"> </th>
                                                    <th style="display:none"></th>
                                                    <th>Replace Product</th>
                                                    <th>Replace Quantity</th>
                                                    <th style="display:none">FK_StandByProduct</th>
                                                    <th>StandBy Product</th>
                                                    <th>StandBy Quantity</th>
                                                    <th style="display:none">FK_StandByStock</th>
                                                    <th>Remarks</th>


                                                </tr>
                                            </thead>
                                            <tbody id="ProductDetailsTbodyP_stby">
                                                <tr id="0">
                                                    <td colspan="8" style="text-align:center;">No Records...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                       
                    </div>

                    <div class="form-group row">

                        <div class="col-md-3" id="status">
                            <label>Status</label> <span class="text-danger">*</span>&nbsp;
                            <select class="form-control perfectValidate_string" name="CSAstatus">
                                <option value="">Please select</option>
                                <option value="1">Open</option>
                                <option value="2">Closed</option>


                            </select> <span id="delCsta_stby" class="error"></span>
                        </div>

                        <div class="col-md-3" id="status" hidden>

                            <label>Ticket Status</label><span class="text-danger">*</span>


                            <select class="form-control perfectValidate_string" name="ID_NextAction" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">

                                <option value="">Please select</option>
                                @if (!(Model.StatusList is null))
                                {
                                    foreach (var Mode in Model.StatusList)
                                    {
                                        <option value="@Mode.ID_NextAction">@Mode.NxtActnName</option>
                                    }
                                }
                            </select>
                            <span id="delsta" class="error"></span>


                        </div>
                        <div class="col-sm-3" hidden>
                            <label><span>Stand By Total</span></label>
                            <input type="text" class="form-control  text-right" readonly="readonly" placeholder="" name="StandByTotalAmounts" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" onchange="Checkstandbyamount(this)" />
                        </div>

                        <div class="col-sm-3" hidden>
                            <div class="form-group row" perfect-class="formGroup">
                                <label>Payment Method</label>
                                <div class="input-group">

                                    <div class="input-group-append">
                                        &nbsp;<button id="addcountry-jq-searchButton3" class="btn btn-primary fa fa-money" type="button" perfect-css="button" title="Add Payment Method" onclick="GetPaymentlists(this,1)"></button>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal fade" perfect-class="formGroupModalpayment2" id="formGroupModalpayment2">
                            <div class="modal-dialog  modal-dialog-centered modal-md" role="document" id="paymentmodal2">
                                <div class="modal-content">
                                    <div class="modal-header border-0">
                                        <h5 class="modal-title">Payment Method</h5>
                                        <button type="button" class="close" onclick="Hidepaymentmethod2(this)">
                                            <span>&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;padding: 1rem;">
                                        <div class="row">


                                            <div class="col-sm-12">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">Method <span class="text-danger">*</span></label>
                                                    <div class="col-sm-8">
                                                        <div class="input-group">
                                                            <select class="form-control" perfect-tempTable-Payment="PaymentMethod" name="PaymentMethod" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                                                <option value="">Please Select </option>


                                                                @if (!(Model.PaymentView is null))
                                                                {
                                                                    foreach (var Module in Model.PaymentView)
                                                                    {
                                                                        <option value="@Module.PaymentmethodID">@Module.Name</option>
                                                                    }
                                                                }
                                                            </select>


                                                        </div>
                                                        <div class="text-danger temptableError"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">
                                                        <span perfect-class="formGroupLabel">Ref No.</span>

                                                    </label>
                                                    <div class="col-sm-8">

                                                        <div class="input-group">
                                                            <input type="text" class="form-control " perfect-tempTable-Payment="Refno" name="Refno" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="250" />

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-12">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">
                                                        <span perfect-class="formGroupLabel">Amount</span>
                                                        <span class="text-danger">*</span>
                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-group">
                                                            <input type="text" class="form-control text-right" perfect-tempTable-Payment="PAmount" id="PAmount" name="PAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" oninput="decimalpnt(this,'PAmount',3)" onchange="Pamount(this)" maxlength="12" />

                                                        </div>
                                                        <div class="text-danger temptableError"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-9">


                                            </div>
                                            <div class="col-sm-3 text-right">
                                                <div class="input-group">

                                                    <div class="input-group-append">
                                                        <div>
                                                            <button type="button" class="btn btn-primary1 " onclick="createtable(this,'Payment',['PaymentMethod'],paytableOptionsTempOut,1)"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                                            <button class="btn btn-light1" type="button" onclick="productclear(this, 'Payment')"><i class="fa fa-refresh" aria-hidden="true"></i></button>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-sm-12">
                                                <div class="form-group row" perfect-class="formGroup">
                                                    <label class="col-sm-4 col-form-label">
                                                        <span perfect-class="formGroupLabel" style="font-weight:500;">Bal. Amount :</span>

                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-group">

                                                            <label class="col-form-label">
                                                                <span perfect-class="formGroupLabel" style="font-weight:500;" name="BalAmts"></span>
                                                            </label>
                                                            @*<input type="text" class="form-control" perfect-temptable-payment="BalAmt" name="BalAmt" perfect-class="" perfect-ctype="input" perfect-css="input" readonly="" style="border:white;background:white;font-weight: 500;">*@
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="col-sm-12">
                                                <div class="form-group row" perfect-class="formGroup">

                                                    <div class="table-responsive" perfect-tempTable-Payment="" perfect-tempTable="Payment" id="Paymentdetheads" perfect-tempTable-lastindex="0" perfect-tempTable-action="0"></div>
                                                    <div class="text-danger temptableError"></div>

                                                </div>
                                            </div>


                                        </div>
                                        <div class="modal-footer">
                                            @*<button type="button" onclick="CreateProductCheckDescription(this);" class="btn btn-primary">Add</button>*@
                                            <button type="button" class="btn btn-primary light" onclick="Billttlnetchck(this,1)">Apply</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" id="btnUpdatedel_stby" onclick="fn_Savedeldetails_stby(this);" class="btn btn-primary">Update</button>
                    <button type="button" class="btn btn-light1" data-dismiss="modal" onclick="resetdelmodal(this)">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>





</div>


<script src="~/Scripts/jqDOM/searchDOMCreation.js"></script>
<script>

    $(document).ready(function () {
        let $thisForm = $(this).find('[perfect-class="formassign"]');
        $thisForm.closest('.jq_deliverypickup_body').find('.deliverypickform').addClass('d-none');
        jQuery('form').validate();


        var url = window.location.pathname;
        var id = url.substring(url.lastIndexOf('/') + 1);

        if (id != "Index") {
            if (id != null && id != "") {

                switch (id) {
                    case "1": $("#Pickupnav").click(); break;
                    case "2": $('#deliverynav').click(); break;
                }
            }
        }
        else {
            $('#Pickupnav')[0].click();
        }

    });

    function fn_showFilter() {

        $formContainer.find('.jq_deliverypickup_body').find('.deliverypickform').toggleClass('d-none');
    }

    //var validationMessage = {

    //    'VisitedDateAfter': {
    //        'required': 'Please Enter A Date',
    //        'maxlength': jQuery.validator.format(' Name should be less than {0} characters'),
    //        'stringonly': 'Special characters are not allowed in  Name'

    //    },
    //    'ID_NextAction': {
    //        'required': 'Please Select Next Action',
    //        'digits': 'Invalid State selected'
    //    },
    //    'BillTypeID': {
    //        'required': 'Please Select Bill Type',
    //        'digits': 'Invalid BillType selected'
    //    }

    //};


    var pickupTableOptions = {

        textButton: {
            buttons: [
                { displayName: "Assign" }
            ]
        },

        onlyShowColumn: ['Slno', 'ReferenceNo', 'CustomerName', 'Mobile','AssignedOn', 'PickUpTime','EMPName','Module'],
        hideColumn: ["ID_ProductDeliveryAssign", "PriorityCode", "StatusCode"],
        rowClickAction: checkmodal,

        renameHeader: { "Slno": "Sl No", "ReferenceNo": "Reference No", "CustomerName": "Customer", "Mobile": "Mobile",  "PickUpTime": "Pickup DateTime", "AssignedOn": "Assigned Time", "EMPName": "Assigned To","Module": "Module" },

        status: ["CurrentStatus"],
        priority: ["Priority"],

    };
    var deliveryTableOptions = {

        textButton: {
            buttons: [
                { displayName: "Assign" }
            ]
        },

        onlyShowColumn: ['Slno', 'ReferenceNo', 'CustomerName', 'Mobile', 'AssignedOn', 'PickUpTime', 'EMPName','Module'],
        hideColumn: ["ID_ProductDeliveryAssign", "PriorityCode", "StatusCode"],
        rowClickAction: checkmodal,

        renameHeader: { "Slno": "Sl No", "ReferenceNo": "Reference No", "CustomerName": "Customer", "Mobile": "Mobile", "PickUpTime": "Delivery DateTime", "AssignedOn": "Assigned Date", "EMPName": "Assigned To", "Module": "Module" },

        status: ["CurrentStatus"],
        priority: ["Priority"],

    };






    var tabledata;
    function fn_Delivery_Pickup_tab(ele, M, ids, tabl) {

        let $sidemenu = $sideMenuOptions.body;
        ClearModalInput();
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let $formDivContainer = $thisForm.find('[name=SearchLoadDiv]');

        let InputDataFilter = {
            'CusName': $('[name=Customer]').val().trim(),
            'FromDate': $('[name=FromDate]').val(),
            'ToDate': $('[name=ToDate]').val(),
            'PageSize': 15,
            'pageIndex': 0,
            'Mode': M,
            'FK_Area': $('[name=AreaID]').val().trim(),
            'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
            'Status': $('[name=Complaintstatus]').val().trim(),
            'FK_Product': $('[name=ProductID]').val().trim(),
            'CusMobile': $('[name=Mobile]').val().trim(),
            'TicketNo': $('[name=Ticket]').val().trim(),

        }
        if (M == 1) {
            titlepdf = 'New Service Assign';
        }
        else {
            titlepdf = 'On Going Service Assign';
        }

        let pageUrl = '@Url.Action("GetDeliiveryAssignResult", "PickUpAndDelivery")';
        $.ajax({
            url: pageUrl,
            type: "POST",
            data: InputDataFilter,
            dataType: "json",
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function (ajaxOutput) {

                if (ajaxOutput.Process.Isprocess) {
                    console.log('place', ajaxOutput);


                    //$(ids).empty().append('<div style="display:none";class="d-flex justify-content-end mb-3 position-relative"><div class="col-md-1 position-absolute top-1 z-index"> <div class="input-group testSearchBox"><button title="Export to PDF" id="btn_export" onclick="exportpdf()" type="button" class="btn btn-primary" o><i class="fa fa-file-pdf-o" style="font-size:20px"></i></button></div></div></div>', $('<div/>', { class: "col-md-12 table_temp_class" }).html(pft_table_createtable(ajaxOutput.Data, tabl)))
                    $(ids).empty().append('<div style="display:none";class="d-flex justify-content-end mb-3 position-relative"><div class="col-md-1 position-absolute top-1 z-index"> <div class="input-group testSearchBox"></div></div></div>', $('<div/>', { class: "col-md-12 table_temp_class" }).html(pft_table_createtable(ajaxOutput.Data, tabl)))
                    datapdf = {

                        'CusName': $('[name=Customer]').val().trim(),
                        'FromDate': $('[name=FromDate]').val(),
                        'ToDate': $('[name=ToDate]').val(),
                        'PageSize': 15,
                        'PageIndex': 0,
                        'Mode': M,
                        'FK_Area': $('[name=AreaID]').val().trim(),
                        'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                        'Status': $('[name=Complaintstatus]').val().trim(),
                        'FK_Product': $('[name=ProductID]').val().trim(),
                        'CusMobile': $('[name=Mobile]').val().trim(),
                        'TicketNo': $('[name=Ticket]').val().trim(),

                    }
                    let $table = $(ids).find('table');

                    $table.dataTable({

                        "serverSide": true,//no change
                        "processing": true,//-- process text when clicked
                        //"lengthChange": false,
                        "lengthMenu": [10, 15, 20, 25, 50, 100],//---drop down page size
                        "searching": false,//--no change
                        "ordering": false,//--sorting
                        "deferLoading": ajaxOutput.totalrecord,//<----to total number of record from db
                        "displayStart": ajaxOutput.PageIndex * ajaxOutput.PageSize,//<----starting record
                        "pageLength": ajaxOutput.PageSize,//<----page size
                        "recordsFiltered": ajaxOutput.PageSize,//<---page size

                        "ajax": returnajaxPagination({
                            apiurl: pageUrl,
                            'CusName': $('[name=Customer]').val().trim(),
                            'FromDate': $('[name=FromDate]').val(),
                            'ToDate': $('[name=ToDate]').val(),
                            'PageSize': 15,
                            'PageIndex': 0,
                            'Mode': M,
                            'FK_Area': $('[name=AreaID]').val().trim(),
                            'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                            'Status': $('[name=Complaintstatus]').val().trim(),
                            'FK_Product': $('[name=ProductID]').val().trim(),
                            'CusMobile': $('[name=Mobile]').val().trim(),
                            'TicketNo': $('[name=Ticket]').val().trim(),

                        }, tabl, $table)
                             });
                }
                else {

                    if (ajaxOutput.Process.Status = "NoData") {



                        $(ids).empty().append($('<div/>', { class: "col-md-12 table_temp_class" }).html(pft_table_createtable(ajaxOutput.Data, tabl)))
                        // $sidemenu.find('table').dataTable({ paging: true });


                        let $table = $(ids).find('table');
                        $table.dataTable({
                            "serverSide": true,//no change
                            "processing": true,//-- process text when clicked
                            // "lengthChange": false,
                            "lengthMenu": [10, 15, 20, 25, 50, 100],//---drop down page size
                            "searching": false,//--no change
                            "ordering": false,//--sorting
                            "deferLoading": ajaxOutput.totalrecord,//<----to total number of record from db
                            "displayStart": ajaxOutput.PageIndex * ajaxOutput.PageSize,//<----starting record
                            "pageLength": ajaxOutput.PageSize,//<----page size
                            "recordsFiltered": ajaxOutput.pageSize,//<---page size

                            "ajax": returnajaxPagination({
                                apiurl: pageUrl,
                                'CusName': $('[name=Customer]').val().trim(),
                                'FromDate': $('[name=FromDate]').val(),
                                'ToDate': $('[name=ToDate]').val(),
                                'PageSize': 15,
                                'PageIndex': 0,
                                'Mode': M,
                                'FK_Area': $('[name=AreaID]').val().trim(),
                                'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                                'Status': $('[name=Complaintstatus]').val().trim(),
                                'FK_Product': $('[name=ProductID]').val().trim(),
                                'CusMobile': $('[name=Mobile]').val().trim(),
                                'TicketNo': $('[name=Ticket]').val().trim(),

                            }, tabl, $table)
                        });

                    }
                    else {

                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                        });
                    }
                }

                //$('#togPickup').html("" + ajaxOutput.totalrecord + "");
                //$('#togdelivery').html("" + ajaxOutput.totalrecord + "");
                get_tab_count(ele);
               // fn_DeliverySearchbyfilter(ele)
            },

            complete: function () {
                $('[name=filt]').val(ids);
                $('[name=md]').val(M);
            }
        });

    }

    function returnajaxPagination(ajaxInfo, tableOptions, tableid)
    {


        return {
            url: ajaxInfo.apiurl,
            type: "post",
            data: function () {
                var info = tableid.DataTable().page.info();
                console.log('info', info);
                let input = { PageSize: info.length, PageIndex: info.page, Customer: ajaxInfo.Customer, FromDate: ajaxInfo.FromDate, Todate: ajaxInfo.Todate, FK_Branch: ajaxInfo.FK_Branch, FK_Product: ajaxInfo.FK_Product, Mobile: ajaxInfo.CusMobile, TicketNo: ajaxInfo.TicketNo, Mode: ajaxInfo.Mode, FK_Area: ajaxInfo.FK_Area, FK_Employee: ajaxInfo.FK_Employee, Status: ajaxInfo.Status,  };
                if (ajaxInfo.searchkey) {
                    input["Name"] = ajaxInfo.searchkey;
                }
                return input
            },
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            success: function (dtajaxOutput) {
                let table = tableid.DataTable();
                table.destroy();
                pft_table_newTableBody(tableid, dtajaxOutput.Data, tableOptions);

                tableid.dataTable({
                    "serverSide": true,
                    "processing": true,
                    //"lengthChange": false,
                    "lengthMenu": [10, 15, 20, 25, 50, 100],
                    "searching": false,
                    "ordering": false,
                    "deferLoading": dtajaxOutput.totalrecord,
                    "displayStart": dtajaxOutput.PageIndex * dtajaxOutput.PageSize,
                    "pageLength": dtajaxOutput.PageSize,
                    "recordsFiltered": dtajaxOutput.PageSize,
                    "ajax": returnajaxPagination(ajaxInfo, tableOptions, tableid)
                })

            },


        }
    }




    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode
        if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;

        return true;
    }




    function ClearModalInput(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $('[name=Employee]').val('');
        $('[name=FK_Employee]').val('');
        $('[name=CSAVisitdate]').val('');
        $('[name=CSAVisittime]').val('');
        $('[name=CSAPriority]').val('');
        $('[name=CSARemarks]').val('');
        $('[name=DepartmentID]').val('0');
        $('[name=Employee]').val('');
        $('[name=EmployeeType]').val('0');
        $('[name=NextAction]').val('');
        $('[name=FK_Attendedby]').val('0');
        $('[name=AttendedBy]').val('');
        $('[name=PdAssignedDate]').val(moment().format('YYYY-MM-DD'));
        $('[name=PdAssignedTime]').val(moment().format('HH:mm'));
        $('[name="ID_NextAction"]').val('');
        $('[name="CSAstatus"]').val('');
        $('[name=PdVehicleDetails]').val('');

        //$('[perfect-tempTable-cstatus]').val('');
        //$('[perfect-tempTable="ComplaintDetails"]').html('');
        $("#ComplaintDetailstbody tr").remove();



    }
    function ConvertJsonDate(Jsondate) {
        var date = "";
        if (Jsondate != "" && Jsondate != null && Jsondate != undefined) {
            var dateString = Jsondate.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            if (month <= 9) {
                month = "0" + month;
            }
            var day = currentTime.getDate();
            if (day <= 9) {
                day = "0" + day;
            }
            var year = currentTime.getFullYear();
            date = day + "-" + month + "-" + year;


        }
        return date;
    }





    function get_tab_count(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');


        let InputDataT = {
            'CusName': $('[name=Customer]').val().trim(),
            'FromDate': $('[name=FromDate]').val(),
            'ToDate': $('[name=ToDate]').val(),
            'PageSize': 15,
            'pageIndex': 0,
            'Mode': 0,
            'FK_Area': $('[name=AreaID]').val().trim(),
            'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
            'Status': $('[name=Complaintstatus]').val().trim(),
            'FK_Product': $('[name=ProductID]').val().trim(),
            'CusMobile': $('[name=Mobile]').val().trim(),
            'TicketNo': $('[name=Ticket]').val().trim(),
        }

      //  console.log('FILTER INPUT 2', InputData);
         let pageUrl = '@Url.Action("GetDeliiveryAssignResult", "PickUpAndDelivery")';
        $.ajax({
            url:pageUrl,
            type: "POST",
            data: InputDataT,//<---- Input json : data passed to controller
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded;charset=utf-8',
            success: function (ajaxOutput) {
                console.log('> Count data', ajaxOutput);




                if (ajaxOutput.Process.IsProcess) {
                   // alert(ajaxOutput.Data[0].Count)
                    //Data[0].TotalCount
                    $('#togPickup').html("" + ajaxOutput.Data[0].Count + "");
                    $('#togdelivery').html("" + ajaxOutput.Data[1].Count + "");
                    }


                else {
                    $.each(successData.Process.Message, function (key, value) {
                        //toastr.warning(value, "Error");
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }




            },
            complete: function () {

                //a.find('.dataTables_wrapper').css('width', '100%');
            }
        });
    }



    function fn_DeliverySearchbyfilter(ele) {
        debugger
      

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let id = $('[name=filt]').val(); //id
        let modes = $('[name=md]').val();//mode

        $thisForm.find('[name=SearchLoadDiv]').empty();
        let s = $(".nav-link active");
        console.log('NAVIGATION VALUE-----', s)
        let Mode = 0;

        let isValid = true;

        let ids = '';
        let tableoptionscustom;
        if (modes = 1) {
            $("#Pickupnav").click()
            Mode = 1;
            ids = '#pickupid';
            tableoptionscustom = pickupTableOptions;
        }
        else if (modes = 2) {
            $("#deliverynav").click()
            Mode = 2;
            ids = '#deliveryid';
            tableoptionscustom = deliveryTableOptions;
        }
        else {
            Mode = 1;
            ids = '#pickupid';
            tableoptionscustom = pickupTableOptions;
        }

        if (Mode == 2) {
            titlepdf = 'New Service Assign';
        }
        else {
            titlepdf = 'On Going Service Assign';
        }

        let FromDate = $("#FrmDate").val();
        debugger
        if (FromDate.trim() === "") {
            $('#FrmDate').removeClass('bg-light').addClass('bg-soft-danger');
            document.getElementById("dateError").innerHTML = "Please Select the From Date";
            isValid = false;
        } else {
            $('#FrmDate').removeClass('bg-soft-danger').addClass('bg-light');
        }
    //if (!FromDate) {

        //    //console.log('inside limit check if')
        //    $thisForm.find('[name="FromDate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Entered Date should be less than or equal to Todays date');
        //    $thisForm.find('[name="FromDate"]').closest('[perfect-class="formGroup"]').find('.limit-check').show();
        //    $thisForm.find('[name="FromDate"]').trigger('blur');
        //    return false;
        //}


        //else {

        //    $thisForm.find('[name="FromDate"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('');
        //    return true;
        //}

        //if (!FromDate) {
        //    isValid = false;
        //    alert('date');
        //    //$('[name="FromDate"]').closest('[perfect-class="formGroup"]').find(errorClass0).attr("style", "display:block");
        //    //$('[name="FromDate"]').closest('[perfect-class="formGroup"]').find(errorClass0).text('Please select From Date');
        //    $thisForm.find('[name="FromDate"]').closest('[perfect-class="formGroup"]').find('.temptableErrors1').text(')
        //    //$('[name="FromDate"]').closest('[perfect-class="formGroup"]').find('.temptableErrors1').text('Entered Date should be less than or equal to Todays date');
        //} else {
        //    //$('[name="FromDate"]').closest('[perfect-class="formGroup"]').find(errorClass0).attr("style", "display:none");
        //    $('[name="FromDate"]').closest('[perfect-class="formGroup"]').find('.temptableErrors1').text('');
        //}

        if (isValid) {

        }
        let inputData = {
            __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
            'CusName': $('[name=Customer]').val(),
            'FromDate': $('[name=FromDate]').val(),
            'ToDate': $('[name=ToDate]').val(),
            'PageSize': 15,
            'PageIndex': 0,
            'Mode': Mode,
            'FK_Area': $('[name=AreaID]').val().trim(),
            'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
            'Status': $('[name=Complaintstatus]').val().trim(),
            'FK_Product': $('[name=ProductID]').val().trim(),
            'CusMobile': $('[name=Mobile]').val().trim(),
            'TicketNo': $('[name=Ticket]').val()
        };

        let pageUrl = '@Url.Action("GetDeliiveryAssignResult", "PickUpAndDelivery")';

        $.ajax({
            url: pageUrl,
            type: "POST",
            data: inputData,//<---- Input json : data passed to controller
            dataType: "json",
            contentType: "application/x-www-form-urlencoded;charset=utf-8",
            success: function (ajaxOutput) {


                if (ajaxOutput.Process.IsProcess) {


                    $(ids).empty().append('<div style="display:none"; class="d-flex justify-content-end mb-3 position-relative"><div class="col-md-1 position-absolute top-1 z-index"> <div class="input-group testSearchBox"></div></div></div>', $('<div/>', { class: "col-md-12 table_temp_class" }).html(pft_table_createtable(ajaxOutput.Data, tableoptionscustom)))
                    datapdf = {

                        'CusName ': $('[name=Customer]').val().trim(),
                        'FromDate': $('[name=FromDate]').val(),
                        'ToDate': $('[name=ToDate]').val(),
                        'pageSize': 15,
                        'pageIndex': 0,
                        'Mode': Mode,
                        'FK_Area': $('[name=AreaID]').val().trim(),
                        'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                        'Status': $('[name=Complaintstatus]').val().trim(),
                        'FK_Product': $('[name=ProductID]').val().trim(),
                        'CusMobile': $('[name=Mobile]').val().trim(),
                        'TicketNo': $('[name=Ticket]').val().trim(),

                    }
                    let $table = $(ids).find('table');
                    console.log('to', $table);

                    $table.dataTable({

                        "serverSide": true,//no change
                        "processing": true,//-- process text when clicked
                        //"lengthChange": false,
                        "lengthMenu": [10, 15, 20, 25, 50, 100],//---drop down page size
                        "searching": false,//--no change
                        "ordering": false,//--sorting
                        "deferLoading": ajaxOutput.totalrecord,//<----to total number of record from db
                        "displayStart": ajaxOutput.PageIndex * ajaxOutput.PageSize,//<----starting record
                        "pageLength": ajaxOutput.PageSize,//<----page size
                        "recordsFiltered": ajaxOutput.PageSize,//<---page size

                        "ajax": returnajaxPagination({
                            apiurl: pageUrl,
                            'CusName': $thisForm.find('[name=Customer]').val(),
                            'FromDate': $('[name=FromDate]').val(),
                            'ToDate': $('[name=ToDate]').val(),
                            'PageSize': 15,
                            'PageIndex': 0,
                            'Mode': Mode,
                            'FK_Area': $('[name=AreaID]').val().trim(),
                            'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                            'Status': $('[name=Complaintstatus]').val().trim(),
                            'FK_Product': $('[name=ProductID]').val().trim(),
                            'CusMobile': $('[name=Mobile]').val().trim(),
                            'TicketNo': $('[name=Ticket]').val(),

                        }, tableoptionscustom, $table)
                    });


                }


                else {

                    if (ajaxOutput.Process.Status = "NoData") {



                        $(ids).empty().append($('<div/>', { class: "col-md-12 table_temp_class" }).html(pft_table_createtable(ajaxOutput.Data, tableoptionscustom)))
                        // $sidemenu.find('table').dataTable({ paging: true });


                        let $table = $(ids).find('table');
                        $table.dataTable({
                            "serverSide": true,//no change
                            "processing": true,//-- process text when clicked
                            // "lengthChange": false,
                            "lengthMenu": [10, 15, 20, 25, 50, 100],//---drop down page size
                            "searching": false,//--no change
                            "ordering": false,//--sorting
                            "deferLoading": ajaxOutput.totalrecord,//<----to total number of record from db
                            "displayStart": ajaxOutput.PageIndex * ajaxOutput.PageSize,//<----starting record
                            "pageLength": ajaxOutput.PageSize,//<----page size
                            "recordsFiltered": ajaxOutput.pageSize,//<---page size

                            "ajax": returnajaxPagination({
                                apiurl: pageUrl,
                                'CusName': $thisForm.find('[name=Customer]').val(),
                                'FromDate': $('[name=FromDate]').val(),
                                'ToDate': $('[name=ToDate]').val(),
                                'PageSize': 15,
                                'PageIndex': 0,
                                'Mode': Mode,
                                'FK_Area': $('[name=AreaID]').val().trim(),
                                'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                                'Status': $('[name=Complaintstatus]').val().trim(),
                                'FK_Product': $('[name=ProductID]').val().trim(),
                                'CusMobile': $('[name=Mobile]').val().trim(),
                                'TicketNo': $('[name=Ticket]').val(),


                            }, tableoptionscustom, $table)
                        });

                    }
                    else {

                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                        });
                    }
                }


            },

            complete: function () {

            }
        });

      

    }


    function FilterReset(ele) {

        let $container = $(ele).closest('[perfect-class="formassign"]');

        $('select[name=Branch]').val('0');
        $container.find('[name=Branch]').val('0');
        $container.find('[name=ProductName]').val('')
        $container.find('[name=ProductID]').val('0');
        $container.find('[name=AreaName]').val('');
        $container.find('[name=AreaID]').val('0');

        $container.find('[name="FromDate"]').val('');
        $container.find('[name="ToDate"]').val('');


        $container.find('[name=Customer]').val('');
        $container.find('[name=Mobile]').val('');
        $container.find('[name=Ticket]').val('');

        $container.find('[name=Complaintstatus]').val('1');
        $('select[name=Complaintstatus]').val('1');

        $container.find('[name=EmployeeSearch]').val('');
        $container.find('[name=FK_EmployeeSearch]').val('0');

    }



    function checkmodal() {
        debugger
        let row = $(this).closest('tr');
        var Saveddt = row.data('pData');

        let id = Saveddt.ID_ProductDeliveryAssign;


        if (Saveddt.Mode == 1 && Saveddt.CSAssignStatus != 2 && Saveddt.TransMode != "INPDR") {

            fn_UpdatepickupStatus(this, id, Saveddt);
        }

        else if (Saveddt.TransMode == "INPDR" && Saveddt.CSAssignStatus != 2) {

            fn_UpdatePickUpStatusEmiRec(this, id, Saveddt);
        }

        else if (Saveddt.Mode == 2 && Saveddt.CSAssignStatus != 2 && Saveddt.TransMode != "INDA" && Saveddt.TransMode != "INSBR") {

            fn_UpdatedeliveryStatus(this, id, Saveddt);
        }
        else if (Saveddt.TransMode == "INDA" && Saveddt.CSAssignStatus != 2) {
            fn_UpdateSalesStatus(this, id, Saveddt)
        }

        else if (Saveddt.Mode == 2 && Saveddt.CSAssignStatus != 2 && Saveddt.TransMode == "INSBR") {

            fn_UpdatedeliveryStatusStby(this, id, Saveddt);
        }

        else {
            if (Saveddt.CSAssignStatus != 2) {
                fn_UpdatepickupStatus(this, id, Saveddt);
            }

        }


    }
    function fn_UpdatepickupStatus(ele, id, dat) {


        debugger
        $('#pickmodalid').removeClass('modal-lg');
        $('#pickmodalid').addClass('modal-xl');

        var InputData = {

            'TransMode': dat.TransMode,
            'FK_ProductDelivery': id,
            'Mode': dat.Mode,
            'Details': 0

        }

         $.ajax({
            url: "@Url.Action("GetTicketDetailsDP", "PickUpAndDelivery")",
            type: "Post",
            data: InputData,
            dataType: "json",
            contentType: "application/x-www-form-urlencoded;charset=utf-8",
            success: function (ajaxOutput) {

                let $thisForm = $(ele).closest('[perfect-class="form"]');



                $thisForm.data({ pwarranty: null });

                $("#DelpickEmployee").val(dat.FK_Employee);
                $('#Delpick_ID_ProductDeliveryAssign').val(ajaxOutput.Data[0]['ID_ProductDelivery']);
                $pwarranty = '';
                console.log('ids', id);

                $thisForm.data({ FK_Employee: dat.FK_Employee });
                console.log('check 234', $thisForm.data('FK_Employee'));

                $thisForm.data({ pwarranty: ajaxOutput.Data[0]['ID_ProductDelivery'] });
                console.log('check 123', $thisForm.data('pwarranty'));
                warrantysave = $thisForm.data('pwarranty');

                $ProductHtml = '';
                if (ajaxOutput.Process.IsProcess) {

                    $('.DivBillType').hide();
                    $('.DivPaymentMethod').hide();

                    $('[name=PdAssignedDate]').val(moment().format('YYYY-MM-DD'));
                    $('[name=PdAssignedTime]').val(moment().format('HH:mm'));

                    $('[name=ID_ProductDeliveryAssign]').text(ajaxOutput.Data[0]['ID_ProductDelivery']);
                    $('#sspanCSRTickno').text(ajaxOutput.Data[0]['CSRTickno']);
                    $('#sspanCSRRegDate').text(ajaxOutput.Data[0]['CSRRegDate']);
                    $('#sspanCustomer').text(ajaxOutput.Data[0]['Customer']);
                    $('#sspanAddress1').text(ajaxOutput.Data[0]['Address1']);
                    $('#sspanAddress2').text(ajaxOutput.Data[0]['Address2']);
                    $('#sspanDistrict').text(ajaxOutput.Data[0]['District']);
                    $('#sspanState').text(ajaxOutput.Data[0]['State']);
                    $('#sspanArea').text(ajaxOutput.Data[0]['Area']);
                    $('#sspanCategory').text(ajaxOutput.Data[0]['Category']);
                    $('#sspanProduct').text(ajaxOutput.Data[0]['Product']);
                    $('#ProductDetailsTbody').empty();
                    let proddtls = ajaxOutput.datas.Data;
                    if (ajaxOutput.datas.Data != null) {
                        if (ajaxOutput.datas.Data.length > 0) {
                            $.each(ajaxOutput.datas.Data, function (i, value) {
                                if (value.Selected == 1) {
                                    checked = "checked";
                                }
                                else {
                                    checked = "";
                                }
                                if (value.ProvideStandBy == 1) {

                                    checked = "checked";
                                }
                                else {
                                    checked = "";
                                }

                                let rowCount = (i + 1);
                                $ProductHtml += "<tr class='rowcount' id=" + rowCount + ">";
                                $ProductHtml += "<td class='jq_Product_ID_Product' Style='Display:none'>" + value.ID_Product + "</td>";
                                $ProductHtml += "<td class='jq_ProductDet_td' ><input id='' type='checkbox'  value='" + value.Selected + "' " + checked +" /></td>";
                                $ProductHtml += "<td class='CurrentProduct' id='CurrentProduct'>" + value.ProdName + "</td>";
                                $ProductHtml += "<td class='jq_ProductDetQty_td' ><input  onkeypress='return /[0-9.]/i.test(event.key)' " + `maxlength=10` + " type='text' " + `onpaste="return false"` +"  min ='1' maxlength='13' class='form-control text-right' value='" + value.Quantity + "' /></td>";
                                $ProductHtml += "<td class='jq_ProductDetRemarks_tds' ><label class='switch'><input type='checkbox'  class='form-control'  value='" + value.ProvideStandBy + "' " + checked + "/><span class='slider round'></span></label></td>";
                                $ProductHtml += "<td class='RplcdProduct'>" +
                                    "<div class='input-group'>" +
                                    "<input type='hidden'  " + ` id=RplacedEmployee_id name=Employee_id` + "  class='form-control RplacedProductIds' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + @ViewBag.FK_Employee + "' >" +
                                    "<input type='hidden'  " + ` id=RplacedProductId${i} name=ID_Product${i}` + "  class='form-control RplacedProductId' perfect-class='formGroupControl' perfect-ctype='hidden' value='' >" +
                                    //"<input type='hidden'  " + `id=RplacedMRPs${index} name=MRPs${index}` + "  class='form-control RplacedMRPs' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.SPDMRP + "'>" +
                                    "<input type='hidden'  " + `id=RplacedStockId${i} name=StockId${i}` + "  class='form-control RplacedStockId' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.Stock + "'>" +
                                    //"<input type='hidden'  " + `id=RplacedTaxAmount${index} name=TaxAmount${index}` + "  class='form-control RplacedTaxAmount' perfect-class='formGroupControl' perfect-ctype='hidden'value='" + value.SPDTaxAmount + "'>" +
                                    "<input type='text'    " + `id=RplacedProductName${i} name=Name${i}` + " class='form-control RplacedProductName' perfect-class='formGroupControl' perfect-css='input' readonly value='" + value.Product + "'>" +
                                    "<div class='input-group-append'><button type='button' " + `id=popup${i}`+ " class='popup btn btn-primary fa fa-search '" + `onclick="GetCmnPopUpSearchValAssign(this, 88, 'Product Details', [], ['ID_Product',  'MRPs', 'SalePrice', 'StockId', 'TaxAmount'])" BindName="Name${i}" BindVal="ID_Product${i}" Function="2" Criterea1="Employee_id" Criterea2="0"` + " disabled></button>" +
                                    "</div></div></td></td>";
                                $ProductHtml += "<td class='RplcdProductqty' ><input  min='0' onkeypress='return /[0-9.]/i.test(event.key)' " + `onpaste="return false"` + " " + `maxlength=10` + " type='text' " + `id=RplacedQty${i}  "` + " class='form-control text-right' value='" + value.SPQuantity + "' readonly/></td>";
                                $ProductHtml += "<td class='RplcdProductAmt' ><input  min='0' onkeypress='return /[0-9.]/i.test(event.key)' " + `onpaste="return false"` +" " + `maxlength=10` +" type='text' " + `id=RplacedSalePrice${i} name=SalePrice${i} onchange="BindProductAmount(this)"` + "  class='form-control text-right' value='" + value.SPAmount + "' readonly/></td>";

                                $ProductHtml += "<td class='jq_ProductDetRemarks_td' ><input type='textbox' class='form-control' " + `maxlength=250` + " value='" + value.Remarks + "'  onkeypress='return /[a-zA-Z0-9&,.]/i.test(event.key)' /></td>";
                                $ProductHtml += "</tr>";


                            });
                        }
                    }
                    else {
                        $ProductHtml += "<tr id='0'><td class='norecord'colspan='8' style'text-align:center'>No Records..</td></tr>";

                    } $('#ProductDetailsTbody').append($ProductHtml);

                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });

                }
            },
             complete: function () {
                 $('.bd-Pick-modal-sm').modal({ backdrop: 'static', keyboard: false });
                 $('.bd-Pick-modal-sm').modal('show');
            }

        });



    }
    //Update PickUp Status with Emi Recovery

    function fn_UpdatePickUpStatusEmiRec(ele, id, dat) {


        debugger
        $('#pickmodalidEMi').removeClass('modal-lg');
        $('#pickmodalidEmi').addClass('modal-xl');

        var InputData = {

            'TransMode': dat.TransMode,
            'FK_ProductDelivery': id,
            'Mode': dat.Mode,
            'Details': 0

        }

         $.ajax({
            url: "@Url.Action("GetTicketDetailsDP", "PickUpAndDelivery")",
            type: "Post",
            data: InputData,
            dataType: "json",
            contentType: "application/x-www-form-urlencoded;charset=utf-8",
            success: function (ajaxOutput) {
                debugger
                let $thisForm = $(ele).closest('[perfect-class="form"]');
                $thisForm.data({ pwarranty: null });

                $("#DelpickEmployee").val(dat.FK_Employee);
                $('#Delpick_ID_ProductDeliveryAssign').val(ajaxOutput.Data[0]['ID_ProductDelivery']);
                $pwarranty = '';
                console.log('ids', id);

                $thisForm.data({ FK_Employee: dat.FK_Employee });
                console.log('check 234', $thisForm.data('FK_Employee'));

                $thisForm.data({ pwarranty: ajaxOutput.Data[0]['ID_ProductDelivery'] });
                console.log('check 123', $thisForm.data('pwarranty'));
                warrantysave = $thisForm.data('pwarranty');

                $ProductHtml = '';
                if (ajaxOutput.Process.IsProcess) {

                    $('[name=PdAssignedDate]').val(moment().format('YYYY-MM-DD'));
                    $('[name=PdAssignedTime]').val(moment().format('HH:mm'));

                    $('[name=ID_ProductDeliveryAssign]').text(ajaxOutput.Data[0]['ID_ProductDelivery']);
                    $('#sspanCSRTickno').text(ajaxOutput.Data[0]['CSRTickno']);
                    $('#sspanCSRRegDate').text(ajaxOutput.Data[0]['CSRRegDate']);
                    $('#sspanCustomerEmi').text(ajaxOutput.Data[0]['Customer']);
                    $('#sspanAddress1Emi').text(ajaxOutput.Data[0]['Address1']);
                    $('#sspanAddress2Emi').text(ajaxOutput.Data[0]['Address2']);
                    $('#sspanDistrictEmi').text(ajaxOutput.Data[0]['District']);
                    $('#sspanStateEmi').text(ajaxOutput.Data[0]['State']);
                    $('#sspanAreaEmi').text(ajaxOutput.Data[0]['Area']);

                    $('#ProductDetailsEmiTbody').empty();
                    let proddtls = ajaxOutput.datas.Data;

                    if (ajaxOutput.datas.Data != null) {
                        if (ajaxOutput.datas.Data.length > 0) {
                            $.each(ajaxOutput.datas.Data, function (i, value) {
                                if (value.Selected == 1) {
                                    checked = "checked";
                                }
                                else {
                                    checked = "";
                                }


                                let rowCount = (i + 1);
                                $ProductHtml += "<tr class='rowcount' id=" + rowCount + ">";
                                $ProductHtml += "<td class='jq_Product_ID_Product' Style='Display:none'>" + value.ID_Product + "</td>";
                                $ProductHtml += "<td class='jq_ProductDet_td' ><input id='' type='checkbox'  value='" + value.Selected + "' " + checked +" /></td>";
                                $ProductHtml += "<td class='CurrentProduct' id='CurrentProduct'>" + value.ProdName + "</td>";
                                $ProductHtml += "<td class='jq_ProductDetQty_td' ><input  onkeypress='return /[0-9.]/i.test(event.key)' " + `maxlength=10` + " type='text' " + `onpaste="return false"` +"  min ='1' maxlength='13' class='form-control text-right' readonly value='" + value.Quantity + "' /></td>";
                                $ProductHtml += "<td class='jq_ProductDetRemarks_td' ><input type='textbox' class='form-control' " + `maxlength=250` + " value='" + value.Remarks + "'  onkeypress='return /[a-zA-Z0-9&,.]/i.test(event.key)' /></td>";
                                $ProductHtml += "</tr>";
                            });
                        }
                    }
                    else {
                        $ProductHtml += "<tr id='0'><td class='norecord'colspan='8' style'text-align:center'>No Records..</td></tr>";

                    } $('#ProductDetailsEmiTbody').append($ProductHtml);

                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });

                }
            },
             complete: function () {
                 $('.bd-PickEmi-modal-sm').modal({ backdrop: 'static', keyboard: false });
                 $('.bd-PickEmi-modal-sm').modal('show');
            }

        });



    }




    function getfunction(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let $tempArr = $thisForm.data('popValueData');
        AddMoreProducts($tempArr.ID_FIELD, $tempArr.Name);
    }
    function AddMoreProducts(idval, idname) {
        var table = document.getElementById("ProductDetailsTbody");

        $('#ProductDetailsTbody tr').each(function (index, ele) {
            if ($(ele).find('.norecord').text() != "") {
                $('#ProductDetailsTbody').empty();
            }
        });

        var row = table.insertRow(-1);
        let rowLength = $("#ProductDetailsTbody td").closest("tr").length;
        row.className = "rowcount";
        row.id = rowLength + 1;

        //Column 0
        var cell0 = row.insertCell(0);
        cell0.className = "jq_Product_ID_Product";
        cell0.setAttribute('style', 'Display:none');
        cell0.innerHTML = idval;

        //Column 1
        var cell1 = row.insertCell(1);
        cell1.className = "jq_ProductDet_td";
        var elementcb = document.createElement("input");
        elementcb.type = "checkbox";
        elementcb.value = "0";
        elementcb.setAttribute('checked', true);
        cell1.appendChild(elementcb);

        //Column 2
        var cell2 = row.insertCell(2);
        cell2.className = "CurrentProduct";
        cell2.id ="CurrentProduct";
        cell2.innerHTML = idname;

        //Column 3
        var cell3 = row.insertCell(3);
        cell3.className = "jq_ProductDetQty_td";
        var elementQty = document.createElement("input");
        elementQty.type = "text";
        elementQty.value = "1";
        elementQty.min = "1";
        elementQty.maxLength  = "13";
        elementQty.className = "form-control text-right";
        elementQty.setAttribute('onkeypress', 'return /[0-9.]/i.test(event.key)');
        elementQty.addEventListener('paste', function (e) { e.preventDefault(); });
        cell3.appendChild(elementQty);

        //Column 4
        var cell4 = row.insertCell(4);
        cell4.className = "jq_ProductDetRemarks_tds";
        cell4.innerHTML = `<label class="switch"><input type="checkbox" class="form-control" value="0"><span class="slider round"></span></label>`;

        //Column 5
        var cell5 = row.insertCell(5);
        cell5.className = "RplcdProduct";
        cell5.innerHTML = `<div class="input-group"><input type="hidden" id="RplacedEmployee_id" name="Employee_id" class="form-control RplacedProductIds" perfect-class="formGroupControl" perfect-ctype="hidden" value='@ViewBag.FK_Employee'><input type="hidden" id="RplacedProductId${rowLength}" name="ID_Product${rowLength}" class="form-control RplacedProductId" perfect-class="formGroupControl" perfect-ctype="hidden" value=""><input type="hidden" id="RplacedStockId${rowLength}" name="StockId${rowLength}" class="form-control RplacedStockId" perfect-class="formGroupControl" perfect-ctype="hidden" value="0"><input type="text" id="RplacedProductName${rowLength}" name="Name${rowLength}" class="form-control RplacedProductName" perfect-class="formGroupControl" perfect-css="input" readonly="" value=""><div class="input-group-append"><button type="button" id="popup${rowLength}" class="popup btn btn-primary fa fa-search " onclick="GetCmnPopUpSearchValAssign(this, 88, 'Product Details', [], ['ID_Product',  'MRPs', 'SalePrice', 'StockId', 'TaxAmount'])" bindname="Name${rowLength}" bindval="ID_Product${rowLength}" function="2" criterea1="Employee_id" criterea2="0" disabled></button></div></div>`;

        //Column 6
        var cell6 = row.insertCell(6);
        cell6.className = "RplcdProductqty";
        var elementPQty = document.createElement("input");
        elementPQty.type = "text";
        elementPQty.value = "";
        elementPQty.min = "0";
        elementPQty.maxLength  = "10";
        elementPQty.className = "form-control text-right";
        elementPQty.setAttribute('onkeypress', 'return /[0-9.]/i.test(event.key)');
        elementPQty.addEventListener('paste', function (e) { e.preventDefault(); });
        elementPQty.setAttribute('readonly', true);
        elementPQty.id = `RplacedQty${rowLength}`;
        cell6.appendChild(elementPQty);

        //Column 7
        var cell7 = row.insertCell(7);
        cell7.className = "RplcdProductAmt";
        var elementPAmt = document.createElement("input");
        elementPAmt.type = "text";
        elementPAmt.value = "";
        elementPAmt.min = "0";
        elementPAmt.maxLength  = "10";
        elementPAmt.className = "form-control text-right";
        elementPAmt.setAttribute('onkeypress', 'return /[0-9.]/i.test(event.key)');
        elementPAmt.id = `RplacedSalePrice${rowLength}`;
        elementPAmt.name = `SalePrice${rowLength}`;
        elementPAmt.setAttribute('onchange', 'BindProductAmount(this)');
        elementPAmt.setAttribute('readonly', true);
        elementPAmt.addEventListener('paste', function (e) { e.preventDefault(); });
        cell7.appendChild(elementPAmt);

        //Column 8
        var cell8 = row.insertCell(8);
        cell8.className = "jq_ProductDetRemarks_td";
        var elementRemarks = document.createElement("input");
        elementRemarks.type = "textbox";
        elementRemarks.value = "";
        elementRemarks.maxLength  = "250";
        elementRemarks.className = "form-control";
        elementRemarks.setAttribute('onkeypress', 'return /[a-zA-Z0-9&,.]/i.test(event.key)');
        cell8.appendChild(elementRemarks);

    }

    function AddMoreProductsOld(idval, idname) {
        // Get the last row of the table
        var lastRow = $('#ProductDetailsTbody tr:last');

        // Clone the last row
        var newRow = lastRow.clone();

        // Increment the id and name index of each input field in the new row
        newRow.find('input').each(function () {
            // Get the current id and name attributes
            var oldId = $('id');
            var oldName = $('name');

            // Increment the index in the id and name attributes
            var newId = oldId.replace(/\d+/, function (match) {
                return parseInt(match) + 1;
            });
            var newName = oldName.replace(/\d+/, function (match) {
                return parseInt(match) + 1;
            });

            // Update the id and name attributes
            $(this).attr('id', newId);
            $(this).attr('name', newName);
        });

        // Insert the new row after the last row of the table
        lastRow.after(newRow);
    }
    function AddMoreProductsOld(idval,idname) {
        var lastRow = $('#ProductDetailsTbody tr:last');
        var newRow = lastRow.clone(true);
        lastRow.after(newRow);
        //alert(newRow.index());
        //var newIndex = lastRow.index()+1 ;

        //newRow.find(`.jq_Product_ID_Product`).find("input").val("");
        newRow.closest('tr').find('.jq_Product_ID_Product').text(idval);
        newRow.closest('tr').find('.CurrentProduct').text(idname);
        //newRow.closest('tr').find(`.RplacedProductName${newIndex}`).find("input").val("");
        //newRow.closest('tr').find(`.RplacedProductName${newIndex}`).removeAttr("index");

        //$(`#RplacedProductId${newRow.index()}`).val("");
        //$(`#RplacedProductName${newRow.index()}`).val("");
        //$(`#RplacedSalePrice${newRow.index()}`).val("0");
        //$(`#RplacedStockId${newRow.index()}`).val("0");

        newRow.find('.RplacedProductId').attr('id', `RplacedProductId${newRow.index()}`);
        newRow.find('.RplacedProductId').attr('name', `ID_Product${newRow.index()}`);
        newRow.find('.RplacedProductName').attr('id', `RplacedProductName${newRow.index()}`);
        newRow.find('.RplacedProductName').attr('name', `Name${newRow.index()}`);
        //let inputElement = document.querySelector('.RplacedProductName');
        //console.log('inputElement', inputElement);
        //inputElement.id = 'RplacedProductName' + newIndex;
        //inputElement.name = 'Name' + newIndex;

        //newRow.find("input").val("");
        //var newIndex = lastRow.index() + 1;
        //newRow.find(":input").each(function () {
        //    var name = $(this).attr("name");
        //    name = name.replace(/\d+/, newIndex);
        //    $(this).attr("name", name);
        //    $(this).attr("id", name);
        //});
        //let row = $(this).closest("tr").index();

    }
    function AddMoreProducts1() {

        var table = document.getElementById("ProductDetailsTbody");

        var row = table.insertRow(-1);
        var clone = row.cloneNode(true);
        table.appendChild(clone);
        var cell1 = row.insertCell(0);
        //var cell2 = row.insertCell(1);
        //var cell3 = row.insertCell(2);
        //var cell4 = row.insertCell(3);
        //var cell5 = row.insertCell(4);
        //var cell6 = row.insertCell(5);
        //var cell7 = row.insertCell(6);
        //var cell8 = row.insertCell(7);
        //var cell9 = row.insertCell(8);
        //var cell10 = row.insertCell(9);
        let cell7data ="<td class='RplcdProduct'>" +
                                    "<div class='input-group'>" +
                                    "<input type='hidden'  " + ` id=RplacedEmployee_id name=Employee_id` + "  class='form-control RplacedProductIds' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + @ViewBag.FK_Employee + "' >" +
                                    "<input type='hidden'  " + ` id=RplacedProductId${i} name=ID_Product${i}` + "  class='form-control RplacedProductId' perfect-class='formGroupControl' perfect-ctype='hidden' value='' >" +
                                    //"<input type='hidden'  " + `id=RplacedMRPs${index} name=MRPs${index}` + "  class='form-control RplacedMRPs' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.SPDMRP + "'>" +
                                    "<input type='hidden'  " + `id=RplacedStockId${i} name=StockId${i}` + "  class='form-control RplacedStockId' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.Stock + "'>" +
                                    //"<input type='hidden'  " + `id=RplacedTaxAmount${index} name=TaxAmount${index}` + "  class='form-control RplacedTaxAmount' perfect-class='formGroupControl' perfect-ctype='hidden'value='" + value.SPDTaxAmount + "'>" +
                                    "<input type='text'    " + `id=RplacedProductName${i} name=Name${i}` + " class='form-control RplacedProductName' perfect-class='formGroupControl' perfect-css='input' readonly value='" + value.Product + "'>" +
                                    "<div class='input-group-append'><button type='button' id='popup' class='popup btn btn-primary fa fa-search '" + `onclick="GetCmnPopUpSearchValAssign(this, 88, 'Product Details', [], ['ID_Product',  'MRPs', 'SalePrice', 'StockId', 'TaxAmount'])" BindName="Name${i}" BindVal="ID_Product${i}" Function="2" Criterea1="Employee_id" Criterea2="0"` + "></button>" +
                                    "</div></div></td></td>";
        //cell1.setAttribute("hidden", true);
        //cell1.innerHTML = `<td class='jq_Product_ID_Product' style='display:none;'>` + 0 + `</td>`;
        //cell2.innerHTML = `<td class='jq_ProductDet_td' ><input id='' type='checkbox'  value='" + value.Selected + "' " + checked +" /></td>`;
        //cell3.innerHTML = `<td >" + value.ProdName + "</td>`;
        //cell4.innerHTML = `<td class='jq_ProductDetQty_td' ><input onkeypress='return isNumberKey(event)' type='text' min='1' maxlength='13' class='form-control text-right' value='" + value.Quantity + "' /></td>`;
        //cell5.innerHTML = `<td class='jq_ProductDetRemarks_tds' ><label class='switch'><input type='checkbox'  class='form-control'  value='" + value.ProvideStandBy + "' " + checked + "/><span class='slider round'></span></label></td>`;
        ////cell6.innerHTML = cell7data;
        //cell7.innerHTML =``;
        //cell8.innerHTML =``;
        //cell9.innerHTML =``;
        //cell10.innerHTML =``;
    }


    function getfunctionAssign(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let $tempArr = $thisForm.data('popValueData');
        let row = $(ele).closest("tr").index();
        $(`#RplacedStockId${row}`).val($tempArr.StockId);
    }
    //////Standby amount start
    $("#ProductDetails tbody").on("change", ".jq_ProductDet_td", function () {
        debugger
        BindProductAmount(this);
    });
    $("#ProductDetails tbody").on("change", ".jq_ProductDetRemarks_tds", function () {
        debugger
        var row = $(this).closest("tr");
        let i = $(this).closest("tr").index();
        let amount = 0
        row.find('.RplcdProductAmt').find('input').val(parseFloat(amount).toFixed(2));
        BindProductAmount(this);
    });

    $("#ProductDetailsdel tbody").on("change", ".jq_ProductDet_td", function () {
        debugger
        BindProductAmount(this,1);
    });
    $("#ProductDetailsdel tbody").on("change", ".jq_ProductDetRemarks_tds", function () {
        debugger
        var row = $(this).closest("tr");
        let i = $(this).closest("tr").index();
        let amount = 0
        row.find('.RplcdProductAmt').find('input').val(parseFloat(amount).toFixed(2));
        BindProductAmount(this,1);
    });


    function BindProductAmount(ele,mode) {
        debugger
        if (mode != 1) {
            let $thisForm = $(ele).closest('[perfect-class="form"]');
            let amount = 0
            let TotalAmount = 0;
            $('#ProductDetailsTbody tr').each(function (index, ele) {
                if ($(this).find('.jq_ProductDet_td').find('[type="checkbox"]').is(':checked') == true) {
                    debugger
                    if ($(this).find('.jq_ProductDetRemarks_tds').find('[type="checkbox"]').is(':checked') == true) {
                        debugger
                        $('#popup'+ index).removeAttr('disabled');
                        $('#RplacedSalePrice' + index).attr("readonly", false);
                        $('#RplacedQty' + index).attr("readonly", false);
                        TotalAmount = TotalAmount + parseFloat($(ele).find('.RplcdProductAmt').find('input').val() == "" ? "0" : $(ele).find('.RplcdProductAmt').find('input').val());
                    }
                    else {
                        $('#popup' + index).attr('disabled',true);
                        $('#RplacedSalePrice' + index).attr("readonly", true);
                        $(ele).find('.RplcdProductAmt').find('input').val('');
                        $(ele).find('.RplcdProductqty').find('input').val('');
                        $(`#RplacedProductId${index}`).val("");
                        $(`#RplacedProductName${index}`).val("");
                        $(`#RplacedStockId${index}`).val("0");
                        $('#RplacedQty' + index).attr("readonly", true);
                    }
                }
                else {
                    $('#popup' + index).attr('disabled', true);
                    $('#RplacedSalePrice' + index).attr("readonly", true);
                    $(ele).find('.RplcdProductAmt').find('input').val('');
                    $(ele).find('.RplcdProductqty').find('input').val('');
                    $(`#RplacedProductId${index}`).val("");
                    $(`#RplacedProductName${index}`).val("");
                    $(`#RplacedStockId${index}`).val("0");
                    $('#RplacedQty' + index).attr("readonly", true);
                }
            });
            $thisForm.find('[name=StandByTotalAmount]').val(parseFloat(TotalAmount).toFixed(2));
            let billamt = 0;
            let bilamt = 0;
            let netamt = $thisForm.find('[name=StandByTotalAmount]').val();
            bilamt = netamt;
            $('#Paymentdethead').find('tbody tr').each(function (index, ele) {
                billamt += parseFloat($(ele).find('.PAmount').text());

            });
            bilamt = parseFloat(bilamt) - billamt;
            $thisForm.find('[name=BalAmt]').text(bilamt.toFixed(2));
            if (parseFloat($thisForm.find('[name=StandByTotalAmount]').val()) > 0) {
                $('.DivBillType').show();
                $('.DivPaymentMethod').show();
            }
            else {
                $('.DivBillType').hide();
                $('.DivPaymentMethod').hide();
            }
        }
        else {
            let $thisForm = $(ele).closest('[perfect-class="form"]');
            let amount = 0
            let TotalAmount = 0;
            $('#ProductDetailsTbodyP tr').each(function (index, ele) {
                if ($(this).find('.jq_ProductDet_td').find('[type="checkbox"]').is(':checked') == true) {
                    debugger
                    if ($(this).find('.jq_ProductDetRemarks_tds').find('[type="checkbox"]').is(':checked') == true) {
                        debugger
                        $('#RplacedSalePrice' + index).attr("readonly", false);
                        TotalAmount = TotalAmount + parseFloat($(ele).find('.RplcdProductAmt').find('input').val() == "" ? "0" : $(ele).find('.RplcdProductAmt').find('input').val());
                    }
                    else {
                        $('#RplacedSalePrice' + index).attr("readonly", true);
                        $(ele).find('.RplcdProductAmt').find('input').val('');
                    }
                }
                else {
                    $('#RplacedSalePrice' + index).attr("readonly", true);
                    $(ele).find('.RplcdProductAmt').find('input').val('');
                }
            });
            $thisForm.find('[name=StandByTotalAmounts]').val(parseFloat(TotalAmount).toFixed(2));
            let billamt = 0;
            let bilamt = 0;
            let netamt = $thisForm.find('[name=StandByTotalAmounts]').val();
            bilamt = netamt;
            $('#Paymentdetheads').find('tbody tr').each(function (index, ele) {
                billamt += parseFloat($(ele).find('.PAmount').text());

            });
            bilamt = parseFloat(bilamt) - billamt;
            $thisForm.find('[name=BalAmts]').text(bilamt.toFixed(2));
        }
    }
    //////Standby amount end
    function fn_UpdatedeliveryStatus(ele, id ,dat) {
      
        $('#delmodalid').removeClass('modal-lg');
        $('#delmodalid').addClass('modal-xl');


        var InputData = {

            'TransMode': dat.TransMode,
            'FK_ProductDelivery': id,
            'Mode': dat.Mode,
            'Details': 0

        }

        $.ajax({
            url: "@Url.Action("GetTicketDetailsDP", "PickUpAndDelivery")",
            type: "Post",
            data: InputData,
            dataType: "json",
            contentType: "application/x-www-form-urlencoded;charset=utf-8",
            success: function (ajaxOutput) {
                $ProductHtml1 = '';
                let $thisForm = $(ele).closest('[perfect-class="form"]');


                $("#PickEmployee").val(dat.FK_Employee);
                $('#Pick_ID_ProductDeliveryAssign').val(ajaxOutput.Data[0]['ID_ProductDelivery']);

                if (ajaxOutput.Process.IsProcess) {
                    $('[name=PdAssignedDate]').val(moment().format('YYYY-MM-DD'));
                    $('[name=PdAssignedTime]').val(moment().format('HH:mm'));

                    $('#spanCSRTickno').text(ajaxOutput.Data[0]['CSRTickno']);
                    $('#spanCSRRegDate').text(ajaxOutput.Data[0]['CSRRegDate']);
                    $('#spanCustomer').text(ajaxOutput.Data[0]['Customer']);
                    $('#spanAddress1').text(ajaxOutput.Data[0]['Address1']);
                    $('#spanAddress2').text(ajaxOutput.Data[0]['Address2']);
                    $('#spanDistrict').text(ajaxOutput.Data[0]['District']);
                    $('#spanState').text(ajaxOutput.Data[0]['State']);
                    $('#spanArea').text(ajaxOutput.Data[0]['Area']);
                    $('#spanCategory').text(ajaxOutput.Data[0]['Category']);
                    $('#spanProduct').text(ajaxOutput.Data[0]['Product']);



                    $('#ProductDetailsTbodyP').empty();
                    let proddtls = ajaxOutput.datas.Data;



                    if (ajaxOutput.datas.Data != null) {

                        if (ajaxOutput.datas.Data.length > 0) {
                            $.each(ajaxOutput.datas.Data, function (i, value) {

                                if (value.Selected == 1) {
                                    checked = "checked";
                                }
                                else {
                                    checked = "";
                                }
                                if (value.ProvideStandBy == 1) {

                                    checked = "checked";
                                }
                                else {
                                    checked = "";
                                }
                                let rowCount = (i + 1);
                                $ProductHtml1 += "<tr id=" + rowCount + ">";
                                $ProductHtml1 += "<td class='jq_Product_ID_Product' Style='Display:none'>" + value.ID_Product + "</td>";
                                $ProductHtml1 += "<td class='jq_ProductDet_td' ><input type='checkbox'  value='" + value.Selected + "' " + checked + " /></td>";
                                $ProductHtml1 += "<td >" + value.ProdName + "</td>";
                                $ProductHtml1 += "<td class='jq_ProductDetQty_td' ><input onkeypress='return isNumberKey(event)' type='text'  class='form-control text-right' value='" + value.Quantity + "' min='0'  maxlength='13' /><span id='qnt'></span></td>";
                                $ProductHtml1 += "<td class='jq_ProductDetRemarks_tds' ><label class='switch'><input type='checkbox'  class='form-control'  value='" + value.ProvideStandBy + "' " + checked + "/><span class='slider round'></span></label></td>";
                                $ProductHtml1 += "<td class='RplcdProduct'>" +
                                    "<div class='input-group'>" +
                                    "<input type='hidden'  " + ` id=RplacedEmployee_id name=Employee_id` + "  class='form-control RplacedProductIds' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + @ViewBag.FK_Employee + "' >" +
                                    "<input type='hidden'  " + ` id=RplacedProductId${i} name=ID_Product${i}` + "  class='form-control RplacedProductId' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.FK_StandByProduct + "' >" +
                                    //"<input type='hidden'  " + `id=RplacedMRPs${index} name=MRPs${index}` + "  class='form-control RplacedMRPs' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.SPDMRP + "'>" +
                                    "<input type='hidden'  " + `id=RplacedStockId${i} name=StockId${i}` + "  class='form-control RplacedStockId' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.Stock + "'>" +
                                    //"<input type='hidden'  " + `id=RplacedTaxAmount${index} name=TaxAmount${index}` + "  class='form-control RplacedTaxAmount' perfect-class='formGroupControl' perfect-ctype='hidden'value='" + value.SPDTaxAmount + "'>" +
                                    "<input type='text'    " + `id=RplacedProductName${i} name=Name${i}` + " class='form-control RplacedProductName' perfect-class='formGroupControl' perfect-css='input' readonly value='" + value.Product + "'>" +
                                    "<div class='input-group-append'><button type='button' id='popup' class='popup btn btn-primary fa fa-search '" + `onclick="GetCmnPopUpSearchValAssign(this, 88, 'Product Details', [], ['ID_Product',  'MRPs', 'SalePrice', 'StockId', 'TaxAmount'])" BindName="Name${i}" BindVal="ID_Product${i}" Function="2" Criterea1="Employee_id" Criterea2="0"` + "></button>" +
                                    "</div></div></td></td>";
                                $ProductHtml1 += "<td class='RplcdProductqty' ><input  min='0' onkeypress='return /[0-9.]/i.test(event.key)' " + `maxlength=10` +" type='text'  class='form-control text-right' value='" + value.SPQuantity + "' /></td>";
                                $ProductHtml1 += "<td class='RplcdProductAmt' hidden ><input  min='0' onkeypress='return /[0-9.]/i.test(event.key)' maxlength ='10' type='text' " + `id=RplacedSalePrice${i} name=SalePrice${i} onchange="BindProductAmount(this,1)"` + "  class='form-control text-right' value='" + value.SPAmount + "' readonly /></td>";
                                $ProductHtml1 += "<td class='jq_ProductDetRemarks_td' ><input type='textbox' class='form-control' " + `maxlength=250` +" value='" + value.Remarks + "' /></td>";
                                $ProductHtml1 += "</tr>";


                            });
                        }
                    }
                    else {
                        $ProductHtml1 += "<tr id='0'><td class='norecord'colspan='4' style'text-align:center'>No Records..</td></tr>";

                    } $('#ProductDetailsTbodyP').append($ProductHtml1);

                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });

                }
            },
            complete: function () {
                $('.bd-del-modal-sm').modal({ backdrop: 'static', keyboard: false });
                $('.bd-del-modal-sm').modal('show');

            }

        });


    }

    function fn_SavePickdetailsEmi(ele) {
        debugger
        var mode;
        var tablerow = $("#ProductDetailsEmiTbody tr");

        var productReplace = [];
        let paymentdetails = [];


            if (tablerow.length > 0) {


                $('#ProductDetailsEmiTbody tr').each(function (index, ele) {

                    //if ($(ele).find('.jq_ProductDet_td').find('[type="checkbox"]').is(':checked') == true) {
                    let ID_Product = $(this).find("td:eq(0)").text();
                    let checkbox1 = $(this).find("td:eq(1) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                    let prodname = $(this).find("td:eq(2)").text();

                    let quantity = $(this).find("td:eq(3) input[type='text']").val();
                    let TextRemarks = $(this).find("td:eq(4) input[type='textbox']").val();

                    var ary = {
                        ID_Product: ID_Product, Selected: checkbox1, ProdName: prodname, Quantity: quantity, ProvideStandBy: 0, Remarks: TextRemarks, StandByQuantity: 0,
                        FK_StandByProduct: 0, StandByAmount: 0, FK_EmployeeStock: 0
                    }
                    productReplace.push(ary);
                    //}




                });
            }
            let $thisForm = $(ele).closest('[perfect-class="form"]');



        let DeliverydateEmi = $thisForm.find('[name="PdAssignedDate"]').val();
        let deltime = $thisForm.find('[name="PdAssignedTime"]').val();
        let picsta = $thisForm.find('[name="ID_NextAction"]').val();
        let picCstaEmi = $thisForm.find('[name="CSAstatus"]').val();
        let BillType = $thisForm.find('[name="BillTypeID"]').val();



        if (DeliverydateEmi == '') {
                document.getElementById("itEmi").style.display = "block";
                document.getElementById('itEmi').innerHTML = "Please select date";

                setTimeout(() => {
                    document.getElementById('itEmi').style.display = 'none'

                }, 5000);
                isValid = false;
            }



            else if (picCstaEmi == 0 || picCstaEmi == '') {

                document.getElementById("picCstaEmi").style.display = "block";
                document.getElementById('picCstaEmi').innerHTML = "Please select Status";

                setTimeout(() => {
                    document.getElementById('picCstaEmi').style.display = 'none'

                }, 5000);
                isValid = false;
            }

            else if (tablerow.length > 0) {
                let blnError = false;

                $('#ProductDetailsTbody tr').each(function (index, ele) {

                    let ID_Product = $(this).find("td:eq(0)").text();
                    let checkbox1 = $(this).find("td:eq(1) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                    let prodname = $(this).find("td:eq(2)").text();

                    let quantity = $(this).find("td:eq(3) input[type='text']").val();
                    let TextRemarks = $(this).find("td:eq(4) input[type='textbox']").val();


                    debugger
                    if (checkbox1 == 1 && quantity == '0') {
                        NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'The quantity must be greater than 0' });
                        //$(this).find("td:eq(3) input[type='text']").addClass('is-invalid');
                        //setTimeout(() => {
                        //    $(this).find("td:eq(3) input[type='text']").removeClass('is-invalid');
                        //    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Quantity' });
                        //}, 2000);
                        isValid = false;
                        blnError = true
                    }


                    else if (blnError) {
                        isValid = false;
                    }
                    else {
                        isValid = true;
                    }

                });

            }

            else {

                isvalid = true;

            }

        let validpay = true;


        if (isValid) {
            debugger
            //if (validpay) {

                var inputData =
                {

                    '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                    'FK_ProductDeliveryAssign': $('#Delpick_ID_ProductDeliveryAssign').val(),
                    'FK_Employee': $('#DelpickEmployee').val(),
                    'PdfDeliveryDate': $thisForm.find('[name=PdAssignedDate]').val().trim(),
                    'PdfDeliveryTime': $thisForm.find('[name=PdAssignedTime]').val().trim(),
                    'Remarks': $thisForm.find('[name=PdVehicleDetails]').val().trim(),
                    'CSAstatus': $thisForm.find('[name="CSAstatus"]').val().trim(),
                    'ID_NextAction': 0,
                    'Productdetails': productReplace,
                    'StandByTotalAmount': 0,
                    'Paymentdetail': paymentdetails ,
                    'FK_BillType': 0,
                    'TransMode': PickUpTransMode,

                };
                console.log('pdf', inputData);

                $.ajax({
                    url: "@Url.Action("Updatedeliveryandpick", "PickUpAndDelivery")",
                    type: "POST",
                    data: inputData,
                    dataType: "json",
                    contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                    success: function (ajaxOutput) {

                        if (ajaxOutput.Process.IsProcess) {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': 'Updated Successfully' });
                            });

                            let onSuccess = $thisForm.attr('perfect-onFormSuccess')
                        }
                        else {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                            });
                        }

                        if (mode = 1) { fn_Delivery_Pickup_tab(this, mode, '#pickupid', pickupTableOptions); }
                        if (mode = 2) { fn_Delivery_Pickup_tab(this, mode, '#deliveryid', deliveryTableOptions); }

                    },

                    complete: function () {
                        $(ele).prop('disabled', false);
                        $('.bd-PickEmi-modal-sm').modal('hide');
                        resetmoal(ele);

                    }
                });

           // }
            //else {
              //  $(ele).prop('disabled', false);
             //   NotificationMessage({ 'type': 'error', 'heading': 'Warning', 'message': 'In Payment Method Balance Amt. Should be  Zero ' });
           // }

        }
        else {
            //NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please all fill mandatory fields' });
        }


    }


    function fn_SavePickdetails(ele) {


        var mode;
        var tablerow = $("#ProductDetailsTbody tr");

        var productReplace = [];


            if (tablerow.length > 0) {


                $('#ProductDetailsTbody tr').each(function (index, ele) {

                    //if ($(ele).find('.jq_ProductDet_td').find('[type="checkbox"]').is(':checked') == true) {
                    let ID_Product = $(this).find("td:eq(0)").text();
                    let checkbox1 = $(this).find("td:eq(1) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                    let prodname = $(this).find("td:eq(2)").text();
                    let standby = $(this).find("td:eq(4) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                    let quantity = $(this).find("td:eq(3) input[type='text']").val();
                    let TextRemarks = $(this).find("td:eq(8) input[type='textbox']").val();
                    let StandByQuantity = $(ele).find('.RplcdProductqty').find('input').val();
                    let FK_StandByProduct = $(ele).find('.RplacedProductId').val();
                    let StandByAmount = $(ele).find('.RplcdProductAmt').find('input').val();
                    let FK_EmployeeStock = $(ele).find('.RplacedStockId').val();

                    var ary = {
                        ID_Product: ID_Product, Selected: checkbox1, ProdName: prodname, Quantity: quantity, ProvideStandBy: standby, Remarks: TextRemarks, StandByQuantity: StandByQuantity,
                        FK_StandByProduct: FK_StandByProduct, StandByAmount: StandByAmount, FK_EmployeeStock: FK_EmployeeStock
                    }
                    productReplace.push(ary);
                    //}




                });
            }
            let $thisForm = $(ele).closest('[perfect-class="form"]');
            let paymentdetails = [];
            if ($thisForm.find('[name="StandByTotalAmount"]').val() != 0 || $thisForm.find('[name="StandByTotalAmount"]').val() != '') {

                $thisForm.find('[perfect-tempTable="Payment"]').find('tbody').find('tr').each(function () {
                    paymentdetails.push($(this).data('pData'));
                })
            }






        let Deliverydate = $thisForm.find('[name="PdAssignedDate"]').val();
        let deltime = $thisForm.find('[name="PdAssignedTime"]').val();
        let picsta = $thisForm.find('[name="ID_NextAction"]').val();
        let picCsta = $thisForm.find('[name="CSAstatus"]').val();
        let BillType = $thisForm.find('[name="BillTypeID"]').val();
        let pickupstatus = $thisForm.find('[name="Pickupstatus"]').val(); 



            if (Deliverydate == '') {
                document.getElementById("it").style.display = "block";
                document.getElementById('it').innerHTML = "Please select date";

                setTimeout(() => {
                    document.getElementById('it').style.display = 'none'

                }, 4000);
                isValid = false;
            }

            //else if (deltime == '') {
            //    document.getElementById("itime").style.display = "block";
            //    document.getElementById('itime').innerHTML = "Please select Time";

            //    setTimeout(() => {
            //        document.getElementById('itime').style.display = 'none'

            //    }, 4000);
            //    isValid = false;
            //}

            //else if (picsta == 0 || picsta == '') {

            //    document.getElementById("itstap").style.display = "block";
            //    document.getElementById('itstap').innerHTML = "Please Select Ticket status";

            //    setTimeout(() => {
            //        document.getElementById('itstap').style.display = 'none'

            //    }, 4000);
            //    isValid = false;
            //}

            else if (picCsta == 0 || picCsta == '') {

                document.getElementById("picCsta").style.display = "block";
                document.getElementById('picCsta').innerHTML = "Please select Status";

                setTimeout(() => {
                    document.getElementById('picCsta').style.display = 'none'

                }, 4000);
                isValid = false;
            }
            else if (picCsta == 2 && (pickupstatus == '' || pickupstatus==0)) {

                document.getElementById("picCsta1").style.display = "block";
                document.getElementById('picCsta1').innerHTML = "Please select  Pick Up Status";

                setTimeout(() => {
                    document.getElementById('picCsta1').style.display = 'none'

                }, 4000);
                isValid = false;
            }
            else if (parseFloat($thisForm.find('[name="StandByTotalAmount"]').val()) > 0 && (BillType == 0 || BillType=='')) {

                document.getElementById("BillTypeVald").style.display = "block";
                document.getElementById('BillTypeVald').innerHTML = "Please select BillType";

                setTimeout(() => {
                    document.getElementById('BillTypeVald').style.display = 'none'

                }, 4000);
                isValid = false;
            }
            else if (tablerow.length > 0) {
                let blnError = false;

                $('#ProductDetailsTbody tr').each(function (index, ele) {

                    let ID_Product = $(this).find("td:eq(0)").text();
                    let checkbox1 = $(this).find("td:eq(1) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                    let prodname = $(this).find("td:eq(2)").text();
                    let standby = $(this).find("td:eq(4) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                    let quantity = $(this).find("td:eq(3) input[type='text']").val();
                    let TextRemarks = $(this).find("td:eq(8) input[type='textbox']").val();
                    let standbyamount = $(ele).find('.RplcdProductAmt').find('input').val();
                    let StandByQuantity = $(ele).find('.RplcdProductqty').find('input').val();
                    let FK_StandByProduct = $(ele).find('.RplacedProductId').val();
                    debugger
                    if (checkbox1 == 1 && quantity == '0') {
                        NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Quantity' });
                        //$(this).find("td:eq(3) input[type='text']").addClass('is-invalid');
                        //setTimeout(() => {
                        //    $(this).find("td:eq(3) input[type='text']").removeClass('is-invalid');
                        //    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Quantity' });
                        //}, 2000);
                        isValid = false;
                        blnError = true
                    }
                    else if (standby == 1 &&FK_StandByProduct == "") {
                        NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Standby Product' });
                        isValid = false;
                        blnError = true
                    }
                    else if (standby == 1 &&(StandByQuantity == "" || StandByQuantity == "0")) {
                        NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Standby Quantity' });
                        isValid = false;
                        blnError = true
                    }
                    else if (standby == 1 &&  standbyamount == "") {
                        NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Standby Amount' });
                        isValid = false;
                        blnError = true
                    }
                    else if (blnError) {
                        isValid = false;
                    }
                    else {
                        isValid = true;
                    }

                });

            }

            else {

                isvalid = true;

            }

        let validpay = true;
        if ($thisForm.find('[name="StandByTotalAmount"]').val() > 0) {

            if (BillAmountbind(ele)) {
                validpay = true;
            }
            else {
                validpay = false;
            }
        }

        if (isValid) {

            if (validpay) {

                var inputData =
                {

                    '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                    'FK_ProductDeliveryAssign': $('#Delpick_ID_ProductDeliveryAssign').val(),
                    'FK_Employee': $('#DelpickEmployee').val(),
                    'PdfDeliveryDate': $thisForm.find('[name=PdAssignedDate]').val().trim(),
                    'PdfDeliveryTime': $thisForm.find('[name=PdAssignedTime]').val().trim(),
                    'Remarks': $thisForm.find('[name=PdVehicleDetails]').val().trim(),
                    'CSAstatus': $thisForm.find('[name="CSAstatus"]').val().trim(),
                    'ID_NextAction': $thisForm.find('[name="ID_NextAction"]').val().trim(),
                    'Productdetails': productReplace,
                    'StandByTotalAmount': $thisForm.find('[name="StandByTotalAmount"]').val().trim(),
                    'Paymentdetail': paymentdetails,
                    'FK_BillType': $thisForm.find('[name="BillTypeID"]').val(),
                    'TransMode': PickUpTransMode,
                    'Pickupstatus': $thisForm.find('[name="Pickupstatus"]').val().trim(), 

                };
                console.log('pdf', inputData);

                $.ajax({
                    url: "@Url.Action("Updatedeliveryandpick", "PickUpAndDelivery")",
                    type: "POST",
                    data: inputData,
                    dataType: "json",
                    contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                    success: function (ajaxOutput) {

                        if (ajaxOutput.Process.IsProcess) {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': 'Updated Successfully' });
                            });

                            let onSuccess = $thisForm.attr('perfect-onFormSuccess')
                        }
                        else {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                            });
                        }

                        if (mode = 1) { fn_Delivery_Pickup_tab(this, mode, '#pickupid', pickupTableOptions); }
                        if (mode = 2) { fn_Delivery_Pickup_tab(this, mode, '#deliveryid', deliveryTableOptions); }

                    },

                    complete: function () {
                        $(ele).prop('disabled', false);
                        $('.bd-Pick-modal-sm').modal('hide');
                        resetmoal(ele);

                    }
                });

            }
            else {
                $(ele).prop('disabled', false);
                NotificationMessage({ 'type': 'error', 'heading': 'Warning', 'message': 'In Payment Method Balance Amt. Should be  Zero ' });
            }

        }
        else {
            //NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please all fill mandatory fields' });
        }
    }


    function fn_Savedeldetails(ele) {


        debugger

        var mode;
        var tablerow = $("#ProductDetailsTbodyP tr");

        var productReplaces = [];

        if (tablerow.length > 0) {


            $('#ProductDetailsTbodyP tr').each(function (index, ele) {

                let ID_Product = $(this).find("td:eq(0)").text();
                let checkbox1 = $(this).find("td:eq(1) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                let prodname = $(this).find("td:eq(2)").text();
                let standby = $(this).find("td:eq(4) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                let quantity = $(this).find("td:eq(3) input[type='text']").val().trim();
                let TextRemarks = $(this).find("td:eq(8) input[type='textbox']").val().trim();

                let StandByQuantity = $(ele).find('.RplcdProductqty').find('input').val();
                let FK_StandByProduct = $(ele).find('.RplacedProductId').val();
                let StandByAmount = $(ele).find('.RplcdProductAmt').find('input').val();
                let FK_EmployeeStock = $(ele).find('.RplacedStockId').val();

                var ary = {
                    ID_Product: ID_Product, Selected: checkbox1, ProdName: prodname, Quantity: quantity, ProvideStandBy: standby, Remarks: TextRemarks,
                    StandByQuantity: StandByQuantity, FK_StandByProduct: FK_StandByProduct, StandByAmount: StandByAmount, FK_EmployeeStock: FK_EmployeeStock
                }

                productReplaces.push(ary);
                console.log('arry', ary);

            });
        }



        let $thisForm = $(ele).closest('[perfect-class="form"]');


        let paymentdetails = [];
        if ($thisForm.find('[name="StandByTotalAmount"]').val() != 0 || $thisForm.find('[name="StandByTotalAmount"]').val() != '') {

            $thisForm.find('[perfect-tempTable="Payment"]').find('tbody').find('tr').each(function () {
                paymentdetails.push($(this).data('pData'));
            })
        }

       // $thisForm.validate({ messages: validationMessage });
        if ($('#Deliverydate').is(":visible") && $('#Deliverytime').is(":visible")) {
            $('[name="PdAssignedDate"]').addClass('perfectValidate_date');
            $('[name="PdAssignedDate"]').addClass('perfectValidate_time');
        }





        let Deliverydates = $thisForm.find('[name="PdAssignedDate"]').val();
        let deltimes = $thisForm.find('[name="PdAssignedTime"]').val();
        let delsta = $thisForm.find('[name="ID_NextAction"]').val();
        let delCsta = $thisForm.find('[name="CSAstatus"]').val();
        let deliveryCsta = $thisForm.find('[name="Pickupstatus"]').val();
        if (Deliverydates == '') {
            document.getElementById("delit").style.display = "block";
            document.getElementById('delit').innerHTML = "Please select date";

            setTimeout(() => {
                document.getElementById('delit').style.display = 'none'

            }, 4000);
            isValid = false;
        }

        //else if (deltimes == '') {
        //    document.getElementById("deltme").style.display = "block";
        //    document.getElementById('deltme').innerHTML = "Please select Time";

        //    setTimeout(() => {
        //        document.getElementById('deltme').style.display = 'none'

        //    }, 4000);
        //    isValid = false;
        //}

        //else if (delsta == 0 || delsta == '') {

        //    document.getElementById("delsta").style.display = "block";
        //    document.getElementById('delsta').innerHTML = "Please Select Ticket status";

        //    setTimeout(() => {
        //        document.getElementById('delsta').style.display = 'none'

        //    }, 4000);
        //    isValid = false;
        //}
        else if (delCsta == 0 || delCsta == '') {

            document.getElementById("delCsta").style.display = "block";
            document.getElementById('delCsta').innerHTML = "Please Select Status";

            setTimeout(() => {
                document.getElementById('delCsta').style.display = 'none'

            }, 4000);
            isValid = false;
        }
        else if (delCsta == 2 && (deliveryCsta == '' || deliveryCsta==0)) {

            document.getElementById("delCsta1").style.display = "block";
            document.getElementById('delCsta1').innerHTML = "Please Select Delivery Status";

            setTimeout(() => {
                document.getElementById('delCsta1').style.display = 'none'

            }, 4000);
            isValid = false;
        }



        else if (tablerow.length > 0) {
            let blnnError = false;

            $('#ProductDetailsTbodyP tr').each(function (index, ele) {

                let ID_Product = $(this).find("td:eq(0)").text();
                let checkbox1 = $(this).find("td:eq(1) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                let prodname = $(this).find("td:eq(2)").text();
                let standby = $(this).find("td:eq(4) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                let quantity = $(this).find("td:eq(3) input[type='text']").val().trim();
                let TextRemarks = $(this).find("td:eq(8) input[type='textbox']").val();
                let standbyamount = $(ele).find('.RplcdProductAmt').find('input').val();
                let StandByQuantity = $(ele).find('.RplcdProductqty').find('input').val();
                let FK_StandByProduct = $(ele).find('.RplacedProductId').val();

                if (checkbox1 == 1 && quantity == '0') {
                     NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Quantity' });
                   // $(this).find("td:eq(3) input[type='text']").addClass('is-invalid');
                    //setTimeout(() => {
                    //    $(this).find("td:eq(3) input[type='text']").removeClass('is-invalid');
                    //    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Quantity' });
                    //}, 2000);
                    isValid = false;
                    blnnError = true
                }
                else if (standby == 1 && FK_StandByProduct == "") {
                    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Standby Product' });
                    isValid = false;
                    blnnError = true
                }
                else if (standby == 1 && (StandByQuantity == "" || StandByQuantity == "0")) {
                    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Standby Quantity' });
                    isValid = false;
                    blnnError = true
                }
                //else if (standby == 1 && standbyamount == "") {
                //    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Standby Amount' });
                //    isValid = false;
                //    blnnError = true
                //}

                else if (blnnError) {
                    isValid = false;
                }
                else {
                    isValid = true;
                }


            });

        }

        else {

            isValid = true;

        }
        debugger
        let validpay = true;
        //if ($thisForm.find('[name="StandByTotalAmounts"]').val() > 0) {
        //    if (BillAmountbind(ele, 1)) {
        //        validpay = true;
        //    }
        //    else {
        //        validpay = false;
        //    }
        //}

        if (isValid) {

            if (validpay) {


                var inputData =
                {

                    '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                    'FK_ProductDeliveryAssign': $('#Pick_ID_ProductDeliveryAssign').val(),
                    'FK_Employee': $('#PickEmployee').val(),
                    'PdfDeliveryDate': $thisForm.find('[name = PdAssignedDate]').val().trim(),
                    'PdfDeliveryTime': $thisForm.find('[name=PdAssignedTime]').val().trim(),
                    'Remarks': $thisForm.find('[name=PdVehicleDetails]').val().trim(),
                    'CSAstatus': $thisForm.find('[name="CSAstatus"]').val().trim(),
                    'Pickupstatus': $thisForm.find('[name="Pickupstatus"]').val().trim(),
                    'ID_NextAction': $thisForm.find('[name="ID_NextAction"]').val().trim(),
                    'Productdetails': productReplaces,
                    'StandByTotalAmount': $thisForm.find('[name="StandByTotalAmounts"]').val().trim(),
                    'Paymentdetail': paymentdetails,
                    'TransMode': PickUpTransMode,
                };
                console.log('pdf', inputData);
                
                $.ajax({
                    url: "@Url.Action("Updatedeliveryandpick", "PickUpAndDelivery")",
                    type: "POST",
                    data: inputData,
                    dataType: "json",
                    contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                    success: function (ajaxOutput) {

                        if (ajaxOutput.Process.IsProcess) {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': 'Updated Successfully' });
                            });

                            let onSuccess = $thisForm.attr('perfect-onFormSuccess')
                        }
                        else {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                            });
                        }

                        if (mode = 1) { fn_Delivery_Pickup_tab(this, mode, '#pickupid', pickupTableOptions); }
                        if (mode = 2) { fn_Delivery_Pickup_tab(this, mode, '#deliveryid', deliveryTableOptions); }

                    },

                    complete: function () {
                        $(ele).prop('disabled', false);
                        $('.bd-del-modal-sm').modal('hide');
                        resetdelmodal(ele);
                    },
                });

            }
            else {

                $(ele).prop('disabled', false);
                NotificationMessage({ 'type': 'error', 'heading': 'Warning', 'message': 'In Payment Method Balance Amt. Should be  Zero ' });
            }
        }
        else {
           // NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please all fill mandatory fields' });
        }
    }




    function deldatecheck(ele) {
        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let Deliverydate = $thisForm.find('[name="PdAssignedDate"]').val();
        var delDate = new Date(Deliverydate);
        delDate.setHours(0, 0, 0, 0)
        var today = new Date();
        today.setHours(0, 0, 0, 0)

        let errorClass = '.temptableErrors';
        if (delDate <= today) {
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:none");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
        }
        else if (delDate > today) {
            isValid = false;
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:block");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Delivery Date should be less than or equal to Todays date');
        }
       
         
        $('[name=FK_Employee]').val('0')
        $('[name=Employee]').val('');
        $('[name=EmployeeType]').val('0');
        $('[name=DepartmentID]').val('0');
        $('select[name=EmployeeType]').find(':selected').val('0');
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');
    }

    function pickdatecheck(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let Deliverydate = $thisForm.find('[name="PdAssignedDate"]').val();
        var delDate = new Date(Deliverydate);
        delDate.setHours(0, 0, 0, 0)
        var today = new Date();
        today.setHours(0, 0, 0, 0)

        let errorClass6 = '.temptableErrors';
        if (delDate <= today) {
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass6).attr("style", "display:none");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass6).text('');
        }
        else if (delDate >= today) {
            isValid = false;
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass6).attr("style", "display:block");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass6).text('PickUp Date should be less than or equal to Todays date');
        }

        $('[name=FK_Employee]').val('0')
        $('[name=Employee]').val('');
        $('[name=EmployeeType]').val('0');
        $('[name=DepartmentID]').val('0');
        $('select[name=EmployeeType]').find(':selected').val('0');
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');
    }



    function saledatecheck(ele) {
        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let Deliverydate = $thisForm.find('[name="PdAssignedDate"]').val();
        var delDate = new Date(Deliverydate);
        delDate.setHours(0, 0, 0, 0)
        var today = new Date();
        today.setHours(0, 0, 0, 0)

        let errorClass7 = '.temptableErrors';
        if (delDate <= today) {
           return true;
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass7).attr("style", "display:none");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass7).text('');
        }
        else if (delDate >= today) {
            return false;
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass7).attr("style", "display:block");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass7).text('Delivery Date should be less than or equal to Todays date');
        }

        $('[name=FK_Employee]').val('0')
        $('[name=Employee]').val('');
        $('[name=EmployeeType]').val('0');
        $('[name=DepartmentID]').val('0');
        $('select[name=EmployeeType]').find(':selected').val('0');
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');
    }


    function createtable(ele, tkey, uniq = [], tableOptionsTempOut,mode) {

        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let tableKey = tkey;
        let $tblcontainer = $thisForm.find('[perfect-tempTable="' + tableKey + '"]');

        let insertData = {};
        let tableOptionsTemp = tableOptionsTempOut;
        console.log('tableOptionsTemp', tableOptionsTemp)
        let unique = (uniq) ? uniq : [];

        let isValid = true;
        let errorClass = '.temptableError';

        //make index
        console.log('check 1');

        let lastIndex = ($tblcontainer.attr('perfect-tempTable-lastindex')) ? parseInt($tblcontainer.attr('perfect-tempTable-lastindex')) : 0;
        let thisactionIndex = ($tblcontainer.attr('perfect-tempTable-action')) ? parseInt($tblcontainer.attr('perfect-tempTable-action')) : 0;
        let indexname = tkey + 'index';
        tableOptionsTemp.rowAttribute.push(indexname);
        tableOptionsTemp.hideColumn.push(indexname);
        console.log('tableOptionsTemp.rowAttribute', tableOptionsTemp.rowAttribute)
        let updateCond = '';
        let isNew = true;

        if (thisactionIndex > 0) {
            //means update
            insertData[indexname] = thisactionIndex;
            updateCond = '[' + indexname + '="' + thisactionIndex + '"]';
            isNew = false;
        }
        else {
            //insert
            insertData[indexname] = lastIndex + 1;
            $tblcontainer.attr('perfect-tempTable-lastindex', lastIndex + 1);
            isNew = true;
        }
        //
        if (tableKey == 'Warranty') {

            isValid = validwartdetail(ele, tableKey, errorClass, isValid);
        }
        else if (tableKey == 'Payment') {
            isValid = validpaymntdetail(ele, tableKey, errorClass, isValid);
        }
        else if (tableKey == 'Purchase') {
            isValid = validsaledetail(ele, tableKey, errorClass, isValid);
        }

        if (unique.length > 0) {
            //getting previous data
            let prevData = [];
            $tblcontainer.find('table > tbody').find('tr').each(function () {
                if (isNew) {
                    prevData.push($(this).data('pData'));
                }
                else {
                    if (parseInt($(this).attr(indexname)) != thisactionIndex) {
                        prevData.push($(this).data('pData'));
                    }

                }

            })
            console.log('previous data', prevData);

            unique.forEach(function (key, i) {
                console.log('unid -> key:' + key + "| index :" + i);
                let $thisEle = $thisForm.find('[perfect-tempTable-' + tableKey + '="' + key + '"]');
                // let headerEleName = $thisForm.find('[name="lblProName"]').text();
                let atname = $thisEle.attr('name');
                let cvalue;
                console.log('atname', atname);
                console.log('$thisEle.length', $thisEle.length);
                if ($thisEle.length != 0) {
                    console.log('len', $thisEle)
                    let $errorElement = $thisEle.closest('[perfect-class="formGroup"]').find(errorClass);
                    let errmessage = key + " Already exits"

                    //getting current value in cval
                    if ($thisEle.is('select')) {
                        cvalue = $thisEle.val();

                    }
                    else if ($thisEle.is('input')) {

                        let inputEleType = $thisEle.attr('type').toLocaleLowerCase();

                        if (inputEleType == 'checkbox') { cvalue = $thisEle.is(':checked'); }
                        else if (inputEleType == 'hidden') { cvalue = $thisEle.val(); console.log('cvalue ->', cvalue); }
                        else { cvalue = $thisEle.val(); }
                    }
                    else { cvalue = $thisEle.val(); }



                    //searching in previous data
                    if (prevData.find(a => a[atname] == cvalue)) {
                        // console.log('Search =>' + cvalue + '| attr :' + atname)
                        $errorElement.text(errmessage);
                        isValid = false;
                    }
                }
            });

        }

        console.log('isValid', isValid);

        if (isValid) {

            console.log('check 4.1');
            // this section make table column data
            $thisForm.find('[perfect-tempTable-' + tableKey + ']').each(function () {
                let $this = $(this);
                let headerName = $this.attr('perfect-tempTable-' + tableKey);
                let nameAttr = $this.attr('name');
                //console.log('nameAttr', nameAttr);
                console.log('headerName', headerName);

                if ($this.is('select')) {

                    //tableOptionsTemp.renameHeader[nameAttr + '_d'] = headerName;
                    tableOptionsTemp.hideColumn.push(nameAttr)
                    //displat text of select
                    if ($this.val() != null) {
                        let selectText = ($this.val().length == 0) ? '' : $this.children(":selected").text();
                        insertData[nameAttr + '_d'] = selectText;
                    }
                    else {
                        let selectText = ($this.val() == null) ? '' : $this.children(":selected").text();
                        insertData[nameAttr + '_d'] = selectText;
                    }

                    insertData[nameAttr] = $this.val();


                    $this.val('').selectpicker('refresh');


                }
                else if ($this.is('input')) {

                    insertData[nameAttr] = $this.val();
                    console.log('insertData[nameAttr]', insertData[nameAttr])
                    if (nameAttr == "prodtid") { }
                    else if (nameAttr == "stkid") { }
                    else {
                        $this.val('');
                    }
                }

            });
            console.log('check 4.2', insertData);
            console.log('check 4.2 tableoption', tableOptionsTemp);
            if (isNew) {
                console.log('check 4.2.1');
                //this section nake table.table row
                if ($tblcontainer.find('table').length == 0) {
                    console.log('check 4.2.3');
                    console.log(insertData);
                    console.log(',tableOptionsTemp', tableOptionsTemp)
                    $tblcontainer.append(pft_table_createtable([insertData], tableOptionsTemp));

                    //  $tblcontainer.find('table').dataTable({ paging: false, ordering: false });
                }
                else {
                    console.log('check 4.2.1');
                    let table = $tblcontainer.find('table').DataTable()
                    table.destroy()
                    pft_table_addTableRow($tblcontainer.find('table'), insertData, tableOptionsTemp);


                }

            }
            else {

                let table = $tblcontainer.find('table').DataTable()
                table.destroy()

                pft_table_replaceTableRow($tblcontainer.find('table'), updateCond, insertData, tableOptionsTemp);

            }


            $tblcontainer.attr('perfect-tempTable-action', 0);

            if (tableKey == 'Warranty') {


            }
            else if (tableKey == 'Payment') {
                debugger
                BillAmountbind(ele,mode);
            }
            else if (tableKey == 'Purchase') {
                $thisForm.find('[name=prdbtn]').removeAttr("disabled", "disabled")

                $thisForm.data({ pwarranty: warrantydetails });
                console.log('check 123', $thisForm.data('pwarranty'));
                $thisForm.data({ addpImageselect: $thisForm.data('pImageselect') });
                console.log('addpImageselect', $thisForm.data('addpImageselect'))
                BindBilldetails(ele);

            }

        }


        console.log('check 5');
    }
    function BillAmountbind(ele,mode) {
        debugger
        let $thisForm = $('[perfect-class="form"]');
        if (mode != 1) {
            let netamt = $thisForm.find('[name="StandByTotalAmount"]').val() == "" ? 0 : $thisForm.find('[name="StandByTotalAmount"]').val();
            let billamt = 0;
            let bilamt = 0;

            if ($thisForm.find('[name=BalAmt]').text() == '') {
                bilamt = 0;
            }
            else {
                bilamt = netamt;
            }
            $('#Paymentdethead').find('tbody tr').each(function (index, ele) {
                billamt += parseFloat($(ele).find('.PAmount').text());
            });

            bilamt = parseFloat(bilamt) - parseFloat(billamt);

            $thisForm.find('[name=BalAmt]').text(bilamt.toFixed(2));

            if (bilamt == 0) {
                return true;
            }
            else {
                return false;
            }
        }
        else {
            let netamt = $thisForm.find('[name="StandByTotalAmounts"]').val() == "" ? 0 : $thisForm.find('[name="StandByTotalAmounts"]').val();
            let billamt = 0;
            let bilamt = 0;

            if ($thisForm.find('[name=BalAmts]').text() == '') {
                bilamt = 0;
            }
            else {
                bilamt = netamt;
            }
            $('#Paymentdetheads').find('tbody tr').each(function (index, ele) {
                billamt += parseFloat($(ele).find('.PAmount').text());
            });

            bilamt = parseFloat(bilamt) - parseFloat(billamt);

            $thisForm.find('[name=BalAmts]').text(bilamt.toFixed(2));

            if (bilamt == 0) {
                return true;
            }
            else {
                return false;
            }
        }

    }
    function GetPaymentlists(ele,mode) {
        debugger
        if (mode == 1) {
            $('#formGroupModalpayment2').modal({ backdrop: 'static', keyboard: false })

            $('#formGroupModalpayment2').modal('show');
        }
        else {
            $('#formGroupModalpayment').modal({ backdrop: 'static', keyboard: false })

            $('#formGroupModalpayment').modal('show');
        }

    }


    function Billttlnetchck(ele,mode) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if (mode != 1) {
            let balamt = $thisForm.find('[name=BalAmt]').text();


            if (parseFloat(balamt) == 0) {
                $('#formGroupModalpayment').modal('hide');
                $thisForm.find('[perfect-tempTable="Payment"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('');
            }
            else {

                $thisForm.find('[perfect-tempTable="Payment"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('Balance Amt. should be Zero');

            }
        }
        else {
            let balamt = $thisForm.find('[name=BalAmts]').text();


            if (parseFloat(balamt) == 0) {
                $('#formGroupModalpayment2').modal('hide');
                $thisForm.find('[perfect-tempTable="Payment"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('');
            }
            else {

                $thisForm.find('[perfect-tempTable="Payment"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('Balance Amt. should be Zero');

            }
        }
    }



    var paytableOptionsTempOut = {
        iconButton: {
            buttons: [

                {
                    icon: "fa fa-pencil btnPerfectGridEdit",
                    class: "btnPerfectGridEdit",
                    action: function () {
                        let savedData = $(this).closest('tr').data('pData')

                        let $tablecontainer = $(this).closest('[perfect-tempTable]');
                        let tableKey = $tablecontainer.attr('perfect-tempTable');
                        let $thisForm = $tablecontainer.closest('[perfect-class="form"]');
                        //index attribute name in table row
                        let indexname = tableKey + 'index';

                        //index number in table row
                        let rindex = $(this).closest('tr').attr(indexname);

                        $tablecontainer.attr('perfect-tempTable-action', rindex);

                        console.log('Editclick', savedData);
                        //filling data in available inputs
                        $thisForm.find('[perfect-tempTable-' + tableKey + ']').each(function () {
                            let $thisNode = $(this);
                            let pf_name = $thisNode.attr('name');
                            if ($thisNode.is('select')) {

                                $thisNode.val(savedData[pf_name]).selectpicker('refresh');

                            }
                            else if ($thisNode.is('input')) {
                                let inputType = $thisNode.attr('type').toLocaleLowerCase();
                                if ($thisNode.attr('type').toLocaleLowerCase() == 'checkbox') {

                                    $thisNode.prop('checked', savedData[pf_name]);
                                }

                                else {

                                    $thisNode.val(savedData[pf_name]);
                                }

                            }
                            else {
                                $thisNode.val(savedData[pf_name]);
                            }


                        });



                    }
                },
                {
                    icon: "fa fa-trash btnPerfectGridDelete",
                    class: "btnPerfectGridDelete",
                    action: function () {
                        let $tablecontainer = $(this).closest('[perfect-tempTable]');
                        let $thistbl = $(this).closest('table');
                        let table = $thistbl.DataTable();
                        table.destroy();
                        if ($(this).closest('tbody').find('tr').length > 1) {
                            $(this).closest('tr').remove();
                            pft_table_slreset($thistbl);
                            //$thistbl.dataTable({ paging: true, searchbtn: false });
                        }
                        else {
                            $thistbl.remove();
                        }
                        console.log($(this).closest('[perfect-tempTable]'))
                        BillAmountbind($tablecontainer);
                    }
                },
            ]
        },

        rowAttribute: [],
        onlyShowColumn: ['PAmount', 'Refno', 'PaymentMethod_d'],
        renameHeader: { "PAmount": "Amount1R", "Refno": "Ref No", "PaymentMethod_d": "Method" },
        hideColumn: ['BalAmt'],
        serialNo: true,

    };

    function Pamount(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let amtp = $thisForm.find('[name="PAmount"]').val() == "" ? "0" : $thisForm.find('[name="PAmount"]').val();
        $thisForm.find('[name="PAmount"]').val(parseFloat(amtp).toFixed(2));
        //salroundoff(ele);
    }
    function validpaymntdetail(ele, tableKey, errorClass, isValid) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').val() == 0 || $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').val() == null) {

            isValid = false
            console.log('false', $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').val());
            $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Please Select Payment Method');
        }
        else {
            $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
        }

        if ($thisForm.find('[perfect-tempTable-' + tableKey + '="PAmount"]').val() < 1) {
            console.log('false', $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').val());
            isValid = false;

            $thisForm.find('[perfect-tempTable-' + tableKey + '="PAmount"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Please enter a value greater than or equal to 1');
        }
        else {

            $thisForm.find('[perfect-tempTable-' + tableKey + '="PAmount"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
        }


        return isValid;

    }

    function productclear(ele, tablekey) {

        let $thisform = $(ele).closest('[perfect-class="form"]');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="input"]').val('');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="select"]').val('').selectpicker('refresh');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="input"]').val('');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="date"]').val('');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="hidden"]').val('');

        let $tblcontainer = $thisform.find('[perfect-tempTable="' + tablekey + '"]');
        $tblcontainer.attr('perfect-tempTable-action', 0);
        //$tblcontainer.empty();
    }
    function Checkstandbyamount(ele) {
        let $thisform = $(ele).closest('[perfect-class="form"]');
        let satandbyamount = $thisForm.find('[name="StandByTotalAmount"]').val();

        if (satandbyamount == '' || satandbyamount == 0) {
            productclear(this, 'Payment');
            thisForm.find('[name=BalAmt]').text(0.00);
        }
    }
    function resetmoal(ele) {
        $('#pickmodalid form')[0].reset();
        productclear(this, 'Payment');
        let $thisform = $(ele).closest('[perfect-class="form"]');
        $thisform.find('[name=BalAmt]').text(0.00);
        let $tblcontainer = $('[perfect-tempTable-Payment]');
        $tblcontainer.attr('perfect-tempTable-action', 0);
        $('#Paymentdethead').empty();
        $("#divpickupstatus").hide();
       
    }
    function resetdelmodal(ele) {
        $('#delmodalid form')[0].reset();
        productclear(this, 'Payment');
        let $thisform = $(ele).closest('[perfect-class="form"]');
        $thisform.find('[name=BalAmt]').text(0.00);
        let $tblcontainer = $('[perfect-tempTable-Payment]');
        $tblcontainer.attr('perfect-tempTable-action', 0);
        $('#Paymentdetheads').empty();
       
        $("#divdeliverystatus").hide();

    }

    function resetsalelmodal(ele) {
        $('#salemodalid form')[0].reset();
    }
    function resetmodalstby(ele) {
        $('#delmodalid_stby form')[0].reset();

    }
    function decimalpnt(ele, id, range) {

        let input = $('#' + id);
        ele.value = ele.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');
        let t = ele.value;
        ele.value = (t.indexOf(".") >= 0) ? (t.substr(0, t.indexOf(".")) + t.substr(t.indexOf("."), range)) : t;
        input.on('keydown', function () {
            if (ele.value.includes('.')) {

            }
            var key = event.keyCode || event.charCode;
            if (key == 8 || key == 46) { }
            else {
                if (ele.value.length == 9) {
                    ele.value = ele.value + '.';
                }
            }

        });
    }

    function Hidepaymentmethod(ele) {
        $('#formGroupModalpayment').modal('hide');
    }
    function Hidepaymentmethod2(ele) {
        $('#formGroupModalpayment2').modal('hide');
    }

    function fn_UpdateSalesStatus(ele, id, dat) {

        debugger
        $('#salemodalid').removeClass('modal-lg');
        $('#salemodalid').addClass('modal-xl');


        var InputData = {

            'TransMode': dat.TransMode,
            'FK_ProductDelivery': id,
            'Mode': dat.Mode,
            'Details': 0

        }

        $.ajax({
            url: "@Url.Action("GetTicketDetailsSales", "PickUpAndDelivery")",
            type: "Post",
            data: InputData,
            dataType: "json",
            contentType: "application/x-www-form-urlencoded;charset=utf-8",
            success: function (ajaxOutput) {
                $ProductHtml3 = '';
                let $thisForm = $(ele).closest('[perfect-class="form"]');


                $("#SaleEmployee").val(dat.FK_Employee);
                $('#Sale_ID_ProductDeliveryAssign').val(ajaxOutput.Data[0]['ID_ProductDelivery']);

                if (ajaxOutput.Process.IsProcess) {
                    console.log('ajaxout', ajaxOutput);

                    $('[name=PdAssignedDate]').val(moment().format('YYYY-MM-DD'));
                    $('[name=PdAssignedTime]').val(moment().format('HH:mm'));



                    $('#spanReferenceNo').text(ajaxOutput.Data[0]['ReferenceNo']);

                    var billDate = new Date(ajaxOutput.Data[0]['BillDate']);
                    var formattedDate = billDate.toLocaleDateString('en-US');

                    $('#spanBillDate').text(formattedDate);
                    $('#spansaleCustomer').text(ajaxOutput.Data[0]['Customer']);
                    $('#spanMobileNo').text(ajaxOutput.Data[0]['MobileNo']);


                    $('#spanDelName').text(ajaxOutput.Data[0]['DelName']);
                    $('#spanDelAddress1').text(ajaxOutput.Data[0]['DelAddress1']);
                    $('#spanDelAddress2').text(ajaxOutput.Data[0]['DelAddress2']);
                    $('#spansaleArea').text(ajaxOutput.Data[0]['Area']);
                    $('#spansalePost').text(ajaxOutput.Data[0]['Post']);
                    $('#spansalePinCode').text(ajaxOutput.Data[0]['PinCode']);
                    $('#spansaleDistrict').text(ajaxOutput.Data[0]['District']);
                    $('#spansaleState').text(ajaxOutput.Data[0]['State']);
                    $('#spansaleCountry').text(ajaxOutput.Data[0]['Country']);
                    $('#spanDelMobileNo').text(ajaxOutput.Data[0]['DelMobileNo']);


                    $('#spanDelVehicleNo').text(ajaxOutput.Data[0]['DelVehicleNo']);
                    $('#spanDelDriverName').text(ajaxOutput.Data[0]['DelDriverName']);
                    $('#spanDelDriverMobileNo').text(ajaxOutput.Data[0]['DelDriverMobileNo']);
                    $('#spanPdEWayBillNo').text(ajaxOutput.Data[0]['PdEWayBillNo']);



                    $('#ProductDetailsSalesTbodyP').empty();

                    let proddtls = ajaxOutput.datas.Data;

                    if (ajaxOutput.datas.Data != null) {
                        if (ajaxOutput.datas.Data.length > 0) {
                            let ComplaintList = '';
                            ComplaintList += `<option value="0" FK_Category="0"></option>`
                            if (ajaxOutput.ComplaintList.Data.length > 0) {
                                $.each(ajaxOutput.ComplaintList.Data, function (i, value) {
                                    ComplaintList += `<option value="${value.ID_ComplaintList}" FK_Category="${value.FK_Category}">${value.ComplaintName}</option>`;
                                });
                            }
                            $.each(ajaxOutput.datas.Data, function (i, value) {
                                let rowCount = (i + 1);
                                $ProductHtml3 += "<tr id=" + rowCount + ">";
                                $ProductHtml3 += "<td class='Sale_ID_Product' Style='Display:none'>" + value.ID_ProductDelivery + "</td>";
                                $ProductHtml3 += "<td class='Sale_FK_Product' Style='Display:none'>" + value.FK_Product + "</td>";
                                $ProductHtml3 += "<td class='Sale_Product'>" + value.Product + "</td>";
                                $ProductHtml3 += "<td class='Sale_Quantity'><input id='Actual_Quantity' onkeypress='return isNumberKey(event)' type='text' readonly class='form-control text-right' value='" + value.Quantity + "' min='0'  maxlength='13' /><span id='qnty'></span></td>";
                                $ProductHtml3 += `<td style="text-align: center;"><input class="IsComplaint" type="checkbox" name="IsComplaint" onchange="fn_IsComplaint(this);" FK_Category="${value.FK_Category}"></td>`;
                                $ProductHtml3 += `<td><select class="form-control" name="ComplaintPriorityList" id="ComplaintPriorityList" class='form-control' disabled>
                                                    <option value="0"></option><option value="1">High</option><option value="2">Medium</option><option value="3">Normal</option>
                                                    </select></td>`;
                                $ProductHtml3 += "<td><input id='Complaint_Quantity' onkeypress='return isNumberKey(event)' type='text' class='form-control text-right'  min='0'  maxlength='13' readonly/><span id='qnty'></span></td>";
                                $ProductHtml3 += `<td><select class="form-control" name="ComplaintList" id="ComplaintList" class='form-control' disabled>
                                                       ${ComplaintList}
                                                    </select></td>`;
                                $ProductHtml3 += `<td class='ComplaintDescription'><input type="text" id="ComplaintDescription" name="ComplaintDescription" class="form-control" perfect-class="formGroupControl" perfect-ctype="input" maxlength="250" perfect-css="input" readonly></td>`;
                                $ProductHtml3 += "</tr>";


                            });
                        }
                    }
                    else {
                        $ProductHtml3 += "<tr id='0'><td class='norecord'colspan='4' style'text-align:center'>No Records..</td></tr>";

                    } $('#ProductDetailsSalesTbodyP').append($ProductHtml3);

                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });

                }
            },
            complete: function () {
                $('.bd-sales-modal-sm').modal({ backdrop: 'static', keyboard: false });
                $('.bd-sales-modal-sm').modal('show');
            }
        });
    }
    function fn_IsComplaint(ele) {
        let selectCategory = $(ele).closest('tr').find('.IsComplaint').attr("FK_Category");
        $(ele).closest('tr').find('#ComplaintList').find(`[fk_category!="${selectCategory}"]`).remove();
        if ($(ele).closest('tr').find('.IsComplaint').is(':checked')) {
            $(ele).closest('tr').find('#Complaint_Quantity').prop('readonly', false);
            $(ele).closest('tr').find('#ComplaintPriorityList').prop('disabled', false);
            $(ele).closest('tr').find('#ComplaintList').prop('disabled', false);
            $(ele).closest('tr').find('#ComplaintDescription').prop('readonly', false);
        }
        else {
            $(ele).closest('tr').find('#Complaint_Quantity').prop('readonly', true);
            $(ele).closest('tr').find('#ComplaintPriorityList').prop('disabled', true);
            $(ele).closest('tr').find('#ComplaintList').prop('disabled', true);
            $(ele).closest('tr').find('#ComplaintDescription').prop('readonly', true);
            $(ele).closest('tr').find('#Complaint_Quantity').val("");
            $(ele).closest('tr').find('#ComplaintPriorityList').val([]);
            $(ele).closest('tr').find('#ComplaintList').val([]);
        }

    }
    function fn_SaveSalesdetails(ele) {
        debugger
        var mode;
        var tablerow1 = $("#ProductDetailsSalesTbodyP tr");

        var productSaleReplaces = [];

        if (tablerow1.length > 0) {
            $('#ProductDetailsSalesTbodyP tr').each(function (index, ele) {

                let ID_ProductDelivery = $(this).find(".Sale_ID_Product").text();
                let FK_Product = $(this).find(".Sale_FK_Product").text();
                let Product = $(this).find(".Sale_Product").text();
                let Quantity = $(this).find(".Sale_Quantity input[type='text']").val().trim();

                var arysale = {
                    ID_ProductDelivery, FK_Product, Product, Quantity
                }
                productSaleReplaces.push(arysale);
            });
        }

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($('#Deliverydate').is(":visible") && $('#Deliverytime').is(":visible")) {
            $('[name="PdAssignedDate"]').addClass('perfectValidate_date');
            $('[name="PdAssignedDate"]').addClass('perfectValidate_time');
        }

        let Deliverydates = $thisForm.find('[name="PdAssignedDate"]').val();
        let deltimes = $thisForm.find('[name="PdAssignedTime"]').val();
        let delsta = $thisForm.find('[name="ID_NextAction"]').val();
        let salesta = $thisForm.find('[name="CSAstatus"]').val();

        if (Deliverydates == '') {
            document.getElementById("Selit").style.display = "block";
            document.getElementById('Selit').innerHTML = "Please select date";

            setTimeout(() => {
                document.getElementById('Selit').style.display = 'none'

            }, 4000);
            isValid = false;
        }

        else if (salesta == 0 || salesta == '') {

            document.getElementById("SelCsta").style.display = "block";
            document.getElementById('SelCsta').innerHTML = "Please Select Status";

            setTimeout(() => {
                document.getElementById('SelCsta').style.display = 'none'

            }, 4000);
            isValid = false;
        }

        else {

            isValid = true;

        }



        if (saledatecheck(ele)) {
            let blnCheck = true;
            if (isValid) {
                var ProductDetailsDelivery = $("#ProductDetailsSalesTbodyP tr");
                let DeliveryComplaints = [];
                if ($('.IsComplaint').filter(':checked').length > 0) {

                    if (ProductDetailsDelivery.length > 0) {
                        $('#ProductDetailsSalesTbodyP tr').each(function (index, ele) {
                            if ($(this).closest('tr').find('.IsComplaint').is(':checked') == true) {
                                let aqty = $(this).closest('tr').find('#Actual_Quantity').val();
                                let cqty = $(this).closest('tr').find('#Complaint_Quantity').val() == "" ? 0 : $(this).closest('tr').find('#Complaint_Quantity').val();
                                let Complaint = $(this).closest('tr').find('#ComplaintList').val() == "" ? 0 : $(this).closest('tr').find('#ComplaintList').val();
                                let ComplaintPriority = $(this).closest('tr').find('#ComplaintPriorityList').val() == "" ? 0 : $(this).closest('tr').find('#ComplaintPriorityList').val();

                                if (parseFloat(cqty) > parseFloat(aqty) || parseFloat(cqty) <= 0) {
                                    blnCheck = false
                                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': 'The quantity entered in the complaint exceeds the actual quantity.Please revise and re-enter' });
                                    return false;

                                }
                                else {
                                    if (Complaint == 0 || Complaint == null) {
                                        blnCheck = false
                                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': 'Please select complaint' });
                                        return false;
                                    }
                                    else {
                                        if (ComplaintPriority == 0 || ComplaintPriority == null) {
                                            blnCheck = false
                                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': 'Please select complaint priority' });
                                            return false;
                                        }
                                        else {
                                            let ComplaintInfo = {};
                                            ComplaintInfo['FK_Product'] = $(this).find(".Sale_FK_Product").text();
                                            ComplaintInfo['Qty'] = cqty;
                                            ComplaintInfo['ComplaintID'] = Complaint;
                                            ComplaintInfo['Description'] = $(this).closest('tr').find('#ComplaintDescription').val();
                                            ComplaintInfo['Priority'] = ComplaintPriority;
                                            DeliveryComplaints.push(ComplaintInfo);
                                        }
                                    }
                                }
                            }
                        });
                    }
                }

                if (blnCheck) {
                    var inputData =
                {

                    '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                    'FK_ProductDeliveryAssign': $('#Sale_ID_ProductDeliveryAssign').val(),
                    'FK_Employee': $('#SaleEmployee').val(),
                    'PdfDeliveryDate': $thisForm.find('[name = PdAssignedDate]').val().trim(),
                    'PdfDeliveryTime': $thisForm.find('[name=PdAssignedTime]').val().trim(),
                    'Remarks': $thisForm.find('[name=PdVehicleDetails]').val().trim(),
                    'CSAstatus': $thisForm.find('[name="CSAstatus"]').val().trim(),
                    'productOuts': productSaleReplaces,
                    'TransMode': PickUpTransMode,
                        'DeliveryComplaints': DeliveryComplaints
                };
                $.ajax({
                    url: "@Url.Action("UpdateSalesdelivery", "PickUpAndDelivery")",
                    type: "POST",
                    data: inputData,
                    dataType: "json",
                    contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                    success: function (ajaxOutput) {

                        if (ajaxOutput.Process.IsProcess) {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': 'Updated Successfully' });
                            });

                            let onSuccess = $thisForm.attr('perfect-onFormSuccess')
                        }
                        else {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                            });
                        }

                        if (mode = 1) { fn_Delivery_Pickup_tab(this, mode, '#pickupid', pickupTableOptions); }
                        if (mode = 2) { fn_Delivery_Pickup_tab(this, mode, '#deliveryid', deliveryTableOptions); }

                    },

                    complete: function () {
                        $(ele).prop('disabled', false);
                        $('.bd-sales-modal-sm').modal('hide');
                        resetsalelmodal(ele);
                    },
                });
                }

        }
        else {

            }

        }
        else {
           // NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please all fill mandatory fields' });
                NotificationMessage({ 'type': 'error', 'heading': 'Warning', 'message': 'Delivery date should be less than or equal to Todays date!!!' });
        }
    }

    function fn_UpdatedeliveryStatusStby(ele, id, dat) {
   
        $('#delmodalid_stby').removeClass('modal-lg');
        $('#delmodalid_stby').addClass('modal-xl');


        var InputData = {

            'TransMode': dat.TransMode,
            'FK_ProductDelivery': id,
            'Mode': dat.Mode,
            'Details': 0

        }

        $.ajax({
            url: "@Url.Action("GetTicketDetailsSTby", "PickUpAndDelivery")",
            type: "Post",
            data: InputData,
            dataType: "json",
            contentType: "application/x-www-form-urlencoded;charset=utf-8",
            success: function (ajaxOutput) {
                $ProductHtml12 = '';
                let $thisForm = $(ele).closest('[perfect-class="form"]');
                debugger

                $("#PickEmployee_stby").val(dat.FK_Employee);
                $('#Pick_ID_ProductDeliveryAssign_stby').val(ajaxOutput.Data[0]['ID_ProductDelivery']);

                if (ajaxOutput.Process.IsProcess) {
                    console.log('ajaxOutput', ajaxOutput);
                    $('[name=PdAssignedDate]').val(moment().format('YYYY-MM-DD'));
                    $('[name=PdAssignedTime]').val(moment().format('HH:mm'));
                    let billno = '';
                    $('#spanCSRTickno_stby').text(ajaxOutput.Data[0]['SalBillNo']);
                    $('#spanCSRRegDate_stby').text(ajaxOutput.Data[0]['SalBillDate']);
                    $('#spanCustomer_stby').text(ajaxOutput.Data[0]['Customer']);
                    $('#spanAddress1_stby').text(ajaxOutput.Data[0]['Address1']);
                    $('#spanAddress2_stby').text(ajaxOutput.Data[0]['Address2']);
                    $('#spanDistrict_stby').text(ajaxOutput.Data[0]['District']);
                    $('#spanState_stby').text(ajaxOutput.Data[0]['State']);
                    $('#spanArea_stby').text(ajaxOutput.Data[0]['Area']);
                    //$('#spanCategory_stby').text(ajaxOutput.Data[0]['Category']);
                    //$('#spanProduct_stby').text(ajaxOutput.Data[0]['Product']);



                    $('#ProductDetailsTbodyP_stby').empty();
                    let proddtls = ajaxOutput.Data;

                    if (proddtls != null) {
                        let SalBill_No = '';
                    }


                    console.log('proddtls', proddtls);
                    if (ajaxOutput.datas.Data != null) {
                        debugger
                        if (ajaxOutput.datas.Data.length > 0) {
                            $.each(ajaxOutput.datas.Data, function (i, value) {

                                if (value.Selected == 1) {
                                    checked = "checked";
                                }
                                else {
                                    checked = "";
                                }
                                if (value.ProvideStandBy == 1) {

                                    checked = "checked";
                                }
                                else {
                                    checked = "";
                                }
                                let rowCount = (i + 1);
                                $ProductHtml12 += "<tr id=" + rowCount + ">";
                                $ProductHtml12 += "<td class='jq_Product_ID_Product_stby' Style='Display:none'>" + value.ID_Product + "</td>";
                                $ProductHtml12 += "<td class='jq_ProductDet_td_stby' Style='Display:none' ><input type='checkbox'  value='" + value.Selected + "' " + checked + " /></td>";
                                $ProductHtml12 += "<td >" + value.ProdName + "</td>";
                                $ProductHtml12 += "<td class='jq_ProductDetQty_td_stby'><input onkeypress='return isNumberKey(event)' type='text'  class='form-control text-right' value='" + value.Quantity.toFixed(3) + "' min='0'  maxlength='13' readonly/><span id='qnt_RE'></span></td>";
                                $ProductHtml12 += "<td class='FK_StandByProduct_stby' Style='Display:none' >" + value.FK_StandByProduct + "</td>";
                                $ProductHtml12 += "<td >" + value.Product + "</td>";
                                $ProductHtml12 += "<td class='jq_ProductStbyQty_td_stby'><input onkeypress='return isNumberKey(event)' type='text'  class='form-control text-right' value='" + value.SPQuantity.toFixed(3) + "' min='0'  maxlength='13' readonly /><span id='qnt_ST'></span></td>";
                                $ProductHtml12 += "<td class='FK_StandByStck_stby' Style='Display:none' >" + value.FK_StandByStock + "</td>";
                                $ProductHtml12 += "<td class='jq_ProductDetRemarks_td_stby' ><input type='textbox' class='form-control' " + `maxlength=500` +" value='" + value.Remarks + "' /></td>";
                                //$ProductHtml12 += "<td class='jq_ProductDetRemarks_td_stby'><textarea class='form-control' rows='1' cols='20' maxlength='500'>" + value.Remarks + "</textarea></td>";


                                $ProductHtml12 += "</tr>";


                            });
                        }
                    }
                    else {
                        $ProductHtml12 += "<tr id='0'><td class='norecord'colspan='4' style'text-align:center'>No Records..</td></tr>";

                    } $('#ProductDetailsTbodyP_stby').append($ProductHtml12);

                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });

                }
            },
            complete: function () {
                $('.bd-del_stby-modal-sm').modal({ backdrop: 'static', keyboard: false });
                $('.bd-del_stby-modal-sm').modal('show');

            }

        });


    }



    //SAVE STANDBY DELIVERY

     function fn_Savedeldetails_stby(ele) {



        var mode;
        var tablerow = $("#ProductDetailsTbodyP_stby tr");

         var productReplacesStandby = [];
         let paymentdetails = [];

        if (tablerow.length > 0) {

            debugger
            $('#ProductDetailsTbodyP_stby tr').each(function (index, ele) {

                if ($(this).find('.jq_ProductDet_td_stby input[type="checkbox"]').is(":checked")) {

                    let ID_Product = $(this).find(".jq_Product_ID_Product_stby").text();
                    let checkbox1 = $(this).find(".jq_Product_ID_Product_stby  input[type='checkbox']").is(":checked") == true ? "1" : "0";
                    let Reprodname = $(this).find("td:eq(2)").text();
                    let ReplaceQty = $(this).find(".jq_ProductDetQty_td_stby input").val();
                    let FK_stbyProduct = $(this).find(".FK_StandByProduct_stby").text();
                    let standbyProduct = $(this).find("td:eq(5)").text();
                    let standbyQty = $(this).find(".jq_ProductStbyQty_td_stby input").val();
                    let FK_StandbyStk = $(this).find(".FK_StandByStck_stby").text();
                    let TextRemarks = $(this).find("jq_ProductDetRemarks_td_stby input").val();


                    var ary = {
                        ID_Product: ID_Product, Selected: checkbox1, ProdName: Reprodname, ReQuantity: ReplaceQty, FK_StandByProduct: FK_stbyProduct, Remarks: TextRemarks,
                        StandByProduct: standbyProduct, StandByQuantity: standbyQty, FK_StandbyStock: FK_StandbyStk
                    }

                    productReplacesStandby.push(ary);
                    console.log('arry', ary);
                }



            });



        }



        let $thisForm = $(ele).closest('[perfect-class="form"]');



       // $thisForm.validate({ messages: validationMessage });
        if ($('#Deliverydate_stby').is(":visible") && $('#Deliverytime_stby').is(":visible")) {
            $('[name="PdAssignedDate"]').addClass('perfectValidate_date');
            $('[name="PdAssignedDate"]').addClass('perfectValidate_time');
        }





        let Deliverydates_stby = $thisForm.find('[name="PdAssignedDate"]').val();
        let deltimes_stby = $thisForm.find('[name="PdAssignedTime"]').val();
        let delsta = $thisForm.find('[name="ID_NextAction"]').val();
        let delCsta_Stby = $thisForm.find('[name="CSAstatus"]').val();

         if (Deliverydates_stby == '') {
            document.getElementById("delit_stby").style.display = "block";
             document.getElementById('delit_stby').innerHTML = "Please select date";

            setTimeout(() => {
                document.getElementById('delit_stby').style.display = 'none'

            }, 4000);
            isValid = false;
        }

         else if (delCsta_Stby == 0 || delCsta_Stby == '') {

            document.getElementById("delCsta_stby").style.display = "block";
             document.getElementById('delCsta_stby').innerHTML = "Please Select Status";

            setTimeout(() => {
                document.getElementById('delCsta_stby').style.display = 'none'

            }, 4000);
            isValid = false;
        }

        

        else {

            isValid = true;

        }
        debugger
        let validpay = true;

        if (isValid) {

            if (validpay) {


                var inputData =
                {

                    '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                    'FK_ProductDeliveryAssign': $('#Pick_ID_ProductDeliveryAssign_stby').val(),
                    'FK_Employee': $('#PickEmployee_stby').val(),
                    'PdfDeliveryDate': $thisForm.find('[name = PdAssignedDate]').val().trim(),
                    'PdfDeliveryTime': $thisForm.find('[name=PdAssignedTime]').val().trim(),
                    'Remarks': $thisForm.find('[name=PdVehicleDetails]').val().trim(),
                    'CSAstatus': $thisForm.find('[name="CSAstatus"]').val().trim(),
                    'Productdetails': productReplacesStandby,
                    'TransMode': PickUpTransMode,
                };
                console.log('pdf', inputData);

                $.ajax({
                    url: "@Url.Action("UpdateStandbydelivery", "PickUpAndDelivery")",
                    type: "POST",
                    data: inputData,
                    dataType: "json",
                    contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                    success: function (ajaxOutput) {

                        if (ajaxOutput.Process.IsProcess) {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': 'Updated Successfully' });
                            });

                            let onSuccess = $thisForm.attr('perfect-onFormSuccess')
                        }
                        else {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                            });
                        }

                        if (mode = 1) { fn_Delivery_Pickup_tab(this, mode, '#pickupid', pickupTableOptions); }
                        if (mode = 2) { fn_Delivery_Pickup_tab(this, mode, '#deliveryid', deliveryTableOptions); }

                    },

                    complete: function () {
                        $(ele).prop('disabled', false);
                        $('.bd-del_stby-modal-sm').modal('hide');
                        resetmodalstby(ele);
                    },
                });

            }
            else {

                $(ele).prop('disabled', false);
                NotificationMessage({ 'type': 'error', 'heading': 'Warning', 'message': 'In Payment Method Balance Amt. Should be  Zero ' });
            }
        }
        else {
           // NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please all fill mandatory fields' });
        }
    }
    function Showpickupstatus(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let checkstatus = 0;
        checkstatus = $thisForm.find('[name="CSAstatus"]').val();
        $thisForm.find('[name="Pickupstatus"]').val('');
        if (checkstatus == 2) {

            $("#divpickupstatus").show();
        }
        else {
            $("#divpickupstatus").hide();
        }
        
    }
    function ShowDeliveryStatus(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let checkstatusdeli = 0;
        checkstatusdeli = $thisForm.find('[name="CSAstatus"]').val();
        $thisForm.find('[name="Pickupstatus"]').val('');
        if (checkstatusdeli == 2) {

            $("#divdeliverystatus").show();
        }
        else {
            $("#divdeliverystatus").hide();
        }
    }
</script>