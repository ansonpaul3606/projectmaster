@model PerfectWebERP.Models.CustomerserviceassignModel.CustomerserviceassignView




<style>
    form .error {
        color: #FF6746;
        font-size: 81%;
        margin-top: 0.25rem;
    }

    .btn-export {
        /*//height:10px;*/
        background-color: #2aa2ad;
        color: white;
    }

    .div-export {
        float: right;
        margin-left: 3px;
        /*background-color:red;*/
        height: 41px;
        /*// width:90px;*/
    }

        .div-export:hover {
            color: white !important;
        }

    .btn-export :hover {
        color: white !important;
    }
</style>


<div class="card ">

    <div class="card-header">
        <div class="col-xl-4">
            <h4 class="card-title col-12">@ViewBag.PageTitle</h4>
        </div>
        @*<div class="col-lg-8 d-md-flex">
                <input class="form-control input-rounded mr-auto mb-md-0 mb-3" name="Content" type="text" placeholder="Search by Ticket, product or customer..."hidden>
            </div>*@

        
        <div class="col-xl-8 text-right">
            <button id="refreshServiceAssign" type="button" class="btn  btn-primary btn-sm" name="Search" perfect-css="button" onclick="fn_ServiceAssign_LoadAssignForm()" title="To Refresh"><i class="fa fa-refresh"></i></button>
            <button id="addcompany-jq-addnewuser" type="button" class="btn  btn-primary btn-sm" name="Search" perfect-css="button" onclick="fn_showFilter()" title="To Filter"><i class="fa fa-filter"></i></button>
            <div class="dropdown div-export" id="exppdf" style="display:block   ">

                <button class="btn  dropdown-toggle btn-sm btn-export" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span><i class="fa fa-file-o" style="font-size:16px"></i> </span>

                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" href="#" onclick="generatePdf(this)">PDF</a>
                    <a class="dropdown-item" href="#" onclick="onExell()">EXCEL </a>

                </div>
            </div>

        </div>
        @*<div class="col-lg-8 d-md-flex">
                <input class="form-control input-rounded mr-auto mb-md-0 mb-3" name="Content" type="text" placeholder="Search by Ticket, product or customer..."hidden>
            </div>*@
    </div>

    <div class="card-body jq_leadgeneration_body ">
        <form id="" class="form-valide" perfect-class="formassign" action="#" method="post" perfect-onFormSuccess="">
            <div class="leadformSesction">
                @Html.AntiForgeryToken()

                <div class="row">

                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Branch</label>*@
                            <select class="form-control " name="Branch" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="getfunction()">
                                <option value="0">Select Terminal</option>
                                @if (!(Model.BranchList is null))
                                {
                                    foreach (var branch in Model.BranchList)
                                    {
                                        <option value="@branch.ID_Branch">@branch.BranchName</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Product</label>*@
                            <div class="input-group">
                                <input type="text" class="form-control" name="ProductName" perfect-class="formGroupControl" placeholder=" Select Product" perfect-ctype="input" perfect-css="input" disabled />
                                <input type="hidden" name="ProductID" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                <div class="input-group-append">
                                    <button id="addproduct-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,18,'Product List',[])" form="formassign" Criterea1="0" Criterea2="0" BindName="ProductName" BindVal="ProductID" Function="1"></button>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Complaint Type</label>*@
                            <select class="form-control " name="ComplaintType" perfect-class="formGroupControl" placeholder=" Select Complaint Type" perfect-ctype="select" perfect-css="select" onchange="getfunction()">
                                <option value="0">Select Complaint Type</option>
                                @if (!(Model.ComplaintList is null))
                                {
                                    foreach (var complaint in Model.ComplaintList)
                                    {
                                        <option value="@complaint.ID_ComplaintList">@complaint.ComplaintName</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Status</label>*@
                            <select class="form-control" name="Complaintstatus" onchange="getfunction()">
                                <option value="-1">Select Status</option>
                                <option value="-1">All</option>
                                <option value="0">New</option>
                                <option value="1">Pending</option>
                                <option value="3">On Hold</option>
                                <option value="5">Pick-up</option>
                                <option value="6">Standby</option>
                                <option value="7">Delivery with standby</option>

                            </select>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>From Date</label>
                            <input type="hidden" name="LeadGenerateID" />
                            <input type="date" class="form-control " name="FromDate" perfect-class="formGroupControl" title="From Date" perfect-ctype="date" perfect-css="date" onchange="getfunction()"/>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>To Date</label>
                            <input type="hidden" name="LeadGenerateID" />
                            <input type="date" class="form-control " name="ToDate" perfect-class="formGroupControl" title="To Date" perfect-ctype="date" perfect-css="date"  onchange="getfunction()"/>
                        </div>
                    </div>
                    <div class="col-sm-3 mt-4 pt-1">
                        <div class="form-group">
                            @*<label>Area</label>*@
                            <div class="input-group">
                                <input type="text" class="form-control" name="AreaName" perfect-class="formGroupControl" placeholder=" Select Area" perfect-ctype="input" perfect-css="input" perfect-tempTable-cstatus="Area" disabled />
                                <input type="hidden" name="AreaID" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" perfect-tempTable-cstatus="Area ID" />
                                <div class="input-group-append">
                                    <button id="addproduct-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,14,'Area List',[])" form="formassign" Criterea1="0" Criterea2="0" BindName="AreaName" BindVal="AreaID" Function="1"></button>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3 mt-4 pt-1">
                        <div class="form-group">
                            @*<label>Post</label>*@
                            <div class="input-group">
                                <input type="text" class="form-control" name="PostName" perfect-class="formGroupControl" placeholder=" Select Post" perfect-ctype="input" perfect-css="input" perfect-tempTable-cstatus="Post" disabled />
                                <input type="hidden" name="PostID" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" perfect-tempTable-cstatus="Post ID" />
                                <div class="input-group-append">
                                    <button id="addproduct-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,13,'Post List',[])" form="formassign" Criterea1="0" Criterea2="0" BindName="PostName" BindVal="PostID" Function="1"></button>
                                </div>

                            </div>
                        </div>
                    </div>


                    @*<div class="col-sm-3">
                            <div class="form-group">
                                <label>Complaint status</label>
                                <select class="form-control" name="Complaintstatus">
                                    <option value="0">Please select</option>
                                    <option value="5">All</option>
                                    <option value="1">New</option>
                                    <option value="2">Assigned</option>
                                    <option value="3">On Hold</option>
                                    <option value="4">Completed</option>
                                </select>
                            </div>
                        </div>*@


                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Customer</label>*@
                            <input type="text" name="Customer" class="form-control" placeholder="Enter Customer" onchange="getfunction()">
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Customer Mobile</label>*@
                            <input type="text" name="Mobile" class="form-control" placeholder="Customer Mobile" onkeypress="return isNumberKey(event)" onchange="getfunction()">
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Ticket Number</label>*@
                            <input type="text" name="Ticket" class="form-control" placeholder="Ticket Number" onchange="getfunction()">
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Ticket Number</label>*@
                            <input type="number" name="DueDays" class="form-control" placeholder="Due Days" onchange="getfunction()">
                        </div>
                    </div>

                    <div class="col-sm-3">
                        @*<label>Employee</label>*@
                        <div class="input-group">
                            <input type="text" class="form-control " name="EmployeeSearch" perfect-class="formGroupControl" placeholder="Select Employee" perfect-ctype="input" perfect-css="input" disabled />
                            <input type="hidden" name="FK_EmployeeSearch" class="form-control " perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                            <div class="input-group-append">
                                <button id="addarea-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchValAssign(this,6,'Employee List',[],['DepartmentID','Department'])" form="formassign" Criterea1="0" BindName="EmployeeSearch" BindVal="FK_EmployeeSearch" Function="1"></button>
                            </div>
                            @*<div id="ProductNameExists-error" class="Custominvalid animated fadeInUp producterror" style="display:none;">Employee already exists.</div>*@
                        </div>
                        @*<div class="text-danger temptableError1" style="font-size:80%;"></div>*@
                    </div>

                    <div class="col-sm-3">
                        <div class="form-group">
                            @*<label>Sort Order</label>*@
                            <select class="form-control" name="Sortorder" onchange="getfunction()">
                                <option value="0">Select Sort Order</option>
                                <option value="1">Terminal</option>
                                <option value="2">Ticket Number</option>
                                <option value="3">Priority</option>
                                <option value="4">Status</option>
								<option value="5">Ticket Date</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-1">
                        <input type="hidden" name="filt" />
                        <input type="hidden" name="md" />
                        <button id="addcompany-jq-addnewuser" type="button" class="btn btn-primary btn-sm " href="#profile" name="Search" perfect-css="button" onclick="fn_LeadSearchbyfilter (this)"><i class="fa fa-refresh fa-spin loaderClass "></i>Search</button>
                    </div>
                    <div class="col-sm-1">

                        <button id="addcompany-jq-filterclear" type="button" class="btn btn-light btn-sm " name="Clearfilter" perfect-css="button" onclick="FilterReset (this)"><i class="fa fa-refresh fa-spin loaderClass "></i>Clear</button>
                    </div>
                    @*<div class="col-sm-3  pt-3">
                            <button id="addcompany-jq-addnewuser" type="button" class="btn btn-primary btn-sm " style="margin-top:10px;" href="#home" name="Search" perfect-css="button" onclick="fn_LeadManagement_search (this)"><i class="fa fa-refresh fa-spin loaderClass "></i>Search</button>
                        </div>*@

                </div>
            </div>


            <br />
            @*<div class="row">
                    <div class="row col-xl-12 pl-4 pr-1" id="test1"></div>



                </div>*@
            @*///////////////////////TAB TABLES//////////////////////////////*@
            <div class="row">
                <div class="col-xl-12">
                    <div class="default-tab">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="New" data-toggle="tab" href="#home" onclick="fn_LeadManagement_search(this, 2, '#test1', tableOptions)"><i class="las la-tasks  mr-2"></i> New&nbsp;&nbsp;<span><label id="todobadge" class="badge badge-circle badge-info">0</label></span> </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="Onhold" style="display:none" data-toggle="tab" href="#profile" onclick="fn_LeadManagement_search(this, 3, '#test2', tableOptions2)"><i class="las la-check mr-2"></i> Completed&nbsp;&nbsp;<label id="overduebadge" class="badge badge-circle badge-success">0</label></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pending" style="display:none" data-toggle="tab" href="#Pendingid" onclick="fn_LeadManagement_search(this, 4, '#test3', tableOptions2)"><i class="las la-exclamation mr-2"></i> Pending&nbsp;&nbsp;<label id="pendingbadge" class="badge badge-circle badge-danger">0</label></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pickup" style="display:none" data-toggle="tab" href="#Pickupid" onclick="fn_LeadManagement_search(this, 5, '#test4', tableOptions2)"><i class="las la-truck-loading mr-2"></i> Pick Up Request&nbsp;&nbsp;<label id="pickupbadge" class="badge badge-circle badge-primary">0</label></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="replacement" style="display:none" data-toggle="tab" href="#Replaceid" onclick="fn_LeadManagement_search(this, 6, '#test5', tableOptions2)"><i class="las la-exchange-alt mr-2"></i> Replacement Request&nbsp;&nbsp;<label id="replacementbadge" class="badge badge-circle badge-yellow">0</label></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="deliveryrequest" style="display:none" data-toggle="tab" href="#Deliveryid" onclick="fn_LeadManagement_search(this, 7, '#test6', tableOptions2)"><i class="las la-truck mr-2"></i> Delivery Request&nbsp;&nbsp;<label id="deliverybadge" class="badge badge-circle badge-purple">0</label></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="factory" style="display:none" data-toggle="tab" href="#Factoryid" onclick="fn_LeadManagement_search(this, 8, '#test7', tableOptions2)"><i class="las la-wrench mr-2"></i> Factory Service&nbsp;&nbsp;<label id="factorybadge" class="badge badge-circle badge-dark">0</label></a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane fade active show" id="home" role="tabpanel">
                                <br />
                                <div class="row">

                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv" id="test1"></div>

                                </div>
                            </div>
                            <div class="tab-pane fade" id="profile">
                                <br />
                                <div class="row">

                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv" id="test2"></div>

                                </div>
                            </div>
                            <div class="tab-pane fade" id="Pendingid">
                                <br />
                                <div class="row">

                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv" id="test3"></div>

                                </div>
                            </div>
                            <div class="tab-pane fade" id="Pickupid">
                                <br />
                                <div class="row">

                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv" id="test4"></div>

                                </div>
                            </div>

                            <div class="tab-pane fade" id="Replaceid">
                                <br />
                                <div class="row">

                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv" id="test5"></div>

                                </div>
                            </div>
                            <div class="tab-pane fade" id="Deliveryid">
                                <br />
                                <div class="row">

                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv" id="test6"></div>

                                </div>
                            </div>
                            <div class="tab-pane fade" id="Factoryid">
                                <br />
                                <div class="row">

                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv" id="test7"></div>

                                </div>
                            </div>
                            <div class="tab-pane fade" id="message">
                                <br />
                                <div class="row">

                                    <div class="table-responsive col-md-12 SearchLoadDiv" name="SearchLoadDiv"></div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @*///////////////////////////////////////////////////////*@


            <div style="display:none;" id="exportpdf"></div>
        </form>

        <input type="hidden" id="ID_LeadGenerateActionhdn" />

    </div>

    @*/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*@
    <div class="modal fade bd-service-modal-sm" tabindex="-1" role="dialog" style="display: none; " aria-hidden="true">
        <div class="modal-dialog modal-xl" id="modalid">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title Serviceassign">Service Assign</h5>
                    <h5 class="modal-title Editassign" style="display:none">Edit Assign</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>×</span>
                    </button>
                </div>
                <form class="form-valide" perfect-class="form" id="formid" action="#" method="post" perfect-onFormSuccess="">
                    <div class="modal fade" perfect-class="formGroupModalCustomerBalance" id="formGroupModalCustomerBalance">
                        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                            <div class="modal-content  rounded-lg">
                                <div class="modal-header border-0">
                                    <h5 class="modal-title">Customer Balance</h5>
                                    <button type="button" class="close" @*data-dismiss="modal"*@ onclick="fn_closeCustomerBalance()">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;padding: 1rem;">
                                    <div class="default-tab">

                                        <ul class="nav nav-tabs" role="tablist">
                                            <li class="nav-item">
                                                <a class="nav-link active" data-toggle="tab" id="Customerdueid" href="#CustomerDue"><i class="fa fa-exclamation mr-2"></i>Customer Due</a>
                                            </li>
                                        </ul>

                                        <div class="tab-content">
                                            <div id="CustomDue" class="tab-pane active">
                                                <div class="row" style="margin-top:1.5rem;">
                                                    <div class="col-sm-12">
                                                        <div id="Accountbalancedetails" style="display:none"></div>
                                                        <div class="row col-md-12" id="Accountbalancedetailss"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-12 mt-3" perfect-class="formGroupModalCustomerBalancebody">


                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0"></div>
                    </div>
                    <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;">

                        <div class="form-group row" id="TopDetails">

                        </div>
                        <div class="form-group row" id="TopDetails2">
                            @*<div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h4 class="card-title">Product Details</h4>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover table-responsive-sm" id="Product">
                                                    <thead>
                                                        <tr>
                                                            <th>SI.No.</th>
                                                            <th>Product</th>
                                                            <th>Complaint</th>
                                                            <th>Description</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="ProductTbody">
                                                        <tr id="0">
                                                            <td colspan="4" style="text-align:center;">No Records...</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>*@

                        </div>
                        <div></div>
                        <div class="form-group row" id="TopDetail">

                        </div>
                        <div class="form-group row" id="TopDetail2">

                        </div>

                        @*<div class="col">
                                <div class="form-group row" id="TopDetail2">

                                </div>
                            </div>*@
                        <input type="hidden" name="ID_Customerserviceassign" />
                        <input type="hidden" name="FK_Customerserviceregister" />
                        <input type="hidden" name="ID_Customer" />

                        <div class="form-group row">

                            <div class="col-md-3" perfect-class="formGroup" id="Visitdate">
                                <label>Visit Date</label>&nbsp;<span class="text-danger">*</span>
                                <input type="date" class="form-control perfectValidate_date" name="CSAVisitdate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="2000-01-01" max="2050-01-01" onchange="datecheck(this)">
                                @*<div class="invalid-feedback animated fadeInUp limit-check" style="display: none;"></div>*@
                                <div class="invalid-feedback animated fadeInUp temptableErrors"></div>
                            </div>
                            <div class="col-md-3" id="Visittime">
                                <label>Visit Time</label>&nbsp;@*<span class="text-danger">*</span>*@
                                <input type="time" class="form-control" placeholder="" name="CSAVisittime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                            </div>
                            <div class="col-md-3" id="Priority">
                                <label>Priority</label>&nbsp;<span class="text-danger">*</span>
                                <select class="form-control perfectValidate_string" name="CSAPriority">
                                    <option value="">Please select</option>
                                    <option value="1">High</option>
                                    <option value="2">Medium</option>
                                    <option value="3">Normal</option>

                                </select>
                            </div>
                            <div class="col-md-3" id="Remarks">
                                <label>Remarks</label>&nbsp;
                                <input type="text" name="CSARemarks" class="form-control" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                <input type="hidden" name="ID_CustomerServiceRegisterProductDetails" class="form-control" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                @*<textarea rows="1" name="CSARemarks" class="form-control" maxlength="500"></textarea>*@
                            </div>

                            <div class="col-md-3" perfect-class="formGroup" id="status">
                                <label>
                                    <span perfect-class="formGroupLabel">Status</span>
                                </label>&nbsp;
                                <select class="form-control" id="nextaction" name="NextAction" @*onchange="fn_bindate(this)"*@ perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" onchange="nxtonchng(this)">
                                    <option value="">Select Status</option>
                                    @if (!(Model.StatusList is null))
                                    {
                                        foreach (var Mode in Model.StatusList)
                                        {
                                            <option value="@Mode.ID_NextAction">@Mode.NxtActnName</option>
                                        }
                                    }
                                </select>
                            </div>

                            <div class="col-sm-3" id="Attendedby">
                                <label>
                                    <span perfect-class="formGroupLabel">Attended By</span>
                                </label>&nbsp;
                                <div class="input-group">
                                    <input type="text" class="form-control perfectValidate_string" name="AttendedBy" perfect-class="formGroupControl" placeholder="Select Employee" perfect-ctype="input" perfect-css="input" disabled />
                                    <input type="hidden" class="form-control " name="FK_Attendedby" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                    <div class="input-group-append">
                                        <button id="addarea-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,6,'Employee List',['DepartmentID','Department']))" Criterea1="0" BindName="AttendedBy" BindVal="FK_Attendedby"></button>
                                    </div>
                                    <div class="text-danger empError" style="font-size:70%;"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-row Employeeadd">
                            <div class="form-group col-md-3">
                                <label>Department</label>
                                <select class="form-control" id="dept" name="DepartmentID" data-id="subtabledepartment-error" perfect-selectButtonAction="testing" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" perfect-tempTable-ComplaintDetails="DepartmentName" onchange="ClearEmployeeonchange(this)">
                                    <option value="0">Please Select  </option>
                                    @if (!(Model.DepartmentList is null))
                                    {
                                        foreach (var DepartmentModule in Model.DepartmentList)
                                        {
                                            <option value="@DepartmentModule.DepartmentID">@DepartmentModule.DepartmentName </option>
                                        }
                                    }
                                </select>
                                <div class="text-danger temptableError mt-0"></div>
                                @*<div id="subtabledepartment-error" class="invalid-feedback animated fadeInUp  temptableError" style="display: none;">Select Department.</div>*@
                            </div>

                            <div class="col-sm-3">

                                <label>Employee</label>
                                <div class="input-group">
                                    <input type="text" class="form-control " name="Employee" perfect-class="formGroupControl" data-id="subtableemployee-error" perfect-ctype="input" perfect-css="input" perfect-tempTable-ComplaintDetails="Employee" disabled />
                                    <input type="hidden" name="FK_Employee" class="form-control " perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" perfect-tempTable-ComplaintDetails="FK_Employee" />
                                    @*<input type="text" class="form-control" name="ProductName" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" perfect-tempTable-cstatus="Product" disabled />

                                        <input type="hidden" name="ProductID" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" perfect-tempTable-cstatus="Product ID" />*@
                                    <div class="input-group-append">
                                        <button id="addarea-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,6,'Employee List',['DepartmentID','Department'])" Criterea1="DepartmentID" BindName="Employee" BindVal="FK_Employee" Function="1"></button>
                                    </div>
                                    @*<div id="subtableemployee-error" class="invalid-feedback animated fadeInUp  temptableError" style="display: none;">Select Employee</div>*@




                                </div>
                                <div class="text-danger temptableError1" style="font-size:80%;"></div>
                                <div id="ProductNameExists-error" class="Custominvalid animated fadeInUp producterror" style="display:none;">Employee already exists.</div>
                            </div>

                            <div class="form-group col-md-3">
                                <label>Role</label>
                                <select class="form-control " name="EmployeeType" perfect-class="formGroupControl" data-id="subtablerole-error" perfect-ctype="select" perfect-css="select" perfect-tempTable-ComplaintDetails="Role">

                                    <option value="0">Please select</option>
                                    @if (!(Model.ActionStatusList is null))
                                    {
                                        foreach (var ActionStatus in Model.ActionStatusList)
                                        {
                                            <option value="@ActionStatus.ID_Mode">@ActionStatus.ModeName</option>
                                        }
                                    }clear

                                </select>
                                <div class="text-danger temptableError2" style="font-size:70%;"></div>

                            </div>

                            <div class="col-sm-2 mt-6">
                                <div class="row">
                                    <div class="col-3">
                                        <button type="button" id="TbtnSave" class="btn btn-primary1" perfect-css="button" onclick="AddProductComplaintdetails(this, 'ComplaintDetails',1)" name="reset" align="center" title="Save"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                        <button type="button" id="TbtnUpdate" class="btn btn-primary1" perfect-css="button" onclick="AddProductComplaintdetails(this, 'ComplaintDetails',2)" name="reset" align="center" title="Update"><i class="fa fa-plus" aria-hidden="true"></i></button>

                                    </div>
                                    <div class="col-3">
                                        <button type="button" id="clear" class="btn btn-light1" perfect-css="button" onclick="ClearProductComplaintdetails(this);"><i class="fa fa-refresh" aria-hidden="true"></i></button>
                                    </div>

                                </div>
                            </div>
                            <!--Confirm Modal-->
                            <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Confirmation</h5>
                                            <button type="button" class="close" data-dismiss="modal">
                                                <span>×</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div id="ConfirmBody">

                                            </div>

                                        </div>
                                        <div class="modal-footer">
                                            @*<button type="button" onclick="fn_SaveCustomerServiceRegister(this)" class="btn btn-primary">Confirm</button>*@
                                            <button type="button" class="btn btn-danger light" data-dismiss="modal">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        @*<div class="col-sm-2 pb-2">
                                <div class="row">
                                    <div class="col-6">
                                        <button type="button" id="TbtnSave" class="btn btn-primary" perfect-css="button" onclick="AddProductComplaintdetails(this,'ComplaintDetails')" name="reset" align="center">ADD</button>
                                        <button type="button" id="TbtnUpdate" class="btn btn-primary" perfect-css="button" onclick="AddProductComplaintdetails(this,'ComplaintDetails')" name="reset" align="center">UPDATE</button>

                                    </div>
                                    <div class="col-6">
                                        <button type="button" id="clear" class="btn btn-primary" perfect-css="button" onclick="ClearProductComplaintdetails(this);">Clear</button>
                                    </div>

                                </div>
                            </div>*@
                        @*<div class="col-xl-12">
                                <button type="button" id="TbtnUpdate" class="btn btn-primary" perfect-css="button" onclick="SubProductDetailsTable_create(this,'cstatus',['Name'])" name="reset" align="center">UPDATE</button>
                            </div>*@





                        <div class="row">
                            <div class="col-xl-8">
                                <div class="table-responsive " perfect-tempTable="ComplaintDetails" id="Emptable" style="display:none">
                                    <table class="table table-responsive-md" id="EMPL">
                                        <thead class="btn-primary" id="EMPLS">
                                            <tr>
                                                <th scope="col" style="text-align:center">SL.NO</th>
                                                @*<th scope="col"="display:none;"><strong>DepartmentID</strong></th>
                                                    <th><strong>Department</strong></th>*@
                                                <th style="display:none; text-align:center"><strong>FK_Employee</strong></th>
                                                <th scope="col" style="text-align:center">Employee</th>
                                                @*<th><strong>Role</strong></th>
                                                    <th style="display:none;"><strong>EmployeeType</strong></th>*@
                                                <th scope="col" style="text-align:center">Role</th>
                                                <th scope="col" style="text-align:center"></th>
                                                <th scope="col" style="display:none;"><strong>DepartmentID</strong></th>
                                                <th style="display:none;"><strong>CSAVisitdate</strong></th>

                                                <th scope="col" style="text-align:center"></th>


                                            </tr>
                                        </thead>
                                        <tbody id="ComplaintDetailstbody">
                                            <tr id="0">
                                                <td style="text-align:center;" colspan="4">No Records..</td>
                                            </tr>

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>


                        <div class="col-xl-6 mt-2">
                            <div class="table-responsive" perfect-tempTable="cstatus" perfect-tempTable-lastindex="0" perfect-tempTable-action="0">

                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btnUpdate" onclick="fn_UpdateCustomerServiceAssignnew(this);" class="btn btn-primary">Update</button>
                        <button type="button" id="btnSave" onclick="fn_SaveCustomerServiceAssign(this);" class="btn btn-primary">Save</button>
                        <button type="button" id="btnUpdatepriority" onclick="fn_Priority_UpdateCustomerServiceAssign(this);" class="btn btn-primary">Update</button>
                        <button type="button" id="btnUpdateprioritynew" onclick="fn_Priority_UpdateCustomerServiceAssign(this);" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-light1" data-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade bd-delivery-modal-sm" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-xl" id="delmodalid">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title Deliveryassign">Delivery Assign</h5>
                    <h5 class="modal-title Editassigndel" style="display:none">Edit Assign</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>×</span>
                    </button>
                </div>
                <form class="form-valide" perfect-class="form" id="delformid" action="#" method="post" perfect-onFormSuccess="">
                    <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh -200px); overflow-y: auto;">

                        <div class="form-group row" id="TopInfoDetails"></div>
                        <div class="form-group row" id="TopInfoDetails2"></div>

                        <input type="hidden" name="ID_Customerserviceassign" />
                        <input type="hidden" name="FK_Customerserviceregister" />
                        <div class='profile-personal-info'>
                            <h4 class='text-primary mb-4'>Delivery Information</h4>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-3" perfect-class="formGroup" id="Deliverydate">
                                <label>Delivery Date</label>&nbsp;<span class="text-danger">*</span>
                                <input type="date" class="form-control" name="PdAssignedDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="2000-01-01" max="2050-01-01" onchange="deldatecheck(this)">
                                <span id='dit' class='error'></span>
                                <div class="invalid-feedback animated fadeInUp temptableErrors"></div>
                            </div>
                            <div class="col-md-3" id="Deliverytime">
                                <label>Delivery Time</label>
                                <input type="time" class="form-control" placeholder="" name="PdAssignedTime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                <span id='detime' class='error'></span>
                                <input type="hidden" name="ID_CustomerServiceRegisterProductDetailsDel" class="form-control" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                            </div>

                            <div class="col-md-3" id="Priority">
                                <label>Priority</label>&nbsp;<span class="text-danger">*</span>
                                <select class="form-control perfectValidate_string" perfectValidate_string name="CSAPriority">
                                    <option value="">Please select</option>
                                    <option value="1">High</option>
                                    <option value="2">Medium</option>
                                    <option value="3">Normal</option>

                                </select>
                                <span id='deprio' class='error'></span>
                            </div>
                            <div class="col-md-3" id="Remarks">
                                <label>Vehicle Details</label>&nbsp;
                                <input type="text" name="PdVehicleDetails" class="form-control" maxlength='250' perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                            </div>
                        </div>

                        <div class="form-group row">

                            <div class="col-sm-3">

                                <label>Employee</label>&nbsp;<span class="text-danger">*</span>
                                <div class="input-group">
                                    <input type="text" class="form-control " name="Employee" perfect-class="formGroupControl" data-id="subtableemployee-error" perfect-ctype="input" perfect-css="input" perfect-tempTable-ComplaintDetails="Employee" disabled />
                                    <input type="hidden" name="FK_Employee" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" perfect-tempTable-ComplaintDetails="FK_Employee" />

                                    <div class="input-group-append">
                                        <button id="addarea-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,6,'Employee List',[])" BindName="Employee" BindVal="FK_Employee"></button>
                                    </div>
                                    <div class="invalid-feedback animated fadeInUp temptableErrorss"></div>

                                </div><span id='empdel' class='error'></span>

                            </div>

                        </div>


                    </div>

                    <div class="modal-footer">
                        <button type="button" id="btnUpdatedel" onclick="fn_UpdateDeliveryAssign(this);" class="btn btn-primary">Assign Delivery</button>
                        <button type="button" class="btn btn-light1" data-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>





    <div class="modal fade bd-pickup-modal-sm" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-xl" id="pickmodalid">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title Deliveryassign">PickUp Assign</h5>
                    <h5 class="modal-title Editassigndel" style="display:none">Edit Assign</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>×</span>
                    </button>
                </div>
                <form class="form-valide" perfect-class="form" id="delformid" action="#" method="post" perfect-onFormSuccess="">
                    <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh -200px); overflow-y: auto;">

                        <div class="form-group row" id="TopInfoDetailsPick"></div>
                        <div class="form-group row" id="TopInfoDetailsPick2"></div>

                        <input type="hidden" name="ID_Customerserviceassign" />
                        <input type="hidden" name="FK_Customerserviceregister" />
                        <div class='profile-personal-info'>
                            <h4 class='text-primary mb-4'>PickUp Information</h4>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-3" perfect-class="formGroup" id="PickUpdate">
                                <label>PickUp Date</label>&nbsp;<span class="text-danger">*</span>
                                <input type="date" class="form-control" name="PdAssignedDate" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="2000-01-01" max="2050-01-01" onchange="pickdatecheck(this)">
                                <span id='picd' class='error'></span>
                                <div class="invalid-feedback animated fadeInUp temptableErrors"></div>

                            </div>
                            <div class="col-md-3" id="PickUptime">
                                <label>PickUp Time</label>&nbsp;@*<span class="text-danger">*</span>*@
                                <input type="time" class="form-control" placeholder="" name="PdAssignedTime" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                <span id='pict' class='error'></span>
                                <input type="hidden" name="ID_CustomerServiceRegisterProductDetailsPick" class="form-control" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                            </div>

                            <div class="col-md-3" id="Priority">
                                <label>Priority</label>&nbsp;<span class="text-danger">*</span>
                                <select class="form-control perfectValidate_string" name="CSAPriority">
                                    <option value="">Please select</option>
                                    <option value="1">High</option>
                                    <option value="2">Medium</option>
                                    <option value="3">Normal</option>

                                </select>
                                <span id='pprio' class='error'></span>
                            </div>
                            <div class="col-md-3" id="Remarks">
                                <label>Vehicle Details</label>&nbsp;
                                <input type="text" name="PdVehicleDetails" class="form-control" maxlength='250' perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                            </div>
                        </div>

                        <div class="form-group row">

                            <div class="col-sm-3">

                                <label>Employee</label>&nbsp;<span class="text-danger">*</span>
                                <div class="input-group">
                                    <input type="text" class="form-control " name="Employee" perfect-class="formGroupControl" data-id="subtableemployee-error" perfect-ctype="input" perfect-css="input" perfect-tempTable-ComplaintDetails="Employee" disabled />
                                    <input type="hidden" name="FK_Employee" class="form-control" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" perfect-tempTable-ComplaintDetails="FK_Employee" />

                                    <div class="input-group-append">
                                        <button id="addarea-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,6,'Employee List',[])" BindName="Employee" BindVal="FK_Employee"></button>
                                    </div>
                                    <div class="invalid-feedback animated fadeInUp temptableErrorss"></div>
                                </div> <span id='pemp' class='error'></span>

                            </div>

                        </div>


                    </div>

                    <div class="modal-footer">
                        <button type="button" id="btnUpdatedel" onclick="fn_UpdatePickupAssign(this);" class="btn btn-primary">Assign PickUp</button>
                        <button type="button" class="btn btn-light1" data-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalFeedback" data-backdrop="static" data-keyboard="false" tabindex="1000">
        <div class="modal-dialog modal-lg" role="dialog">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title"><span id="headerFeedback"></span></h5>
                    <button type="button" class="close" aria-label="Close" onclick="CloseFdModal()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;padding: 1rem;">
                    <div class="row">
                        <div class="col-sm-12" id="divmdlFeedback">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>
@*//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*@
@*</div>*@

@*<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>*@
@*01/10/2022 commented*@
@*<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.1/jspdf.debug.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>*@


<script src="~/Scripts/jspdf.min.js"></script>
<script src="~/Scripts/jspdf.plugin.autotable.min.js"></script>
<script src="~/Scripts/exportFile.js"></script>
<script src="~/Scripts/xlsx.min.js"></script>

<script src="~/Scripts/jqDOM/searchDOMCreation.js"></script>
<script>

    function checkLimit()
    {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        //let Visitdate = moment($thisForm.find('[name="CSAVisitdate"]').val(), "mm/dd/yyyy");
        var currentdate = new Date();
        let Todate = currentdate.getDate;
    }

    function getdept(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        crt2 = $('[name=DepartmentID]').val()


    }
    function fn_showFilter() {

        $formContainer.find('.jq_leadgeneration_body').find('.leadformSesction').toggleClass('d-none');

    }
    $(document).ready(function () {

        let $thisForm = $(this).find('[perfect-class="formassign"]');
        $thisForm.closest('.jq_leadgeneration_body').find('.leadformSesction').addClass('d-none');

        jQuery('form').validate();


        //var enqDate = new Date(Visitdate);
        //enqDate.setHours(0, 0, 0, 0)
        //var today = new Date();
        //today.setHours(0, 0, 0, 0)

        ////debugger
        //initFunctions('form');

        /////////////////////// switch //////////////////////////
        var url = window.location.pathname;
        var id = url.substring(url.lastIndexOf('/') + 1);
        console.log('ID------------------', id)
        if (id != "Serviceassign") {
            if (id != null && id != "") {
                ////debugger
                switch (id) {
                    case "1": $("#New").click(); break;
                    //case "2": $("#Onhold").click(); break;s

                }
            }
        } else {
            $("#New")[0].click();
        }
        //////////////////////switch /////////////////////
        //fn_LeadManagement_search ();

        let $thisForms = $(this).closest('[perfect-class="form"]');
        ////debugger

        var v = $thisForms.find('[name="NextAction"]').val();
        var v = $('#nextAction').val();
        if (v == null || v == '' || v == 0) { document.getElementById("btnUpdateprioritynew").disabled = true; }
        else { document.getElementById("btnUpdateprioritynew").disabled = false; }
    });

    function nxtonchng(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');

        var v = $thisForm.find('[name="NextAction"]').val();
        if (v == null ||v==''||v==0) { document.getElementById("btnUpdateprioritynew").disabled = true; }
        else { document.getElementById("btnUpdateprioritynew").disabled = false; }

    }




    function checkfunction()
    {
        let row = $(this).closest('tr');
        let Saveddata = row.data('pData');

        var curntemp = Saveddata.Employee;       
        //debugger
        let id = Saveddata.ID_CustomerServiceRegister;
        var ID_CustomerServiceRegisterProductDetails = 0;
        if (Saveddata.ID_CustomerServiceRegisterProductDetails != 0) {
            ID_CustomerServiceRegisterProductDetails = Saveddata.ID_CustomerServiceRegisterProductDetails;
        }

        if (Saveddata.StatusCode == 3) {
            fn_ShowServiceAssignDetailsnew(this, id , ID_CustomerServiceRegisterProductDetails);
        }
        else if (Saveddata.StatusCode == 0 ) {
            ClearModalInput();
            GetTicketDetailsnew(this, id , ID_CustomerServiceRegisterProductDetails);
        }
        else if (Saveddata.StatusCode == 7 ) {// delivery Request
            fn_ShowDeliverydetails(this, id , curntemp, ID_CustomerServiceRegisterProductDetails)
        }
        else if (Saveddata.StatusCode == 5) {//pickup request
            fn_ShowPickupdetails(this, id , ID_CustomerServiceRegisterProductDetails)
        }
        else if (Saveddata.StatusCode == 4 || Saveddata.StatusCode == 10 || Saveddata.StatusCode == 9 ) {//completed
            Feedbackview(this, id , ID_CustomerServiceRegisterProductDetails)
        }
        else {
            fn_ShowServiceAssignDetailsnew(this, id, ID_CustomerServiceRegisterProductDetails);
        }
    }

    var tableOptions = {

        //textButton: {
        //    buttons: [
        //        { displayName: "Assign", class: "fa fa-pencil btnPerfectGridEdit", action: fn_showprioritynewtab }
        //    ]
        //},

        onlyShowColumn: ['Slno', 'TicketNo', 'TicketDate', 'Customer', 'Mobile', 'Customer', 'Branch', 'Area', 'Priority', 'Due', 'Channel', 'Product'],
        hideColumn: ["ID_CustomerServiceRegister", "PriorityCode", "StatusCode", "Status", "ID_Master", "TransMode","ID_CustomerServiceRegisterProductDetails"],
        trackInfo: { "TicketNo": "Click to more information" },
        rowClickAction: checkfunction,
        //serialNo: true,
        renameHeader: { "Slno": "SL NO.", "TicketNo": "Ticket No", "TicketDate": "Ticket Date", "Mobile": "Mobile", "Customer": "Customer", "Branch": "Terminal", "Priority": "Priority", "Status": "Status", "Assign": "Action", "Area":"Area","Due":"Time Due" },
        isDateType: ["TicketDate"],
        //customIcon: ["Assign"],
        //buttons: ["Assign", { action: checkfunction }],
        status: ["Status"],
        priority: ["Priority"],
        Channel: ["Channel"],
        @*hyperlink: {"TicketNo" : "@Url.Action("UserChangepasswordindex", "UserChangepassword")" }*@
        //customIcon: { 'FK_Priority': [{ text: '1', icon: '<svg>' }, { text: '2', icon: '<svg>' }], 'time': [{ text: '3', icon: '<svg>' }, { text: 'Hot', icon: '<svg>' }] }
        //  rowClickAction: () => { alert("clicked row") }
    };

    var tableOptionspdf = {
        onlyShowColumn: ['Slno', 'TicketNo', 'TicketDate', 'Customer', 'Mobile', 'Customer', 'Branch', 'Area', 'Due'],

        //serialNo: true,
        renameHeader: { "Slno": "SL No.", "TicketNo": "Ticket No", "TicketDate": "Ticket Date", "Mobile": "Mobile", "Customer": "Customer", "Branch": "Terminal", "Area": "Area" },
        isDateType: ["TicketDate"],
        //customIcon: ["Assign"],

    }
    var tableOptions2 = {

        //textButton: {
        //    buttons: [
        //        { displayName: "Assign", class: "fa fa-pencil btnPerfectGridEdit", action: /*checkfunction*/fn_showpriority }
        //    ]
        //},

        onlyShowColumn: ['Slno', 'TicketNo', 'TicketDate', 'Customer', 'Mobile', 'Customer', 'Branch', 'Priority', 'Status', 'Area', 'Due', 'Employee', 'Channel', 'Product'],
        hideColumn: ["ID_CustomerServiceRegister", "PriorityCode", "StatusCode", "ID_Master", "TransMode", "ID_CustomerServiceRegisterProductDetails"],
        trackInfo: { "TicketNo": "Click to more information" },
        rowClickAction: checkfunction,
        //serialNo: true,
        renameHeader: { "Slno": "SL NO.", "TicketNo": "Ticket No", "TicketDate": "Ticket Date", "Mobile": "Mobile", "Customer": "Customer", "Branch": "Terminal", "Priority": "Priority", "Status": "Status", "Assign": "Action", "Test": "PriorityCode", "Area":"Area","Due":"Time Due" },
        isDateType: ["TicketDate"],
        //customIcon: ["Assign"],
        //buttons: ["Assign", { action: checkfunction }],
        status: ["Status"],
        priority: ["Priority"],
        Channel: ["Channel"],
        @*hyperlink: {"TicketNo":"@Url.Action("UserChangepasswordindex", "UserChangepassword")"}*@
        //customIcon: { 'FK_Priority': [{ text: '1', icon: '<svg>' }, { text: '2', icon: '<svg>' }], 'time': [{ text: '3', icon: '<svg>' }, { text: 'Hot', icon: '<svg>' }] }
        //  rowClickAction: () => { alert("clicked row") }
    };

    //////////////////////////////////NEW PAGINATION CHECK///////////////////////////////////////////////
    function datecheck(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        //invalid-feedback

        let Visitdate = $thisForm.find('[name="CSAVisitdate"]').val();
        var enqDate = new Date(Visitdate);
        enqDate.setHours(0, 0, 0, 0)
        var today = new Date();
        today.setHours(0, 0, 0, 0)

        let errorClass4 = '.temptableErrors';
        if (enqDate >= today) {

            $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass4).attr("style", "display:none");
            $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass4).text('');
        }
        else if (enqDate <= today){
            isValid = false;
            console.log('false');
            $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass4).attr("style", "display:block");
            $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass4).text('Visit Date should be greater than or equal to Todays date');

        }


        //$thisForm.find('[perfect-ctype="date"]').val('');
        $('[name=FK_Employee]').val('0');
        $('[name=Employee]').val('');
        //$('select[name=EmployeeType]').val('0');
        $('[name=EmployeeType]').val('0');
        //$('select[name=EmployeeType]').val('0');
        $('[name=DepartmentID]').val('0');
        $('select[name=EmployeeType]').find(':selected').val('0')
        $('select[name=DepartmentID]').find(':selected').val('0')
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');
    }

    function Feedbackview(ele, ID_CustomerServiceRegister, ID_CustomerServiceRegisterProductDetails) {

        let row = $(this).closest('tr');
        let Saveddata = row.data('pData');

        $('#divmdlFeedback').load('@Url.Action("GetCustFeedbackList", "CustFeedback")', function () {
            $("#hdn_IDCustomerServiceRegister").val(ID_CustomerServiceRegister);
            $("#hdn_IDCustomerServiceRegisterProductDetails").val(ID_CustomerServiceRegisterProductDetails);
            $("#headerFeedback").text("Customer Feedback Details");
            var msg = $(".Errmsg").val().trim();
            if (msg != "") {

                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': msg });
                rowclick = 0;
            }
            else {
                $('#modalFeedback').modal('show');
            }
        });
    }



    var titlepdf;
    var datapdf;

       function fn_LeadSearchbyfilter(ele) {


        let $thisForm = $(ele).closest('[perfect-class="form"]');
           let id = $('[name=filt]').val(); //id
           let modes = $('[name=md]').val();//mode
        $thisForm.find('[name=SearchLoadDiv]').empty();

             let s = $(".nav-link active");
             console.log('NAVIGATION VALUE-----', s)
             let Mode = 0;
           let ids = '';
           let tableoptionscustom;
           if (modes = 2) {
               $("#New").click()
               Mode = 2;
               ids = '#test1';
               tableoptionscustom = tableOptions;
           }
           else if (modes = 3) {
               $("#Onhold").click()
               Mode = 3;
               ids = '#test2';
               tableoptionscustom = tableOptions2;
           }
           else if (modes = 4) {
               $("#pending").click();
               Mode = 4;
               ids = '#test3';
               tableoptionscustom = tableOptions2;
           }
           else if (modes = 5) {
               $("#pickup").click();
               Mode = 5;
               ids = '#test4';
               tableoptionscustom = tableOptions2;
           }
           else if (modes = 6) {
               $("#replacement").click();
               Mode = 6;
               ids = '#test5';
               tableoptionscustom = tableOptions2;
           }
           else if (modes = 7) {
               $("#deliveryrequest").click();
               Mode = 7;
               ids = '#test6';
               tableoptionscustom = tableOptions2;
           }
           else if (modes = 8) {
               $("#factory").click();
               Mode = 8;
               ids = '#test7';
               tableoptionscustom = tableOptions2;
           }
           else
           {
               Mode = 2;
               ids = '#test1';
               tableoptionscustom = tableOptions;
           }

           if (Mode == 2) {
               titlepdf = 'New Service Assign';
           }
           else {
               titlepdf = 'On Going Service Assign';
           }


             var InputData = {
                 'Customer': $('[name=Customer]').val().trim(),
                 'FromDate': $('[name=FromDate]').val(),
                 'ToDate': $('[name=ToDate]').val(),
                 'FK_Branch': $('[name=Branch]').val().trim(),
                 'Status': $('[name=Complaintstatus]').val().trim(),
                 'FK_ComplaintType': $('[name=ComplaintType]').val().trim(),
                 'FK_Product': $('[name=ProductID]').val().trim(),
                 'Mobile': $('[name=Mobile]').val().trim(),
                 'Sortorder': $('[name=Sortorder]').val().trim(),
                 'TicketNumber': $('[name=Ticket]').val().trim(),
                 'pageSize': 15,
                 'pageIndex': 0,
                 'Mode': Mode,
                 'FK_Area': $('[name=AreaID]').val().trim(),
                 'FK_Post': $('[name=PostID]').val().trim(),
                 'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                 'DueDays': $('[name=DueDays]').val().trim(),
             }


             let pageUrl = '@Url.Action("GetSearchResults", "Service")';
             $.ajax({
             url: pageUrl,
             type: "POST",
             data: InputData,//<---- Input json : data passed to controller
             dataType: "json",
             contentType: "application/x-www-form-urlencoded;charset=utf-8",
             success: function (ajaxOutput) {


                 console.log(ajaxOutput.Data, 'ajaxOutput.Data////<<<<>>>>>')

                if (ajaxOutput.Process.IsProcess) {
                    $(ids).empty().append('<div class="d-flex justify-content-end mb-3 position-relative"><div class="col-md-1 position-absolute top-1 z-index"> <div class="input-group testSearchBox"></div></div></div>', $('<div/>', { class: "col-md-12 table_temp_class" }).html(pft_table_createtable(ajaxOutput.Data, tableoptionscustom)))
                    datapdf = {
                        'Customer': $('[name=Customer]').val().trim(),
                        'FromDate': $('[name=FromDate]').val(),
                        'ToDate': $('[name=ToDate]').val(),
                        'FK_Branch': $('[name=Branch]').val().trim(),
                        'Status': $('[name=Complaintstatus]').val().trim(),
                        'FK_ComplaintType': $('[name=ComplaintType]').val().trim(),
                        'FK_Product': $('[name=ProductID]').val().trim(),
                        'Mobile': $('[name=Mobile]').val().trim(),
                        'Sortorder': $('[name=Sortorder]').val().trim(),
                        'TicketNumber': $('[name=Ticket]').val().trim(),
                        'pageSize': ajaxOutput.totalrecord,
                        'pageIndex': 0,
                        'Mode': Mode,
                        'FK_Area': $('[name=AreaID]').val().trim(),
                        'FK_Post': $('[name=PostID]').val().trim(),
                        'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                        'DueDays': $('[name=DueDays]').val().trim(),
                    }


                              let $table = $(ids).find('table');
                              $table.dataTable({
                                  "serverSide": true,//no change
                                  "processing": true,//-- process text when clicked
                                  //"lengthChange": false,
                                  "lengthMenu": [10, 15, 20, 25, 50, 100],//---drop down page size
                                  "searching": false,//--no change
                                  "ordering": false,//--sorting
                                  "deferLoading": ajaxOutput.totalrecord,//<----to total number of record from db
                                  "displayStart": ajaxOutput.PageIndex * ajaxOutput.PageSize,//<----starting record
                                  "pageLength": ajaxOutput.PageSize,//<----page size
                                  "recordsFiltered": ajaxOutput.PageSize,//<---page size

                                  "ajax": returnajaxPagination({ apiurl: pageUrl, pageSize: ajaxOutput.PageSize, Customer: $('[name=Customer]').val().trim(), FromDate: $('[name=FromDate]').val(), ToDate: $('[name=ToDate]').val(), FK_Branch: $('[name=Branch]').val().trim(), FK_ComplaintType: $('[name=ComplaintType]').val().trim(), FK_Product: $('[name=ProductID]').val().trim(), Mobile: $('[name=Mobile]').val().trim(), Sortorder: $('[name=Sortorder]').val().trim(), TicketNumber: $('[name=Ticket]').val().trim(), 'Mode': Mode, 'FK_Area': $('[name=AreaID]').val().trim(), 'FK_Post': $('[name=PostID]').val().trim(), 'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(), 'Status': $('[name=Complaintstatus]').val().trim(), 'DueDays': $('[name=DueDays]').val().trim() }, tableoptionscustom, $table)
                              });

                }
                else {
                    if (ajaxOutput.Process.Status = "NoData") {



                        $(ids).empty().append($('<div/>', { class: "col-md-12 table_temp_class" }).html(pft_table_createtable(ajaxOutput.Data, tableoptionscustom)))
                        // $sidemenu.find('table').dataTable({ paging: true });


                        let $table = $(ids).find('table');
                        $table.dataTable({
                            "serverSide": true,//no change
                            "processing": true,//-- process text when clicked
                            // "lengthChange": false,
                            "lengthMenu": [],//---drop down page size
                            "searching": false,//--no change
                            "ordering": false,//--sorting
                            "deferLoading": ajaxOutput.totalrecord,//<----to total number of record from db
                            "displayStart": ajaxOutput.PageIndex * ajaxOutput.PageSize,//<----starting record
                            "pageLength": ajaxOutput.PageSize,//<----page size
                            "recordsFiltered": ajaxOutput.pageSize,//<---page size

                            "ajax": returnajaxPagination({ apiurl: pageUrl, pageSize: ajaxOutput.PageSize, Customer: $('[name=Customer]').val().trim(), FromDate: $('[name=FromDate]').val(), ToDate: $('[name=ToDate]').val(), FK_Branch: $('[name=Branch]').val().trim(), FK_ComplaintType: $('[name=ComplaintType]').val().trim(), FK_Product: $('[name=ProductID]').val().trim(), Mobile: $('[name=Mobile]').val().trim(), Sortorder: $('[name=Sortorder]').val().trim(), TicketNumber: $('[name=Ticket]').val().trim(), 'Mode': Mode, 'FK_Area': $('[name=AreaID]').val().trim(), 'FK_Post': $('[name=PostID]').val().trim(), 'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(), 'Status': $('[name=Complaintstatus]').val().trim(), 'DueDays': $('[name=DueDays]').val().trim() }, tableoptionscustom, $table)
                        });
                    }
                    else {
                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                        });
                    }
                }

                },
                complete: function () {

                }
            });


    }

        var tabledd;
      function exportpdf() {

          let pageUrl = '@Url.Action("GetSearchResults", "Service")';
            $.ajax({
                url:pageUrl,
                type: "POST",
                data: datapdf,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                success: function (ajaxOutput) {
                    if (ajaxOutput.Process.IsProcess) {

                        $('#exportpdf').html(pft_table_createtable(ajaxOutput.Data, tableOptionspdf))

                        var sTable = document.getElementById('exportpdf').innerHTML;


                        var doc = new jsPDF('l', 'pt', 'a4');


                        var specialElementHandlers = {
                            // element with id of "bypass" - jQuery style selector
                            '.no-export': function (element, renderer) {
                                // true = "handled elsewhere, bypass text extraction"
                                return true;
                            }
                        };
                        var margins = {
                            top: 32,
                            bottom: 20,
                            left: 40,
                            width: 100
                        };

                        doc.setFontSize(22);

                        doc.text(20, 20, titlepdf);
                        doc.setFontSize(5);


                        doc.fromHTML(
                            sTable, // HTML string or DOM elem ref.
                            margins.left,
                            margins.top, {
                                'width': margins.width,
                                'elementHandlers': specialElementHandlers
                            },

                            function (dispose) {
                                // dispose: object with X, Y of the last line add to the PDF
                                //          this allow the insertion of new lines after html
                                doc.save('ServiceAssign.pdf');
                            }, margins);
                    }
                             else {
                              if (ajaxOutput.Process.Status = "NoData") {
                    }
                    else {
                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                        });
                    }
                }
            },
            complete: function () {

            }
        });
    }



    var Data;
    var tabMode;
    var tabledata;
    function fn_LeadManagement_search(ele, M, ids, tabl) {
       
        let $sidemenu = $sideMenuOptions.body;
        ClearModalInput();
       // let $thisForm = $(ele).closest('.Search-Control');
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let $formDivContainer = $thisForm.find('[name=SearchLoadDiv]');

        var InputData = {
            'Customer': $('[name=Customer]').val().trim(),
            'FromDate': $('[name=FromDate]').val(),
            'ToDate': $('[name=ToDate]').val(),
            'FK_Branch': $('[name=Branch]').val().trim(),
            'Status': $('[name=Complaintstatus]').val().trim(),
            'FK_ComplaintType': $('[name=ComplaintType]').val().trim(),
            'FK_Product': $('[name=ProductID]').val().trim(),
            'Mobile': $('[name=Mobile]').val().trim(),
            'Sortorder': $('[name=Sortorder]').val().trim(),
            'TicketNumber': $('[name=Ticket]').val().trim(),
            'pageSize': 15,
            'pageIndex': 0,
            'Mode': M,
            'FK_Area': $('[name=AreaID]').val().trim(),
            'FK_Post': $('[name=PostID]').val().trim(),
            'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
            'DueDays': $('[name=DueDays]').val().trim(),
        }
        if (M == 2) {
            titlepdf = 'New Service Assign';
        }
        else {
            titlepdf = 'On Going Service Assign';
        }

        tabMode = M;


          let pageUrl = '@Url.Action("GetSearchResults", "Service")';
            $.ajax({
                url:pageUrl,
                type: "POST",
                data: InputData,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                success: function (ajaxOutput) {

                    console.log('place', ajaxOutput);
                          if (ajaxOutput.Process.IsProcess) {
                              
                              
                              Data = ajaxOutput.Data;
                              document.querySelector('#exppdf').style.display = 'block';

                              $(ids).empty().append('<div class="d-flex justify-content-end mb-3 position-relative"><div class="col-md-1 position-absolute top-1 z-index"> <div class="input-group testSearchBox"></div></div></div>', $('<div/>', { class: "col-md-12 table_temp_class" }).html(pft_table_createtable(ajaxOutput.Data, tabl)))
                              datapdf = {
                                  'Customer': $('[name=Customer]').val().trim(),
                                  'FromDate': $('[name=FromDate]').val(),
                                  'ToDate': $('[name=ToDate]').val(),
                                  'FK_Branch': $('[name=Branch]').val().trim(),
                                  'Status': $('[name=Complaintstatus]').val().trim(),
                                  'FK_ComplaintType': $('[name=ComplaintType]').val().trim(),
                                  'FK_Product': $('[name=ProductID]').val().trim(),
                                  'Mobile': $('[name=Mobile]').val().trim(),
                                  'Sortorder': $('[name=Sortorder]').val().trim(),
                                  'TicketNumber': $('[name=Ticket]').val().trim(),
                                  'pageSize': ajaxOutput.totalrecord,
                                  'pageIndex': 0,
                                  'Mode': M,
                                  'FK_Area': $('[name=AreaID]').val().trim(),
                                  'FK_Post': $('[name=PostID]').val().trim(),
                                  'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                                  'DueDays': $('[name=DueDays]').val().trim(),
                              }
                              let $table = $(ids).find('table');

                              $table.dataTable({
                                  "serverSide": true,//no change
                                  "processing": true,//-- process text when clicked
                                  //"lengthChange": false,
                                  "lengthMenu": [10, 15, 20, 25, 50, 100],//---drop down page size
                                  "searching": false,//--no change
                                  "ordering": false,//--sorting
                                  "deferLoading": ajaxOutput.totalrecord,//<----to total number of record from db
                                  "displayStart": ajaxOutput.PageIndex * ajaxOutput.PageSize,//<----starting record
                                  "pageLength": ajaxOutput.PageSize,//<----page size
                                  "recordsFiltered": ajaxOutput.PageSize,//<---page size

                                  "ajax": returnajaxPagination({ apiurl: pageUrl, pageSize: ajaxOutput.PageSize, Customer: $('[name=Customer]').val().trim(), FromDate: $('[name=FromDate]').val(), ToDate: $('[name=ToDate]').val(), FK_Branch: $('[name=Branch]').val().trim(), FK_ComplaintType: $('[name=ComplaintType]').val().trim(), FK_Product: $('[name=ProductID]').val().trim(), Mobile: $('[name=Mobile]').val().trim(), Sortorder: $('[name=Sortorder]').val().trim(), TicketNumber: $('[name=Ticket]').val().trim(), 'Mode': M, 'FK_Area': $('[name=AreaID]').val().trim(), 'FK_Post': $('[name=PostID]').val().trim(), 'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(), 'Status': $('[name=Complaintstatus]').val().trim(), 'DueDays': $('[name=DueDays]').val().trim() }, tabl, $table)
                              });

                          } else {
                              document.querySelector('#exppdf').style.display = 'none';
                              if (ajaxOutput.Process.Status = "NoData") {



                                  $(ids).empty().append($('<div/>', { class: "col-md-12 table_temp_class" }).html(pft_table_createtable(ajaxOutput.Data, tabl)))
                        // $sidemenu.find('table').dataTable({ paging: true });


                        let $table = $(ids).find('table');
                        $table.dataTable({
                            "serverSide": true,//no change
                            "processing": true,//-- process text when clicked
                           // "lengthChange": false,
                            "lengthMenu": [10, 15, 20, 25, 50, 100],//---drop down page size
                            "searching": false,//--no change
                            "ordering": false,//--sorting
                            "deferLoading": ajaxOutput.totalrecord,//<----to total number of record from db
                            "displayStart": ajaxOutput.PageIndex * ajaxOutput.PageSize,//<----starting record
                            "pageLength": ajaxOutput.PageSize,//<----page size
                            "recordsFiltered": ajaxOutput.pageSize,//<---page size

                            "ajax": returnajaxPagination({ apiurl: pageUrl, pageSize: ajaxOutput.PageSize, Customer: $('[name=Customer]').val().trim(), FromDate: $('[name=FromDate]').val(), ToDate: $('[name=ToDate]').val(), FK_Branch: $('[name=Branch]').val().trim(), FK_ComplaintType: $('[name=ComplaintType]').val().trim(), FK_Product: $('[name=ProductID]').val().trim(), Mobile: $('[name=Mobile]').val().trim(), Sortorder: $('[name=Sortorder]').val().trim(), TicketNumber: $('[name=Ticket]').val().trim(), 'Mode': M, 'FK_Area': $('[name=AreaID]').val().trim(), 'FK_Post': $('[name=PostID]').val().trim(), 'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(), 'Status': $('[name=Complaintstatus]').val().trim(), 'DueDays': $('[name=DueDays]').val().trim() }, tabl, $table)
                        });
                    }
                    else {
                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                        });
                    }
                }


                    get_tab_count(this);

            },
            complete: function () {
                $('[name=filt]').val(ids);
                $('[name=md]').val(M);
            }
        });
    }




    function returnajaxPagination(ajaxInfo, tableOptions, tableid) {
        //{ apiurl, pageSize }

        return {
            url: ajaxInfo.apiurl,
            type: "post",
            data: function () {
                var info = tableid.DataTable().page.info();
                console.log('RETURN AJAX', info)
                //return { <antiforgery>:<antiforgery>, length: ajaxInfo.pageSize, page: info.page }
                let input = { pageSize: info.length, pageIndex: info.page, Customer: ajaxInfo.Customer, FromDate: ajaxInfo.FromDate, Todate: ajaxInfo.Todate, FK_Branch: ajaxInfo.FK_Branch, FK_ComplaintType: ajaxInfo.FK_ComplaintType, FK_Product: ajaxInfo.FK_Product, Mobile: ajaxInfo.Mobile, TicketNo: ajaxInfo.TicketNo, Sortorder: ajaxInfo.Sortorder, Mode: ajaxInfo.Mode, FK_Area: ajaxInfo.FK_Area, FK_Post: ajaxInfo.FK_Post, FK_Employee: ajaxInfo.FK_Employee, Status: ajaxInfo.Status, DueDays: ajaxInfo.DueDays };
                if (ajaxInfo.searchkey) {
                    input["Name"] = ajaxInfo.searchkey;
                }
                return input
            },
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            success: function (dtajaxOutput) {
                // $sideMenuOptions.body.html(pft_table_createtable(dtajaxOutput.Data, tableOptions));
                console.table(dtajaxOutput.Data, 'dtajaxOutput.Data>>pagination fun')
                Data = dtajaxOutput.Data;
                document.querySelector('#exppdf').style.display = 'block';
                let table = tableid.DataTable();
                table.destroy();
                pft_table_newTableBody(tableid, dtajaxOutput.Data, tableOptions);

                tableid.dataTable({
                    "serverSide": true,
                    "processing": true,
                    //"lengthChange": false,
                    "lengthMenu": [10, 15, 20, 25, 50, 100],
                    "searching": false,
                    "ordering": false,
                    "deferLoading": dtajaxOutput.totalrecord,
                    "displayStart": dtajaxOutput.PageIndex * dtajaxOutput.PageSize,
                    "pageLength": dtajaxOutput.PageSize,
                    "recordsFiltered": dtajaxOutput.PageSize,
                    "ajax": returnajaxPagination(ajaxInfo, tableOptions, tableid)
                })

            },

        }
    }
    /////////////////////////////////////////////////////////////////////////////////



 ///////////////////////ASSIGN////////////////////////////\

    function GetTicketDetailsnew(ele, id, ID_CustomerServiceRegisterProductDetails) {

         ClearModalInput();
         $('#Emptable').css('display', 'none');
         $('.Editassign').hide();
         $('.Serviceassign').show();
         $('.Employeeadd').show();
        //let row = $(this).closest('tr');
         $('#TopDetail').hide();
         $('#TopDetail2').hide();
         $('#TopDetails').show();
         $('#TopDetails2').show();
         $('.bd-service-modal-sm').validate().resetForm();
         $('select[name=DepartmentID]').prop("disabled", false);
         $('#Visitdate').show();
         $('#Visittime').show();
         $('#Remarks').show();
         $('#status').hide();
         $('#Attendedby').hide();
         $('#Priority').show();
        //let Saveddata = row.data('pData');
        //console.log("Saved data", Saveddata);

         //var el = $('.modal-lg');
         //el.addClass('modal-xl');
         //el.removeClass('modal-lg');

         $('#modalid').removeClass('modal-lg');
         $('#modalid').addClass('modal-xl');

        var $thisForm = $(ele).closest('[perfect-class="form"]');
        var InputData = {
            'FK_Customerserviceregister': id,
            'TransMode': ""/* $(ele).attr('data-id') */
        }
         //let Saveddata = row.data('pData');
        //console.log("Saved data", Saveddata);
        $.ajax({
            url: "@Url.Action("GetTicketDetailsNew", "Service")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {

                $('[name=ID_Customer]').val(ajaxOutput.ID_Customer);
                $('[name=FK_Customerserviceregister]').val(id);
                $('[name=ID_Customerserviceassign]').val(ajaxOutput.ID_Customerserviceassign);
                $('[name=ID_CustomerServiceRegisterProductDetails]').val(ID_CustomerServiceRegisterProductDetails);
                $TicketHtml = '';
                if (ajaxOutput != null) {

                    $('[name=CSAPriority]').val(ajaxOutput['Priority']);

                    $('[name="DepartmentID"]').val('@Model.ID_DefaultDept').selectpicker('refresh');
                    $('[name="DepartmentID"]').trigger('change');
                    $('#TopDetails').empty();
                    //Ticket Information
                    $TicketHtml += "<div class='col-sm-12'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Ticket Information</h4>";
                    $TicketHtml += "<div class='row'>";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    //$TicketHtml += "<div class='col-4'>";
                    $TicketHtml += "<h5 class='f-w-500'>Ticket <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "</div >";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput['Ticket'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    //$TicketHtml += "<div class='col-5'>";
                    $TicketHtml += "<h5 class='f-w-500'>Customer <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "</div >";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput['Customer'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    //$TicketHtml += "<div class='col-3'>";
                    $TicketHtml += "<h5 class='f-w-500'>Address <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "</div >";
                    $TicketHtml += "<div class='col-9'><span>" + ajaxOutput['Address'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    //$TicketHtml += "<div class='col-4'>";
                    $TicketHtml += "<h5 class='f-w-500'>Land Mark <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "</div >";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput['Landmark'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    //$TicketHtml += "<div class='col-6'>";
                    $TicketHtml += "<h5 class='f-w-500'>Contact No. <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "</div >";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput['OtherMobile'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";

                    $TicketHtml += "<h5 class='f-w-500'>Mobile Number <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput['Mobile'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-2'>";
                    $TicketHtml += "<div>";
                    $TicketHtml += "<div class='row'>";


                    $TicketHtml += `<div class='col-sm-2'> <button id="customerbalancebtn" class="btn btn-primary fa fa-info" type="button" perfect-css="button" title="Customer Balance" onclick="ShowCustomerBalance(this)"></button>`;
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";


                    //Service Information
                    if (ajaxOutput['FromDate'].length > 0 || ajaxOutput['ToDate'].length > 0 || ajaxOutput['FromTime'].length > 0 || ajaxOutput['ToTime'].length > 0) {

                    $TicketHtml += "<div class='col-sm-12 py-3'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Service Information</h4>";
                    $TicketHtml += "<div class='row'>";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Requested Date <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput['FromDate'] + ' ' + " - " + ' ' + ajaxOutput['ToDate'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Requested Time <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput['FromTime'] + ' ' + " - " + ' ' +  ajaxOutput['ToTime'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";

                    }

                    const parts = (ajaxOutput['FromDate']).split("/");

                    var dateObject = new Date(parts[2], parts[1] - 1, parts[0]);
                    $('[name=CSAVisitdate]').val(moment(dateObject).format('YYYY-MM-DD'));

                    let Saveddatanews = ajaxOutput;

                    $('#TopDetails').append($TicketHtml);

                    if (ajaxOutput!= null) {

                        $('#TopDetails2').empty();
                        var ProductData = ajaxOutput;
                        $ProductHtml = '';
                        //if (ProductData.length > 0) {
                            $ProductHtml += "<div class='col-sm-12'>";
                            $ProductHtml += "<div class='profile-personal-info'>";
                            $ProductHtml += "<h4 class='text-primary mb-4'>Product Details</h4>";
                            $ProductHtml += "<div class='row'>";

                            $ProductHtml += "<div class='col-sm-4'>";
                            $ProductHtml += "<div class='info'>";
                            $ProductHtml += "<div class='row'>";
                            $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Category/Product Name<span class='pull-right'>:</span></h5>";
                            $ProductHtml += "</div >";
                            $ProductHtml += "<div class='col-6'><span>" + ajaxOutput['Productname'] + "</span>";
                            $ProductHtml += "</div ></div >";
                            $ProductHtml += "</div >";
                            $ProductHtml += "</div >";

                            $ProductHtml += "<div class='col-sm-4'>";
                            $ProductHtml += "<div class='info'>";
                            $ProductHtml += "<div class='row'>";
                            $ProductHtml += "<div class='col-6'>";
                            $ProductHtml += "<h5 class='f-w-500'>Product Complaint <span class='pull-right'>:</span></h5>";
                            $ProductHtml += "</div >";
                            $ProductHtml += "<div class='col-6'><span>" + ajaxOutput['ProductComplaint']+ "</span>";
                            $ProductHtml += "</div ></div >";
                            $ProductHtml += "</div >";
                            $ProductHtml += "</div >";

                            $ProductHtml += "<div class='col-sm-4'>";
                            $ProductHtml += "<div class='info'>";
                            $ProductHtml += "<div class='row'>";
                            $ProductHtml += "<div class='col-6'>";
                            $ProductHtml += "<h5 class='f-w-500'>Description <span class='pull-right'>:</span></h5>";
                            $ProductHtml += "</div >";
                            $ProductHtml += "<div class='col-6'><span>" + ajaxOutput['ProductDescription'] + "</span>";
                            $ProductHtml += "</div ></div >";
                            $ProductHtml += "</div >";
                            $ProductHtml += "</div >";

                            $ProductHtml += "</div >";
                            $ProductHtml += "</div >";
                            $ProductHtml += "</div>";
                            $ProductHtml += "</div>";




                            //$.each(ProductData, function (i, value) {
                            //    let rowCount = (i + 1);

                            //    $ProductHtml += "<tr id=" + rowCount + ">";
                            //    $ProductHtml += "<td style='text-align: center;'>" + rowCount + "</td>";
                            //    $ProductHtml += "<td>" + value.Productname + "</td>";
                            //    $ProductHtml += "<td>" + value.ProductComplaint + "</td>";
                            //    $ProductHtml += "<td>" + value.ProductDescription + "</td>";
                            //    $ProductHtml += "</tr>";
                            //});
                        //}
                        //else {
                        //    $ProductHtml += "<tr id='0'><td colspan='4' style'text-align:center'>No Records..</td></tr>";
                        //}

                        $('#TopDetails2').append($ProductHtml);
                    }

                    $('#btnUpdateprioritynew').css('display', 'none');
                    $('#btnUpdatepriority').css('display', 'none');
                    $('#btnUpdate').css('display', 'none');
                    $('#btnSave').css('display', 'block');
                    $('.bd-service-modal-sm').modal('show');

                    $('#TbtnUpdate').css('display', 'none');
                    $('#TbtnSave').css('display', 'block');
                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
                $('.bd-service-modal-sm').validate().resetForm();
            }
        });

    }
    //////////////////////////////////////////////////

    function fn_ShowServiceAssignDetailsnew(ele, id, ID_CustomerServiceRegisterProductDetails) {
        
        ClearModalInput();

        $('.Editassign').hide();
        $('.Serviceassign').show();
        $('.Employeeadd').show();
        $('#TopDetail').hide();
        $('#TopDetail2').hide();
        $('#TopDetails').show();
        $('#TopDetails2').show();

        $('#Visitdate').show();
        $('#Visittime').show();
        $('#Remarks').show();
        $('#status').hide();
        $('#Attendedby').hide();
        $('#Priority').show();

        $('#modalid').removeClass('modal-lg');
        $('#modalid').addClass('modal-xl');

        var InputData = {
            'FK_Customerserviceregister': id,
            'TransMode': /*ServiceassignTransMode*/"",
        }

        $.ajax({
            url: "@Url.Action("GetTicketDetailsByIdNew", "Service")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
               //let $thisForm = $(this).find('[perfect-class="form"]');
                //$thisForm.validate({ messages: validationMessage });
                 let $thisForm = $(ele).closest('[perfect-class="form"]');

                $('[name=CSAVisitdate]').val(moment(ajaxOutput.Model.Visitdate).format('YYYY-MM-DD'));
                $('[name=CSAVisittime]').val(ajaxOutput.Model['Visittime']);
                $('[name=CSAPriority]').val(ajaxOutput.Model['Priority']);
                $('[name=CSARemarks]').val(ajaxOutput.Model['Remarks']);
                $('[name=ID_CustomerServiceRegisterProductDetails]').val(ID_CustomerServiceRegisterProductDetails);


                if (ajaxOutput.CustomerData != null) {

                    $('#TopDetails').empty();
                    $('[name=ID_Customer]').val(ajaxOutput.CustomerData.Data[0].ID_Customer);
                    $('[name=FK_Customerserviceregister]').val(id);
                    let cusassign = $('[name=ID_Customerserviceassign]').val(ajaxOutput.Model.ID_Customerserviceassign);
                    $TicketHtml = '';


                    //Ticket Information
                    $TicketHtml += "<div class='col-sm-12'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Ticket Information</h4>";
                    $TicketHtml += "<div class='row  px-3'>";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Ticket <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Ticket + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Customer <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Customer + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Address <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-9'><span>" + ajaxOutput.CustomerData.Data[0].Address + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Land Mark <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Landmark + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Contact No. <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].OtherMobile + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Mobile Number <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Mobile + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += `<div class='col-sm-2'> <button id="customerbalancebtn" class="btn btn-primary fa fa-info" type="button" perfect-css="button" title="Customer Balance" onclick="ShowCustomerBalance(this)"></button>`;
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";

                    if (ajaxOutput.CustomerData.Data[0].FromDate.length > 0 || ajaxOutput.CustomerData.Data[0].ToDate.length > 0 || ajaxOutput.CustomerData.Data[0].FromTime.length > 0 || ajaxOutput.CustomerData.Data[0].ToTime.length > 0) {


                    //Service Information
                    $TicketHtml += "<div class='col-sm-12 py-3'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Service Information</h4>";
                    $TicketHtml += "<div class='row  px-3'>";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Requested Date <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromDate + "</span>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromDate + ' ' + " - " + ' ' + ajaxOutput.CustomerData.Data[0].ToDate + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Requested Time <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromTime + "</span>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromTime + ' ' + " - " + ' ' + ajaxOutput.CustomerData.Data[0].ToTime + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";
                    }
                    console.clear()
                    console.log(ajaxOutput.CustomerData.Data[0].PickUpOn)

                    if (ajaxOutput.CustomerData.Data[0].PickUpOn != null) {
                        if (ajaxOutput.CustomerData.Data[0].PickUpOn != "") {
                            $TicketHtml += "<div class='col-sm-12 py-3'>";
                            $TicketHtml += "<div class='profile-personal-info'>";
                            $TicketHtml += "<h4 class='text-primary mb-4'>Pick Up Information</h4>";
                            $TicketHtml += "<div class='row px-3'>";

                            $TicketHtml += "<div class='col-sm-5'>";
                            $TicketHtml += "<div class='info'>";
                            $TicketHtml += "<div class='row'>";
                            $TicketHtml += "<h5 class='f-w-500'>Date<span class='pull-right'>:</span></h5>";
                            $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].PickUpOn + "</span>";
                            $TicketHtml += "</div ></div >";
                            $TicketHtml += "</div >";
                            $TicketHtml += "</div >";

                            $TicketHtml += "<div class='col-sm-5'>";
                            $TicketHtml += "<div class='info'>";
                            $TicketHtml += "<div class='row'>";
                            $TicketHtml += "<h5 class='f-w-500'>Pick Up Person <span class='pull-right'>:</span></h5>";
                            $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].PickUpBy + "</span>";
                            $TicketHtml += "</div ></div >";
                            $TicketHtml += "</div >";
                            $TicketHtml += "</div >";
                            $TicketHtml += "<div class='col-sm-5'>";
                            $TicketHtml += "<div class='info'>";
                            $TicketHtml += "<div class='row'>";
                            $TicketHtml += "<h5 class='f-w-500'>Remarks<span class='pull-right'>:</span></h5>";
                            $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].PickUpRemarks + "</span>";
                            $TicketHtml += "</div ></div >";
                            $TicketHtml += "</div >";
                            $TicketHtml += "</div >";
                            $TicketHtml += "</div >";
                            $TicketHtml += "</div >";
                            $TicketHtml += "</div>";
                            $TicketHtml += "</div>";
                        }
                    }

                    $('#TopDetails').append($TicketHtml);

                    if (ajaxOutput != null) {

                        $('#TopDetails2').empty();
                        var ProductData = ajaxOutput.Products;
                        $ProductHtml = '';
                        //if (ProductData.length > 0) {
                        $ProductHtml += "<div class='col-sm-12 '>";
                        $ProductHtml += "<div class='profile-personal-info'>";
                        $ProductHtml += "<h4 class='text-primary mb-4'>Product Details</h4>";
                        $ProductHtml += "<div class='row'>";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Category/Product Name<span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Productname + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Product Complaint <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].ProductComplaint + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Description <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].ProductDescription + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div>";
                        $ProductHtml += "</div>";
                        //$.each(ProductData, function (i, value) {
                        //    let rowCount = (i + 1);

                        //    $ProductHtml += "<tr id=" + rowCount + ">";
                        //    $ProductHtml += "<td style='text-align: center;'>" + rowCount + "</td>";
                        //    $ProductHtml += "<td>" + value.Productname + "</td>";
                        //    $ProductHtml += "<td>" + value.ProductComplaint + "</td>";
                        //    $ProductHtml += "<td>" + value.ProductDescription + "</td>";
                        //    $ProductHtml += "</tr>";
                        //});
                        //}
                        //else {
                        //    $ProductHtml += "<tr id='0'><td colspan='4' style'text-align:center'>No Records..</td></tr>";
                        //}

                        $('#TopDetails2').append($ProductHtml);
                    }
                    //////////////////////////////////////////
                    $('#btnUpdateprioritynew').css('display', 'none');
                    $('#btnUpdatepriority').css('display', 'none');
                    $('#btnUpdate').css('display', 'block');
                    $('#btnSave').css('display', 'none');
                    $('.bd-service-modal-sm').modal('show');

                    $('#TbtnUpdate').css('display', 'none');
                    $('#TbtnSave').css('display', 'block');
                }

                else {

                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': "Error" });


                }

                //var empdata = ajaxOutput.AssignEmployee;

                //var TbodyHtml = '';
                ////$('#ComplaintDetailstbody').empty();
                ////if (ajaxOutput.AssignEmployee != null) {
                ////    $.each(ajaxOutput.AssignEmployee.Data, function (i, value) {

                ////        TbodyHtml += "<tr>";
                ////        TbodyHtml += "<td style='text-align:center;'>" + value.SLNO + "</td>";
                ////        TbodyHtml += "<td style='display:none;'>" + value.ID_Employee + "</td>";
                ////        TbodyHtml += "<td style='text-align:center;'>" + value.Employee + "</td>";
                ////        TbodyHtml += "<td style='text-align:center;'>" + value.EmployeeType + "</td>";
                ////        TbodyHtml += "<td style='display:none;'>" + value.ID_CSAEmployeeType + "</td>";
                ////        TbodyHtml += "<td style='display:none;'>" + value.DepartmentID + "</td>";
                ////        TbodyHtml += "<td style='text-align:center;'><div class='d-flex'><a href='#' class='btn btnPerfectGrid shadow btn-xs sharp mr-1' title='Edit' onclick='EditProductComplaintdetails(this);'> <i class='fa fa-pencil btnPerfectGridEdit'></i></a>";
                ////        TbodyHtml += "<a href='#' class='btn btnPerfectGrid shadow btn-xs sharp mr-1' title='Delete' onclick='RemoveProductComplaintdetails(this);'><i class='fa fa-trash btnPerfectGridDelete'><title>Delete</title></i></a>";
                ////        TbodyHtml += "<a href='#' class='btn btnPerfectGrid shadow btn-xs sharp mr-1' title='Assigned Works' onclick='Employeechecking(this);'><i class='fa fa-history'><title>Assigned Works</title></i></a></div ></td > ";
                ////        TbodyHtml += "</tr>";

                ////    }); $('#ComplaintDetailstbody').append(TbodyHtml);
                ////}
                ////else {
                ////    TbodyHtml += "<tr><td style='text-align:center;' colspan='4'></td></tr>";
                ////}
                /////////////////////////////////////////////////
                //return TbodyHtml;

            },
            complete: function () {
                $(ele).prop('disabled', false);
                $('.bd-service-modal-sm').validate().resetForm();
                //$thisForm.find('[perfect-tempTable-ComplaintDetails="Employee"]').closest('[perfect-class="formGroup"]').find('temptableError2').text('');
                //$thisForm.find('[perfect-tempTable-ComplaintDetails="DepartmentName"]').closest('[perfect-class="formGroup"]').find('temptableError').text('');
                //$thisForm.find('[perfect-tempTable-ComplaintDetails="Role"]').closest('[perfect-class="formGroup"]').find('temptableError2').text('');
                $('#modalid').on('hidden.bs.modal', function () {
                    $('#modalid form')[0].reset();
                });

            }
        });

    }
    function Cleardelpick(ele) {
        //debugger;
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $('[name=Employee]').val('');
        $('[name=FK_Employee]').val('');
        $('[name=CSAVisitdate]').val('');
        $('[name=CSAVisittime]').val('');
        $('[name=CSAPriority]').val("3");
        $('[name=CSARemarks]').val('');
        $('[name=ID_CustomerServiceRegisterProductDetails]').val('');
        $('[name=ID_CustomerServiceRegisterProductDetailsPick]').val('');
        $('[name=DepartmentID]').val('0');
        $('[name=Employee]').val('');
        $('[name=EmployeeType]').val('0');
        $('[name=NextAction]').val('');
        $('[name=FK_Attendedby]').val('0');
        $('[name=AttendedBy]').val('');
        $('[name=PdAssignedDate]').val('');
        $('[name=PdAssignedTime]').val('');
        $('[name=PdVehicleDetails]').val('');
        //$('[perfect-tempTable-cstatus]').val('');
        //$('[perfect-tempTable="ComplaintDetails"]').html('');
        $("#ComplaintDetailstbody tr").remove();



        //    let $thisForm = $(ele).closest('[perfect-class="form"]');
        //    //let pData = $thisForm.data('pData');

        //    $thisForm.find('[name="DepartmentID"]').val('').selectpicker('refresh');
        //    $thisForm.find('[name="EmployeeType"]').val('').selectpicker('refresh');
        //    $thisForm.find('[name="Employee"]').val('');
        //    $thisForm.find('[name="FK_Employee"]').val('');
        //    $('#TbtnUpdate').css('display', 'none');
        //    $('#TbtnSave').css('display', 'block');

        //    ValidateAddOtherProductservicedetails();


            //$thisForm.validate().resetForm();


    }


    //PickUpdetails
    function fn_ShowPickupdetails(ele, id, ID_CustomerServiceRegisterProductDetails) {

        Cleardelpick(ele);
        $('#TopInfoDetailsPick').show();
        $('#TopInfoDetailsPick2').show();
        //$('#Priority').show();


        $('#pickmodalid').removeClass('modal-lg');
        $('#pickmodalid').addClass('modal-xl');

        var InputData = {
            'FK_Customerserviceregister': id
        }



        $.ajax({

            url: "@Url.Action("GetTicketDetailsByIdNew", "Service")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {


                let $thisForm = $(ele).closest('[perfect-class="form"]');

                //'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                $('[name=Employee]').val(ajaxOutput['Employee']);
                $('[name=FK_Employee]').val(ajaxOutput['FK_Employee']);
                $('[name=CSAVisitdate]').val(moment(ajaxOutput.Model.Visitdate).format('YYYY-MM-DD'));
                $('[name=CSAVisittime]').val(ajaxOutput.Model['Visittime']);
               // $('[name=CSAPriority]').val(ajaxOutput.Model['Priority']);
                $('[name=CSARemarks]').val(ajaxOutput.Model['Remarks']);
                $('[name=ID_CustomerServiceRegisterProductDetailsPick]').val(ID_CustomerServiceRegisterProductDetails);

                console.log("Output >", ajaxOutput)

                if (ajaxOutput.CustomerData != null) {


                    $('#TopInfoDetailsPick').empty();
                    $('[name=FK_Customerserviceregister]').val(id);
                    let cusassign = $('[name=ID_Customerserviceassign]').val(ajaxOutput.Model.ID_Customerserviceassign);
                    $TicketHtml = '';


                    //Ticket Information
                    $TicketHtml += "<div class='col-sm-12'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Ticket Information</h4>";
                    $TicketHtml += "<div class='row  px-3'>";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Ticket <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Ticket + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Customer <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Customer + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Address <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-9'><span>" + ajaxOutput.CustomerData.Data[0].Address + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Land Mark <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Landmark + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Contact No. <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].OtherMobile + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Mobile Number <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Mobile + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";


                    //Service Information
                    $TicketHtml += "<div class='col-sm-12 py-3'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Service Information</h4>";
                    $TicketHtml += "<div class='row  px-3'>";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Requested Date <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromDate + "</span>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromDate + ' ' + " - " + ' ' + ajaxOutput.CustomerData.Data[0].ToDate + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Requested Time <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromTime + "</span>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromTime + ' ' + " - " + ' ' + ajaxOutput.CustomerData.Data[0].ToTime + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";



                    $('#TopInfoDetailsPick').append($TicketHtml);

                    if (ajaxOutput != null) {

                        console.log('product get assigned-->', ajaxOutput.Products);
                        $('#TopInfoDetailsPick2').empty();
                        var ProductData = ajaxOutput.Products;
                        $ProductHtml = '';
                        //if (ProductData.length > 0) {
                        $ProductHtml += "<div class='col-sm-12 '>";
                        $ProductHtml += "<div class='profile-personal-info'>";
                        $ProductHtml += "<h4 class='text-primary mb-4'>Product Details</h4>";
                        $ProductHtml += "<div class='row'>";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Category/Product Name<span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Productname + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Product Complaint <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].ProductComplaint + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Description <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].ProductDescription + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div>";
                        $ProductHtml += "</div>";

                        $('#TopInfoDetailsPick2').append($ProductHtml);
                    }
                    //////////////////////////////////////////
                   // $('#btnUpdateprioritynew').css('display', 'none');
                    //$('#btnUpdatepriority').css('display', 'none');
                   // $('#btnUpdate').css('display', 'block');
                    //$('#btnSave').css('display', 'none');
                    $('.bd-pickup-modal-sm').modal('show');

                    //$('#TbtnUpdate').css('display', 'none');
                   // $('#TbtnSave').css('display', 'block');
                }

                else {

                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': "Error" });
                }


            },
            complete: function () {

                $(ele).prop('disabled', false);
               //('.bd-delivery-modal-sm').validate().resetForm();
                //$thisForm.find('[perfect-tempTable-ComplaintDetails="Employee"]').closest('[perfect-class="formGroup"]').find('temptableError2').text('');
                $('#pickmodalid').on('hidden.bs.modal', function () {
                    $('#pickmodalid form')[0].reset();
                });

            }


            });
    }

    //DeliveryDetails


    function fn_ShowDeliverydetails(ele, id, emp, ID_CustomerServiceRegisterProductDetails) {

        //ClearModalInput();

        //$('.bd-delivery-modal-sm').modal('show');

        $('#TopInfoDetails').show();
        $('#TopInfoDetails2').show();

        $('#Priority').show();

        $('#delmodalid').removeClass('modal-lg');
        $('#delmodalid').addClass('modal-xl');

        $("#emply").val(emp);


        var InputData = {
            'FK_Customerserviceregister': id
        }


        $.ajax({

            url: "@Url.Action("GetTicketDetailsByIdNew", "Service")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {


                let $thisForm = $(ele).closest('[perfect-class="form"]');

                //'FK_Employee': $('[name=FK_EmployeeSearch]').val().trim(),
                $('[name=Employee]').val(ajaxOutput['Employee']);
                $('[name=FK_Employee]').val(ajaxOutput['FK_Employee']);
                $('[name=CSAVisitdate]').val(moment(ajaxOutput.Model.Visitdate).format('YYYY-MM-DD'));
                $('[name=CSAVisittime]').val(ajaxOutput.Model['Visittime']);
                //$('[name=CSAPriority]').val(ajaxOutput.Model['Priority']);
                $('[name=CSARemarks]').val(ajaxOutput.Model['Remarks']);
                $('[name=ID_CustomerServiceRegisterProductDetailsDel]').val(ID_CustomerServiceRegisterProductDetails);

                console.log("Output >", ajaxOutput)

                if (ajaxOutput.CustomerData != null) {


                    $('#TopInfoDetails').empty();
                    $('[name=FK_Customerserviceregister]').val(id);
                    let cusassign = $('[name=ID_Customerserviceassign]').val(ajaxOutput.Model.ID_Customerserviceassign);
                    $TicketHtml = '';


                    //Ticket Information
                    $TicketHtml += "<div class='col-sm-12'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Ticket Information</h4>";
                    $TicketHtml += "<div class='row  px-3'>";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Ticket <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Ticket + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Customer <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Customer + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Address <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-9'><span>" + ajaxOutput.CustomerData.Data[0].Address + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Land Mark <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Landmark + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Contact No. <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].OtherMobile + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Mobile Number <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Mobile + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";


                    //Service Information
                    $TicketHtml += "<div class='col-sm-12 py-3'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Service Information</h4>";
                    $TicketHtml += "<div class='row  px-3'>";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Requested Date <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromDate + "</span>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromDate + ' ' + " - " + ' ' + ajaxOutput.CustomerData.Data[0].ToDate + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Requested Time <span class='pull-right'>:</span></h5>";
                    //$TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromTime + "</span>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromTime + ' ' + " - " + ' ' + ajaxOutput.CustomerData.Data[0].ToTime + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";


                    $('#TopInfoDetails').append($TicketHtml);

                    if (ajaxOutput != null) {

                        console.log('product get assigned-->', ajaxOutput.Products);
                        $('#TopInfoDetails2').empty();
                        var ProductData = ajaxOutput.Products;
                        $ProductHtml = '';
                        //if (ProductData.length > 0) {
                        $ProductHtml += "<div class='col-sm-12 '>";
                        $ProductHtml += "<div class='profile-personal-info'>";
                        $ProductHtml += "<h4 class='text-primary mb-4'>Product Details</h4>";
                        $ProductHtml += "<div class='row'>";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Category/Product Name<span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Productname + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Product Complaint <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].ProductComplaint + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Description <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].ProductDescription + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div>";
                        $ProductHtml += "</div>";

                        $('#TopInfoDetails2').append($ProductHtml);
                    }
                    //////////////////////////////////////////
                   // $('#btnUpdateprioritynew').css('display', 'none');
                    //$('#btnUpdatepriority').css('display', 'none');
                   // $('#btnUpdate').css('display', 'block');
                    //$('#btnSave').css('display', 'none');
                    $('.bd-delivery-modal-sm').modal('show');

                    //$('#TbtnUpdate').css('display', 'none');
                   // $('#TbtnSave').css('display', 'block');
                }

                else {

                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': "Error" });
                }


            },
            complete: function () {

                $(ele).prop('disabled', false);
               //('.bd-delivery-modal-sm').validate().resetForm();
                //$thisForm.find('[perfect-tempTable-ComplaintDetails="Employee"]').closest('[perfect-class="formGroup"]').find('temptableError2').text('');
                $('#delmodalid').on('hidden.bs.modal', function () {
                    $('#delmodalid form')[0].reset();
                });

            }


        });



    }



    function deldatecheck(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let Deliverydate = $thisForm.find('[name="PdAssignedDate"]').val();
        var delDate = new Date(Deliverydate);
        delDate.setHours(0, 0, 0, 0)
        var today = new Date();
        today.setHours(0, 0, 0, 0)

        let errorClass = '.temptableErrors';
        if (delDate >= today) {
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:none");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
        }
        else if (delDate <= today) {
            isValid = false;
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:block");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Delivery Date should be greater than or equal to Todays date');
        }

        $('[name=FK_Employee]').val('0')
        $('[name=Employee]').val('');
        $('[name=EmployeeType]').val('0');
        $('[name=DepartmentID]').val('0');
        $('select[name=EmployeeType]').find(':selected').val('0');
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');
    }


    function pickdatecheck(ele) {
       
        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let Deliverydate = $thisForm.find('[name="PdAssignedDate"]').val();
        var delDate = new Date(Deliverydate);
        delDate.setHours(0, 0, 0, 0)
        var today = new Date();
        today.setHours(0, 0, 0, 0)

        let errorClass6 = '.temptableErrors';
        if (delDate >= today) {
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass6).attr("style", "display:none");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass6).text('');
        }
        else if (delDate <= today) {
            isValid = false;
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass6).attr("style", "display:block");
            $thisForm.find('[name="PdAssignedDate"]').closest('[perfect-class="formGroup"]').find(errorClass6).text('PickUp Date should be greater than or equal to Todays date');
        }

        $('[name=FK_Employee]').val('0')
        $('[name=Employee]').val('');
        $('[name=EmployeeType]').val('0');
        $('[name=DepartmentID]').val('0');
        $('select[name=EmployeeType]').find(':selected').val('0');
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');
    }


/////// Priority updation/////////
function fn_showprioritys(ele) {
        
        ClearModalInput();
    $('#Emptable').css('display', 'none');
    $('.Employeeadd').hide();
    $('.Editassign').show();
    $('.Serviceassign').hide();

    //$('.modal-dialog modal-lg').addClass('modal-dialog modal-xl').removeClass('modal-dialog modal-lg');
    //var el = $('.modal-xl');
    //el.addClass('modal-lg');
    //el.removeClass('modal-xl');

    let row = $(this).closest('tr');

    let Saveddata = row.data('pData');
    console.log("Saved data1", Saveddata);

        var InputData = {
            'FK_Customerserviceregister': Saveddata.ID_CustomerServiceRegister
        }

        $.ajax({
            url: "@Url.Action("GetTicketDetailsByIdNew", "Service")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
               //let $thisForm = $(this).find('[perfect-class="form"]');
                //$thisForm.validate({ messages: validationMessage });
                 let $thisForm = $(ele).closest('[perfect-class="form"]');
                 //$thisForm.validate().resetForm();
                    ////debugger
                //$('[name=Employee]').val(ajaxOutput['Employee']);
                //$('[name=FK_Employee]').val(ajaxOutput['FK_Employee']);
                $('[name=CSAVisitdate]').val(moment(ajaxOutput.Model.Visitdate).format('YYYY-MM-DD'));
                $('[name=CSAVisittime]').val(ajaxOutput.Model['Visittime']);
                $('[name=CSAPriority]').val(ajaxOutput.Model['Priority']);
                $('[name=CSARemarks]').val(ajaxOutput.Model['Remarks']);

                console.log("Output >", ajaxOutput)

                if (ajaxOutput.CustomerData != null) {
                   // //debugger
                    $('#TopDetails').empty();
                    $('[name=FK_Customerserviceregister]').val(Saveddata.ID_CustomerServiceRegister);
                    let cusassign = $('[name=ID_Customerserviceassign]').val(ajaxOutput.Model.ID_Customerserviceassign);
                    $TicketHtml = '';


                    //Ticket Information
                    $TicketHtml += "<div class='col-sm-12'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Ticket Information</h4>";
                    $TicketHtml += "<div class='row'>";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Ticket <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Ticket + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Customer <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Customer + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-5'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Address <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-9'><span>" + ajaxOutput.CustomerData.Data[0].Address + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Land Mark <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Landmark + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Mobile <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Mobile + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Phone <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].OtherMobile + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";


                    //Service Information
                    $TicketHtml += "<div class='col-sm-12 py-3'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Service Information</h4>";
                    $TicketHtml += "<div class='row  px-3'>";

                    $TicketHtml += "<div class='col-sm-4'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Visit Date <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromDate + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='col-sm-3'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Visit Time <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].FromTime + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";

                    $('#TopDetails').append($TicketHtml);
                    ////debugger
                    if (ajaxOutput != null) {
                        console.log('product get assigned-->', ajaxOutput.Products);
                        $('#TopDetails2').empty();
                        var ProductData = ajaxOutput.Products;
                        $ProductHtml = '';

                        $ProductHtml += "<div class='col-sm-12 '>";
                        $ProductHtml += "<div class='profile-personal-info'>";
                        $ProductHtml += "<h4 class='text-primary mb-4'>Product Details</h4>";
                        $ProductHtml += "<div class='row'>";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Category/Product Name<span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Productname + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Product Complaint <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].ProductComplaint + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='col-sm-4'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<div class='col-6'>";
                        $ProductHtml += "<h5 class='f-w-500'>Description <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "</div >";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].ProductDescription + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div>";
                        $ProductHtml += "</div>";


                        $('#TopDetails2').append($ProductHtml);
                    }
                    //////////////////////////////////////////
                    //$('#EmployeeAdd').css('display', 'block');
                    $('#btnUpdatepriority').css('display', 'block');
                    $('#btnUpdate').css('display', 'none');
                    $('#btnSave').css('display', 'none');
                    $('.bd-service-modal-sm').modal('show');

                    $('#TbtnUpdate').css('display', 'none');
                    $('#TbtnSave').css('display', 'block');
                }

                else {

                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': "Error" });


                }

            },
            complete: function () {
                $(ele).prop('disabled', false);
                $('.bd-service-modal-sm').validate().resetForm();
            }
        });

    }

    function fn_showpriority(ele) {
         ////debugger
        ClearModalInput();
    $('#Emptable').css('display', 'none');
    $('.Employeeadd').hide();
    $('.Editassign').show();
        $('.Serviceassign').hide();
        $('#TopDetail').show();
        $('#TopDetail2').show();
        $('#TopDetails').hide();
        $('#TopDetails2').hide();

        $('#Visitdate').show();
        $('#Visittime').show();
        $('#Remarks').show();
        $('#status').show();
        $('#Attendedby').show();
        $('#Priority').show();

        $('.bd-service-modal-sm').validate().resetForm();

        $('#modalid').removeClass('modal-xl');
        $('#modalid').addClass('modal-lg');

    let row = $(this).closest('tr');

    let Saveddata = row.data('pData');
    console.log("Saved data1", Saveddata);

        var InputData = {
            'FK_Customerserviceregister': Saveddata.ID_CustomerServiceRegister
        }

        $.ajax({
            url: "@Url.Action("GetTicketDetailsByIdNew", "Service")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
               //let $thisForm = $(this).find('[perfect-class="form"]');
                //$thisForm.validate({ messages: validationMessage });
                 let $thisForm = $(ele).closest('[perfect-class="form"]');
                 //$thisForm.validate().resetForm();
                   // //debugger
                //$('[name=Employee]').val(ajaxOutput['Employee']);
                //$('[name=FK_Employee]').val(ajaxOutput['FK_Employee']);
                $('[name=CSAVisitdate]').val(moment(ajaxOutput.Model.Visitdate).format('YYYY-MM-DD'));
                $('[name=CSAVisittime]').val(ajaxOutput.Model['Visittime']);
                $('[name=CSAPriority]').val(ajaxOutput.Model['Priority']);
                $('[name=CSARemarks]').val(ajaxOutput.Model['Remarks']);

                console.log("Output >", ajaxOutput)

                if (ajaxOutput.CustomerData != null) {
                  //  //debugger
                    $('#TopDetail').empty();
                    $('[name=FK_Customerserviceregister]').val(Saveddata.ID_CustomerServiceRegister);
                    let cusassign = $('[name=ID_Customerserviceassign]').val(ajaxOutput.Model.ID_Customerserviceassign);
                    $TicketHtml = '';


                    //Ticket Information
                    $TicketHtml += "<div class='col-sm-6'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Ticket Information</h4>";
                    $TicketHtml += "<div class='row '>";

                    $TicketHtml += "<div class='col-sm-9'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Ticket <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Ticket + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='row '>";
                    $TicketHtml += "<div class='col-sm-9'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Customer <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Customer + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";




                    $('#TopDetail').append($TicketHtml);
                   // //debugger
                    if (ajaxOutput != null) {
                        console.log('product get assigned-->', ajaxOutput.Products);
                        //$('#TopDetail').empty();
                        var ProductData = ajaxOutput.Products;
                        $ProductHtml = '';


                        $ProductHtml += "<div class='col-sm-6'>";
                        $ProductHtml += "<div class='profile-personal-info'>";
                        $ProductHtml += "<h4 class='text-primary mb-4'>Product Details</h4>";
                        $ProductHtml += "<div class='row '>";

                        $ProductHtml += "<div class='col-sm-12'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<h5 class='f-w-500'>Category/Poduct Name <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].Productname + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='row  '>";
                        $ProductHtml += "<div class='col-sm-12'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<h5 class='f-w-500'>Complaint <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.CustomerData.Data[0].ProductComplaint + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div>";
                        $ProductHtml += "</div>";


                        $('#TopDetail').append($ProductHtml);
                    }
                    //////////////////////////////////////////
                    //$('#EmployeeAdd').css('display', 'block');
                    $('#btnUpdateprioritynew').css('display', 'none');
                    $('#btnUpdatepriority').css('display', 'block');
                    $('#btnUpdate').css('display', 'none');
                    $('#btnSave').css('display', 'none');
                    $('.bd-service-modal-sm').modal('show');

                    $('#TbtnUpdate').css('display', 'none');
                    $('#TbtnSave').css('display', 'block');
                }

                else {

                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': "Error" });


                }

            },
            complete: function () {
                $(ele).prop('disabled', false);
                $('.bd-service-modal-sm').validate().resetForm();
                $('#modalid').on('hidden.bs.modal', function () {
                    $('#modalid form')[0].reset();
                });

            }
        });

    }

function fn_showprioritynewtab(ele) {
////debugger
    ClearModalInput();
    var $thisForm = $(ele).closest('[perfect-class="form"]');
    $('#Emptable').css('display', 'none');
    $('.Employeeadd').hide();
    $('.Editassign').show();
    $('.Serviceassign').hide();
    $('#TopDetail').show();
    $('#TopDetail2').show();
    $('#TopDetails').hide();
    $('#TopDetails2').hide();

    $('#Visitdate').hide();
    $('#Visittime').hide();
    $('#Remarks').hide();
    $('#status').show();
    $('#Attendedby').show();
    $('#Priority').hide();


    $('#modalid').removeClass('modal-xl');
    $('#modalid').addClass('modal-lg');
    let row = $(this).closest('tr');

    let Saveddata = row.data('pData');
    console.log("Saved data1", Saveddata);

        var InputData = {
            'FK_Customerserviceregister': Saveddata.ID_CustomerServiceRegister/* $(ele).attr('data-id') */
        }
         //let Saveddata = row.data('pData');
        //console.log("Saved data", Saveddata);
        $.ajax({
            url: "@Url.Action("GetTicketDetailsNew", "Service")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
                ////debugger
                $('[name=FK_Customerserviceregister]').val(Saveddata.ID_CustomerServiceRegister);
                let cusassign = $('[name=ID_Customerserviceassign]').val(ajaxOutput.ID_Customerserviceassign);
                $TicketHtml = '';
                if (ajaxOutput != null) {
                    $('[name=CSAPriority]').val(ajaxOutput['Priority']);
                    $('#TopDetail').empty();
                    //Ticket Information

                    $TicketHtml += "<div class='col-sm-6'>";
                    $TicketHtml += "<div class='profile-personal-info'>";
                    $TicketHtml += "<h4 class='text-primary mb-4'>Ticket Information</h4>";
                    $TicketHtml += "<div class='row '>";

                    $TicketHtml += "<div class='col-sm-9'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Ticket <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput['Ticket'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<div class='col-sm-9'>";
                    $TicketHtml += "<div class='info'>";
                    $TicketHtml += "<div class='row'>";
                    $TicketHtml += "<h5 class='f-w-500'>Customer <span class='pull-right'>:</span></h5>";
                    $TicketHtml += "<div class='col-6'><span>" + ajaxOutput['Customer'] + "</span>";
                    $TicketHtml += "</div ></div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";

                    $TicketHtml += "</div >";
                    $TicketHtml += "</div >";
                    $TicketHtml += "</div>";
                    $TicketHtml += "</div>";



                    let Saveddatanews = ajaxOutput;

                    $('#TopDetail').append($TicketHtml);
                    //debugger
                    if (ajaxOutput!= null) {
                        console.log('product get ticket-->', ajaxOutput);

                        var ProductData = ajaxOutput;
                        $ProductHtml = '';
                        //if (ProductData.length > 0) {

                        $ProductHtml += "<div class='col-sm-6'>";
                        $ProductHtml += "<div class='profile-personal-info'>";
                        $ProductHtml += "<h4 class='text-primary mb-4'>Product Details</h4>";
                        $ProductHtml += "<div class='row '>";

                        $ProductHtml += "<div class='col-sm-12'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<h5 class='f-w-500'>Category/Product Name<span class='pull-right'>:</span></h5>";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.Productname + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "<div class='row '>";
                        $ProductHtml += "<div class='col-sm-12'>";
                        $ProductHtml += "<div class='info'>";
                        $ProductHtml += "<div class='row'>";
                        $ProductHtml += "<h5 class='f-w-500'>Complaint <span class='pull-right'>:</span></h5>";
                        $ProductHtml += "<div class='col-6'><span>" + ajaxOutput.ProductComplaint + "</span>";
                        $ProductHtml += "</div ></div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";

                        $ProductHtml += "</div >";
                        $ProductHtml += "</div >";
                        $ProductHtml += "</div>";
                        $ProductHtml += "</div>";

                        $('#TopDetail').append($ProductHtml);
                    }

                    $('#btnUpdateprioritynew').css('display', 'block');
                    $('#btnUpdatepriority').css('display', 'none');
                    $('#btnUpdate').css('display', 'none');
                    $('#btnSave').css('display', 'none');
                    $('.bd-service-modal-sm').modal('show');

                    $('#TbtnUpdate').css('display', 'none');
                    $('#TbtnSave').css('display', 'none');
                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
                $('.bd-service-modal-sm').validate().resetForm();
                var v = $thisForm.find('[name="NextAction"]').val();
                if (v == null || v == '' || v == 0) { document.getElementById("btnUpdateprioritynew").disabled = true; }
                else { document.getElementById("btnUpdateprioritynew").disabled = false; }
            }
        });

    }
///////////////


    ////////////////////////////////////////////////

    function showSearchModal(ele) {
         let $thisForm = $(ele).closest('[perfect-class="form-Assign"]');

        let $model = $(ele).closest('[perfect-class="formGroup"]').find('[perfect-class="formGroupModal"]');
        $(ele).closest('[perfect-class="formGroup"]').find('[perfect-class="formGroupModal"]').modal('show');

        $.ajax({
            url: '@Url.Action("GetEmployee", "Service")',
            type: "Get",
            headers: { "token_key": "1234" },
            //data: { branchID: id },
            dataType: "json",
            contentType: "application/json",
            success: function (successData) {
                console.log('> Search button click success', successData);

                if (successData.Process.IsProcess) {
                    var sss = createSelectListWithSearch({ data: successData.Data, element: $model, onlyShowColumn: ["EmployeeCode", "EmployeeName"] });
                    sss.then(function (ret) {
                        if (ret) {
                            //console.log('>_ Search button > list click', ret);
                            //console.log("Customer>", );

                            $.ajax({
                                url: '@Url.Action("GetEmployeeInfo", "Service")',
                                type: "Get",
                                headers: { "token_key": "1234" },
                                data: { FK_Employee: ret.ID_Employee },
                                dataType: "json",
                                contentType: "application/json",
                                success: function (EmployeeData) {
                                    if (EmployeeData.Process.IsProcess) {

                                        $(ele).closest('[perfect-class="formGroup"]').find('[perfect-class="formGroupModal"]').modal('hide');

                                        $thisForm.find('[name=FK_Employee]').val(EmployeeData.Data[0].ID_Employee);
                                        $thisForm.find('[name=Employee]').val(EmployeeData.Data[0].EmployeeName);


                                    }
                                },
                                error: function (EmployeeData) {

                                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': "Error selecting customer" });
                                }


                            });


                        }
                        else {
                            console.log(ret);
                        }
                    });

                }
                else {
                    $.each(successData.Process.Message, function (key, value) {
                        //toastr.warning(value, "Error");
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }
            },
            complete: function () {

                //a.find('.dataTables_wrapper').css('width', '100%');
            }
        });
    }

    function ClearModalInput(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $('[name=Employee]').val('');
        $('[name=FK_Employee]').val('');
        $('[name=CSAVisitdate]').val('');
        $('[name=CSAVisittime]').val('');
        $('[name=CSAPriority]').val('3');
        $('[name=CSARemarks]').val('');
        $('[name=ID_CustomerServiceRegisterProductDetails]').val('');
        $('[name=DepartmentID]').val('0');
        $('[name=Employee]').val('');
        $('[name=EmployeeType]').val('0');
        $('[name=NextAction]').val('');
        $('[name=FK_Attendedby]').val('0');
        $('[name=AttendedBy]').val('');
        $('[name=PdAssignedDate]').val('');
        $('[name=PdAssignedTime]').val('');
        $('[name=PdVehicleDetails]').val('');
        //$('[perfect-tempTable-cstatus]').val('');
        //$('[perfect-tempTable="ComplaintDetails"]').html('');
        $("#ComplaintDetailstbody tr").remove();



    }
    function ConvertJsonDate(Jsondate) {
        var date = "";
        if (Jsondate != "" && Jsondate != null && Jsondate != undefined) {
            var dateString = Jsondate.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            if (month <= 9) {
                month = "0" + month;
            }
            var day = currentTime.getDate();
            if (day <= 9) {
                day = "0" + day;
            }
            var year = currentTime.getFullYear();
            date = day + "-" + month + "-" + year;


        }
        return date;
    }

        //Save  service assign details
    function fn_SaveCustomerServiceAssign(ele,id) {
       // //debugger

        //let Saveddata = Saveddatanews;
        //console.log("Saved data new", Saveddata);

        let $thisForm = $(ele).closest('[perfect-class="form"]');

        if ($('#Visitdate').is(":visible") && $('#Visittime').is(":visible")) {
            $('[name="CSAVisitdate"]').addClass('perfectValidate_date');

        }

        let Empdatas = [];
        $thisForm.find('[perfect-tempTable="ComplaintDetails"]').find('tbody').find('tr').each(function () {
            let tr = $(this);
            let Employeedata = {
                FK_Employee: tr.find("td:eq(1)").text().trim(), EmployeeType: tr.find("td:eq(4)").text().trim()
            }
            Empdatas.push(Employeedata);
        })
        ////debugger
        console.log('is valid-->', $thisForm.valid())
        var isValid = true;
        if ($thisForm.valid()) {

            let Visitdate = $thisForm.find('[name="CSAVisitdate"]').val();
            var enqDate = new Date(Visitdate);
            enqDate.setHours(0, 0, 0, 0)
            var today = new Date();
            today.setHours(0, 0, 0, 0)

            let errorClass = '.temptableErrors';
            if (enqDate >= today) {

                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:none");
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
            }
            else if (enqDate <= today) {
                isValid = false;
                console.log('false');
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:block");
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Visit Date should be greater than or equal to Todays date');

            }
            if (isValid) {
                var rowcount = document.getElementById('ComplaintDetailstbody').rows.length;
                if (Empdatas.length != 0 && rowcount != 0) {
                    let $thisForm = $(ele).closest('[perfect-class="form"]');

                    $(ele).prop('disabled', true);
                    //console.log("prevData >", Employeedata)

                    //let row = $(this).closest('tr');
                    //let Saveddata = $thisForm.data('pData');
                    console.log('SAV----->', id);
                    var inputData =
                    {
                        'ID_CustomerServiceAssign': $('[name=ID_Customerserviceassign]').val(),
                        '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                        'FK_Customerserviceregister': $thisForm.find('[name=FK_Customerserviceregister]').val().trim(),
                        //'FK_Employee': $thisForm.find('[name=FK_Employee]').val().trim(),
                        'CSAVisitdate': $thisForm.find('[name=CSAVisitdate]').val().trim(),
                        'CSAVisittime': $thisForm.find('[name=CSAVisittime]').val().trim(),
                        'CSAPriority': $thisForm.find('[name=CSAPriority]').val().trim(),
                        'CSARemarks': $thisForm.find('[name=CSARemarks]').val().trim(),
                        'TransMode': /*ServiceassignTransMode*/"",
                        'Assignees': Empdatas,
                        'ID_CustomerServiceRegisterProductDetails': $('[name=ID_CustomerServiceRegisterProductDetails]').val(),
                    }
                    console.log("inputdatas >", inputData)
                    $.ajax({
                        url: "@Url.Action("AddCustomerserviceAssignnew","Service")",
                        type: "POST",
                        data: inputData,
                        dataType: "json",
                        contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                        success: function (ajaxOutput) {
                           // //debugger
                            if (ajaxOutput.Process.IsProcess) {
                                $.each(ajaxOutput.Process.Message, function (key, value) {
                                    NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': value });
                                });
                                // Get the value set in form's perfect-onFormSuccess attribute
                                let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                                //if (onSuccess) {
                                //    window[onSuccess]();
                                //}
                            }
                            else {
                                $.each(ajaxOutput.Process.Message, function (key, value) {
                                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                                });
                            }
                            fn_LeadManagement_search(this, 2, '#test1', tableOptions);
                        },
                        complete: function () {
                            //fn_LeadManagement_search(this, 2, '#test1', tableOptions2);
                            $(ele).prop('disabled', false);
                            $('.bd-service-modal-sm').modal('hide');
                            //Searchtableresult(this);
                        }
                    });
                }
                else {
                    let $modal = createSearchModalDOM();

                    let $message = '<span>Add Atleast One Employee Details</span>';
                    $modal.modal.find('.modal-body')
                        .addClass('text-black')
                        .html($message);
                    $modal.modal.find('.modal-title')
                        .addClass('text-primary')
                        .text('Message');

                    $modal.modal.show();
                }
            }
        }
    }

    function fn_UpdateCustomerServiceAssignnew(ele, id) {
        var mode;
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($('#Visitdate').is(":visible") && $('#Visittime').is(":visible")) {
            $('[name="CSAVisitdate"]').addClass('perfectValidate_date');
            $('[name="CSAVisittime"]').addClass('perfectValidate_time');
        }

        if ($('#TbtnUpdate').is(":visible") && $('#TbtnSave').is(":hidden")) {
            mode = 2;
        }
        else
        {
            mode = 3;
        }
        let Empdatas = [];
        $thisForm.find('[perfect-tempTable="ComplaintDetails"]').find('tbody').find('tr').each(function () {
            let tr = $(this);
            let Employeedata = {
                FK_Employee: tr.find("td:eq(1)").text().trim(),EmployeeType: tr.find("td:eq(4)").text().trim()
            }
            Empdatas.push(Employeedata);
        })

       // //debugger
        var rowcount = document.getElementById('ComplaintDetailstbody').rows.length;
        //let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.valid()) {

            let Visitdate = $thisForm.find('[name="CSAVisitdate"]').val();
            var enqDate = new Date(Visitdate);
            enqDate.setHours(0, 0, 0, 0)
            var today = new Date();
            today.setHours(0, 0, 0, 0)


            let errorClass = '.temptableErrors';
            if (enqDate >= today) {

                isValid = true;
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:none");
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
            }
            else {
                isValid = false;
                console.log('false');
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:block");
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Visit Date should be greater than or equal to Todays date');

            }
            if (isValid) {
                if (Empdatas.length != 0 && rowcount != 0) {
                    $(ele).prop('disabled', true);


                    var inputData =
                    {
                        'ID_Customerserviceassign': $('[name=ID_Customerserviceassign]').val(),
                        '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                        'FK_Customerserviceregister': $thisForm.find('[name=FK_Customerserviceregister]').val().trim(),
                        //'FK_Employee': $thisForm.find('[name=FK_Employee]').val().trim(),
                        'CSAVisitdate': $thisForm.find('[name=CSAVisitdate]').val().trim(),
                        'CSAVisittime': $thisForm.find('[name=CSAVisittime]').val().trim(),
                        'CSAPriority': $thisForm.find('[name=CSAPriority]').val().trim(),
                        'CSARemarks': $thisForm.find('[name=CSARemarks]').val().trim(),
                        'Assignees': Empdatas,
                        'ID_CustomerServiceRegisterProductDetails': $('[name=ID_CustomerServiceRegisterProductDetails]').val(),
                    }

                    $.ajax({
                        url: "@Url.Action("UpdateCustomerserviceAssignNew", "Service")",
                        type: "POST",
                        data: inputData,
                        dataType: "json",
                        contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                        success: function (ajaxOutput) {
                            if (ajaxOutput.Process.IsProcess) {
                                $.each(ajaxOutput.Process.Message, function (key, value) {
                                    NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': 'Updated Successfully' });
                                });
                                // Get the value set in form's perfect-onFormSuccess attribute
                                let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                                //if (onSuccess) {
                                //    window[onSuccess]();
                                //}
                            }
                            else {
                                $.each(ajaxOutput.Process.Message, function (key, value) {
                                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                                });
                            }
                            if (mode = 8) { fn_LeadManagement_search(this, mode, '#test7', tableOptions2); }
                            if (mode = 7) { fn_LeadManagement_search(this, mode, '#test6', tableOptions2); }
                            if (mode = 6) { fn_LeadManagement_search(this, mode, '#test5', tableOptions2); }
                            if (mode = 5) { fn_LeadManagement_search(this, mode, '#test4', tableOptions2); }
                            if (mode = 4) { fn_LeadManagement_search(this, mode, '#test3', tableOptions2); }
                            if (mode = 3) { fn_LeadManagement_search(this, mode, '#test2', tableOptions2); }
                            if (mode = 2) { fn_LeadManagement_search(this, mode, '#test1', tableOptions); }
                            //fn_LeadManagement_search(this, 3, '#test2', tableOptions);
                        },
                        complete: function () {
                            //fn_LeadManagement_search(this, 3, '#test2', tableOptions);
                            $(ele).prop('disabled', false);
                            $('.bd-service-modal-sm').modal('hide');
                            Searchtableresult(this);
                        }
                    });
                }
                else {
                    let $modal = createSearchModalDOM();

                    let $message = '<span>Add Atleast One Employee Details</span>';
                    $modal.modal.find('.modal-body')
                        .addClass('text-black')
                        .html($message);
                    $modal.modal.find('.modal-title')
                        .addClass('text-primary')
                        .text('Message');

                    $modal.modal.show();
                }
            }
        }
    }


    function fn_UpdateDeliveryAssign(ele, id) {
        ////debugger;
        //let Searchtableresult(ele);
        var mode;
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($('#Deliverydate').is(":visible") && $('#Deliverytime').is(":visible")) {
            $('[name="PdAssignedDate"]').addClass('perfectValidate_date');
            $('[name="PdAssignedTime"]').addClass('perfectValidate_time');
        }
        if ($('#TbtnUpdate').is(":visible") && $('#TbtnSave').is(":hidden")) {
            mode = 2;
        }
        else {
            mode = 3;
        }
        //if ($thisForm.valid()) {


            let deDate = $thisForm.find('[name="PdAssignedDate"]').val();
            let detime = $thisForm.find('[name="PdAssignedTime"]').val();
            let prio = $thisForm.find('[name="CSAPriority"]').val();
        let employee = $thisForm.find('[name="Employee"]').val();


        if (deDate == '') {
            document.getElementById("dit").style.display = "block";
            document.getElementById('dit').innerHTML = "Please select date";
            setTimeout(() => {
                document.getElementById('dit').style.display = 'none'

            }, 6000);
            isValid = false;
        }


        else if (prio == '') {
            document.getElementById("deprio").style.display = "block";
            document.getElementById('deprio').innerHTML = "Please select Priority";
            setTimeout(() => {
                document.getElementById('deprio').style.display = 'none'

            }, 6000);
            isValid = false;
        }
        else if (employee == '') {
            document.getElementById("empdel").style.display = "block";
            document.getElementById('empdel').innerHTML = "Please select Employee";
            setTimeout(() => {
                document.getElementById('empdel').style.display = 'none'

            }, 8000);
            isValid = false;
        }
        else {
            isValid = true;
        }


            if (isValid) {

                var inputData =
                {
                    'ID_Customerserviceassign': $('[name=ID_Customerserviceassign]').val(),
                    '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                    'FK_Customerserviceregister': $thisForm.find('[name=FK_Customerserviceregister]').val().trim(),
                    'FK_Employee': $thisForm.find('[name=FK_Employee]').val().trim(),
                    'CSAVisitdate': $thisForm.find('[name=PdAssignedDate]').val().trim(),
                    'CSAVisittime': $thisForm.find('[name=PdAssignedTime]').val().trim(),
                    'CSAPriority': $thisForm.find('[name=CSAPriority]').val().trim(),
                    'CSARemarks': $thisForm.find('[name=PdVehicleDetails]').val().trim(),
                    'ID_CustomerServiceRegisterProductDetails': $('[name=ID_CustomerServiceRegisterProductDetailsDel]').val(),
                }

                $.ajax({
                    url: "@Url.Action("UpdateCustomerserviceDeliveryAssign", "Service")",
                    type: "POST",
                    data: inputData,
                    dataType: "json",
                    contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                    success: function (ajaxOutput) {

                        if (ajaxOutput.Process.IsProcess) {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': 'Updated Successfully' });
                            });

                            let onSuccess = $thisForm.attr('perfect-onFormSuccess')
                        }
                        else {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                            });
                        }
                        if (mode = 8) { fn_LeadManagement_search(this, mode, '#test7', tableOptions2); }
                        if (mode = 7) { fn_LeadManagement_search(this, mode, '#test6', tableOptions2); }
                        if (mode = 6) { fn_LeadManagement_search(this, mode, '#test5', tableOptions2); }
                        if (mode = 5) { fn_LeadManagement_search(this, mode, '#test4', tableOptions2); }
                        if (mode = 4) { fn_LeadManagement_search(this, mode, '#test3', tableOptions2); }
                        if (mode = 3) { fn_LeadManagement_search(this, mode, '#test2', tableOptions2); }
                        if (mode = 2) { fn_LeadManagement_search(this, mode, '#test1', tableOptions); }

                    },

                    complete: function () {
                        $(ele).prop('disabled', false);
                        $('.bd-delivery-modal-sm').modal('hide');
                        //Searchtableresult(this);
                    }
                });
            }


        //}
        //else {
        //    $(ele).prop('disabled', false);
        //}


    }




    function fn_UpdatePickupAssign(ele, id) {


       // //debugger;
       // Cleardelpick();
        var mode;





        //let errorClass9 = '.temptableError';
        //let isValid = true;

        let $thisForm = $(ele).closest('[perfect-class="form"]');

        if ($('#pdate').is(":visible") && $('#PickUptime').is(":visible")) {
            $('[name="PdAssignedDate"]').addClass('perfectValidate_date');
            $('[name="PdAssignedTime"]').addClass('perfectValidate_time');
        }
        if ($('#TbtnUpdate').is(":visible") && $('#TbtnSave').is(":hidden")) {
            mode = 2;
        }
        else {
            mode = 3;
        }
        //if ($thisForm.valid()) {

            let employee = $thisForm.find('[name="FK_Employee"]').val();

        let piDate = $thisForm.find('[name="PdAssignedDate"]').val();
        let pitime = $thisForm.find('[name="PdAssignedTime"]').val();
        let pprio = $thisForm.find('[name="CSAPriority"]').val();
        let Pemployee = $thisForm.find('[name="Employee"]').val();


        if (piDate == '') {
            document.getElementById("picd").style.display = "block";
            document.getElementById('picd').innerHTML = "Please select date";
            setTimeout(() => {
                document.getElementById('picd').style.display = 'none'

            }, 6000);
            isValid = false;
        }

        else if (pprio == '') {
            document.getElementById("pprio").style.display = "block";
            document.getElementById('pprio').innerHTML = "Please select Priority";
            setTimeout(() => {
                document.getElementById('pprio').style.display = 'none'

            }, 6000);
            isValid = false;
        }

        else if (Pemployee == '') {
            document.getElementById("pemp").style.display = "block";
            document.getElementById('pemp').innerHTML = "Please select Employee";
            setTimeout(() => {
                document.getElementById('pemp').style.display = 'none'

            }, 8000);
            isValid = false;
        }
        else {
            isValid = true;
        }


            if (isValid) {

                var inputData =
                {
                    'ID_Customerserviceassign': $('[name=ID_Customerserviceassign]').val(),
                    '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                    'FK_Customerserviceregister': $thisForm.find('[name=FK_Customerserviceregister]').val().trim(),
                    'FK_Employee': $thisForm.find('[name=FK_Employee]').val().trim(),
                    'CSAVisitdate': $thisForm.find('[name=PdAssignedDate]').val().trim(),
                    'CSAVisittime': $thisForm.find('[name=PdAssignedTime]').val().trim(),
                    'CSAPriority': $thisForm.find('[name=CSAPriority]').val().trim(),
                    'CSARemarks': $thisForm.find('[name=PdVehicleDetails]').val().trim(),
                    'ID_CustomerServiceRegisterProductDetails': $('[name=ID_CustomerServiceRegisterProductDetailsPick]').val(),
                }

                $.ajax({
                    url: "@Url.Action("UpdateCustomerserviceDeliveryAssign", "Service")",
                    type: "POST",
                    data: inputData,
                    dataType: "json",
                    contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                    success: function (ajaxOutput) {

                        if (ajaxOutput.Process.IsProcess) {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': 'Updated Successfully' });
                            });

                            let onSuccess = $thisForm.attr('perfect-onFormSuccess')
                        }
                        else {
                            $.each(ajaxOutput.Process.Message, function (key, value) {
                                NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                            });
                        }
                        if (mode = 8) { fn_LeadManagement_search(this, mode, '#test7', tableOptions2); }
                        if (mode = 7) { fn_LeadManagement_search(this, mode, '#test6', tableOptions2); }
                        if (mode = 6) { fn_LeadManagement_search(this, mode, '#test5', tableOptions2); }
                        if (mode = 5) { fn_LeadManagement_search(this, mode, '#test4', tableOptions2); }
                        if (mode = 4) { fn_LeadManagement_search(this, mode, '#test3', tableOptions2); }
                        if (mode = 3) { fn_LeadManagement_search(this, mode, '#test2', tableOptions2); }
                        if (mode = 2) { fn_LeadManagement_search(this, mode, '#test1', tableOptions); }

                    },

                    complete: function () {
                        $(ele).prop('disabled', false);
                        $('.bd-pickup-modal-sm').modal('hide');
                        //Searchtableresult(this);
                    }
                });
            }


        //}




    }



    function fn_Priority_UpdateCustomerServiceAssign(ele, id) {
        var Visitdate;
        var mode;
        var serviceassign;
        let gridname;
        let table;
        let row = $(this).closest('tr');
        let Saveddata = row.data('pData');
        console.log("Saved data5", Saveddata);
        //let $thisForm = $(ele).closest('[perfect-class="form"]');
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($('#Visitdate').is(":hidden") && $('#Visittime').is(":hidden")) {
            $('[name="CSAVisitdate"]').removeClass('perfectValidate_date');
            $('[name="CSAVisittime"]').removeClass('perfectValidate_time');
            Visitdate = $('[name="CSAVisitdate"]').val(moment().format('YYYY-MM-DD'));
            mode = 2;
            gridname = '#test2';
            table = tableOptions;
        }
        else {
            $('[name="CSAVisitdate"]').addClass('perfectValidate_date');
            $('[name="CSAVisittime"]').addClass('perfectValidate_time');
            Visitdate = $('[name="CSAVisitdate"]').val();
            mode = 3;
            gridname = '#test3';
            table = tableOptions2;
        }
       // //debugger

        var validemp=0;
       // //debugger
        let nextaction = $('[name=NextAction]').val();
        let attendedby = $('[name=AttendedBy]').val();
        console.log('NEXTACTION>', nextaction);
        let errorClass = '.empError';
        if (nextaction != 0/* && $('[name=AttendedBy]').val() == '' && $('[name=FK_Attendedby]').val() == null*/) {
            validemp = 1;
            $('[name="AttendedBy"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:block");
            $('[name=AttendedBy]').closest('[perfect-class="formGroup"]').find(errorClass).text('Please select Attended By');
        }
        else {
            validemp = 0;
            $('[name="AttendedBy"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:none");
            $('[name=AttendedBy]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
        }
        if (attendedby == '' && nextaction!=0/* && $('[name=AttendedBy]').val() == '' && $('[name=FK_Attendedby]').val() == null*/) {
            validemp = 1;
            $('[name="AttendedBy"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:block");
            $('[name=AttendedBy]').closest('[perfect-class="formGroup"]').find(errorClass).text('Please select Attended By');
        }
        else {
            validemp = 0;
            $('[name="AttendedBy"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:none");
            $('[name=AttendedBy]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
        }


        var rowcount = document.getElementById('ComplaintDetailstbody').rows.length;
        //let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.valid() && validemp == 0) {

            let Visitdate = $thisForm.find('[name="CSAVisitdate"]').val();
            var enqDate = new Date(Visitdate);
            enqDate.setHours(0, 0, 0, 0)
            var today = new Date();
            today.setHours(0, 0, 0, 0)

            let errorClass = '.temptableErrors';
            if (enqDate >= today) {

                isValid = true;
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:none");
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
            }
            else {
                isValid = false;
                console.log('false');
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).attr("style", "display:block");
                $thisForm.find('[name="CSAVisitdate"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Visit Date should be greater than or equal to Todays date');
            }

            if ($('#Visitdate').is(":hidden") && $('#Visittime').is(":hidden")) {
                $('[name="CSAVisitdate"]').removeClass('perfectValidate_date');
                $('[name="CSAVisittime"]').removeClass('perfectValidate_time');
                isValid = true;
            }
            else {
                $('[name="CSAVisitdate"]').addClass('perfectValidate_date');
                $('[name="CSAVisittime"]').addClass('perfectValidate_time');

            }
            if (isValid) {

                    $(ele).prop('disabled', true);


                    var inputData =
                    {
                        'ID_Customerserviceassign': $thisForm.find('[name=ID_Customerserviceassign]').val().trim(),
                        '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                        'FK_Customerserviceregister': $thisForm.find('[name=FK_Customerserviceregister]').val().trim(),
                        //'FK_Employee': $thisForm.find('[name=FK_Employee]').val().trim(),
                        'CSAVisitdate': Visitdate,
                        'CSAVisittime': $thisForm.find('[name=CSAVisittime]').val().trim(),
                        'CSAPriority': $thisForm.find('[name=CSAPriority]').val().trim(),
                        'CSARemarks': $thisForm.find('[name=CSARemarks]').val().trim(),
                        'Status': $thisForm.find('[name=NextAction]').val().trim(),
                        'FK_Attendedby': $thisForm.find('[name=FK_Attendedby]').val().trim(),
                        'ID_CustomerServiceRegisterProductDetails': $('[name=ID_CustomerServiceRegisterProductDetails]').val(),

                    }
                console.log('CHECK THE DATA>', inputData)
                    $.ajax({
                        url: "@Url.Action("UpdateCustomerserviceAssignPriority", "Service")",
                        type: "POST",
                        data: inputData,
                        dataType: "json",
                        contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                        success: function (ajaxOutput) {

                            if (ajaxOutput.Process.IsProcess) {
                                $.each(ajaxOutput.Process.Message, function (key, value) {
                                    NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': value });
                                });
                                // Get the value set in form's perfect-onFormSuccess attribute
                                let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                                //if (onSuccess) {
                                //    window[onSuccess]();
                                //}
                                //fn_LeadManagement_search(this, mode, '#test3', tableOptions);

                            }
                            else {
                                $.each(ajaxOutput.Process.Message, function (key, value) {
                                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                                });
                            }
                            if (mode = 8) { fn_LeadManagement_search(this, mode, '#test7', tableOptions2); }
                            if (mode = 7) { fn_LeadManagement_search(this, mode, '#test6', tableOptions2); }
                            if (mode = 6) { fn_LeadManagement_search(this, mode, '#test5', tableOptions2); }
                            if (mode = 5) { fn_LeadManagement_search(this, mode, '#test4', tableOptions2); }
                            if (mode = 4) { fn_LeadManagement_search(this, mode, '#test3', tableOptions2); }
                            if (mode = 3) { fn_LeadManagement_search(this, mode, '#test2', tableOptions2); }
                            if (mode = 2) { fn_LeadManagement_search(this, mode, '#test1', tableOptions); }
                        },
                        complete: function () {
                            //fn_LeadManagement_search(this, mode, gridname, table);
                            $(ele).prop('disabled', false);
                            $('.bd-service-modal-sm').modal('hide');
                            //Searchtableresult(this);
                            $('.bd-service-modal-sm').validate().resetForm();
                            //$('[name="FK_Attendedby"]').removeClass('perfectValidate_string');
                            //fn_LeadManagement_search(this, mode, gridname, tableOptions);

                        }
                    });


            }
        }

    }

    //End save  service assign details
    function fn_UpdateCustomerServiceAssign(ele) {
        //debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.valid()) {
            $(ele).prop('disabled', true);


            var inputData =
                {
                    '__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),
                    'FK_Customerserviceregister': $thisForm.find('[name=FK_Customerserviceregister]').val().trim(),
                    'FK_Employee': $thisForm.find('[name=FK_Employee]').val().trim(),
                    'CSAVisitdate': $thisForm.find('[name=CSAVisitdate]').val().trim(),
                    'CSAVisittime': $thisForm.find('[name=CSAVisittime]').val().trim(),
                    'CSAPriority': $thisForm.find('[name=CSAPriority]').val().trim(),
                    'CSARemarks': $thisForm.find('[name=CSARemarks]').val().trim()
                }

            $.ajax({
                url: "@Url.Action("UpdateCustomerserviceAssign", "Service")",
                type: "POST",
                data: inputData,
                dataType: "json",
                contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                success: function (ajaxOutput) {
                    if (ajaxOutput.Process.IsProcess) {
                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': value });
                        });
                        // Get the value set in form's perfect-onFormSuccess attribute
                        let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                        if (onSuccess) {
                            window[onSuccess]();
                        }
                    }
                    else {
                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                        });
                    }
                },
                complete: function () {
                    $(ele).prop('disabled', false);
                    $('.bd-service-modal-sm').modal('hide');
                    Searchtableresult(this);
                }
            });
        }
    }


    function getfunction(ele) {
        //debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let emplooyee = $thisForm.find('[name=FK_Employee]').val()
        if ($thisForm.valid()) {
            if (emplooyee != '') {
                GetExistancy(ele)
            }
            else {
                NotificationMessage({ 'message': 'Please Select Department' });
            }
        }
        else
        {//debugger
            $('[name=FK_Employee]').val('0')
            $('[name=Employee]').val('');
            //$('select[name=EmployeeType]').val('0');
            $('[name=EmployeeType]').val('0');
            //$('select[name=EmployeeType]').val('0');
            $('[name=DepartmentID]').val('0');
            $('select[name=EmployeeType]').find(':selected').val('0')
            $('select[name=DepartmentID]').find(':selected').val('0')
            $('#TbtnUpdate').css('display', 'none');
            $('#TbtnSave').css('display', 'block');
            //$thisForm.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
            //$thisForm.find('[perfect-ctype="input"]').val('');
            NotificationMessage({ 'message': 'Please Enter Visit date , Visit Time & Priority First' });
        }


    }

    function GetExistancy(ele) {

        let inputdata = 0;

        let $thisForm = 0;

        $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.valid()) {
            //let mobileno=0;
            //    let categrory = $thisForm.find('[name=Category]').val()
            //    if (categrory == 2 || categrory == 4) {
            //        inputdata = { FK_Product: $thisForm.find('[name="FK_Product"]').val(), Mobile: $thisForm.find('[name="CustomerMobile"]').val(), FK_CustomerServiceRegister: $thisForm.find('[name="ID_Customerserviceregister"]').val()}

            //    }
            //    else
            //    {
            //        inputdata = { FK_Product: $thisForm.find('[name="FK_ProductP"]').val(), Mobile: $thisForm.find('[name="CustomerMobile"]').val(), FK_CustomerServiceRegister: $thisForm.find('[name="ID_Customerserviceregister"]').val()}

            //    }
            var InputData =
            {
                //'__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),

                'FK_Employee': $('[name=FK_Employee]').val(),
                'VisitDate': $('[name=CSAVisitdate]').val().trim(),
                'Visittime': $('[name=CSAVisittime]').val().trim(),
                'Mode': 0
            }
            let pdata = $thisForm.data('pData');
        $.ajax({
            url: '@Url.Action("GetEmployeeHistory", "Service")',
            type: "POST",
            data: InputData,//<---- Input json : data passed to controller
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded;charset=utf-8',
            success: function (ajaxOutput) {



                if (ajaxOutput.Process.IsProcess) {

                    let dtable = ajaxOutput.Data;
                    var tikno = dtable[0].TicketNo.bold()
                    let confirmationDialogBoxOption = { heading: "Warning", body: dtable[0].Message + "<br>Do you want to continue? ", cancel: "No", confirm: "Yes" };
                    var confirmBoxObj = ConfirmDialog(confirmationDialogBoxOption);

                    confirmBoxObj.then(function (selectedOption) {
                        if (selectedOption) {

                        }
                        else {

                            let $thisForm = $(ele).closest('[perfect-class="form"]');
                            //$thisForm.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
                            //$thisForm.find('[perfect-ctype="input"]').val('');
                            //$thisForm.find('[perfect-ctype="date"]').val('');
                            //$thisForm.find('[perfect-ctype="hidden"]').val('');

                            $('[name=FK_Employee]').val('0')
                            $('[name=Employee]').val('');
                            $('select[name=EmployeeType]').val('0');
                            $('[name=EmployeeType]').val('0');
                            $('select[name=EmployeeType]').val('0');
                            $('[name=DepartmentID]').val('');
                            $thisForm.validate().resetForm();
                        }
                    });



                }
                else {

                }
            },
            complete: function () {


            }
        });
    }
    }

    function Employeechecking(ele) {

        let inputdata = 0;

        let $thisForm = 0;

        $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.valid()) {

            var tr = $(ele).closest('tr');
            var $tds = tr.find('td'),
                FK_Employee = $tds.eq(1).text(),
                CSAVisitdate = $tds.eq(7).text(),
                CSAVisittime = $tds.eq(8).text()
                console.log('TABLE VALUES', $tds)
            var InputData =
            {
                //'__RequestVerificationToken': $('[name="__RequestVerificationToken"]').val(),

                'FK_Employee': FK_Employee ,
                'VisitDate': CSAVisitdate ,
                'Visittime': CSAVisittime,
                'Mode': 1
            }

        $.ajax({
            url: '@Url.Action("GetEmployeeTicketHistory", "Service")',
            type: "POST",
            data: InputData,//<---- Input json : data passed to controller
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded;charset=utf-8',
            success: function (ajaxOutput) {


                //debugger
                if (ajaxOutput.Process.IsProcess) {
                    //debugger

                    let table = JSON.parse(ajaxOutput.Data);

                        let $modal = createSearchModalDOM();
                        let $message = pft_table_createtable(table.dtable, { serialNo: true });
                        $modal.modal.find('.modal-body')
                        .addClass('text-black')
                        .html($message);
                        $modal.modal.find('.modal-title')
                        .addClass('text-primary')
                        .text('Assigned Tickets');

                       $modal.modal.show();


                }
                else {
                    let $modal = createSearchModalDOM();
                    let $message = '<span>No Ticket History Available</span>';
                    $modal.modal.find('.modal-body')
                        .addClass('text-black')
                        .html($message);
                    $modal.modal.find('.modal-title')
                        .addClass('text-primary')
                        .text('Assigned Tickets');

                    $modal.modal.show();
                }
            },
            complete: function () {


            }
        });
        }
    }



    function clears(ele) {
        //debugger

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        //let pData = $thisForm.data('pData');

        $thisForm.find('[name="DepartmentID"]').val('').selectpicker('refresh');
        $thisForm.find('[name="EmployeeType"]').val('').selectpicker('refresh');
        $thisForm.find('[name="Employee"]').val('');
        $thisForm.find('[name="FK_Employee"]').val('');
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');

        ValidateAddOtherProductservicedetails();


        //$thisForm.validate().resetForm();
    }
    function clearEmployeeData(ele) {

        let $container = $(ele).closest('[perfect-class="form"]');
        $container.find('[name=FK_Employee]').val('0')
        $container.find('[name=Employee]').val('');

        $container.find('[name="EmployeeType"]').val('').selectpicker('refresh');
        $container.find('[name=EmployeeType]').val('');
        //$container.find('[name=ModeName]').val('');
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');

        //ValidateAddOtherProductservicedetails();

        //$thisForm.validate().resetForm();
    }
    function onchangedept()
    {
        $("#dept").on('change', function () {

            clearEmployeeData();

        })
    }
    //function emptable()
    //{
    //    //$('#Emptable').show;
    //    $('#Emptable').css('display', 'block');
    //}
    function foreditclear()
    {
        let $thistbl = $(this).closest('table');
        let table = $thistbl.DataTable();
        pft_table_slreset($thistbl);
    }
   ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


    function ValidateAddOtherProductservicedetails() {
        //debugger

        var Error = 0;
        const $inp = $(".Subproduct");
        let is_empty = true;
        $inp.each((i, el) => {

            //const is_empty = !el.value.trim();

            console.log($(el).attr('name'), $('[name=' + $(el).attr('name') + ']').val());

            if (!$('[name=' + $(el).attr('name') + ']').val() == undefined || $('[name=' + $(el).attr('name') + ']').val() != "") {
                is_empty = false;


            }
            else {
                is_empty = true//!$('[name=' + $(el).attr('name') + ']').val();
            }

            let ErrorID = $(el).attr('data-id');

            console.log(ErrorID, is_empty)

            if (is_empty) {
                //debugger


                $('#' + ErrorID).css('display', 'block');
                Error++;

            }
            else if (!is_empty) {
                $('#' + ErrorID).css('display', 'none');

                //if (Error > 0) {
                //    Error--;
                //}
            }
            el.classList.toggle("is-empty", is_empty);
        });
        return Error
    }

    console.log('check 3');




    function AddProductComplaintdetails(ele, val, btnid) {
        //debugger

        $("#dept").on('change', function () {

            ClearEmployeeonchange(this);

        })
        let tableKey = val;
        let errorClass = '.temptableError';
        let errorClass1 = '.temptableError1';
        let errorClass2 = '.temptableError2';
        let isValid = true;
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.find('[perfect-tempTable-' + tableKey + '="Employee"]').val().length == 0 || $thisForm.find('[perfect-tempTable-' + tableKey + '="Employee"]').val().length == null) {
            isValid = false;
            console.log('false');
            $thisForm.find('[perfect-tempTable-' + tableKey + '="Employee"]').closest('[perfect-class="formGroup"]').find(errorClass1).text('Please select Employee');
        }
        else {
            $thisForm.find('[perfect-tempTable-' + tableKey + '="Employee"]').closest('[perfect-class="formGroup"]').find(errorClass1).text('');
        }
        if ($thisForm.find('[perfect-tempTable-' + tableKey + '="DepartmentName"]').val() == 0  || $thisForm.find('[perfect-tempTable-' + tableKey + '="DepartmentName"]').val().length == null) {

            isValid = false;
            console.log('false');
            $thisForm.find('[perfect-tempTable-' + tableKey + '="DepartmentName"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Please Select Department');
        }
        else {
            $thisForm.find('[perfect-tempTable-' + tableKey + '="DepartmentName"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
        }
        if ($thisForm.find('[perfect-tempTable-' + tableKey + '="Role"]').val() == 0 || $thisForm.find('[perfect-tempTable-' + tableKey + '="Role"]').val() == null) {

            isValid = false;
            console.log('false');
            $thisForm.find('[perfect-tempTable-' + tableKey + '="Role"]').closest('[perfect-class="formGroup"]').find(errorClass2).text('Please Select Role');
        }
        else {
            $thisForm.find('[perfect-tempTable-' + tableKey + '="Role"]').closest('[perfect-class="formGroup"]').find(errorClass2).text('');
        }








        console.log("Validate >", ValidateAddProductcomplaintdetails())
        let $container = $(ele).closest('[perfect-class="form"]');
     //   console.log("Check Exist >", (CheckExisting($container.find('[name=FK_Employee]').val(), val, ele)));
        if (isValid) {
            //debugger
            //if (Employeechecking() <= 0) {
                //debugger
            if (ValidateAddProductcomplaintdetails() <= 0 && CheckExisting($container.find('[name=FK_Employee]').val(), val, ele, 'ProductNameExists-error', btnid) <= 0) {
                if (btnid == 2) {
                    removerow($container.find('[name=FK_Employee]').val(), ele, btnid, val);
                }
                    $('#Emptable').css('display', 'block');
                    $('#TbtnUpdate').css('display', 'none');
                    $('#TbtnSave').css('display', 'block');
                    let $tbl = $container.find('[perfect-tempTable="' + val + '"]');
                    //let savedData = [];
                    //$container.find('[perfect-tempTable="' + val + '"]').find('tbody').find('tr').each(function () {
                    //    savedData.push($(this).data('pData'));
                    //})

                    RemoveEmptyRow('ComplaintDetailstbody');

                    var TbodyHtml = '';

                    var rowcount = document.getElementById('ComplaintDetailstbody').rows.length;

                    rowcount = rowcount + 1;
                    TbodyHtml += "<tr id=" + htmlEncode(rowcount) + ">";
                    TbodyHtml += "<td class='row-index' style='text-align:center;'>" + htmlEncode(rowcount) + "</td>";

                    TbodyHtml += "<td style='display:none;'>" + $container.find('[name=FK_Employee]').val() + "</td>";
                    TbodyHtml += "<td style='text-align:center;'>" + htmlEncode($container.find('[name=Employee]').val()) + "</td>";
                    TbodyHtml += "<td style='text-align:center;'>" + htmlEncode($('select[name=EmployeeType]').find(':selected').text()) + "</td>";
                    TbodyHtml += "<td style='display:none;'>" + $container.find('[name=EmployeeType]').val() + "</td>";
                    TbodyHtml += "<td style='display:none;'>" + $('select[name=DepartmentID]').find(':selected').val() + "</td>";
                    TbodyHtml += "<td style='display:none;'>" + htmlEncode($('select[name=DepartmentID]').find(':selected').text()) + "</td>";
                    TbodyHtml += "<td style='display:none;'>" + $('[name=CSAVisitdate]').val() + "</td>";

                    console.log('TIME',  $('[name=CSAVisittime]').val());
                    console.log('DATE',   $('[name=CSAVisitdate]').val());
                TbodyHtml += "<td style='text-align:center;'><div class='d-flex'><a href='#' class='btn btnPerfectGrid shadow btn-xs sharp mr-1' title='Edit' onclick='EditProductComplaintdetails(this);'> <i class='fa fa-pencil btnPerfectGridEdit'></i></a>";
                TbodyHtml += "<a href='#' class='btn btnPerfectGrid shadow btn-xs sharp mr-1' title='Delete' onclick='RemoveProductComplaintdetails(this);'><i class='fa fa-trash btnPerfectGridDelete'></i></a>";
                TbodyHtml += "<a href='#' class='btn btnPerfectGrid shadow btn-xs sharp mr-1' title='Assigned Works' onclick='Employeechecking(this);'><i class='fa fa-history'></i></a></div ></td > ";
                    TbodyHtml += "</tr>";


                    $('#ComplaintDetailstbody').append(TbodyHtml);


                    $('[name=FK_Employee]').val('0')
                    $('[name=Employee]').val('');
                    $('select[name=EmployeeType]').val('0');
                    $('[name=EmployeeType]').val('0');
                    $('select[name=EmployeeType]').val('0');
                    $('[name=DepartmentID]').val('0');

                }
            //}
        }

    }

    function ValidateAddProductcomplaintdetails() {
        //debugger
        var Error = 0;
        const $inp = $(".product");
        let is_empty = '';
        $inp.each((i, el) => {

            //is_empty = !el.value.trim();


            if (!$('[name=' + $(el).attr('name') + ']').val() == undefined) {
                is_empty = false;
            }
            else {
                is_empty = !$('[name=' + $(el).attr('name') + ']').val();
            }


            let ErrorID = $(el).attr('data-id');
            if (is_empty) {
                console.log(`field ${el.id} is empty`);
                $('#' + ErrorID).css('display', 'block');
                Error++;
                console.log("While empty", Error)
            }
            else if (!is_empty) {
                $('#' + ErrorID).css('display', 'none');
                console.log("While not empty", Error)
                //if (Error > 0) {
                //    Error--;
                //}
            }
            el.classList.toggle("is-empty", is_empty);
        });
        return Error;
    }


    function RemoveProductComplaintdetails(ele) {

        let ObjectName = $(ele).closest("tr").find("td").eq(2).text().trim();

        if (confirm("Are you sure you want to delete " + " " + ObjectName + "?")) {
            var row = $(ele).closest('tr');

            var siblings = row.siblings();

            siblings.each(function (index) {
                $(this).children('td').first().text(index + 1);
            });

            // Removing the current row.
            $(ele).closest('tr').remove();

            $('[name=FK_Employee]').val('0')
            $('[name=Employee]').val('');
            $('select[name=EmployeeType]').val('0');
            $('[name=EmployeeType]').val('0');
            $('select[name=EmployeeType]').val('0');
            $('[name=DepartmentID]').val('0');
            $('#TbtnUpdate').css('display', 'none');
            $('#TbtnSave').css('display', 'block');

            $('select[name=DepartmentID]').prop("disabled", false);
        }
        else {
            return false;
        }

        //If removed all rows
        var rowcount = document.getElementById('ComplaintDetailstbody').rows.length;
        if (rowcount == 0) {
            $('#Emptable').css('display', 'none');
            let TbodyHtml = '';
            TbodyHtml += "<tr id='0'> <td style='text-align:center;' colspan='5'>No Records..</td> </tr>";
            $('#ComplaintDetailstbody').html(TbodyHtml);
            $("#ComplaintDetailstbody tr").remove();
        }
    }

    function removerow(Object_ID, ele, btnid, val) {
        $('select[name=DepartmentID]').prop("disabled", false);
        let $container = $(ele).closest('[perfect-class="form"]');
        var cntr = 0;
        $container.find('[perfect-tempTable="' + val + '"]').find('tbody').find('tr').each(function () {

            var $tds = $(this).find('td'),
                productId = $tds.eq(1).text();
            //debugger

            if (productId == Object_ID) {

                if (btnid == 2) {
                    cntr++;
                    if (cntr > 1) {


                    }
                    else {
                        var siblings = tre.siblings();
                        console.log('Sibling>', siblings);
                        siblings.each(function (index) {
                            $(this).children('td').first().text(index + 1);
                        });
                        tre.remove();

                    }
                }


            }
            else {
                var siblings = tre.siblings();
                console.log('Sibling>', siblings);
                siblings.each(function (index) {
                    $(this).children('td').first().text(index + 1);
                });
                tre.remove();
            }


        })
    }
    var tre;
    function EditProductComplaintdetails(ele) {
        //debugger
        let $container = $(ele).closest('[perfect-class="form"]');
        var tr = $(ele).closest('tr');
        tre = $(ele).closest('tr');
        var $tds = tr.find('td'),
            Slno = $tds.eq(0).text(),
            FK_Employee = $tds.eq(1).text(),
            Employee = $tds.eq(2).text(),
            DepartmentID = $tds.eq(5).text(),
            Role = $tds.eq(4).text(),
            EmployeeType = $tds.eq(3).text();

        $container.find('[name=FK_Employee]').val(FK_Employee);
        //$container.find('[name=DepartmentName]').val(DepartmentName);
        $container.find('[name=Employee]').val(Employee);
        $container.find('[name=EmployeeType]').val(EmployeeType);

        $('select[name=EmployeeType]').val(Role);
        $('select[name=DepartmentID]').val(DepartmentID);
        $('select[name=DepartmentID]').prop("disabled", true);
        //$container.find('[name=EmployeeType]').val(EmployeeType);




        //Re Calculate SI>NO



        //$(ele).closest('tr').remove();
        //End
        // Add no record if table empty
        var rowcount = document.getElementById('ComplaintDetailstbody').rows.length;
        if (rowcount == 0) {
            $('#Emptable').css('display', 'none');
            let TbodyHtml = '';
            TbodyHtml += "<tr id='0'> <td style='text-align:center;' colspan='4'>No Records..</td> </tr>";
            $('#ComplaintDetailstbody').html(TbodyHtml);
        }
        $('#TbtnUpdate').css('display', 'block');
        $('#TbtnSave').css('display', 'none');
        //end
        //$("#dept").on('change', function () {

        //    ClearEmployeeonchange(this);

        //})
    }

    function ClearProductComplaintdetails(ele) {

        $('select[name=DepartmentID]').prop("disabled", false);
        let $container= $(ele).closest('[perfect-class="form"]');
        $container.find('[name=FK_Employee]').val('0')
        $container.find('[name=Employee]').val('');
        $('select[name=EmployeeType]').val('0');
        $('select[name=DepartmentID]').val('0');
        $container.find('[name=EmployeeType]').val('0');
       // $('select[name=EmployeeType]').val('');
        $container.find('[name=DepartmentID]').val('0');
        //$container.find('[name=ModeName]').val('');
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');
        ValidateAddProductcomplaintdetails(this);
        if (CheckExisting($container.find('[name=FK_Employee]').val(), 'ComplaintDetails', ele, 'ProductNameExists-error') <= 0) {

            $container.find('[name="FK_Employee"]').closest('[perfect-class="form"]').find('.producterror').attr("style", "display:none");
        }
    }
    function ClearEmployeeonchange(ele) {

        $('select[name=DepartmentID]').prop("disabled", false);
        let $container = $(ele).closest('[perfect-class="form"]');
        $container.find('[name=FK_Employee]').val('0')
        $container.find('[name=Employee]').val('');
        $('select[name=EmployeeType]').val('0');
        $container.find('[name=EmployeeType]').val('0');
        //$('select[name=EmployeeType]').val('0');
        //$container.find('[name=DepartmentID]').val('');
        //$container.find('[name=ModeName]').val('');
        $('#TbtnUpdate').css('display', 'none');
        $('#TbtnSave').css('display', 'block');
        ValidateAddProductcomplaintdetails(this);
        if (CheckExisting($container.find('[name=FK_Employee]').val(), 'ComplaintDetails', ele, 'ProductNameExists-error') <= 0) {

            $container.find('[name="FK_Employee"]').closest('[perfect-class="form"]').find('.producterror').attr("style", "display:none");

        }

    }

    function CheckExisting(Object_ID, val, ele, Error, btnid) {
        //debugger
        let $container = $(ele).closest('[perfect-class="form"]');
        var cntr = 0;
        var Exist = 0;
        $container.find('[perfect-tempTable="' + val + '"]').find('tbody').find('tr').each(function () {

            var $tds = $(this).find('td'),
                productId = $tds.eq(1).text();

            console.log('PRODUCT_ID-->', productId)


                if (productId == Object_ID) {
                    if (btnid == 2)
                    {
                        cntr++;
                        if (cntr > 1)
                        {
                            Exist++;

                        }
                        else
                        {
                            Exist = 0;
                        }
                    }
                    else {

                        Exist++;
                    }

                }

            if (Exist > 0)
            {
                    $('#' + Error).css('display', 'block');
                    console.log('Yes it exist');

            }
            else {
                $('#' + Error).css('display', 'none');
                console.log('No it not exist');
            }
        })
        return Exist;
    }
    //End Product add,edit,delete,validate

    function RemoveEmptyRow(ID) {
        let val = $('#' + ID).find('tr:first').attr('id');
        if (val == 0) {
            $('#' + ID).empty();
        }
    }

    function FilterReset(ele)
    {
        document.querySelector('#exppdf').style.display = 'none';
        let $container = $(ele).closest('[perfect-class="formassign"]');

        $('select[name=Branch]').val('0');
        $container.find('[name=Branch]').val('0');
        $container.find('[name=ProductName]').val('')
        $container.find('[name=ProductID]').val('0');
        $container.find('[name=AreaName]').val('');
        $container.find('[name=AreaID]').val('0');
        $container.find('[name=PostName]').val('')
        $container.find('[name=PostID]').val('0');
        $container.find('[name=FromDate]').val('');
        $container.find('[name=ToDate]').val('');
        $container.find('[name=ComplaintType]').val('0');
        $('select[name=ComplaintType]').val('0');
        $container.find('[name=Customer]').val('');
        $container.find('[name=Mobile]').val('');
        $container.find('[name=Ticket]').val('');
        $container.find('[name=Sortorder]').val('');
        $('select[name=Sortorder]').val('0');
        $container.find('[name=Complaintstatus]').val('');
        $('select[name=Complaintstatus]').val('8');
        $container.find('[name=EmployeeSearch]').val('');

    }
    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode
        if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;

        return true;
    }

    function ShowCustomerBalance(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.find('[name=ID_Customer]').val() != '') {
            var obj = {
                FK_Customer: $thisForm.find('[name=ID_Customer]').val(),
                TransDate: moment().format('YYYY-MM-DD'),
            }

            console.log(obj)
            $.ajax({
                url: "@Url.Action("getGetCustomerAccountBalance", "Sales")",
                type: "POST",
                data: obj,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
                success: function (ajaxOutput) {
                    $('#Accountbalancedetailss').html('')
                    if (ajaxOutput.Process.IsProcess) {
                        let table = JSON.parse(ajaxOutput.Data);
                        $('#Accountbalancedetailss').html(pft_table_createtable(table.dtable, { serialNo: true }))
                        document.getElementById("Accountbalancedetails").style.display = 'none';
                      $("#formGroupModalCustomerBalance").modal('show');
                    }
                    else {
                        document.getElementById("Accountbalancedetails").style.display = 'block';
                        $('#Accountbalancedetails').html("<p style='text-align:center;' >No Records..</p>");
                        $('#Accountbalancedetailss').html('')
                        NotificationMessage({
                            'type': 'info', 'heading': 'info', 'message': "Customer has no balance"
                        });
                    }
                }

            });


        }
        else {
            NotificationMessage({
                'type': 'info', 'heading': 'info', 'message': "Please select Import From"
            });
        }

    }
    function fn_closeCustomerBalance() {
        $("#formGroupModalCustomerBalance").modal('hide');
    }

    function generatePdf(ele) {
        var cdata;


        let $container = $(ele).closest('[perfect-class="form"]');
        const obj = {
          
            "Ticket Number": $('input[name="Ticket"]').val(),
            "Due Days": $('input[name="DueDays"]').val(),

            Branch: $('select[name="Branch"] option:selected').text(),
            "Complaint Type": $('select[name="ComplaintType"] option:selected').text(),
           "Status": $('select[name="Complaintstatus"] option:selected').text(),
          
            "Sortorder": $('select[name="Sortorder"] option:selected').text(),
            "Customer Mobile": $('input[name="Mobile"]').val(),
            Customer: $('input[name="Customer"]').val(),
            "Post": $('input[name="PostName"]').val(),
            Product: $('input[name="ProductName"]').val(),
            "Area": $('input[name="AreaName"]').val(),
            "Employee": $('input[name="EmployeeSearch"]').val()




        };
        const obj2 = {
            "From":    $('input[name="FromDate"]').val(),
            "To": $('input[name="ToDate"]').val()
        }



        console.log(obj, '--obj--');
        console.log(obj2, '--obj2--');


       

        Data.forEach((x) => {
            if (x['TicketDate']) {
                let q = x['TicketDate'].split('T');
                x['TicketDate'] = changeDateFormat(q[0]);
            }
            
        })

       

         $.ajax({
              url: '@Url.Action("GetCompanyDetails", "Home")',
              type: "GET",
              dataType: "json",
              contentType: "application/x-www-form-urlencoded;charset=utf-8",
                 success: function (ajaxOutput) {


                     cdata = ajaxOutput;

                },
             complete: function () {

                 //LeadType = 'My Leads';
                 var reportName;
                 var head = [];
                 var ptableData = {};
                 //debugger;
                 if (tabMode == '2') {
                     //    console.log('todoList', Data)
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Channel", "Priority", "Time Due"];
                     reportName = "New";
                     ptableData = {
                         columns: [

                             {  dataKey: "TicketNo" },
                             {  dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             {  dataKey: "Customer" },
                             {  dataKey: "Mobile" },
                             {  dataKey: "Area" },
                             {  dataKey: "Channel" },
                             { dataKey: "Priority" },
                             {  dataKey: "Due" },


                         ],
                         rows: Data

                     };
                 } else if (tabMode == '3') {
                     console.log('Lead', Data)
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee","Channel", "Priority", "Status","Time Due"];
                         reportName = "Completed";
                         ptableData = {
                             columns: [

                                 {  dataKey: "TicketNo" },
                                 {  dataKey: "TicketDate" },
                                 {  dataKey: "Branch" },
                                 { dataKey: "Customer" },
                                 {  dataKey: "Mobile" },
                                 {  dataKey: "Area" },
                                 { dataKey: "Employee" },
                                 {  dataKey: "Channel" },
                                 {  dataKey: "Priority" },
                                 {  dataKey: "Status" },
                                 { dataKey: "Due" },

                             ],
                             rows: Data

                         };



                 } else if (tabMode == '4') {
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     reportName = "Pending";
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             {  dataKey: "TicketDate" },
                             {  dataKey: "Branch" },
                             {  dataKey: "Customer" },
                             {  dataKey: "Mobile" },
                             {  dataKey: "Area" },
                             { dataKey: "Employee" },
                             {  dataKey: "Channel" },
                             {  dataKey: "Priority" },
                             { dataKey: "Status" },
                             {  dataKey: "Due" },

                         ],
                         rows: Data

                     };
                 } else if (tabMode == '5') {
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     reportName = "Pick Up Request";
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };

                 } else if (tabMode == '6') {
                     reportName = "Replacement Request";
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };
                 }
                 else if (tabMode == '7') {
                     reportName = "Delivery Request";
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };
                 }
                 else if (tabMode == '8') {
                     reportName = "Factory Service";
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };
                 }

                 var str = "";
                 var str2 = `Report :  SERVICE ASSIGN - ${reportName} List`;
                 var filename = `SERVICE ASSIGN - ${reportName} List`;
                 var num = 0;

                 for (var i in obj) {
                     if (obj[i] != "" && obj[i].toUpperCase() != "PLEASE SELECT" && obj[i] != 0 && obj[i] != "Select Terminal" && obj[i] != "Select Complaint Type" && obj[i] != "Select Status" && obj[i] != "Select Sort Order") {

                         if (num == 0) {
                             str = "Filter By : ";
                         }
                         str = str + i + ' : ' + obj[i] + ' , ';
                         num++;
                     }

                 };
                 //for (var i in obj2) {
                 //    if (obj2[i] != "" && obj2[i] != undefined) {

                        

                 //       // str2 = str2 + i + ' : ' + changeDateFormat(obj2[i]) + ' , ';
                 //    }

                 //};
                 if (obj2['From'] && obj2['To']) {
                     
                     str2 = str2 + ` ,For the Period  ${changeDateFormat(obj2['From'])} - ${changeDateFormat(obj2['To'])}`;
                 }
                 var upperhead;
                 if (str2 && str) {
                     upperhead = {


                         columnStyles: { 0: { halign: 'left', textColor: "black", fontSize: 14, fillColor: false, } },
                         columnStyles: { 1: { halign: 'left', textColor: "black", fontSize: 11, fillColor: false, } },

                         body: [

                             [

                                 str2 +
                                 '\n' + str


                             ]
                         ],

                         theme: 'plain',
                         styles: {
                             // fillColor: '#3366ff',
                             color: 'black',
                             rowHeight: 1 // Adjust the row height value to reduce the space between rows
                         },
                         didDrawCell: function (data) {
                             data.cell.styles.lineHeight = 0.2; // Adjust the line height value to your preference
                         }



                     };

                 } else if (str2 && str == "") {
                     upperhead = {


                         columnStyles: { 0: { halign: 'left', textColor: "black", fontSize: 14, fillColor: false, } },
                         columnStyles: { 1: { halign: 'left', textColor: "black", fontSize: 11, fillColor: false, } },

                         body: [


                             [ str2 ]


                         ],

                         theme: 'plain',
                         styles: {
                             // fillColor: '#3366ff',
                             color: 'black',
                             rowHeight: 1 // Adjust the row height value to reduce the space between rows
                         },
                         didDrawCell: function (data) {
                             data.cell.styles.lineHeight = 0.2; // Adjust the line height value to your preference
                         }



                     };

                 }

                 exportPdf("", [head], cdata, upperhead, "", ptableData, "", `${filename} Report`, "a4","","","l");
                // exportPdf(ptitle, phead, cdata, upperhead, footerdata, ptableData, grpvariable, filename, pageSize, tableOptions, columnStyles, PageOrientation)

                }
         });
    }

    function onExell() {



        var cdata;
       
       

        const obj = {

            "Ticket Number": $('input[name="Ticket"]').val(),
            "Due Days": $('input[name="DueDays"]').val(),

            Branch: $('select[name="Branch"] option:selected').text(),
            "Complaint Type": $('select[name="ComplaintType"] option:selected').text(),
            "Status": $('select[name="Complaintstatus"] option:selected').text(),

            "Sortorder": $('select[name="Sortorder"] option:selected').text(),
            "Customer Mobile": $('input[name="Mobile"]').val(),
            Customer: $('input[name="Customer"]').val(),
            "Post": $('input[name="PostName"]').val(),
            Product: $('input[name="ProductName"]').val(),
            "Area": $('input[name="AreaName"]').val(),
            "Employee": $('input[name="EmployeeSearch"]').val()




        };
        const obj2 = {
            "From": $('input[name="FromDate"]').val(),
            "To": $('input[name="ToDate"]').val()
        }



        console.log(obj, '--obj--');
        console.log(obj2, '--obj2--');


       

        let ReportName1;

        
        //Data.unshift(str);

         $.ajax({
              url: '@Url.Action("GetCompanyDetails", "Home")',
              type: "GET",
              dataType: "json",
              contentType: "application/x-www-form-urlencoded;charset=utf-8",
                 success: function (ajaxOutput) {


                     cdata = ajaxOutput;

                },
             complete: function () {
                 console.log(cdata, "---cdata----");
                 var reportName;
                 var head = [];
                 var ptableData = {};

                 if (tabMode == '2') {
                     //    console.log('todoList', Data)
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Channel", "Priority", "Time Due"];
                     reportName = "New";
                     ptableData = {
                         columns: [

                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Due" },


                         ],
                         rows: Data

                     };
                 } else if (tabMode == '3') {
                     console.log('Lead', Data)
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     reportName = "Completed";
                     ptableData = {
                         columns: [

                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };



                 } else if (tabMode == '4') {
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     reportName = "Pending";
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };
                 } else if (tabMode == '5') {
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     reportName = "Pick Up Request";
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };

                 } else if (tabMode == '6') {
                     reportName = "Replacement Request";
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };
                 }
                 else if (tabMode == '7') {
                     reportName = "Delivery Request";
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };
                 }
                 else if (tabMode == '8') {
                     reportName = "Factory Service";
                     head = ["Sl .No", "Ticket No", "Ticket Date", "Terminal", "Customer", "Mobile", "Area", "Employee", "Channel", "Priority", "Status", "Time Due"];
                     ptableData = {
                         columns: [


                             { dataKey: "TicketNo" },
                             { dataKey: "TicketDate" },
                             { dataKey: "Branch" },
                             { dataKey: "Customer" },
                             { dataKey: "Mobile" },
                             { dataKey: "Area" },
                             { dataKey: "Employee" },
                             { dataKey: "Channel" },
                             { dataKey: "Priority" },
                             { dataKey: "Status" },
                             { dataKey: "Due" },

                         ],
                         rows: Data

                     };
                 }


                 var str = "";
                 var str2 = `Report :  SERVICE ASSIGN - ${reportName} List`;
                 var filename = `SERVICE ASSIGN - ${reportName} List`;
                 var num = 0;

                 for (var i in obj) {
                     if (obj[i] != "" && obj[i].toUpperCase() != "PLEASE SELECT" && obj[i] != 0 && obj[i] != "Select Terminal" && obj[i] != "Select Complaint Type" && obj[i] != "Select Status" && obj[i] != "Select Sort Order") {

                         if (num == 0) {
                             str = "Filter By : ";
                         }
                         str = str + i + ' : ' + obj[i] + ' , ';
                         num++;
                     }

                 };
                 //for (var i in obj2) {
                 //    if (obj2[i] != "" && obj2[i] != undefined) {

                 //        str2 = str2 + i + ' : ' + changeDateFormat(obj2[i]) + ' , ';
                 //    }

                 //};

                 if (obj2['From'] && obj2['To']) {
                     //debugger
                     str2 = str2 + ` ,For the Period  ${changeDateFormat(obj2['From'])} - ${changeDateFormat(obj2['To'])}`;
                 }

                 ReportName1 = `${cdata.Company} \n${cdata.Branch}\n ${str2} \n ${str} `
                 generateExell(ReportName1, [head], ptableData, "", "", `${filename} Report`);


                

             }
         });
        




    }

    function changeDateFormat(date) {
        /*var date = '2023-06-05';*/

        // Split the date into year, month, and day components
        var dateComponents = date.split('-');

        // Rearrange the components to form the desired format
        var formattedDate = dateComponents[2] + '/' + dateComponents[1] + '/' + dateComponents[0];

        console.log(formattedDate); // Output: 05/06/23
        return formattedDate;
    }

    function getfunction() {
       document.querySelector('#exppdf').style.display = 'none';
    }
</script>

