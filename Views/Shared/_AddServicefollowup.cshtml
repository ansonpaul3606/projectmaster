


@model PerfectWebERP.Models.ServiceListModel.ServiceListView
<style>
    .tableFixHead {
        overflow: auto;
        height: 242px;
    }

        .tableFixHead thead tr {
            position: sticky;
            top: 0;
            z-index: 1;
        }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        padding: 8px 16px;
    }

    th {
        background: var(--perfect-primary);
    }
</style>
<style>
    .table-responsive-sm {
        max-width: 1200.98px
    }

    .form-group2 {
        margin-bottom: 0.1rem;
        margin-left: 1px;
    }
</style>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12" id="jq_ServiceIndex_formContainer">
            <div class="card ">

                <div class="card-header">
                    <h4 class="card-title">Follow Up No :<span class="col-sm-4 col-form-label" perfect-class="formGroupLabel">@Model.TicketNo</span></h4>
                </div>

                <div class="card-body px-2">
                    <form id="" class="form-valide" perfect-class="form" action="#" method="post" perfect-onFormSuccess="">


                        <div class="col-md-12 jq_service_commonForm_div">

                            @Html.AntiForgeryToken()



                            <div class="col-sm-12 border p-3" style="border-color:black">
                                <div class="row">
                                    <div class="col-sm-6">
                                    </div>
                                    <div class="col-sm-6">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-4">

                                        <div class="profile-personal-info">

                                            <h4 class='text-primary mb-4'>Ticket Details</h4>

                                            <div class="form-group2 row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel" class="font-weight-bold">Ticket Number:</span>

                                                </label>
                                                <div class="col-sm-8">
                                                    <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="TicketNo" perfect-ctype="input" perfect-css="input">@Model.TicketNo</label>

                                                </div>

                                            </div>

                                            <div class="form-group2 row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel" class="font-weight-bold">Registered On:</span>

                                                </label>
                                                <div class="col-sm-8">
                                                    <label class="col-sm-8 col-form-label" type="date" perfect-class="formGroupControl" name="RegisteredOn" perfect-ctype="input" perfect-css="input">@Model.RegisteredOn</label>

                                                </div>

                                            </div>
                                            <div class="form-group2 row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel" class="font-weight-bold">Visit On:</span>

                                                </label>
                                                <div class="col-sm-8">
                                                    <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="VisitedDate" perfect-ctype="input" perfect-css="input">@Model.VisitedDate</label>

                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="profile-personal-info">


                                            <h4 class='text-primary mb-4'>Customer Details</h4>

                                            <div class="form-group2 row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel" class="font-weight-bold">Customer Name:</span>

                                                </label>
                                                <div class="col-sm-8">

                                                    <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="CusName" perfect-ctype="input" perfect-css="input">@Model.CusName</label>
                                                    <input type="hidden" id="FK_Customer" name="FK_Customer" value="@Model.FK_Customer" />
                                                    <input type="hidden" id="FK_CustomerOthers" name="FK_CustomerOthers" value="@Model.FK_CustomerOthers" />
                                                </div>

                                            </div>

                                            <div class="form-group2 row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel" class="font-weight-bold">Mobile:</span>

                                                </label>
                                                <div class="col-sm-8">
                                                    <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Mobile" perfect-ctype="input" perfect-css="input">@Model.Mobile</label>

                                                </div>

                                            </div>

                                            <div class="form-group2 row" perfect-class="formGroup">
                                                <label class="col-sm-4 col-form-label">
                                                    <span perfect-class="formGroupLabel" class="font-weight-bold">Address:</span>

                                                </label>
                                                <div class="col-sm-8">
                                                    <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address1" perfect-ctype="input" perfect-css="input">@Model.Address1</label>

                                                    <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="District" perfect-ctype="input" perfect-css="input">@Model.District</label>
                                                    <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address2" perfect-ctype="input" perfect-css="input">@Model.Address2</label>
                                                    <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Address2" perfect-ctype="input" perfect-css="input">@Model.Address3</label>

                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="profile-personal-info">

                                            <div class="form-group" perfect-class="Assign" action="#" method="post" perfect-onFormSuccess="">

                                                <h4 class='text-primary mb-4'>Product Details</h4>


                                                @if (Model != null)
                                                {
                                                    foreach (var item in Model.ComplaintproductDetails)
                                                    {
                                                        <div class="form-group2 row" perfect-class="formGroup">
                                                            <label class="col-sm-4 col-form-label">
                                                                <span perfect-class="formGroupLabel" class="font-weight-bold"> Name:</span>

                                                            </label>

                                                            <div class="col-sm-8">

                                                                <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Product" perfect-ctype="input" perfect-css="input">  @Html.DisplayFor(model => item.Product)</label>
                                                                <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" style="display:none">  @Html.DisplayFor(model => item.ID_Product)</label>

                                                                <input type="hidden" id="ID_Product" name="ID_Product" value="@Html.DisplayFor(model => item.ID_Product)" />
                                                                <input type="hidden" id="FK_Category" name="FK_Category" value="@Html.DisplayFor(model => item.FK_Category)" />
                                                            </div>

                                                        </div>
                                                        <div class="form-group2 row" perfect-class="formGroup">
                                                            <label class="col-sm-4 col-form-label">
                                                                <span perfect-class="formGroupLabel" class="font-weight-bold">Category:</span>

                                                            </label>
                                                            <div class="col-sm-8">
                                                                <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="Category" perfect-ctype="input" perfect-css="input"> @Html.DisplayFor(model => item.Category)</label>

                                                            </div>

                                                        </div>

                                                        if (item.ProductComplaint != null && item.ProductComplaint != "")
                                                        {

                                                            <div class="form-group2 row divproductcomplaint" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel" class="font-weight-bold">Complaint:</span>

                                                                </label>
                                                                <div class="col-sm-8">

                                                                    <label class="col-sm-8 col-form-label" id="idlabelcomplaintdetails" name="ProductComplaint" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input"> @Html.DisplayFor(model => item.ProductComplaint)</label>

                                                                </div>

                                                            </div>
                                                        }
                                                        if (item.ServiceName != null && item.ServiceName != "")

                                                        {


                                                            <div class="form-group2 row divproductservice" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel" class="font-weight-bold">Service:</span>

                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <label class="col-sm-8 col-form-label" id="idlabelservicedetails" name="ServiceName" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input"> @Html.DisplayFor(model => item.ServiceName)</label>

                                                                </div>

                                                            </div>
                                                        }
                                                        <div class="form-group2 row" perfect-class="formGroup">
                                                            <label class="col-sm-4 col-form-label">
                                                                <span perfect-class="formGroupLabel" class="font-weight-bold">Description:</span>

                                                            </label>
                                                            <div class="col-sm-8">
                                                                <label class="col-sm-8 col-form-label" perfect-class="formGroupControl" name="ProductDescription" perfect-ctype="input" perfect-css="input"> @Html.DisplayFor(model => item.ProductDescription)</label>

                                                            </div>

                                                        </div>

                                                    }
                                                }
                                            </div>
                                        </div>
                                        <input type="hidden" name="FK_Customerserviceregister" value="@Model.FK_Customerserviceregister" />
                                        <input type="hidden" name="ID_Product" value="@Model.ID_Product" />
                                    </div>
                                </div>


                                @*-------------------------------------------------------------------------*@

                                @*-------------------------------*@

                                <div class="col-sm-12">
                                    <div class="default-tab">

                                        <ul class="nav nav-tabs" role="tablist">

                                            <li class="nav-item">
                                                <a class="nav-link active" id="Serviceinfoid" data-toggle="tab" href="#Serviceinfo"><i class="las la-book-reader mr-2"></i>Service Attended</a>

                                            </li>
                                            <li class="nav-item">

                                                <a class="nav-link" id="replacementinfoid" data-toggle="tab" href="#navpills2-1"><i class="las la-tty mr-2"></i>Replaced Product</a>

                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="attendanceinfoid" data-toggle="tab" href="#navpills2-2"><i class="la la-calendar-plus mr-2"></i> Attendance</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="summaryinfoid" data-toggle="tab" href="#navpills2-3" onclick="bindserv()"><i class="la la-bell mr-2"></i> Action Taken</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" data-toggle="tab" href="#History"><i class="las la-history mr-2"></i> Service History</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" data-toggle="tab" href="#warranty" onclick="fn_WaranttyDetails()"><i class="las la-file-invoice mr-2"></i> Warranty/AMC Details</a>
                                            </li>
                                        </ul>




                                        <div class="tab-content">

                                            <div id="Serviceinfo" class="tab-pane active">
                                                <div class="card-body">
                                                    @*table-responsive-lg*@
                                                    <div class="table-responsive-lg tableFixHead">
                                                        <table class="table table-hover table-responsive-lg table-striped  text-black" id="ProductServices">
                                                            <thead class="bg-primary text-white">
                                                                <tr>
                                                                <tr>
                                                                    <th style="display:none"> </th>
                                                                    <th style="display:none"></th>
                                                                    <th></th>
                                                                    <th>Components</th>
                                                                    <th>Service</th>
                                                                    <th>Service Type</th>
                                                                    <th>Service Cost</th>
                                                                    <th style="display:none">Tax Amount</th>
                                                                    <th style="display:none">Net Amount</th>
                                                                    <th>Remarks</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="ProductServiceTbody">
                                                                <tr id="0">
                                                                    @*<td colspan="4" style="text-align:center;">No RecordsABCDFE...</td>*@
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        <div class="modal-footer">



                                                            <div class="modal fade bd-ProductserviceMoredetails-modal-sm" id="moreservicemodel" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
                                                                <div class="modal-dialog modal-xl">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <h5 class="modal-title">Service Details</h5>
                                                                            <button type="button" class="close" data-dismiss="modal">
                                                                                <span>x</span>
                                                                            </button>
                                                                        </div>

                                                                        <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;">

                                                                            <div class="form-row" id="TopDetails">


                                                                            </div>
                                                                            <div class="form-row">
                                                                                <div class="col-sm-12">
                                                                                    <div class="card">
                                                                                        <div class="card-body">
                                                                                            <div class="table-responsive-lg tableFixHead">
                                                                                                <table class="table table-hover table-responsive-lg table-striped  text-black" id="ProductServicesMore">
                                                                                                    <thead class="bg-primary text-white">
                                                                                                        <tr>

                                                                                                            <th style="display:none"> </th>
                                                                                                            <th style="display:none"></th>
                                                                                                            <th></th>
                                                                                                            <th style="display:none">Components</th>
                                                                                                            <th>Service</th>
                                                                                                            <th>Service Type</th>
                                                                                                            <th>Service Cost</th>
                                                                                                            <th style="display:none">Tax Amount</th>
                                                                                                            <th style="display:none">Net Amount</th>
                                                                                                            <th>Remarks</th>
                                                                                                        </tr>
                                                                                                    </thead>
                                                                                                    <tbody id="ProductServiceTbodyMoredetails">
                                                                                                        <tr id="0">
                                                                                                            @*<td colspan="4" style="text-align:center;">No Records...</td>*@
                                                                                                        </tr>
                                                                                                    </tbody>
                                                                                                </table>

                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <!-- /# card -->
                                                                                </div>

                                                                            </div>

                                                                            <div class="modal-footer">

                                                                                <button type="button" id="btnSaveServicesMore" onclick="BindMoredetailsServiceAmountTEST(this)" class="btn btn-primary">Apply</button>

                                                                            </div>
                                                                            <input type="hidden" name="ID_Product" perfect-class="formGroupControl" />
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>



                                                        </div>
                                                    </div>
                                                    <br />
                                                    <div class="float-right">
                                                        <button type="button" id="btnSaveaddServices" onclick="GetServicesadd(this,0)" class="btn btn-primary">Add Services</button>
                                                        <button type="button" id="btnSaveServices" onclick="BindServiceAmount(this)" class="btn btn-primary">Next>></button>
                                                    </div>

                                                </div>
                                                <input type="hidden" name="FK_Customerserviceregister" />
                                            </div>
                                            <div id="navpills2-1" class="tab-pane">
                                                <div class="card">

                                                    <div class="card-body">
                                                        <div class="table-responsive-lg tableFixHead" id="replaceproducttable">

                                                            @*<input type="hidden" name="Name"class="form-control " perfect-class="formGroupControl" perfect-css="hidden" >*@

                                                            <table class="table table-hover table-responsive-lg table-striped  text-black" id="ProductDetails">
                                                                <thead class="bg-primary text-white">
                                                                    <tr>

                                                                        <th></th>
                                                                        <th>Component</th>
                                                                        <th>Quantity</th>
                                                                        <th style="display:none">Amount</th>
                                                                        <th>Change Mode</th>
                                                                        <th>Buy Back /Security Amount</th>
                                                                        <th style="display:none"></th>
                                                                        <th>Replaced Product</th>
                                                                        <th>Replaced Quantity</th>
                                                                        <th>Replaced Amount</th>
                                                                        <th>Remarks</th>
                                                                        <th style="display:none"> </th>
                                                                        <th style="display:none"> </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="ProductDetailsTbody">
                                                                    <tr id="0">
                                                                        @*<td colspan="12" style="text-align:center;">No Records...</td>*@
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <div class="modal-footer">
                                                                <div class="modal fade bd-ProductReplacementMoredetails-modal-sm" id="moreservicemodel" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">

                                                                    <div class="modal-dialog modal-xl">
                                                                        <div class="modal-content">
                                                                            <div class="modal-header">
                                                                                <h5 class="modal-title">Component Details</h5>
                                                                                <button type="button" class="close" data-dismiss="modal">
                                                                                    <span>×</span>
                                                                                </button>
                                                                            </div>
                                                                            <div>

                                                                            </div>
                                                                            <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;">

                                                                                <div class="form-row" id="TopDetails">
                                                                                    <div class="col-sm-6">
                                                                                        <div class="form-group row" perfect-class="formGroup">
                                                                                            <label class="col-sm-4 col-form-label">

                                                                                                <span perfect-class="formGroupLabel">Category</span>
                                                                                                <span class="text-danger">*</span>
                                                                                            </label>
                                                                                            <div class="col-sm-8">
                                                                                                <select class="form-control" name="CategoryNameID" id="CategoryNameID" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" data-live-search="true" onchange="clearproduct(this)">

                                                                                                    <option value="">Please Select </option>

                                                                                                    @if (!(Model.CategoryList is null))
                                                                                                    {
                                                                                                        foreach (var categorylist in Model.CategoryList)
                                                                                                        {
                                                                                                            <option value="@categorylist.CategoryNameID">@categorylist.CategoryName</option>
                                                                                                        }

                                                                                                    }

                                                                                                </select>

                                                                                            </div>

                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="col-sm-6">
                                                                                        <div class="form-group row" perfect-class="formGroup">
                                                                                            <label class="col-sm-4 col-form-label">
                                                                                                <span perfect-class="formGroupLabel">Product</span>

                                                                                            </label>
                                                                                            <div class="col-sm-8">
                                                                                                <div class="input-group">
                                                                                                    <input type="text" class="form-control " name="ProductName" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                                                                    <input type="hidden" name="ProductID" class="" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />

                                                                                                    <div class="input-group-append">

                                                                                                        <button id="addproduct-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchVal(this,85,'Product List',[])" Criterea1="CategoryNameID" Criterea2="0" Function="1" BindName="ProductName" BindVal="ProductID"></button>


                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>

                                                                                </div>
                                                                                <div class="form-row">
                                                                                    <div class="col-sm-12">
                                                                                        <div class="card">
                                                                                            <div class="card-body">
                                                                                                <div class="table-responsive-lg tableFixHead">
                                                                                                    <table class="table table-hover table-responsive-lg table-striped  text-black" id="ReplacecProductDetails">
                                                                                                        <thead class="bg-primary text-white">
                                                                                                            <tr>

                                                                                                                <th></th>
                                                                                                                <th>Component</th>
                                                                                                                <th>Quantity</th>
                                                                                                                <th style="display:none">Amount</th>
                                                                                                                <th>Change Mode</th>
                                                                                                                <th>Buy Back /Security Amount</th>
                                                                                                                <th style="display:none"> </th>
                                                                                                                <th>Replaced Product</th>
                                                                                                                <th>Replaced Quantity</th>
                                                                                                                <th>Replaced Amount</th>
                                                                                                                <th>Remarks</th>
                                                                                                                <th style="display:none"> </th>
                                                                                                                <th style="display:none"> </th>
                                                                                                            </tr>
                                                                                                        </thead>
                                                                                                        <tbody id="ProductDetailsTbodyMoredetails">
                                                                                                            <tr id="0">
                                                                                                                <td colspan="12" style="text-align:center;">No Records...</td>
                                                                                                            </tr>
                                                                                                        </tbody>
                                                                                                    </table>

                                                                                                    <div class="modal-footer">

                                                                                                        @*<button type="button" id="btnSaveMoreReplaceProduct" onclick="BindMoredetailsProduct(this)" class="btn btn-primary">Apply</button>*@

                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                        <!-- /# card -->
                                                                                    </div>

                                                                                </div>
                                                                                <div class="form-row">

                                                                                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                                                                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                                                                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                                                                    <button type="button" id="btnSaveMoreReplaceProduct" onclick="BindMoredetailsProduct(this)" class="btn btn-primary">Apply</button>

                                                                                </div>


                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                </div>


                                                            </div>
                                                        </div>
                                                        <br />
                                                        <div class="float-right">
                                                            <button type="button" id="btnSaveaddReplaceProductdetails" onclick="GetProserMoreDetails(this,0)" class="btn btn-primary">Add Components</button>
                                                            <button type="button" id="btnSaveProductDetails" onclick="BindProductAmount(this)" class="btn btn-primary">Next>></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="FK_Customerserviceregister" />
                                            </div>


                                            <div id="navpills2-2" class="tab-pane">
                                                <div class="card-body">
                                                    @*<div class="table-responsive">*@
                                                    <div class="table-responsive-sm">
                                                        <table class="table table-hover table-responsive-sm table-striped  text-black" id="AttendedProductServices">
                                                            <thead class="bg-primary text-white">
                                                                <tr>
                                                                <tr>
                                                                    @*<th></th>*@
                                                                    <th style="display:none"> </th>
                                                                    <th style="display:none"></th>
                                                                    <th></th>
                                                                    <th>Employee</th>
                                                                    <th>Department</th>
                                                                    <th>Role</th>

                                                                </tr>


                                                            </thead>
                                                            <tbody id="AttendedProductServiceTbody">
                                                                <tr id="0">
                                                                    <td colspan="4" style="text-align:center;">No Records...</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        <div class="modal-footer">

                                                            <button type="button" id="btnSaveAttendedServices" onclick="BindServiceattended(this)" class="btn btn-primary">Next>></button>




                                                        </div>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="FK_Customerserviceregister" value="@Model.FK_Customerserviceregister" />
                                            </div>

                                            <div id="navpills2-3" class="tab-pane">
                                                <div class="card">

                                                    <div class="row">
                                                        <div class="col-sm-4">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">


                                                                </label>
                                                                <div class="col-sm-8  PerError">

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">


                                                                </label>
                                                                <div class="col-sm-8  PerError">

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">


                                                                </label>
                                                                <div class="col-sm-8  PerError">

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Visited Date</span>
                                                                    <span class="text-danger">*</span>
                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <input type="date" class="form-control perfectValidate_date" name="VisitedDateAfter" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" min="01-01-1970" onchange="datecheck(this)" />
                                                                    <div class="invalid-feedback animated fadeInUp temptableErrors"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Customer Note</span>

                                                                </label>
                                                                <div class="col-sm-8  PerError">
                                                                    <span class="text-danger temptableError"></span>
                                                                    <textarea type="text" class="form-control" name="CustomerNote" rows="3" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input"></textarea>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Employee Note</span>

                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <textarea type="text" class="form-control" name="EmployeeNote" rows="3" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="250"></textarea>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4" style="display:none">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Service Amount</span>

                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <div class="input-group mb-2">
                                                                        <div class="input-group-prepend">
                                                                            <span class="input-group-text fa fa-money bg-primary text-white"></span>
                                                                        </div>
                                                                        <input type="text" class="form-control text-right" readonly="readonly" oninput="decimalpnt(this,'ServiceAmount',3)" placeholder="" name="ServiceAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Security Amount</span>

                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <input type="text" class="form-control text-right" placeholder="" oninput="decimalpnt(this,'ReplaceAmount',3)" name="ReplaceAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4" style="display:none">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Product /Replace Amount</span>

                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <input type="number" class="form-control text-right" readonly="readonly" placeholder="" oninput="decimalpnt(this,'ProductAmount',3)" name="ProductAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4" style="display:none">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Total Amount</span>

                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <input type="text" class="form-control text-right" readonly="readonly" placeholder="" oninput="decimalpnt(this,'TotalAmount',3)" name="TotalAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4" style="display:none">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Discount Amount</span>

                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <input type="text" class="form-control text-right" placeholder="" id="disamount" name="DiscountAmount" oninput="decimalpnt(this,'DiscountAmount',3)" onchange="CalculateTotal(this)" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" min="0" maxlength="9" />
                                                                    @*<div class="invalid-feedback animated fadeInUp limit-check" style="display: block;"></div>
                                                                        <div id="disamount-error" class="Custominvalid animated fadeInUp disamounterror" style="display: none;">Amount should be less or equal to Total Amount</div>*@


                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4" style="display:none">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Net Amount</span>

                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <input type="text" class="form-control  text-right" readonly="readonly" oninput="decimalpnt(this,'NetAmount',3)" placeholder="" name="NetAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Action</span>
                                                                    <span class="text-danger">*</span>
                                                                </label>
                                                                <div class="col-sm-8">
                                                                    <select class="form-control perfectValidate_numeric" name="ID_NextAction" perfect-class="formGroupControl" onchange="Showactionlead(this)" perfect-ctype="select" perfect-css="select">

                                                                        <option value="">Please select</option>
                                                                        @if (!(Model.NextActionMode is null))
                                                                        {
                                                                            foreach (var Mode in Model.NextActionMode)
                                                                            {
                                                                                <option value="@Mode.ID_NextAction" Status="@Mode.FK_ActionStatus">@Mode.NxtActnName</option>
                                                                            }
                                                                        }
                                                                    </select>

                                                                </div>
                                                            </div>
                                                        </div>

                                                        @*<div class=" showactionlead">*@
                                                        <div class="col-sm-4 divactionlead">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Lead Action</span>
                                                                    <span class="text-danger">*</span>
                                                                </label>
                                                                <div class="col-sm-8 PerError">
                                                                    <select class="form-control" name="ID_NextActionLead" perfect-class="formGroupControl" onchange="SetActiontypedropdown(this)" perfect-ctype="select" perfect-css="select" perfect-tempTable-ProductType="FK_NetAction">
                                                                        <option value="0">Please select</option>
                                                                        @if (!(Model.LeadNextActionlists is null))
                                                                        {
                                                                            foreach (var NextAction in Model.LeadNextActionlists)
                                                                            {
                                                                                <option value="@NextAction.ID_NextActionLead" Statuslead="@NextAction.NxtActnStageLead">@NextAction.NxtActnNameLead</option>
                                                                            }
                                                                        }
                                                                    </select>
                                                                    <div class="text-danger temptableError"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4 divactiontype">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Action Type</span>
                                                                    <span class="text-danger">*</span>
                                                                </label>
                                                                <div class="col-sm-8 PerError">
                                                                    <select class="form-control" name="FK_ActionType" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                                                        <option value="0">Please select</option>
                                                                        @if (!(Model.Actntyplists is null))
                                                                        {
                                                                            foreach (var Action in Model.Actntyplists)
                                                                            {
                                                                                <option value="@Action.FK_ActionType">@Action.ActnTypeName</option>
                                                                            }
                                                                        }
                                                                    </select>
                                                                    <div class="text-danger temptableError"></div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-4   divfollowupdate">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Follow up Date</span>
                                                                    <span class="text-danger">*</span>
                                                                </label>
                                                                <div class="col-sm-8 PerError">

                                                                    <input type="date" class="form-control" id="textNextActionDate" name="NextActionDateLead" perfect-class="formGroupControl" perfect-ctype="date" perfect-css="date" max="2050-01-01" />

                                                                    <div class="invalid-errors animated fadeInUp limit-check" style="display: block;"></div>

                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-4  divaasignedto">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Assigned To</span>
                                                                </label>
                                                                <div class="col-sm-8">


                                                                    <div class="input-group">

                                                                        @if (!(Model.EmployeeInfoList is null))
                                                                        {
                                                                            foreach (var EmployeeInfo in Model.EmployeeInfoList)
                                                                            {
                                                                                <input type="text" class="form-control perfectValidate_string_nm" value="@EmployeeInfo.EmpFName" placeholder="" name="AssignEmp" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />
                                                                                <input type="hidden" name="FK_EmployeeAssign" value="@EmployeeInfo.ID_Employee" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />

                                                                            }


                                                                        }
                                                                        <div class="input-group-append">

                                                                            <button id="addEmployee-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchValAssign(this,69,'Employee Details',[],['Branchs','BranchTypeID','FK_Departement','Department','BranchType','SLNo'])" Function="" Criterea1="0" Criterea2="0" Criterea3="0" BindName="AssignEmp" BindVal="FK_EmployeeAssign"></button> @*Criterea1="FK_Departement" Criterea2="BranchID" Criterea3="BranchTypeID"*@

                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>

                                                        @*</div>*@
                                                        <div class="col-sm-4 DivBillType" @*style="display:none"*@>
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">
                                                                    <span perfect-class="formGroupLabel">Bill Type</span>
                                                                    <span class="text-danger">*</span>
                                                                </label>
                                                                <div class="col-sm-8">

                                                                    <select class="form-control " name="BillTypeID" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                                                        <option value="">Please Select </option>


                                                                        @if (!(Model.BillTypeListView is null))
                                                                        {
                                                                            foreach (var BillType in Model.BillTypeListView)
                                                                            {
                                                                                <option value="@BillType.BillTypeID">@BillType.BillType</option>
                                                                            }
                                                                        }
                                                                    </select>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group row" perfect-class="formGroup">
                                                                <label class="col-sm-4 col-form-label">Payment Method</label>
                                                                <div class="col-sm-5">
                                                                    <div class="input-group">

                                                                        <div class="input-group-append">
                                                                            &nbsp;<button id="addcountry-jq-searchButton3" class="btn btn-primary fa fa-money" type="button" perfect-css="button" title="Add Payment Method" onclick="GetPaymentlists(this)"></button>

                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>


                                                        <div class="modal fade" perfect-class="formGroupModalpayment" id="formGroupModalpayment">
                                                            <div class="modal-dialog  modal-dialog-centered modal-md" role="document">
                                                                <div class="modal-content">
                                                                    <div class="modal-header border-0">
                                                                        <h5 class="modal-title">Payment Method</h5>
                                                                        <button type="button" class="close" data-dismiss="modal">
                                                                            <span>&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body" perfect-class="formGroup" style="max-height: calc(100vh - 200px); overflow-y: auto;padding: 1rem;">
                                                                        <div class="row">


                                                                            <div class="col-sm-12">
                                                                                <div class="form-group row" perfect-class="formGroup">
                                                                                    <label class="col-sm-4 col-form-label">Method <span class="text-danger">*</span></label>
                                                                                    <div class="col-sm-8">
                                                                                        <div class="input-group">
                                                                                            <select class="form-control" perfect-tempTable-Payment="PaymentMethod" name="PaymentMethod" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select">
                                                                                                <option value="">Please Select </option>


                                                                                                @if (!(Model.PaymentView is null))
                                                                                                {
                                                                                                    foreach (var Module in Model.PaymentView)
                                                                                                    {
                                                                                                        <option value="@Module.PaymentmethodID">@Module.Name</option>
                                                                                                    }
                                                                                                }
                                                                                            </select>


                                                                                        </div>
                                                                                        <div class="text-danger temptableError"></div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-sm-12">
                                                                                <div class="form-group row" perfect-class="formGroup">
                                                                                    <label class="col-sm-4 col-form-label">
                                                                                        <span perfect-class="formGroupLabel">Ref No.</span>

                                                                                    </label>
                                                                                    <div class="col-sm-8">

                                                                                        <div class="input-group">
                                                                                            <input type="text" class="form-control " perfect-tempTable-Payment="Refno" name="Refno" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="250" />

                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-sm-12">
                                                                                <div class="form-group row" perfect-class="formGroup">
                                                                                    <label class="col-sm-4 col-form-label">
                                                                                        <span perfect-class="formGroupLabel">Amount</span>
                                                                                        <span class="text-danger">*</span>
                                                                                    </label>
                                                                                    <div class="col-sm-8">
                                                                                        <div class="input-group">
                                                                                            <input type="text" class="form-control text-right" perfect-tempTable-Payment="PAmount" id="PAmount" name="PAmount" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" oninput="decimalpnt(this,'PAmount',3)" onchange="Pamount(this)" maxlength="12" />

                                                                                        </div>
                                                                                        <div class="text-danger temptableError"></div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-sm-9">


                                                                            </div>
                                                                            <div class="col-sm-3 text-right">
                                                                                <div class="input-group">

                                                                                    <div class="input-group-append">
                                                                                        <div>
                                                                                            <button type="button" class="btn btn-primary1 " onclick="createtable(this,'Payment',['PaymentMethod'],paytableOptionsTempOut)"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                                                                            <button class="btn btn-light1" type="button" onclick="productclear(this, 'Payment')"><i class="fa fa-refresh" aria-hidden="true"></i></button>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>

                                                                            </div>
                                                                            <div class="col-sm-12">
                                                                                <div class="form-group row" perfect-class="formGroup">
                                                                                    <label class="col-sm-4 col-form-label">
                                                                                        <span perfect-class="formGroupLabel" style="font-weight:500;">Bal. Amount :</span>

                                                                                    </label>
                                                                                    <div class="col-sm-8">
                                                                                        <div class="input-group">

                                                                                            <label class="col-form-label">
                                                                                                <span perfect-class="formGroupLabel" style="font-weight:500;" name="BalAmt"></span>
                                                                                            </label>
                                                                                            @*<input type="text" class="form-control" perfect-temptable-payment="BalAmt" name="BalAmt" perfect-class="" perfect-ctype="input" perfect-css="input" readonly="" style="border:white;background:white;font-weight: 500;">*@
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>


                                                                            <div class="col-sm-12">
                                                                                <div class="form-group row" perfect-class="formGroup">

                                                                                    <div class="table-responsive" perfect-tempTable-Payment="" perfect-tempTable="Payment" id="Paymentdethead" perfect-tempTable-lastindex="0" perfect-tempTable-action="0"></div>
                                                                                    <div class="text-danger temptableError"></div>

                                                                                </div>
                                                                            </div>


                                                                        </div>
                                                                        <div class="modal-footer">
                                                                            @*<button type="button" onclick="CreateProductCheckDescription(this);" class="btn btn-primary">Add</button>*@
                                                                            <button type="button" class="btn btn-primary light" onclick="Billttlnetchck(this)">Apply</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-right" perfect-class="formFooter">
                                                        <button type="button" id="btnSave" onclick="fn_SaveCustomerService(this);" class="btn btn-primary" name="add">Save</button>
                                                        <button id="btnupdate" type="button" class="btn btn-primary mr-3 addcompany-jq-addnewuserUpdate d-none" name="update" perfect-css="button" onclick="UpdateServicefollowup(this)"><i class="fa fa-refresh fa-spin  loaderClass"></i>Update</button>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="FK_Customerserviceregister" />
                                                <input type="hidden" name="ID_Product" value="@Model.ID_Product" />
                                            </div>
                                            <div id="History" class="tab-pane">
                                                <div class="row">
                                                    <div class="card-body">
                                                        <div id="servdet" style="display:none"></div>
                                                        <div class="row col-md-12" id="servicehis"></div>
                                                    </div>
                                                </div>
                                                @*<div class="card">

                                                        <div class="card-body">
                                                            <div class="table-responsive">
                                                                <table class="table table-responsive-sm" id="Product">
                                                                    <thead class="bg-primary text-white">
                                                                        <tr>
                                                                            <th>SI.No.</th>
                                                                            <th>Ticket No</th>
                                                                            <th>Service</th>
                                                                            <th>Complaint</th>
                                                                            <th>Status</th>
                                                                            <th>Closed Date</th>
                                                                            <th>Employee Note</th>

                                                                        </tr>
                                                                    </thead>
                                                                    <tbody id="ProductTbodyhistroy">
                                                                        <tr id="0">
                                                                            <td colspan="7" style="text-align:center;">No Records...</td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>*@
                                            </div>
                                            <div id="warranty" class="tab-pane">
                                                <div class="form-row">
                                                    <div class="col-sm-12">
                                                        <div class="card" style="height:fit-content;margin-bottom: 0rem;">
                                                            <div class="card-body">
                                                                <div id="warrntydt" style="display:none"></div>
                                                                <div class="row col-md-12" id="warrantyhis"></div>

                                                            </div>
                                                        </div>

                                                        <div class="card" style="height:fit-content; margin-bottom: 0rem;">

                                                            <div class="card-header" style="display:none" id="Warrantyheader">
                                                                <h4 class=""><span id="invoiceno"></span> </h4>
                                                            </div>
                                                            <div class="card-body">
                                                                <div class="table-responsive" perfect-tempTable="Warrantydet" style="display:none" id="Warrantydet">
                                                                    <table class="table table2-hover table-responsive-sm table2-striped  text-black" id="Warrantydetlst">
                                                                        <thead class="bg-primary text-white">
                                                                            <tr>
                                                                                <th>Warranty/AMC Type</th>
                                                                                <th>Repl. Warranty/AMC Due Dt</th>
                                                                                <th>Serv. Warranty/AMC Renewal Dt</th>
                                                                                <th>Doc Type</th>
                                                                                <th></th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody id="Warrantydetbdy">
                                                                            <tr id="0">
                                                                                <td colspan="7" style="text-align:center;">No Records...</td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>



                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>




                    </form>


                    @*</form>*@
                </div>

            </div>
            <div class="modal fade show" id="imageGrid" style="display:none; padding-right: 17px" aria-modal="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content rounded-0">
                        <div class="modal-header border-0">
                            <h5 class="modal-title text-primary" id="modaltit"></h5>
                            <button type="button" class="close" data-dismiss="modal">
                                <span>×</span>
                            </button>
                        </div>
                        <div class="modal-body" style="padding: 1rem;">
                            <p>
                                <button type="button" class="btn btn-rounded btn-primary2" title="Zoom-in" onclick="zoomin()"><i class="fa fa-search-plus fa-lg"></i></button>
                                <button type="button" class="btn btn-rounded btn-primary2" title="Zoom-out" onclick="zoomout()"><i class="fa fa-search-minus fa-lg"></i></button>
                                <button type="button" class="btn btn-rounded btn-primary2" title="Image view" onclick="actual()"><i class="fa fa-search fa-lg"></i></button>
                                <button type="button" class="btn btn-rounded btn-primary2" title="Download file" onclick="download()"><i class="fa fa-download fa-lg"></i></button>
                            </p>
                            <img id="myImg" onclick="imgzoomin()">
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{

    <script>

    //const $formContainer = $('#jq_ServiceIndex_formContainer');
    var serviceids;
    var proddetls;
    var servdetls;
    var attendeddetls;
    var paymentdetls;

    (function () {
        //jQuery('form').validate();//<-----  Validate/initialize our form on page load
        jQuery('select').selectpicker();
    })();
    $(document).ready(function () {

        var today = new Date().toISOString().split('T')[0];
        document.getElementsByName("NextActionDateLead")[0].setAttribute('min', today);
        serviceids = @ViewBag.Service ;

        $('.divaasignedto').hide();
        $('.divfollowupdate').hide();
        $('.divactiontype').hide();
        $('.divactionlead').hide();



        $('#jq-sidemenu').hide();
        if (serviceids != 0) {
            Servicefollowup(this, serviceids)
        }
        else {

             proddetls="";
             servdetls="";
            attendeddetls = "";
            paymentdetls = "";
        }

           GetProserDetails(this,@Model.FK_Customerserviceregister);
           GetServices(this,@Model.FK_Customerserviceregister);
           GetAttendedEmployeeDetails(this,@Model.FK_Customerserviceregister);


        $("#ProductServicesMore").on('change', "input[type='checkbox']", function (e) {



            if ($("input[id='chk1']:checked").length > 0) {
                document.getElementById("btnSaveServicesMore").disabled = false;
            }
            else {
                document.getElementById("btnSaveServicesMore").disabled = true;
            }

        });

        $("#ReplacecProductDetails").on('change', "input[type='checkbox']", function (e) {

            if ($("input[id='chk2']:checked").length > 0) {
                document.getElementById("btnSaveMoreReplaceProduct").disabled = false;
            }
            else {
                document.getElementById("btnSaveMoreReplaceProduct").disabled = true;
            }

        });



            let $thisForm = $(this).find('[perfect-class="form"]');
            $thisForm.closest('.jq_Service_body').find('.ServiceformSesction').addClass('d-none');
           let $thisFormPrhistory = $(this).find('[perfect-class="ProHistory"]');
           $thisFormPrhistory.closest('.jq_ProHistory_body').find('.ProductHisformSesction').addClass('d-none');

             $thisForm.validate({ messages: validationMessage });

            let $thisForms = $(this).find('[perfect-class="form"]');
        $thisForms.find('[name="VisitedDateAfter"]').val(moment().format('YYYY-MM-DD'));
        $thisForms.find('[name="DiscountAmount"]').val(0);

       // GetProductDetails(this, $thisForms.find('[name="ID_Product"]').val());
        var ProducttableOptions = {

            renameHeader: { "Complaint": "Complaint/Service" },
            hideColumn: ["ID_Master", "TransMode"],
            trackInfo: { "TicketNo": "Click to more information" },
            serialNo: true,
        };

         var obj = {
             FK_Customer: isNaN(parseInt($thisForm.find('[name=FK_Customer]').val())) ? 0 : parseInt($thisForm.find('[name=FK_Customer]').val()),
             FK_CustomerOthers: isNaN(parseInt($thisForm.find('[name=FK_CustomerOthers]').val())) ? 0 : parseInt($thisForm.find('[name=FK_CustomerOthers]').val()),
             FK_Product: isNaN(parseInt($thisForm.find('[name=ID_Product]').val())) ? 0 : parseInt($thisForm.find('[name=ID_Product]').val()),
             FK_Category: isNaN(parseInt($thisForm.find('[name=FK_Category]').val())) ? 0 : parseInt($thisForm.find('[name=FK_Category]').val()),
         Mode: 2
         }

         $.ajax({
                 url: "@Url.Action("getBillList", "Service")",
                type: "POST",
                data: obj ,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
                  success: function (ajaxOutput) {

                 if (ajaxOutput.Process.IsProcess) {
                     let table = JSON.parse(ajaxOutput.Data);

                     $('#servicehis').html(pft_table_createtable(table.dtable, ProducttableOptions))

                 }


             }



         });



        // ... Custom validation message

                  //  $('#GridData').DataTable();
    $('#GridData').DataTable({
            "searching": false,
        "paging": false,
            "info": false,
         "bAutoWidth": false,
        "bLengthChange": false,
        "recordsFiltered":false,
        "ordering": false
        });

        var today = new Date();
        var day = today.getDate() > 9 ? today.getDate() : "0" + today.getDate(); // format should be "DD" not "D" e.g 09
        var month = (today.getMonth() + 1) > 9 ? (today.getMonth() + 1) : "0" + (today.getMonth() + 1);
        var year = today.getFullYear();

        $thisForms.find('[name="VisitedDateAfter"]').attr('max', year + "-" + month + "-" + day);

    });

    //Function for edit from page index list view ,bind data
    function ConvertJsonDate(Jsondate) {
        var date = "";
        if (Jsondate != "" && Jsondate != null && Jsondate != undefined) {
            var dateString = Jsondate.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            var day = currentTime.getDate();
            var year = currentTime.getFullYear();
            date = day + "-" + month + "-" + year;
        }
        return date;
    }
    function decimalpnt(ele, name, range) {

        let input = $('#' + name);
        ele.value = ele.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');
        let t = ele.value;
        ele.value = (t.indexOf(".") >= 0) ? (t.substr(0, t.indexOf(".")) + t.substr(t.indexOf("."), range)) : t;
        input.on('keydown', function () {
            if (ele.value.includes('.')) {

            }
            var key = event.keyCode || event.charCode;
            if (key == 8 || key == 46) { }
            else {
                if (ele.value.length == 9) {
                    ele.value = ele.value + '.';
                }
            }

        });

    }


    function Servicefollowup(ele, ID_ServiceFollowUp) {
        debugger
            let inputData = {
                __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                ID_ServiceFollowUp: ID_ServiceFollowUp,
                TransMode:'@ViewBag.TransMode',

        };


            $.ajax({
                url: '@Url.Action("GetServicefollowupInfoByID", "ServiceList")',
                        type: "POST",

                        data: inputData,
                        dataType: "json",
                        contentType: 'application/x-www-form-urlencoded;charset=utf-8',
                        success: function (ajaxOutput) {


                        console.log("Return", ajaxOutput.Data[0]);
                            if (ajaxOutput.Process.IsProcess) {

                                console.log('>_ Inside GetservicefollowupinfoInfo', ajaxOutput)

                                $sideMenuOptions.close();

                                let $thisForm = $(ele).find('[perfect-class="form"]');

                                $thisForm.validate({ messages: validationMessage });
                                $thisForm.find('button[name=add]').addClass('d-none');

                                var date1 = moment(ajaxOutput.Data[0].EntrOn).format('YYYY-MM-DD');


                                var today = new Date();
                                date1 = new Date(date1);
                                date1.setHours(0, 0, 0, 0)

                                var today = new Date();
                                today.setHours(0, 0, 0, 0)

                                if (today.toDateString() != date1.toDateString()) {

                                    $thisForm.find('button[name=update]').addClass('d-none');

                                }
                                else {
                                    console.log('entron', date1);
                                    $thisForm.find('button[name=update]').removeClass('d-none');
                                }
                                debugger

                                $thisForm.data({ pData: ajaxOutput.Data[0] }); //setting the pdata value in form for update -id is taking
                                $thisForm.attr('perfect-onFormSuccess', '.jq_ServiceIndex_formContainer');
                                $thisForm.find('button[name=add]').addClass('d-none');
                                console.log('anson1', ajaxOutput.Data[0].CustomerNote);
                                console.log('anson1', ajaxOutput.Data[0].EmployeeNote);
                                $thisForm.find('[name=VisitedDateAfter]').val(moment(ajaxOutput.Data[0].VisitedDateAfter).format('YYYY-MM-DD'));
                                $thisForm.find('[name="CustomerNote"]').val(ajaxOutput.Data[0].CustomerNote),
                                    $thisForm.find('[name="EmployeeNote"]').val(ajaxOutput.Data[0].EmployeeNote),
                                    $thisForm.find('[name="ServiceAmount"]').attr("readonly", true),
                                    $thisForm.find('[name="ProductAmount"]').attr("readonly", true),
                                    $thisForm.find('[name="ReplaceAmount"]').val(ajaxOutput.Data[0].ReplaceAmount),
                                    $thisForm.find('[name="TotalAmount"]').attr("readonly", true),
                                    $thisForm.find('[name="NetAmount"]').attr("readonly", true),
                                    $thisForm.find('[name="DiscountAmount"]').val(/*ajaxOutput.Data[0].DiscountAmount*/),

                                    $thisForm.find('[name="ID_NextAction"]').val(ajaxOutput.Data[0].ID_NextAction).selectpicker('refresh'),
                                    $thisForm.find('[name="ID_NextAction"]').trigger('change');
                                $thisForm.find('[name="ID_NextActionLead"]').val(ajaxOutput.Data[0].ID_NextActionLead).selectpicker('refresh'),
                                    $thisForm.find('[name="ID_NextActionLead"]').trigger('change');
                                $thisForm.find('[name="FK_ActionType"]').val(ajaxOutput.Data[0].FK_ActionType).selectpicker('refresh'),
                                    $thisForm.find('[name="BillTypeID"]').val(ajaxOutput.Data[0].BillTypeID).selectpicker('refresh'),


                                    $thisForm.find('[name=NextActionDateLead]').val(moment(ajaxOutput.Data[0].NextActionDateLead).format('YYYY-MM-DD'));
                                // $thisForm.find('[name=AssignEmp]').val(ajaxOutput.Data[0].EmployeeName),
                                $thisForm.find('[name=FK_EmployeeAssign]').val(ajaxOutput.Data[0].FK_EmployeeAssign).selectpicker('refresh'),





                                    servdetls = ajaxOutput.Data[0].ServiceDetails;
                                console.log('servdetls', servdetls);

                                //  bindTextboxservicecost(ajaxOutput.Data[0].ServiceDetails.ID_Mode);
                                proddetls = ajaxOutput.Data[0].ProductDetails
                                console.log('servdetls', proddetls);
                                // bindTextbox(ajaxOutput.Data[0].ProductDetails.ID_Mode);
                                attendeddetls = ajaxOutput.Data[0].AttendedEmployeeDetails
                                console.log('attendeddetls', attendeddetls);

                                if (ajaxOutput.Data[0].PaymentDetail != null) {
                                    fillTablepaymentmethod($thisForm, 'Payment', ajaxOutput.Data[0].PaymentDetail, paytableOptionsTempOut)
                            }
                                if (ajaxOutput.Data[0].ReplaceAmount > 0) {
                                    $(".DivBillType").show();
                                    $thisForm.find('[name="BillTypeID"]').addClass('perfectValidate_numeric');
                                }
                                else if (ajaxOutput.Data[0].ReplaceAmount == 0 || ajaxOutput.Data[0].ReplaceAmount == "") {

                                    $(".DivBillType").hide();
                                    $thisForm.find('[name="BillTypeID"]').val('').selectpicker('refresh');
                                    $thisForm.find('[name="BillTypeID"]').removeClass('perfectValidate_numeric');
                                }


                            }
                            else {
                                console.log('>_ Inside GetServicefollowupInfo :false')

                                $.each(ajaxOutput.Process.Message, function (key, value)
                                {
                                    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });

                                });
                            }
                },

            });

        }

    function fillTablepaymentmethod(ele, tkey, data, tableOptionsTempOut) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let tableOptionsTempfill = tableOptionsTempOut;
        let insertData = []
        let tableKey = tkey;
        let indexname = tkey + 'index';
        tableOptionsTempfill.rowAttribute.push(indexname);
        tableOptionsTempfill.hideColumn.push(indexname);
        let $tblcontainer = $thisForm.find('[perfect-tempTable="' + tableKey + '"]');
        $.each(data, function (keyOne, valOne) {

            let pData = {};

            pData[indexname] = keyOne + 1;
            $tblcontainer.attr('perfect-tempTable-lastindex', pData[indexname])
            //---

            $thisForm.find('[perfect-tempTable-' + tableKey + ']').each(function () {
                let $this = $(this);
                let headerName = $this.attr('perfect-tempTable-' + tableKey);
                let nameAttr = $this.attr('name');
                //console.log('tfhyrtname', nameAttr)
                if (typeof valOne[nameAttr] !== undefined) {

                    if ($this.is('select')) {
                        // tableOptionsTempfill.renameHeader[nameAttr + '_d'] = headerName;
                        tableOptionsTempfill.hideColumn.push(nameAttr);
                        //displat text of select
                        pData[nameAttr + '_d'] = $this.find('[value="' + valOne[nameAttr] + '"]').text();
                        pData[nameAttr] = valOne[nameAttr];
                        console.log('select', $this.find('options[value="' + valOne[nameAttr] + '"]').text());

                    }
                    else if ($this.is('input')) {

                        let inputType = $this.attr('type').toLocaleLowerCase();
                        console.log(inputType)


                        if (inputType == 'date') {

                            if (valOne[nameAttr] == null) {
                                pData[nameAttr] = valOne[nameAttr];
                            }
                            else {
                                pData[nameAttr] = moment(valOne[nameAttr]).format('YYYY-MM-DD');
                            }


                        }
                        else {
                            pData[nameAttr] = valOne[nameAttr];


                        }
                    }
                    else {
                        pData[nameAttr] = valOne[nameAttr];


                    }
                }



            });

            insertData.push(pData);


            //----

        });
        $tblcontainer.empty();
        $tblcontainer.append(pft_table_createtable(insertData, tableOptionsTempfill));

    }




    function datecheck(ele) {
        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        //invalid-feedback

        let Visitdate = $thisForm.find('[name="VisitedDateAfter"]').val();
        var enqDate = new Date(Visitdate);
        enqDate.setHours(0, 0, 0, 0)
        var today = new Date();
        today.setHours(0, 0, 0, 0)


        let errorClass4 = '.temptableErrors';
        if (enqDate > today) {

            $thisForm.find('[name="VisitedDateAfter"]').closest('[perfect-class="form"]').find(errorClass4).attr("style", "display:block");
            $thisForm.find('[name="VisitedDateAfter"]').closest('[perfect-class="form"]').find(errorClass4).text('Future Date Not Allowed');
        }
       //else if (enqDate < today) {

       //     $thisForm.find('[name="VisitedDateAfter"]').closest('[perfect-class="formGroup"]').find(errorClass4).attr("style", "display:none");
       //     $thisForm.find('[name="VisitedDateAfter"]').closest('[perfect-class="formGroup"]').find(errorClass4).text('');
       // }
    }




    var validationMessage = {

        'VisitedDateAfter': {
            'required': 'Please Enter A Date',
            'maxlength': jQuery.validator.format(' Name should be less than {0} characters'),
            'stringonly': 'Special characters are not allowed in  Name'

        },
        'ID_NextAction': {
            'required': 'Please Select Next Action',
            'digits': 'Invalid State selected'
        },
        'FK_ActionType': {
            'required': 'Please Select  Action Type',
            'digits': 'Invalid Action Type selected'
        },
        'ID_NextActionLead': {
            'required': 'Please Select  Lead Action',
            'digits': 'Invalid  Lead Action selected'
        },
        'NextActionDateLead': {
            'required': 'Please Enter Follow up Date',
            'min': jQuery.validator.format('Please Enter a Valid Date')
        },
        'BillTypeID': {
            'required': 'Please Select Bill Type',
            'digits': 'Invalid BillType selected'
        }


    };
                function Filter(ele) {

                    $('.bd-example-modal-sm').modal('show');
        }





    var serviceproductdetails;

        function GetServices(ele, id) {
            let $dropDownList = [];
            var $thisForm = $(ele).closest('[perfect-class="form"]');
        var InputData = {
            'FK_Customerserviceregister': id
        }

        $.ajax({
            url: "@Url.Action("GetServiceDetails", "ServiceList")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
                $ProductHtml = '';
                if (ajaxOutput != null) {
                    let checked = "";
                    let arrayList = [];
                    if (servdetls != "") {
                        debugger
                        ajaxOutput.Lits.Data = servdetls;
                        arrayList = servdetls;
                        checked = "checked";
                    }
                    if (ajaxOutput.Lits.Data != null) {

                        if (ajaxOutput.Lits.Data.length > 0) {
                            $.each(ajaxOutput.Lits.Data, function (i, value) {
                                debugger
                                //let options = ''
                                //if (servdetls != '') {

                                //    $.each(servdetls, function (key, value1) {

                                //        if (value1.ID_Mode == value.ID_Mode) {


                                //            $.each(ajaxOutput.ServiceMod.Data, function (i, valuea) {
                                //                if (valuea.ID_Mode.toString() == value1.ID_Mode) {

                                //                    options += '<option value=' + valuea.ID_Mode + ' selected="selected">' + valuea.ModeName + '</option>'
                                //                }
                                //                else {
                                //                    options += '<option value=' + valuea.ID_Mode + '>' + valuea.ModeName + '</option>'
                                //                }
                                //            });
                                //        }


                                //    });

                                //}
                                //else {

                                //    $.each(ajaxOutput.ServiceMod.Data, function (i, valuea) {
                                //        options += '<option value=' + valuea.ID_Mode + '>' + valuea.ModeName + '</option>'
                                //    });
                                //    //---

                                //}

                                let options = ''
                                if (servdetls != '') {

                                    $.each(servdetls, function (key, value1) {

                                        if (value1.ID_Mode == value.ID_Mode) {

                                            //value.OctyAmount = value1.OctyAmount;
                                            $.each(ajaxOutput.ServiceMod.Data, function (i, valuea) {
                                                debugger
                                                if (valuea.ID_Mode.toString() == value1.ID_Mode) {

                                                    let optionValue = '<option value=' + valuea.ID_Mode + ' selected="selected">' + valuea.ModeName + '</option>';
                                                    if (!$dropDownList.includes(optionValue)) {
                                                        $dropDownList.push(optionValue)
                                                    }
                                                }
                                                else {
                                                    let optionValue = '<option value=' + valuea.ID_Mode + '>' + valuea.ModeName + '</option>';
                                                    if (!$dropDownList.includes(optionValue)) {
                                                        $dropDownList.push(optionValue)
                                                    }
                                                }
                                            });
                                        }


                                    });

                                }
                                else {

                                    $.each(ajaxOutput.ServiceMod.Data, function (i, valuea) {
                                        let optionValue = '<option value=' + valuea.ID_Mode + '>' + valuea.ModeName + '</option>';
                                        if (!$dropDownList.includes(optionValue)) {
                                            $dropDownList.push(optionValue)
                                        }
                                    });

                                }

                                $.each($dropDownList, function (i, value) {
                                    options += value;
                                });
                                $dropDownList = [];

                                let idReadOnly = parseInt((value.ID_Mode == undefined ? 1 : value.ID_Mode))!=1?"readonly":""
                                let $dropdownservice = '<select class="form-control" onchange="bindTextboxservicecost(this)">' + options + '</select>';
                                let rowCount = (i + 1);
                                let row = $(ele).closest("tr");
                                row.find('.jq_ProductServiceMode_td').find('selected').val(value.ID_Mode);
                                $ProductHtml += "<tr id=" + rowCount + ">";
                                $ProductHtml += "<td class='jq_ProductServices_ID_Services' Style='Display:none'>" + value.ID_Services + "</td>";
                                $ProductHtml += "<td class='jq_ProductServices_ID_Product' Style='Display:none'>" + value.ID_Product + "</td>";

                                $ProductHtml += "<td class='jq_ProductServices_td' ><input type='checkbox'  value='" + value.ProductStatus + "'" + checked + "/></td>";
                                $ProductHtml += "<td>" + value.SubProduct + "</td>";
                                $ProductHtml += "<td>" + value.Service + "</td>";
                                $ProductHtml += "<td class='jq_ProductServiceMode_td'>" + $dropdownservice + "</td>";
                                $ProductHtml += "<td class='jq_ProductServicesAmnt_td' ><input onkeypress='return /[0-9.]/i.test(event.key)' type='text'  min='0' maxlength ='12' "+`onpaste="return false"`+" class='form-control servicecost text-right' perfect-class='formGroupControl'  value='" + parseFloat(value.ServiceCost).toFixed(2) + "' " + `onchange="GetTaxNetdetails(this)" ${idReadOnly}` + "/></td>";
                                $ProductHtml += "<td class='jq_ProductServicesTaxAmount' style='display:none'><input onkeypress='return /[0-9]/i.test(event.key)' type='number'  min='0' maxlength ='12' class='form-control TaxAmount text-right' perfect-class='formGroupControl'  value='" + parseFloat(value.ServiceTaxAmount).toFixed(2) + "' readonly/></td>";
                                $ProductHtml += "<td class='jq_ProductServicesNetAmount' style='display:none'><input onkeypress='return /[0-9]/i.test(event.key)' type='number'  min='0' maxlength ='12' class='form-control NetAmount text-right' perfect-class='formGroupControl'  value='" + parseFloat(value.ServiceNetAmount).toFixed(2) + "' readonly/></td>";
                                $ProductHtml += "<td class='jq_ProductServicesRemarks_td' ><input type='textbox' style='width:300px' class='form-control'  value='" + value.Remarks + "' /></td>";



                                $ProductHtml += "</tr>";
                            });
                        }

                    }
                    else {
                        $ProductHtml += "<tr id='0'><td colspan='8' class='norecord' style'text-align:center'>No Records........</td></tr>";

                    }
                    $('#ProductServiceTbody').append($ProductHtml);

                    $('.bd-Productservice-modal-sm').modal('show');



                }

                    else {
                        $.each(ajaxOutput.Process.Message, function (key, value) {
                            NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                        });
                    }
                },
                complete: function () {
                    $(ele).prop('disabled', false);
                }
            });

        }



      function GetAttendedEmployeeDetails(ele, id) {



          var $thisForm = $(ele).closest('[perfect-class="form"]');
        var InputData = {
            'FK_Customerserviceregister': id
        }

        $.ajax({
            url: "@Url.Action("GetAttendedEmployeeDetails", "ServiceList")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
               // $('[name=FK_Customerserviceregister]').val($(ele).attr('data-id'));
                $AttendedEmpHtml = '';
                if (ajaxOutput != null) {




                        $('#AttendedProductServiceTbody').empty();
                       // var ProductData = ajaxOutput.Data;
                    let checked = "";
                    if (attendeddetls != "") {
                        ajaxOutput.Data = attendeddetls;

                    }
                    if (ajaxOutput.Data != null) {
                        if (ajaxOutput.Data.length > 0) {
                            $.each(ajaxOutput.Data, function (i, value) {
                                console.log("sas", ajaxOutput.Data);
                                let rowCount = (i + 1);
                                if (value.Attend == 1) {
                                    checked = "checked";
                                }
                                else {
                                    checked = "";
                                }
                                $AttendedEmpHtml += "<tr id=" + rowCount + ">";
                                $AttendedEmpHtml += "<td class='jq_ProductServices_ID_Employee' Style='Display:none'>" + value.ID_Employee + "</td>";

                                //    $ProductHtml += "<td style='text-align: center;'>" + rowCount + "</td>";
                                $AttendedEmpHtml += "<td class='jq_ProductServices_td' ><input type='checkbox'  value='" + value.Attend + "'" + checked+" /></td>";
                                $AttendedEmpHtml += "<td>" + value.Employee + "</td>";
                                $AttendedEmpHtml += "<td>" + value.Department + "</td>";
                                $AttendedEmpHtml += "<td>" + value.EmployeeType + "</td>";
                                $AttendedEmpHtml += "<td class='jq_Employeetypeid_td' Style =Display:none>" + value.ID_CSAEmployeeType + "</td>";
                                $AttendedEmpHtml += "</tr>";
                            });
                        }
                    }
                        else {
                            $AttendedEmpHtml += "<tr id='0'><td  colspan='4' style'text-align:center'>No Records..</td></tr>";
                        }

                        $('#AttendedProductServiceTbody').append($AttendedEmpHtml);





                  //  $('#btnUpdate').css('display', 'none');
                  //  $('#btnSave').css('display', 'block');
                    $('.bd-Productservice-modal-sm').modal('show');
                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
            }
        });

    }


    var bindservicemodajaxout;
     function GetServicesadd(ele, id) {



         var $thisForm = $(ele).closest('[perfect-class="form"]');
        var InputData = {
            'FK_Services': id
        }

        $.ajax({
            url: "@Url.Action("GetServiceAddDetails", "ServiceList")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
               // $('[name=FK_Customerserviceregister]').val($(ele).attr('data-id'));

                $ProductHtml = '';
                console.log("sas",ajaxOutput.ServiceMod.Data);
                console.log("Listssas", ajaxOutput.Lits.Data);
                bindservicemodajaxout = ajaxOutput;
                if (ajaxOutput != null) {


                    if (ajaxOutput != null) {

                        $('#ProductServiceTbodyMoredetails').empty();
                       // var ProductData = ajaxOutput.Data;

                        let options = ''
                        $.each(ajaxOutput.ServiceMod.Data,function (i, value) {

                            options += '<option value=' + value.ID_Mode + '>' + value.ModeName + '</option>'
                        });
                        let $dropdownservice = '<select class="form-control" onchange="bindTextboxservicecost(this)">' + options + '</select>';

                        if (ajaxOutput.Lits.Data.length > 0) {
                            $.each(ajaxOutput.Lits.Data, function (i, value) {


                               console.log("sas",ajaxOutput.Data);
                                let rowCount = (i + 1);


                                $ProductHtml += "<tr id=" + rowCount + ">";
                                $ProductHtml += "<td class='jq_ProductServices_ID_Services' Style='Display:none'>" + value.ID_Services + "</td>";
                                $ProductHtml += "<td class='jq_ProductServices_ID_Product' Style='Display:none'>" + value.ID_Product + "</td>";
                                //    $ProductHtml += "<td style='text-align: center;'>" + rowCount + "</td>";
                                $ProductHtml += "<td class='jq_ProductServices_td' ><input id='chk1' type='checkbox'  value='" + value.ProductStatus + "' /></td>";
                                //$ProductHtml += "<td>" + value.SubProduct + "</td>";
                                $ProductHtml += "<td>" + value.Service + "</td>";
                                $ProductHtml += "<td class='jq_ProductServiceMode_td'  >" + $dropdownservice + "</td>";
                                $ProductHtml += "<td class='jq_ProductServicesAmnt_td' ><input onkeypress='return /[0-9.]/i.test(event.key)' type='text' " + `onpaste="return false"` +"  min ='0'   maxlength ='12' class='form-control servicecost text-right' value='" + parseFloat(value.ServiceCost).toFixed(2) + "' " + `onchange="GetTaxNetdetails(this)"` + "/></td>";
                                $ProductHtml += "<td class='jq_ProductServicesTaxAmount' style='display:none'><input onkeypress='return /[0-9]/i.test(event.key)' type='number'  min='0' maxlength ='12' class='form-control TaxAmount text-right' perfect-class='formGroupControl'  value='" + parseFloat(value.TaxAmount).toFixed(2) + "' readonly/></td>";
                                $ProductHtml += "<td class='jq_ProductServicesNetAmount' style='display:none'><input onkeypress='return /[0-9]/i.test(event.key)' type='number'  min='0' maxlength ='12' class='form-control NetAmount text-right' perfect-class='formGroupControl'  value='" + parseFloat(value.NetAmount).toFixed(2) + "' readonly/></td>";
                                $ProductHtml += "<td class='jq_ProductServicesRemarks_td' ><input type='textbox' style='width:300px' class='form-control'  value='" + value.Remarks + "' /></td>";




                                $ProductHtml += "</tr>";
                            });
                            if ($("input[id='chk1']:checked").length > 0) {

                                document.getElementById("btnSaveServicesMore").disabled = false;
                            }
                            else {
                                document.getElementById("btnSaveServicesMore").disabled = true;
                            }

                        }
                        else {
                            $ProductHtml += "<tr id='0'><td colspan='4' style'text-align:center'>No Records..</td></tr>";
                        }




                        $('#ProductServiceTbodyMoredetails').append($ProductHtml);

                    }




                  //  $('#btnUpdate').css('display', 'none');
                  //  $('#btnSave').css('display', 'block');
                    $('.bd-ProductserviceMoredetails-modal-sm').modal('show');
                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
            }
        });

    }
    ///////////////////////////////////////
    function GetTaxNetdetails(ele) {
        let row = $(ele).closest("tr");
        let TaxableAmount = row.find('.jq_ProductServicesAmnt_td').find('input').val();
        let FK_ServiceType = row.find('.jq_ProductServices_ID_Services').text();
        var $thisForm = $(ele).closest('[perfect-class="form"]');
        var InputData = {
            'FK_ServiceType': FK_ServiceType,
            'TaxableAmount': TaxableAmount,
        }

        $.ajax({
            url: "@Url.Action("GetServiceTaxAndNet", "ServiceList")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
                debugger
                if (ajaxOutput != null) {
                    row.find('.jq_ProductServicesTaxAmount').find('input').val(parseFloat(ajaxOutput.TaxNet.Data[0].TaxAmount).toFixed(2));
                    row.find('.jq_ProductServicesNetAmount').find('input').val(parseFloat(ajaxOutput.TaxNet.Data[0].NetAmount).toFixed(2));
                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
            }
        });

    }

         function GetProserDetails(ele, id) {

             let $dropDownList = [];

            var $thisForm = $(ele).closest('[perfect-class="form"]');
        var InputData = {
            'FK_Customerserviceregister': id
        }

        $.ajax({
            url: "@Url.Action("GetProductDetails", "ServiceList")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
               // $('[name=FK_Customerserviceregister]').val($(ele).attr('data-id'));
                $ProductHtml = '';
                if (ajaxOutput != null) {

                    let checked = "";
                    if (proddetls != "") {
                        ajaxOutput.Lits.Data = proddetls;
                        checked = "checked";
                    }
                    if (ajaxOutput != null) {

                        $('#ProductDetailsTbody').empty();
                        console.log("FGFG", ajaxOutput.Lits.Data);
                        console.log("FGFGVew", ajaxOutput.ChangeMod.Data);




                        console.log('proddetls', proddetls)
                        console.log('ajaxOutput.Lits.Data', ajaxOutput.Lits.Data)
                        if (ajaxOutput.Lits.Data != null) {
                            if (ajaxOutput.Lits.Data.length > 0) {

                                $.each(ajaxOutput.Lits.Data, function (i, value) {
                                    let options = ''
                                if (proddetls != '') {

                                    $.each(proddetls, function (key, value1) {

                                        if (value1.ID_Mode == value.ID_Mode) {

                                           //value.OctyAmount = value1.OctyAmount;
                                            $.each(ajaxOutput.ChangeMod.Data, function (i, valuea) {
                                                debugger
                                                if (valuea.ID_Mode.toString() == value1.ID_Mode) {

                                                    let optionValue = '<option value=' + valuea.ID_Mode + ' selected="selected">' + valuea.ModeName + '</option>';
                                                    if (!$dropDownList.includes(optionValue)) {
                                                        $dropDownList.push(optionValue)
                                                    }
                                                }
                                                else {
                                                    let optionValue = '<option value=' + valuea.ID_Mode + '>' + valuea.ModeName + '</option>';
                                                    if (!$dropDownList.includes(optionValue)) {
                                                        $dropDownList.push(optionValue)
                                                    }
                                                }
                                            });
                                        }


                                    });

                                }
                                else {

                                    $.each(ajaxOutput.ChangeMod.Data, function (i, valuea) {
                                        let optionValue = '<option value=' + valuea.ID_Mode + '>' + valuea.ModeName + '</option>';
                                        if (!$dropDownList.includes(optionValue)) {
                                            $dropDownList.push(optionValue)
                                        }
                                    });
                                    //---

                                }

                                $.each($dropDownList, function (i, value) {
                                    options += value;
                                });
                                    $dropDownList = [];




                                    let idReadOnly = "";
                                    let idProduct = "";
                                    let idqtty = "";
                                    switch (parseInt(value.ID_Mode == undefined ? 1 : value.ID_Mode)) {
                                        case undefined: idReadOnly = ""; break;
                                        case 1: idReadOnly = ""; break;
                                        case 2: idReadOnly = ""; break;
                                        default:idReadOnly = "readonly"; break;
                                    }
                                    switch (parseInt(value.ID_Mode)) {
                                        case undefined: idProduct = ""; break;
                                        case 3:
                                            idProduct = "disabled";
                                            idqtty = "readonly";
                                            break;

                                        default: idProduct = ""; break;
                                    }
                                    //let idReadOnly = parseInt((value.ID_Mode == undefined ? 1 : value.ID_Mode)) != (1||2) ? "readonly" : ""
                                    let $dropdown = '<select class="form-control" onchange="bindTextbox(this)">' + options + '</select>';





                                    let rowCount = (i + 1);
                                    let index = i;


                                    $ProductHtml += "<tr id=" + rowCount + ">";

                                    $ProductHtml += "<td class='jq_Product_ID_Product' Style='Display:none'>" + value.ID_OLD_Product + "</td>";
                                    $ProductHtml += "<td class='jq_ProductDet_td' ><input type='checkbox'  value='" + value.ID_OLD_Product + "'" + checked+" /></td>";
                                    $ProductHtml += "<td >" + value.OLD_Product + "</td>";
                                    $ProductHtml += "<td class='jq_ProductDetQty_td' ><input  min='0' onkeypress='return /[0-9.]/i.test(event.key)' type='text' " + `onpaste="return false"` + "  maxlength ='10'  class='form-control text-right' value='" + value.SPDOldQuantity + "' /></td>";
                                    $ProductHtml += "<td style='display:none' class='jq_ProductDetAmnt_td'><input   min ='0' onkeypress='return /[0-9.]/i.test(event.key)'  type='number'  maxlength ='10'  class='form-control text-right' value='" + value.Amount + "'/></td>";
                                    $ProductHtml += "<td class='jq_ProductChangeMode_td'  >" + $dropdown + "</td>";

                                    $ProductHtml += "<td class='jq_ProductDetReplaAmnt_td' ><input ' min='0' onkeypress='return /[0-9.]/i.test(event.key)' maxlength ='10' type='text' " + `onpaste="return false"` +"  class='form-control text-right' value='" + value.ReplaceAmount + "' " + `${idReadOnly}`+"/></td>";



                                    $ProductHtml += "<td class='RplcdProduct'>" +
                                    "<div class='input-group'>" +
                                        "<input type='hidden'  " + ` id=RplacedProductId${index} name=ID_Product${index}` + "  class='form-control RplacedProductId' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.ID_Product + "' >" +
                                        "<input type='hidden'  " + `id=RplacedMRPs${index} name=MRPs${index}` + "  class='form-control RplacedMRPs' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.SPDMRP + "'>" +
                                        //"<input type='hidden'  " + `id=RplacedSalePrice${index} name=SalePrice${index}` +"  class='form-control RplacedSalePrice' perfect-class='formGroupControl' perfect-ctype='hidden'>" +                                        "<input type='hidden'  " + `id=RplacedStockId${index} name=StockId${index}` + "  class='form-control RplacedStockId' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + value.Stock + "'>" +
                                        "<input type='hidden'  " + `id=RplacedTaxAmount${index} name=TaxAmount${index}` + "  class='form-control RplacedTaxAmount' perfect-class='formGroupControl' perfect-ctype='hidden'value='" + value.SPDTaxAmount + "'>" +

                                        "<input type='text'    " + `id=RplacedProductName${index} name=Name${index}` + " class='form-control RplacedProductName' perfect-class='formGroupControl' perfect-css='input' readonly value='" + value.Product + "'>" +


                                        "<input type='hidden'  " + ` id=RplacedEmployee_id name=Employee_id` + "  class='form-control' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + @ViewBag.FK_Employee + "' >" +

                                        "<div class='input-group-append'><button type='button'" + `id=popup${index}`+" class='popup btn btn-primary fa fa-search '" + `onclick="GetCmnPopUpSearchValAssign(this, 88, 'Product Details', [], ['ID_Product',  'MRPs', 'SalePrice', 'StockId', 'TaxAmount'])" Criterea1="Employee_id" Criterea2="0" BindName="Name${index}" BindVal="ID_Product${index}" Function="2"` + " " + `${idProduct}` +"></button>" +
                                    "</div></div></td></td>";

                                    $ProductHtml += "<td class='RplcdProductqty' ><input  min='0' onkeypress='return /[0-9.]/i.test(event.key)' maxlength ='10' type='text' " + `onpaste="return false"` + " class='form-control text-right' value='" + value.Quantity + "' " + `${idqtty}` +"/></td>";
                                    $ProductHtml += "<td class='RplcdProductAmt' ><input  min='0' onkeypress='return /[0-9.]/i.test(event.key)' maxlength ='10' type='number' " + `onpaste="return false"` +"  " + `id=RplacedSalePrice${index} name=SalePrice${index}` + "  class='form-control text-right' value='" + value.SPDSalesPrice + "' readonly/></td>";

                                    $ProductHtml += "<td class='jq_ProductDetRemarks_td' ><input type='textbox' style='width:200px'  class='form-control'  value='" + value.Remarks + "' /></td>";

                                    $ProductHtml += "<td class='jq_Product_EmpCode' Style='Display:none'>" + value.EmpCode + "</td>";
                                    $ProductHtml += "<td class='jq_Product_StockID' Style='Display:none'>" + value.StockID + "</td>";
                                    $ProductHtml += "</tr>";
                                });

                            }
                        }
                        else {
                            $ProductHtml += "<tr id='0'><td id='norcd' class='norecord'colspan='4' style'text-align:center'>No Records..</td></tr>";
                        }

                        $('#ProductDetailsTbody').append($ProductHtml);
                    }



                  //  $('#btnUpdate').css('display', 'none');
                  //  $('#btnSave').css('display', 'block');
                    $('.bd-ProductDetails-modal-sm').modal('show');
                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
            }
        });

    }

    function Commonpopup(ele, i) {
        let $thisForm = $(this).closest('[perfect-class="form"]');
        let row = $(ele).closest("tr");
        GetCmnPopUpSearchValAssign(this, 88, 'Product Details', [], ['ID_Product', 'Name', 'MRPs', 'SalePrice', 'StockId', 'TaxAmount']);
        let productID = $thisForm.find('[name=ID_Product]').val();
        let productName = $thisForm.find('[name=Name]').val();

        row.find('.RplcdProduct').find('input').val(productName);
    }

    //$("#ProductDetailsTbody").on("click", ".popup", function () {
    //    let row = $(this).closest("tr");
    //    let $thisForm = $(this).closest('[perfect-class="form"]');
    //    GetCmnPopUpSearchValAssign(this, 88, 'Product Details', [], ['ID_Product', 'Name', 'MRPs', 'SalePrice', 'StockId','TaxAmount']);

    //    let Name = $thisForm.find('[name=Name]').val();
    //    row.find('.RplcdProduct').find('input').val(Name);

    //});

    function getfunctionAssign(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let $tempArr = $thisForm.data('popValueData');
        let row = $(ele).closest("tr").index();
        $(`#RplacedProductId${row}`).val($tempArr.ID_FIELD);
        $(`#RplacedProductName${row}`).val($tempArr.Name);
        $(`#RplacedMRPs${row}`).val($tempArr.MRPs);
        $(`#RplacedSalePrice${row}`).val($tempArr.SalePrice);
        $(`#RplacedStockId${row}`).val($tempArr.StockId);
        $(`#RplacedTaxAmount${row}`).val($tempArr.TaxAmount);



        //console.log("FSaveddata", $tempArr)
    }
    function getfunctionAssignchnage(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let $tempArr = $thisForm.data('popValueData');
        console.log("$tempArr", $tempArr)
        let row = $(ele).closest("tr").index();

        $(`#RplacedProductIds${row}`).val($tempArr.ID_FIELD);
        $(`#RplacedProductNames${row}`).val($tempArr.Name);
        $(`#RplacedMRPss${row}`).val($tempArr.MRPs);
        $(`#RplacedSalePrices${row}`).val($tempArr.SalePrice);
        $(`#RplacedStockIds${row}`).val($tempArr.StockId);
        $(`#RplacedTaxAmounts${row}`).val($tempArr.TaxAmount);
    }

    var bindajaxout;

    function GetProserMoreDetails(ele,id) {

        debugger
        var $thisForm = $(ele).closest('[perfect-class="form"]');
        var InputData = {
            'FK_Customerserviceregister': id,
            'FK_Product': $thisForm.find('[name="ProductID"]').val(),
            'CategoryNameID': $thisForm.find('[name="CategoryNameID"]').val(),
        }

        $.ajax({
            url: "@Url.Action("GetProductMoreDetails", "ServiceList")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
               // $('[name=FK_Customerserviceregister]').val($(ele).attr('data-id'));
                $TicketHtml = '';
                if (ajaxOutput !=null) {


                    if (ajaxOutput != null) {

                        $('#ProductDetailsTbodyMoredetails').empty();
                        console.log("FGFG", ajaxOutput.Lits.Data);
                        console.log("FGFGVew", ajaxOutput.ChangeMod.Data);
                        bindajaxout = ajaxOutput;
                        let options = ''
                        $.each(ajaxOutput.ChangeMod.Data, function (i, value) {
                            options += '<option value=' + value.ID_Mode + '>' + value.ModeName + '</option>'
                        });
                        let $dropdown = '<select class="form-control" onchange="bindTextbox(this)">' + options + '</select>';
                        console.log('drop value', $dropdown);
                        $ProductHtml = '';


                        console.log('AJAXOUT DETAILS', ajaxOutput.Lits.Data);
                        if (ajaxOutput.Lits.Data != null) {
                            if (ajaxOutput.Lits.Data.length > 0) {

                                $.each(ajaxOutput.Lits.Data, function (i, value) {
                                    let rowCount = (i + 1);

                                    debugger
                                    $ProductHtml += "<tr id=" + rowCount + ">";
                                    //    $ProductHtml += "<td style='text-align: center;'>" + rowCount + "</td>";
                                    $ProductHtml += "<td class='jq_Product_ID_Product' Style='Display:none'>" + value.FK_Product + "</td>";
                                    $ProductHtml += "<td class='jq_ProductDet_td'><input  id='chk2'type='checkbox'  value='" + value.FK_Product + "' /></td>";
                                    $ProductHtml += "<td >" + value.Product + "</td>";

                                    $ProductHtml += "<td class='jq_ProductDetQty_td'><input type='text' id='Quantity' min ='0' onkeypress='return /[0-9]/i.test(event.key)' " + `onpaste="return false"` +" maxlength ='10' class='form-control text-right'  value=' " + value.Quantity + "' /></td>";
                                    $ProductHtml += "<td style='display:none' class='jq_ProductDetAmnt_td'><input type='number' id='Amount' min ='0' onkeypress='return /[0-9.]/i.test(event.key)'  maxlength ='12'  class='form-control text-right'  value='" + value.Amount + "' /></td>";
                                    $ProductHtml += "<td class='jq_ProductChangeMode_td' style='width: 130px;'>" + $dropdown + "</td>";

                                    $ProductHtml += "<td class='jq_ProductDetReplaAmnt_td'><input type='text' " + `onpaste="return false"` +" id='ReplaceAmount'min ='0' onkeypress='return /[0-9.]/i.test(event.key)' maxlength ='10'  class='form-control text-right' value='" + value.ReplaceAmount + "' /></td>";


                                    $ProductHtml += "<td class='RplcdProduct'>" +
                                        "<div class='input-group'>" +
                                        "<input type='hidden' " + `id=RplacedProductIds${i} name=ID_Product${i}` +"  class='form-control RplacedProductId' perfect-class='formGroupControl' perfect-ctype='hidden'>" +
                                        "<input type='hidden' " + `id=RplacedMRPss${i} name=MRP${i}` +"  class='form-control RplacedMRPs' perfect-class='formGroupControl' perfect-ctype='hidden'>" +
                                        //"<input type='hidden' " + `id=RplacedSalePrices${i} name=SalePrice${i}` +"  class='form-control RplacedSalePrice' perfect-class='formGroupControl' perfect-ctype='hidden'>" +
                                        "<input type='hidden' " + `id=RplacedStockIds${i} name=StockId${i}` +" class='form-control RplacedStockId' perfect-class='formGroupControl' perfect-ctype='hidden'>" +
                                        "<input type='hidden' " + `id=RplacedTaxAmounts${i} name=TaxAmount${i}` + "  class='form-control RplacedTaxAmount' perfect-class='formGroupControl' perfect-ctype='hidden'>" +

                                         "<input type='hidden'  " + ` id=RplacedEmployee_id name=Employee_id` + "  class='form-control' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + @ViewBag.FK_Employee + "' >" +

                                        "<input type='text'   " + `id=RplacedProductNames${i} name=Names${i}` + " class='form-control RplacedProductName' perfect-class='formGroupControl' perfect-css='input' readonly>" +
                                        "<div class='input-group-append'><button type='button' " + `id=popupsub${i}` + " class='popup btn btn-primary fa fa-search '" + `onclick="GetCmnPopUpSearchValAssign(this, 88, 'Product Details', [], ['ID_Product',  'MRPs', 'SalePrice', 'StockId', 'TaxAmount'])"  Criterea1="Employee_id" Criterea2="0"  BindName="Names${i}" BindVal="ID_Product${i}" Function="4" ` + "></button>" +
                                        "</div></div></td></td>";

                                    $ProductHtml += "<td class='RplcdProductqty' ><input  min='0' onkeypress='return /[0-9.]/i.test(event.key)' maxlength ='10' type='text' " + `onpaste="return false"` +"  class='form-control text-right' value='" + value.ReplaceAmount + "' /></td>";
                                    $ProductHtml += "<td class='RplcdProductAmt' ><input  min='0' onkeypress='return /[0-9.]/i.test(event.key)' maxlength ='10' type='number' " + `onpaste="return false"` +" class='form-control text-right' " + `id=RplacedSalePrices${i} name=SalePrice${i}` +" readonly/></td>";

                                    $ProductHtml += "<td class='jq_ProductDetRemarks_td'><input type='textbox' style='width:200px'   class='form-control'  value='" + value.Remarks + "' /></td>";

                                    $ProductHtml += "<td class='jq_Product_EmpCode' Style='Display:none'>" + value.EmpCode + "</td>";
                                    $ProductHtml += "<td class='jq_Product_StockID' Style='Display:none'>" + value.StockID + "</td>";
                                    $ProductHtml += "</tr>";
                                });

                                if ($("input[id='chk2']:checked").length > 0) {
                                    document.getElementById("btnSaveMoreReplaceProduct").disabled = false;
                                }
                                else {
                                    document.getElementById("btnSaveMoreReplaceProduct").disabled = true;
                                }

                            }
                        }
                        else {
                            $ProductHtml += "<tr id='0'><td colspan='4' style'text-align:center'>No Records..</td></tr>";
                        }

                        $('#ProductDetailsTbodyMoredetails').append($ProductHtml);

                    }




                    $('.bd-ProductReplacementMoredetails-modal-sm').modal('show');
                }



            },

        });

        }


      function fn_showFilter() {

        $formContainer.find('.jq_Service_body').find('.ServiceformSesction').toggleClass('d-none');

        let $thisForm = $(this).find('[perfect-class="form"]');

    }

    function bindTextboxservicecost(ele) {
        debugger
        let Values = $(ele).val();

        if (Values == 1) {
            $(ele).closest('tr').find('.jq_ProductServicesAmnt_td').find('input').prop('readonly', false)


        }
        else {

            $(ele).closest('tr').find('.jq_ProductServicesAmnt_td').find('input').prop('readonly', true)
            $(ele).closest('tr').find('.jq_ProductServicesAmnt_td').find('input').val("0");
            $(ele).closest('tr').find('.jq_ProductServicesTaxAmount').find('input').val("0");
            $(ele).closest('tr').find('.jq_ProductServicesNetAmount').find('input').val("0");


        }
    }
    function getParent(ele) {
        var t = ele.parentNode;
        tagName = "table";

        while (t) {
            if (t.tagName && t.tagName.toLowerCase() == tagName) {

                return t.id;
            }
            else {
                t = t.parentNode;
            }

        }
        return null;
    }
    function bindTextbox(ele) {
        debugger
        let Value = $(ele).val();
        let row = $(ele).closest("tr").index();

        var tableid = getParent(ele);
        if (Value == 1 || Value == 2) {
            $(ele).closest('tr').find('.jq_ProductDetReplaAmnt_td').find('input').prop('readonly', false);
        }
        else {
            $(ele).closest('tr').find('.jq_ProductDetReplaAmnt_td').find('input').prop('readonly', true);
            $(ele).closest('tr').find('.jq_ProductDetReplaAmnt_td').find('input').val("0");
        }
        if (Value == 3) {
            if (tableid == "ProductDetails") {
                $(`#popup${row}`).attr("disabled", "disabled");
            }
            else {
                $(`#popupsub${row}`).attr('disabled', 'disabled');
            }

            //$(`#popup${row}`).attr("disabled", "disabled");
            $(ele).closest('tr').find('.RplcdProductqty').find('input').prop('readonly', true);
            $(ele).closest('tr').find('.RplcdProductqty').find('input').prop('disabled', true);
            $(`#RplacedProductId${row}`).val("");
            $(`#RplacedProductName${row}`).val("");
            $(`#RplacedMRPs${row}`).val("");
            $(`#RplacedSalePrice${row}`).val("0");
            $(`#RplacedStockId${row}`).val("");
            $(`#RplacedTaxAmount${row}`).val("");
            $(ele).closest('tr').find('.RplcdProductqty').find('input').val("0");
            $(ele).closest('tr').find('.RplcdProductAmt').find('input').val("0");

        }
        else {
            $(`#popup${row}`).removeAttr('disabled');
            $(ele).closest('tr').find('.RplcdProductqty').find('input').prop('readonly', false);
            $(ele).closest('tr').find('.RplcdProductqty').find('input').prop('disabled', false);
        }

    }
    function bindTextboxSubAdd(ele) {
        debugger
        let Value = $(ele).val();
        let row = $(ele).closest("tr").index();

        if (Value == 1 || Value == 2) {
            $(ele).closest('tr').find('.jq_ProductDetReplaAmnt_td').find('input').prop('readonly', false);
        }
        else {
            $(ele).closest('tr').find('.jq_ProductDetReplaAmnt_td').find('input').prop('readonly', true);
            $(ele).closest('tr').find('.jq_ProductDetReplaAmnt_td').find('input').val("0");
        }
        if (Value == 3) {
            $(`#popupsub${row}`).attr('disabled', 'disabled');
            $(ele).closest('tr').find('.RplcdProductqty').find('input').prop('readonly', true);
            $(`#RplacedProductId${row}`).val("");
            $(`#RplacedProductName${row}`).val("");
            $(`#RplacedMRPs${row}`).val("");
            $(`#RplacedSalePrice${row}`).val("0");
            $(`#RplacedStockId${row}`).val("");
            $(`#RplacedTaxAmount${row}`).val("");
            $(ele).closest('tr').find('.RplcdProductqty').find('input').val("0");
            $(ele).closest('tr').find('.RplcdProductAmt').find('input').val("0");
        }
        else {
            $(`#popup${row}`).removeAttr('disabled');
            $(ele).closest('tr').find('.RplcdProductqty').find('input').prop('readonly', false);
        }

    }

        function fn_showProHistory() {

            $formContainer.find('.jq_ProHistory_body').find('.ProductHisformSesction').toggleClass('d-none');

            let $thisForm = $(this).find('[perfect-class="form"]');

        }


    function CheckExisting(Object_ID, val, ele, Error) {
        debugger
        let $container = $(ele).closest('[perfect-class="form"]');
        var Exist = 0;
        $container.find('[perfect-tempTable="' + val + '"]').find('tbody').find('tr').each(function () {
            var $tds = $(this).find('td'),
                productId = $tds.eq(1).text();
            console.log('PRODUCT_ID-->', productId)
            if (productId == Object_ID) {
                console.log($tds);
                console.log(Exist);
                Exist++;

            }
            if (Exist > 0) {
                $('#' + Error).css('display', 'block');
                console.log('Yes it exist');
            }
            else {
                $('#' + Error).css('display', 'none');
                console.log('No it not exist');
            }
        })
        return Exist;
    }

    function BindMoredetailsServiceAmountTEST(ele) {
        debugger

        var tablemoredetailsrws = $("#ProductServiceTbodyMoredetails tr");

        var ProductService = [];

        if (tablemoredetailsrws.length > 0) {



            $('#ProductServiceTbodyMoredetails tr').each(function (index, ele) {


                if ($($(this).find("td:eq(2) input[type='checkbox']")[0]).is(":checked") == true) {



                    let checkbox1 = $(this).find("td:eq(2) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                    let ID_Service = $(this).find("td:eq(0)").text();
                    let ID_Product = $(this).find("td:eq(1)").text();
                    let FK_Service = $(this).find("td:eq(3)").text();
                    let TextServiceMode = $(this).find("td:eq(4) option:selected").text();
                    let TextserviceModvalue = $(this).find("td:eq(4) option:selected").val();


                    let Textvaluecost = $(this).find("td:eq(5) input[type='text']").val().trim();
                    let TextvalueTaxAmount = $(this).find("td:eq(6) input[type='number']").val().trim();
                    let TextvalueNetAmount = $(this).find("td:eq(7) input[type='number']").val().trim();
                    let Textvalueremark = $(this).find("td:eq(8) input[type='textbox']").val();


                    var ary = { checkbox1: checkbox1, ID_Service: ID_Service, ID_Product: ID_Product, FK_Service: FK_Service, TextServiceMode: TextServiceMode, TextserviceModvalue: TextserviceModvalue, Textvaluecost: Textvaluecost, TextvalueTaxAmount: TextvalueTaxAmount ,TextvalueNetAmount: TextvalueNetAmount ,Textvalueremark: Textvalueremark }

                    ProductService.push(ary);

                }

            });




            console.log("ProductService test", ProductService)


            if (ProductService.length > 0) {


                $ProductmoreHtml = '';



                $.each(ProductService, function (i, key) {
                    let isexitp = 0;
                    $('#ProductServiceTbody tr').each(function (index, ele) {
                        if ($(ele).find('.norecord').text() != "") {
                            $('#ProductServiceTbody').empty();

                        }
                        if ($(ele).find('.jq_ProductServices_ID_Services').text() == key.ID_Service) {
                            isexitp++;

                        }
                    });
                    let CheckBoxValue = key.checkbox1 == "1" ? "Checked" : "";



                    let CheckBox = "<input type='checkbox' value='' " + CheckBoxValue + ">";

                    let options = ''
                    $.each(bindservicemodajaxout.ServiceMod.Data, function (i, value) {
                        if (value.ID_Mode == key.TextserviceModvalue) {
                            options += '<option value=' + value.ID_Mode + ' selected="selected">' + value.ModeName + '</option>'
                        }
                        else {
                            options += '<option value=' + value.ID_Mode + '>' + value.ModeName + '</option>'
                        }

                    });
                    $dropdown = '<select class="form-control" onchange="bindTextboxservicecost(this)">' + options + '</select>';





                    if (isexitp == 0) {
                        var readonly;

                        if (key.TextserviceModvalue == 1) {

                            readonly = '';

                        }
                        else {

                            readonly = "readonly";
                            key.Textvaluecost = 0;
                        }






                        $ProductmoreHtml += "<tr><td class='jq_ProductServices_td'>" + CheckBox + "</td><td></td><td class='jq_ProductServices_ID_Services' Style='Display:none'>" + key.ID_Service + "</td><td class='jq_ProductServices_ID_Product' Style='Display:none'>" + key.ID_Product + "</td><td class='jq_Type_td'>" + key.FK_Service + "</td></td><td class='jq_ProductServiceMode_td'>"
                            + $dropdown + "</td><td class='jq_ProductServicesAmnt_td'> <input onkeypress='return /[0-9.]/i.test(event.key)' type='number'  min ='0'   maxlength ='12' class='form-control servicecost text-right' value='" + key.Textvaluecost + "' " + `onchange="GetTaxNetdetails(this)"` + readonly +" /></td >" +
                            "<td class='jq_ProductServicesTaxAmount' style='display:none'> <input type='number' class='form-control text-right' value='" + key.TextvalueTaxAmount + "' readonly/></td >" +
                            "<td class='jq_ProductServicesNetAmount' style='display:none'> <input type='number' class='form-control text-right' value='" + key.TextvalueNetAmount + "' readonly/></td >" +
                            "<td class='jq_ProductServicesRemarks_td' ><input type='textbox'style='width:300px' class='form-control'  value='" + key.Textvalueremark + "' /></td></td ></tr > ";


                    }

                });


                $('#ProductServiceTbody').append($ProductmoreHtml);


            }

            $('.bd-ProductserviceMoredetails-modal-sm').modal('hide');
        }
    }


    function BindMoredetailsProduct(ele) {

        var tablemoredetailsrws = $("#ProductDetailsTbodyMoredetails tr");

        var ProductReplace = [];

        if (tablemoredetailsrws.length > 0) {

            //let rowCountProductDetails = parseInt($('#ProductDetailsTbody tr').length);

            $('#ProductDetailsTbodyMoredetails tr').each(function (index, ele) {
                if ($($(this).find("td:eq(1) input[type='checkbox']")[0]).is(":checked") == true) {
                    debugger

                    let checkbox1 = $(this).find("td:eq(1) input[type='checkbox']").is(":checked") == true ? "1" : "0";
                    let ID_Product = $(this).find("td:eq(0)").text();
                    let FK_Product = $(this).find("td:eq(2)").text();
                    let Textquanityy = $(this).find("td:eq(3) input[type='text'] ").val().trim();
                    let TextAmount = $(this).find("td:eq(4) input[type='number']").val().trim();
                    let TextChangeMode = $(this).find("td:eq(5) option:selected").text();
                    let TextChangeModvalue = $(this).find("td:eq(5) option:selected").val();
                    //'<select class="form-control" onchange="bindTextbox(this)">'
                    let TextReplaceamount = $(this).find("td:eq(6) input[type='text']").val().trim();

                    let RPDProductID = $(this).find('#RplacedProductIds' + index).val();
                    let RPDMRP = $(this).find('#RplacedMRPss' + index).val();
                    let RPDSalesPrice = $(this).find('#RplacedSalePrices' + index).val();
                    let RPDStockID = $(this).find('#RplacedStockIds' + index).val();
                    let RPDTaxAmount = $(this).find('#RplacedTaxAmounts' + index).val();
                    let RPDProduct = $(this).find('#RplacedProductNames' + index).val();

                    let RPDQuantity = $(this).find('.RplcdProductqty').find('input').val();
                    let RPDAmount = $(this).find('.RplcdProductAmt').find('input').val();

                    let TextRemarks = $(this).find("td:eq(10) input[type='textbox']").val().trim();
                    let EmpCode = $(this).find("td:eq(11)").text();
                    let StockID = $(this).find("td:eq(12)").text();

                    var pushvalue = {
                        checkbox1: checkbox1, ID_Product: ID_Product, FK_Product: FK_Product, Textquanityy: Textquanityy, TextAmount: TextAmount,
                        TextChangeMode: TextChangeMode, TextReplaceamount: TextReplaceamount, TextRemarks: TextRemarks, TextChangeModvalue: TextChangeModvalue, EmpCode: EmpCode, StockID: StockID,
                        RPDProductID: RPDProductID, RPDProduct: RPDProduct, RPDMRP: RPDMRP, RPDSalesPrice: RPDSalesPrice, RPDStockID: RPDStockID, RPDTaxAmount ,RPDQuantity: RPDQuantity, RPDAmount: RPDAmount
                    }

                    ProductReplace.push(pushvalue);

                }

            });


            console.log("ProductReplace test", ProductReplace)


            if (ProductReplace.length > 0) {

                $('#ProductDetailsTbody tr').each(function (index, ele) {
                    if ($(ele).find('.norecord').text() != "") { $('#ProductDetailsTbody').empty(); }
                });

                let rowCountProductDetails = parseInt($('#ProductDetailsTbody tr').length);



                ProductmoreHtml = '';

                let $dropdown;

                $.each(ProductReplace, function (i, key) {

                    let isexit = 0;
                    $('#ProductDetailsTbody tr').each(function (index, ele) {
                        if ($(ele).find('.norecord').text() !="") { $('#ProductDetailsTbody').empty();}
                        if ($(ele).find('.jq_Product_ID_Product').text() == key.ID_Product) {
                            isexit++;

                        }



                    });


                    let CheckBoxValue = key.checkbox1 == "1" ? "Checked" : "";


                    let CheckBox = "<input type='checkbox' value='' " + CheckBoxValue + ">";

                    let idProduct = ""
                    switch (parseInt(key.TextChangeModvalue)) {
                        case undefined: idProduct = ""; break;
                        case 3: idProduct = "disabled"; break;
                        default: idProduct = ""; break;
                    }

                    let options = ''
                    $.each(bindajaxout.ChangeMod.Data, function (i, value) {
                        if (value.ID_Mode == key.TextChangeModvalue) {
                            options += '<option value=' + value.ID_Mode + ' selected="selected">' + value.ModeName + '</option>'
                        }
                        else {
                            options += '<option value=' + value.ID_Mode + '>' + value.ModeName + '</option>'
                        }

                    });
                    $dropdown = '<select class="form-control" onchange="bindTextbox(this)">' + options + '</select>';





                    if (isexit == 0) {
                        var readonly;

                        if (key.TextChangeModvalue == 1 || key.TextChangeModvalue ==2) {

                            readonly = '';

                        }
                        else {

                            readonly = "readonly";
                            key.TextReplaceamount = 0;
                        }
                        let idProduct = ""
                        let idqty=""
                        switch (parseInt(key.TextChangeModvalue)) {
                            case undefined: idProduct = ""; break;
                            case 3: idProduct = "disabled"; break;
                            case 3: idqty = "readonly"; break;
                            default: idProduct = ""; break;
                        }

                        rowCountProductDetails++;
                      //  let rowCountProductDetails = parseInt($('#ProductDetailsTbody tr').length++);
                        ProductmoreHtml += "<tr id=" + rowCountProductDetails +"><td class='jq_ProductDet_td'>" + CheckBox + "</td><td class='jq_Product_ID_Product' Style='Display:none'>" + key.ID_Product +
                            "</td><td class='jq_ProductDet_td'>" + key.FK_Product + "</td><td class='jq_ProductDetQty_td'> <input type='text' " + `onpaste="return false"` +" maxlength='10' class='form-control text-right' value='" + key.Textquanityy +
                        "' /></td><td style='display:none' class='jq_ProductDetAmnt_td' > <input type='number'  class='form-control text-right' value='" + key.TextAmount + "'/></td><td class='jq_ProductChangeMode_td'>"
                            + $dropdown + "</td><td class='jq_ProductDetReplaAmnt_td'><input type='text' " + `onpaste="return false"` +" maxlength='10' class='form-control text-right' value='" + key.TextReplaceamount + "'" + readonly + "/></td>"+

                            "<td class='RplcdProduct'>" +

                        "<div class='input-group'>"+
                            "<input type='hidden' value='" + key.RPDProductID + "' " + `id=RplacedProductId${rowCountProductDetails - 1}  name=ID_Product${rowCountProductDetails-1}` +" class='form-control RplacedProductId' perfect-class='formGroupControl' perfect-ctype='hidden'>" +
                            "<input type='hidden' " + `id=RplacedMRPs${rowCountProductDetails - 1}  name=MRPs${rowCountProductDetails - 1}`+" value='" + key.RPDMRP + "' class='form-control RplacedMRPs' perfect-class='formGroupControl' perfect-ctype='hidden'>" +
                            //"<input type='hidden' " + `id='RplacedSalePrice'  name='SalePrice${rowCountProductDetails-1}'` +"  value='" + key.RPDSalesPrice + "' class='form-control RplacedSalePrice' perfect-class='formGroupControl' perfect-ctype='hidden'>" +
                            "<input type='hidden' " + `id=RplacedStockId${rowCountProductDetails - 1}  name=StockId ${rowCountProductDetails - 1}` +" value='" + key.RPDStockID + "' class='form-control RplacedStockId' perfect-class='formGroupControl' perfect-ctype='hidden'>" +
                            "<input type='hidden' " + `id=RplacedTaxAmount${rowCountProductDetails - 1}  name=TaxAmount ${rowCountProductDetails - 1}` + "  value='" + key.RPDTaxAmount + "' class='form-control RplacedTaxAmount' perfect-class='formGroupControl' perfect-ctype='hidden'>" +
                            "<input type='hidden'  " + ` id=RplacedEmployee_id${rowCountProductDetails - 1} name=Employee_id${rowCountProductDetails - 1} ` + "  class='form-control' perfect-class='formGroupControl' perfect-ctype='hidden' value='" + @ViewBag.FK_Employee + "' >" +

                            "<input type='text' value='" + key.RPDProduct + "' " + `id=RplacedProductName${rowCountProductDetails - 1}  name=Name${rowCountProductDetails - 1}` + "  class='form-control RplacedProductName' perfect-class='formGroupControl' perfect-css='input' readonly>" +

                            "<div class='input-group-append'><button type='button' " + `id=popup${rowCountProductDetails - 1}` + " class='popup btn btn-primary fa fa-search ' " + `onclick="GetCmnPopUpSearchValAssign(this, 88, 'Product Details', [], ['ID_Product', 'MRPs', 'SalePrice', 'StockId', 'TaxAmount'])" Criterea1="Employee_id" Criterea2="0"  BindName="Name" BindVal="ID_Product" Function="2"` + "  " + `${idProduct}` +"></button>" +
                        "</div></div></td></td>"+
                            "<td class='RplcdProductqty' ><input   type='text' " + `onpaste="return false"` + " maxlength='10' class='form-control text-right' value='" + key.RPDQuantity + "' " + `${idProduct}` +"/></td>"+
                            "<td class='RplcdProductAmt' ><input   type='number' " + `id=RplacedSalePrice${rowCountProductDetails - 1}  name=SalePrice${rowCountProductDetails - 1}` + "  class='form-control text-right' value='" + key.RPDSalesPrice + "' readonly/></td>"+
                        "<td class='jq_ProductDetRemarks_td'><input type='textbox' class='form-control'style='width:200px'  value='" + key.TextRemarks + "'/></td > "+
                        "<td class='jq_Product_EmpCode' Style='Display:none'>" + key.EmpCode + "'/></td > <td class='jq_Product_StockID' Style='Display:none'>" + key.StockID + "'/></td </td ></tr > ";

                    }


                });


                $('#ProductDetailsTbody').append(ProductmoreHtml);
                console.log(ProductmoreHtml);


            }

            $('.bd-ProductReplacementMoredetails-modal-sm').modal('hide');
        }
    }


    var sum = 0;
    //$(".servicecost").each(function () {
    //    debugger
    //    var value = $(this).text();
    //    // add only if the value is number
    //    if (!isNaN(value) && value.length != 0) {
    //        sum += parseFloat(value);
    //    }




    //});


    var sum;
    var Replacesum ;
    var Productssum ;

        function BindServiceAmount(ele) {

            console.log('inside binddatat fn1')

           //let $modal = $(ele).closest('.modal');
           // let $thisForm = $(ele).closest('[perfect-class="form"]');
           // //var sum;
           // sum = +0;

           // debugger

           // $('#ProductServiceTbody tr').each(function (index, ele) {

           //     let value = 0;

           //     if ($(this).find('.jq_ProductServices_td').find('[type="checkbox"]').is(':checked') == true) {
           //          value = $(ele).find('.jq_ProductServicesAmnt_td').find('input').val()
           //     value=+value ;
           // }


           //     sum = +sum + (+value);


           // });

           // let $thisForms = $(this).find('[perfect-class="form"]');
           // $thisForms.find('[name="ServiceAmount"]').val(sum);
           //// console.log('serviceamount :', $thisForms.find('[name=ServiceAmount]'));

           // console.log('serviceamount :', sum);
           //CalculateTotal(ele);
           // $('.bd-Productservice-modal-sm').modal('hide');

            $("#replacementinfoid").click();

        }


    function bindserv() {
        debugger
        //BindServiceAmount(this);
        BindProductAmount(this);
        //CalculateTotal(this);
        //BillAmountbind(this);

    }

    function BindProductAmount(ele) {

        console.log('inside binddatat fn2')
        let $modal = $(ele).closest('.modal');


        Replacesum = +0;

        $('#ProductDetailsTbody tr').each(function (index, ele) {

            debugger


            if ($(this).find('.jq_ProductDet_td').find('[type="checkbox"]').is(':checked') == true && $(this).find("td:eq(5) option:selected").val() == 2) {

                ReplaceAmount = $(ele).find('.jq_ProductDetReplaAmnt_td').find('input').val()

                Replacesum = +Replacesum + (+ReplaceAmount);

            }
        });

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        $thisForm.find('[name=ReplaceAmount]').val(parseFloat(Replacesum).toFixed(2));
        let securityAmount = $thisForm.find('[name=ReplaceAmount]').val(parseFloat(Replacesum).toFixed(2));

        CalculateTotal(ele);

        //    $('.bd-ProductDetails-modal-sm').modal('hide');

        $("#attendanceinfoid").click();

        if (Replacesum > 0) {
            $(".DivBillType").show();
            $('[name="BillTypeID"]').addClass('perfectValidate_numeric');
        }
        else if (Replacesum == 0 || Replacesum == "") {

            $(".DivBillType").hide();
            $('[name="BillTypeID"]').val('').selectpicker('refresh');
            $('[name="BillTypeID"]').removeClass('perfectValidate_numeric');
        }
    }



    function BindServiceattended(ele) {



        $("#summaryinfoid").click();
    }


        function BindImageFils(ele) {

            console.log('inside binddatat fn')
            let $modal = $(ele).closest('.modal');
            let $thisForm = $(ele).closest('[perfect-class="form"]');
            $modal.find('table tbody').find('tr').each(function () {
                var images = $('.jq_ProductImageID_td').attr('src');
                console.log('for relative image url ' + $('#imgFiletemp').attr('src'));
                console.log('fg', images);
            });


        }
        function BindDocFils(ele) {

            console.log('inside binddatat fn')
            let $modal = $(ele).closest('.modal');
            let $thisForm = $(ele).closest('[perfect-class="form"]');
            $modal.find('table tbody').find('tr').each(function () {
                var images = $('.jq_UploadDoc_td').attr('src');
                console.log('for relative Doc url ' + $('#imgDocFiletemp').attr('src'));

            });


    }



    function CalculateTotal(ele) {

        console.log('calculations');
        console.log('sum', sum);
        console.log('Productssum', Productssum);
        console.log('Replacesum', Replacesum);

        let $thisForm = $('[perfect-class="form"]');


        //let ReplaceAmount = Replacesum;

        //let Productsum = Productssum;
        //let ServiceAmount = sum;
        //let DiscAmnt = $thisForm.find('[name="DiscountAmount"]').val() == "" ? "0" : $('[name="DiscountAmount"]').val();

        // TotAmount = parseFloat(ServiceAmount) + parseFloat(Productsum) - parseFloat(ReplaceAmount);


        //console.log('total', TotAmount);

        //let NetAmount = parseFloat(TotAmount) - parseFloat(DiscAmnt);

       // console.log('as', Sprice + Salesprice);
        $('[name=ReplaceAmount]').val(parseFloat(Replacesum).toFixed(2));
        //$('[name="ProductAmount"]').val(Productssum);
        //$('[name="ServiceAmount"]').val(sum);
        //$('[name="TotalAmount"]').val(TotAmount);
        //$('[name="NetAmount"]').val(NetAmount);
        let billamt = 0;
        let bilamt = 0;
        let netamt = $thisForm.find('[name=ReplaceAmount]').val();
        bilamt = netamt;
        $('#Paymentdethead').find('tbody tr').each(function (index, ele) {
            billamt += parseFloat($(ele).find('.PAmount').text());

        });
        bilamt = parseFloat(bilamt) - billamt;
        $thisForm.find('[name=BalAmt]').text(bilamt.toFixed(2));

    }


    function checkadmount(ele) {

        let ReplaceAmount = Replacesum;
        let Productsum = Productssum;
        let ServiceAmount = sum;
        TotAmount = parseFloat(ServiceAmount) + parseFloat(Productsum) - parseFloat(ReplaceAmount);

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let disamount = $thisForm.find('[name="DiscountAmount"]').val();
        let totalamount = TotAmount;



        debugger
        if (parseFloat(disamount) > parseFloat(totalamount)) {

            console.log('inside limit check if')
            $thisForm.find('[name="DiscountAmount"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('Amount  should be less than or Equal to Total Amount');
            return false;
        }
        else {

            console.log('inside limit check else')
            $thisForm.find('[name="DiscountAmount"]').closest('[perfect-class="formGroup"]').find('.limit-check').text('')
            return true;
        }
    }



    function fn_SaveCustomerService(ele) {


        let isValid = true;
        let blnHas = false;
        let $thisForm = $(ele).closest('[perfect-class="form"]');
       let selectactionstatusvalue = $thisForm.find('[name="ID_NextAction"]').children(":selected").attr('Status');



        var tablerow = $("#ProductDetailsTbody tr");




        if (tablerow.length > 0) {
            let blnBuyBack = false;
            $('#ProductDetailsTbody tr').each(function (index, ele) {

                let checkbox1 =$(this).find(".jq_ProductDet_td input[type='checkbox']").is(":checked") == true ? "1" : "0";

                let TextChangeMode = $(this).find("td:eq(5) option:selected").text();
                let TextChangeModvalue = $(ele).find("td:eq(5) option:selected").val();


                let RPDProductID =$(ele).find('.RplacedProductId').val();
                let Quantity = $(ele).find('.jq_ProductDetQty_td').find('input').val();
                let RplcdQuantity = $(ele).find('.RplcdProductqty').find('input').val();

                if (checkbox1 == 1 && (Quantity == 0 || Quantity == "") && !blnHas) {
                    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Quantity' });
                    isValid = false;
                    blnHas = true;
                }
                else if (checkbox1 == 1 && TextChangeModvalue != 3 && RPDProductID == 0 && !blnHas) {
                    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Replaced product' });
                    isValid = false;
                    blnHas=true;
                }
                else if (checkbox1 == 1 && TextChangeModvalue != 3 && RPDProductID != 0 && (RplcdQuantity == 0 || RplcdQuantity == "") &&!blnHas) {
                    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Replaced Quantity' });
                    isValid = false;
                    blnHas = true;
                }
                if ($(this).find('.jq_ProductDet_td').find('[type="checkbox"]').is(':checked') == true && $(this).find('.jq_ProductChangeMode_td').find('select').val() == 1 && !blnBuyBack) {
                    blnBuyBack = true;

                }
            });
            if (!blnBuyBack && parseInt(selectactionstatusvalue) == 9) {
                NotificationMessage({ 'type': 'error', 'heading': 'Warning', 'message': 'Invalid action in Action Taken section' });
                isValid = false;
            }
        }



        if (isValid == true) {
            if ($thisForm.valid()) {
                if (BillAmountbind(ele)) {

                    $(ele).prop('disabled', true); // avoiding form submit the double click



                    var tableservicedetailsrws = $("#ProductServiceTbody tr");

                    let ServiceDetails = [];

                    if (tableservicedetailsrws.length > 0) {


                        $('#ProductServiceTbody tr').each(function (index, ele) {
                            debugger;
                            // if ($($(this).find("<td class='jq_ProductServices_td' input[type='checkbox']")[0]).is(":checked") == true)
                            if ($(this).find('.jq_ProductServices_td').find('[type="checkbox"]').is(':checked') == true) {
                                let Serviceinfo = {};
                                Serviceinfo['ID_Product'] = $(this).find('.jq_ProductServices_ID_Product').text();
                                Serviceinfo['ID_Services'] = $(this).find('.jq_ProductServices_ID_Services').text();
                                Serviceinfo['Services'] = $(this).find('.jq_Type_tdjq_Type_td').text();
                                Serviceinfo['ServiceType'] = $(this).find('.jq_ProductServiceMode_td').find('select').val();

                                Serviceinfo['ServiceCost'] = $(this).find('.jq_ProductServicesAmnt_td').find('input').val();
                                Serviceinfo['ServiceTaxAmount'] = $(this).find('.jq_ProductServicesTaxAmount').find('input').val();
                                Serviceinfo['ServiceNetAmount'] = $(this).find('.jq_ProductServicesNetAmount').find('input').val();
                                Serviceinfo['Remarks'] = $(this).find('.jq_ProductServicesRemarks_td').find('input').val();
                                console.log('Serviceinfo', Serviceinfo);
                                ServiceDetails.push(Serviceinfo);

                            }

                        });
                    }

                    var tablereplacedetailsrws = $("#ProductDetailsTbody tr");

                    let ProductDetails = [];

                    if (tablereplacedetailsrws.length > 0) {
                        debugger;

                        $('#ProductDetailsTbody tr').each(function (index, ele) {
                            debugger;
                            // if ($($(this).find("<td class='jq_ProductServices_td' input[type='checkbox']")[0]).is(":checked") == true)
                            if ($(this).find('.jq_ProductDet_td').find('[type="checkbox"]').is(':checked') == true) {
                                let PrDetinfo = {};


                                PrDetinfo['ID_Product'] = $(ele).find('.jq_Product_ID_Product').text();
                                PrDetinfo['Quantity'] = $(ele).find('.jq_ProductDetQty_td').find('input').val();
                                PrDetinfo['Amount'] = $(ele).find('.jq_ProductDetAmnt_td').find('input').val();
                                PrDetinfo['ReplaceAmount'] = $(ele).find('.jq_ProductDetReplaAmnt_td').find('input').val();
                                PrDetinfo['ID_Mode'] = $(ele).find('.jq_ProductChangeMode_td').find('select').val();
                                PrDetinfo['ModelNo'] = $(ele).find('.jq_ProductDetModelNO_td').find('input').val();

                                PrDetinfo['RpdProductId'] = $(ele).find('.RplacedProductId').val();
                                PrDetinfo['RpdMRP'] = $(ele).find('.RplacedMRPs').val()
                                PrDetinfo['RpdSalePrice'] = $(ele).find('.RplcdProductAmt').val();
                                PrDetinfo['RpdStockId'] = $(ele).find('.RplacedStockId').val();
                                PrDetinfo['RpdTaxAmount'] = $(ele).find('.RplacedTaxAmount').val();
                                PrDetinfo['RpdProductName'] = $(ele).find('.RplacedProductName').val();

                                PrDetinfo['RpdProductQty'] = $(ele).find('.RplcdProductqty').find('input').val();
                                PrDetinfo['RpdProductAmount'] = $(ele).find('.RplcdProductAmt').find('input').val();

                                PrDetinfo['Remarks'] = $(ele).find('.jq_ProductDetRemarks_td').find('input').val();
                                if ($(ele).find('.jq_Product_EmpCode').text() != null) {
                                    PrDetinfo['EmpCode'] = $(ele).find('.jq_Product_EmpCode').text();
                                } else {
                                    PrDetinfo['EmpCode'] = 0;
                                }
                                if ($(ele).find('.jq_Product_StockID').text() != null) {
                                    PrDetinfo['StockID'] = $(ele).find('.jq_Product_StockID').text();
                                } else {
                                    PrDetinfo['StockID'] = 0;
                                }
                                console.log('Prinfo', PrDetinfo);
                                ProductDetails.push(PrDetinfo);


                            }

                        });
                    }


                    var tableemployeedetailsrws = $("#AttendedProductServiceTbody tr");

                    let EmployeeDetails = [];

                    if (tableemployeedetailsrws.length > 0) {


                        $('#AttendedProductServiceTbody tr').each(function (index, ele) {


                            if ($(this).find('.jq_ProductServices_td').find('[type="checkbox"]').is(':checked') == true) {
                                let EmpDetinfo = {};
                                EmpDetinfo['ID_Employee'] = $(this).find('.jq_ProductServices_ID_Employee').text();
                                EmpDetinfo['EmployeeType'] = $(this).find('.jq_Employeetypeid_td').text();
                                console.log('Prinfo', EmpDetinfo);
                                EmployeeDetails.push(EmpDetinfo);


                            }

                        });
                    }
                    let paymentdetails = [];
                    $thisForm.find('[perfect-tempTable="Payment"]').find('tbody').find('tr').each(function () {
                        paymentdetails.push($(this).data('pData'));
                    })
                    console.log(@Model.FK_Customerserviceregister);
                    var data;
                    data = checkadmount;
                    if (data) {
                        let inputData = {

                            __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                            'ServiceFollowUpID': 0,
                            'FK_Customerserviceregister': $thisForm.find('[name="FK_Customerserviceregister"]').val(),


                            'StartingDate': $thisForm.find('[name="VisitedDateAfter"]').val(),

                            'AttendedMode': $thisForm.find('[name="AttendedMode"]').val(),
                            'CustomerNote': $thisForm.find('[name="CustomerNote"]').val(),
                            'EmployeeNote': $thisForm.find('[name="EmployeeNote"]').val(),
                            'ServiceAmount': $thisForm.find('[name="ServiceAmount"]').val(),
                            'ReplaceAmount': $thisForm.find('[name="ReplaceAmount"]').val(),
                            'ProductAmount': $thisForm.find('[name="ProductAmount"]').val(),
                            'TotalAmount': $thisForm.find('[name="TotalAmount"]').val(),
                            'DiscountAmount': $thisForm.find('[name="DiscountAmount"]').val(),
                            'NetAmount': $thisForm.find('[name="NetAmount"]').val(),
                            'ID_NextAction': $thisForm.find('[name="ID_NextAction"]').val(),

                            'ID_NextActionLead': $thisForm.find('[name="ID_NextActionLead"]').val(),
                            'FK_ActionType': $thisForm.find('[name="FK_ActionType"]').val(),
                            'FK_EmployeeAssign': $thisForm.find('[name="FK_EmployeeAssign"]').val(),
                            'NextActionDateLead': $thisForm.find('[name="NextActionDateLead"]').val(),

                            'ServiceDetails': ServiceDetails,
                            'ProductDetails': ProductDetails,
                            'PaymentDetail': paymentdetails,
                            'BillTypeID': $thisForm.find('[name="BillTypeID"]').val(),
                            'TransMode': '@ViewBag.TransMode',
                            'AttendedEmployeeDetails': EmployeeDetails


                        };
                        console.log('save56', inputData)
                        $.ajax({
                            url: "@Url.Action("ServiceFollowUpUpdate", "ServiceList")",
                            type: "POST",
                            data: inputData,
                            dataType: "json",
                            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                            success: function (ajaxOutput) {

                                if (ajaxOutput.Process.IsProcess) {

                                    $.each(ajaxOutput.Process.Message, function (key, value) {
                                        NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': value });

                                        var url = '@Url.Action("Index", "ServiceList")?mgrp='+'@ViewBag.mgrp';
                                        window.location.href = url;
                                    });

                                    $thisForm.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
                                    $thisForm.find('[perfect-ctype="input"]').val('');
                                    $thisForm.find('[perfect-ctype="date"]').val('');
                                    $thisFormNew.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
                                    $thisFormNew.find('[perfect-ctype="input"]').val('');
                                    $thisFormNew.find('[perfect-ctype="date"]').val('');




                                    // Get the value set in form's perfect-onFormSuccess attribute
                                    let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                                    if (onSuccess) {
                                        window[onSuccess]();
                                    }
                                }
                                else {
                                    $.each(ajaxOutput.Process.Message, function (key, value) {
                                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                                    });
                                }
                            },
                            complete: function () {
                                $(ele).prop('disabled', false);
                            }

                        });
                    }
                }
                else {
                    $(ele).prop('disabled', false);
                    NotificationMessage({ 'type': 'error', 'heading': 'Warning', 'message': 'In Payment Method Balance Amt. Should be  Zero ' });
                }
            }
        }
    }

    function UpdateServicefollowup(ele) {

        let isValid = true;
        let blnHas = false;
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let selectactionstatusvalue = $thisForm.find('[name="ID_NextAction"]').children(":selected").attr('Status');



        var tablerow = $("#ProductDetailsTbody tr");




        if (tablerow.length > 0) {
            let blnBuyBack = false;
            $('#ProductDetailsTbody tr').each(function (index, ele) {

                let checkbox1 = $(this).find(".jq_ProductDet_td input[type='checkbox']").is(":checked") == true ? "1" : "0";

                let TextChangeMode = $(this).find("td:eq(5) option:selected").text();
                let TextChangeModvalue = $(ele).find("td:eq(5) option:selected").val();


                let RPDProductID = $(ele).find('.RplacedProductId').val();
                let Quantity = $(ele).find('.jq_ProductDetQty_td').find('input').val();
                let RplcdQuantity = $(ele).find('.RplcdProductqty').find('input').val();

                if (checkbox1 == 1 && (Quantity == 0 || Quantity == "") && !blnHas) {
                    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Quantity' });
                    isValid = false;
                    blnHas = true;
                }
                else if (checkbox1 == 1 && TextChangeModvalue != 3 && RPDProductID == 0 && !blnHas) {
                    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Replaced product' });
                    isValid = false;
                    blnHas = true;
                }
                else if (checkbox1 == 1 && TextChangeModvalue != 0 && RPDProductID != 0 && (RplcdQuantity == 0 || RplcdQuantity == "") && !blnHas) {
                    NotificationMessage({ 'type': 'Error', 'heading': 'Warning', 'message': 'Please Enter Replaced Quantity' });
                    isValid = false;
                    blnHas = true;
                }
                if ($(this).find('.jq_ProductDet_td').find('[type="checkbox"]').is(':checked') == true && $(this).find('.jq_ProductChangeMode_td').find('select').val() == 1 && !blnBuyBack) {
                    blnBuyBack = true;

                }
            });
            if (!blnBuyBack && parseInt(selectactionstatusvalue) == 9) {
                NotificationMessage({ 'type': 'error', 'heading': 'Warning', 'message': 'Invalid action in Action Taken section' });
                isValid = false;
            }
        }



        if (isValid == true) {
            if ($thisForm.valid()) {
                if (BillAmountbind(ele)) {

                    $(ele).prop('disabled', true);

                    let pdata = $thisForm.data('pData');

                    var tableservicedetailsrws1 = $("#ProductServiceTbody tr");

                    let ServiceDetails1 = [];

                    if (tableservicedetailsrws1.length > 0) {


                        $('#ProductServiceTbody tr').each(function (index, ele) {

                            // if ($($(this).find("<td class='jq_ProductServices_td' input[type='checkbox']")[0]).is(":checked") == true)
                            if ($(this).find('.jq_ProductServices_td').find('[type="checkbox"]').is(':checked') == true) {
                                let Serviceinfo1 = {};
                                Serviceinfo1['ID_Product'] = $(this).find('.jq_ProductServices_ID_Product').text();
                                Serviceinfo1['ID_Services'] = $(this).find('.jq_ProductServices_ID_Services').text();
                                Serviceinfo1['Services'] = $(this).find('.jq_Type_tdjq_Type_td').text();
                                Serviceinfo1['ServiceType'] = $(this).find('.jq_ProductServiceMode_td').find('select').val();
                                Serviceinfo1['ServiceCost'] = $(this).find('.jq_ProductServicesAmnt_td').find('input').val();

                                Serviceinfo1['ServiceTaxAmount'] = $(this).find('.jq_ProductServicesTaxAmount').find('input').val();
                                Serviceinfo1['ServiceNetAmount'] = $(this).find('.jq_ProductServicesNetAmount').find('input').val();

                                Serviceinfo1['Remarks'] = $(this).find('.jq_ProductServicesRemarks_td').find('input').val();
                                console.log('Serviceinfo', Serviceinfo);
                                ServiceDetails1.push(Serviceinfo1);

                            }

                        });
                    }

                    var tablereplacedetailsrws2 = $("#ProductDetailsTbody tr");

                    let ProductDetails1 = [];

                    if (tablereplacedetailsrws2.length > 0) {


                        $('#ProductDetailsTbody tr').each(function (index, ele) {

                            // if ($($(this).find("<td class='jq_ProductServices_td' input[type='checkbox']")[0]).is(":checked") == true)
                            if ($(this).find('.jq_ProductDet_td').find('[type="checkbox"]').is(':checked') == true) {
                                let PrDetinfo1 = {};

                                PrDetinfo1['ID_Product'] = $(this).find('.jq_Product_ID_Product').text();
                                //  PrDetinfo['ID_Product'] = $(this).find('.jq_ProductDet_td').find('[type="checkbox"]').val();
                                PrDetinfo1['Quantity'] = $(this).find('.jq_ProductDetQty_td').find('input').val();
                                PrDetinfo1['Amount'] = $(this).find('.jq_ProductDetAmnt_td').find('input').val();
                                PrDetinfo1['ReplaceAmount'] = $(this).find('.jq_ProductDetReplaAmnt_td').find('input').val();

                                PrDetinfo1['RpdProductId'] = $(ele).find('.RplacedProductId').val();
                                PrDetinfo1['RpdMRP'] = $(ele).find('.RplacedMRPs').val()
                                PrDetinfo1['RpdSalePrice'] = $(ele).find('.RplcdProductAmt').val();
                                PrDetinfo1['RpdStockId'] = $(ele).find('.RplacedStockId').val();
                                PrDetinfo1['RpdTaxAmount'] = $(ele).find('.RplacedTaxAmount').val();
                                PrDetinfo1['RpdProductName'] = $(ele).find('.RplacedProductName').val();

                                PrDetinfo1['RpdProductQty'] = $(ele).find('.RplcdProductqty').find('input').val();
                                PrDetinfo1['RpdProductAmount'] = $(ele).find('.RplcdProductAmt').find('input').val();
                                // PrDetinfo['ChangeMode'] = $(this).find('.jq_ProductChangeMode_td').val();
                                PrDetinfo1['ID_Mode'] = $(this).find('.jq_ProductChangeMode_td').find('select').val();
                                PrDetinfo1['ModelNo'] = $(this).find('.jq_ProductDetModelNO_td').find('input').val();
                                PrDetinfo1['Remarks'] = $(this).find('.jq_ProductDetRemarks_td').find('input').val();
                                PrDetinfo1['EmpCode'] = $(this).find('.jq_Product_EmpCode').text();
                                PrDetinfo1['StockID'] = $(this).find('.jq_Product_StockID').text();
                                console.log('Prinfo', PrDetinfo1);
                                ProductDetails1.push(PrDetinfo1);

                            }

                        });
                    }


                    var tableemployeedetailsrws3 = $("#AttendedProductServiceTbody tr");

                    let EmployeeDetails1 = [];

                    if (tableemployeedetailsrws3.length > 0) {


                        $('#AttendedProductServiceTbody tr').each(function (index, ele) {

                            // if ($($(this).find("<td class='jq_ProductServices_td' input[type='checkbox']")[0]).is(":checked") == true)
                            if ($(this).find('.jq_ProductServices_td').find('[type="checkbox"]').is(':checked') == true) {
                                let EmpDetinfo1 = {};
                                EmpDetinfo1['ID_Employee'] = $(this).find('.jq_ProductServices_ID_Employee').text();
                                EmpDetinfo1['EmployeeType'] = $(this).find('.jq_Employeetypeid_td').text();
                                console.log('Prinfo', EmpDetinfo1);
                                EmployeeDetails1.push(EmpDetinfo1);


                            }

                        });
                    }
                    let paymentdetails1 = [];
                    $thisForm.find('[perfect-tempTable="Payment"]').find('tbody').find('tr').each(function () {
                        paymentdetails1.push($(this).data('pData'));
                    })
                    console.log('pdata after view click', pdata)
                    console.log('> Update servicefollow up  form data saved', pdata);
                    var data;
                    data = checkadmount;
                    if (data) {
                        let inputData = {

                            __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                            ID_ServiceFollowUp: pdata.ID_ServiceFollowUp,
                            'FK_Customerserviceregister': $thisForm.find('[name="FK_Customerserviceregister"]').val(),
                            'StartingDate': $thisForm.find('[name="VisitedDateAfter"]').val(),
                            'AttendedMode': $thisForm.find('[name="AttendedMode"]').val(),
                            'CustomerNote': $thisForm.find('[name="CustomerNote"]').val(),
                            'EmployeeNote': $thisForm.find('[name="EmployeeNote"]').val(),
                            'ServiceAmount': $thisForm.find('[name="ServiceAmount"]').val(),
                            'ReplaceAmount': $thisForm.find('[name="ReplaceAmount"]').val(),
                            'ProductAmount': $thisForm.find('[name="ProductAmount"]').val(),
                            'TotalAmount': $thisForm.find('[name="TotalAmount"]').val(),
                            'DiscountAmount': $thisForm.find('[name="DiscountAmount"]').val(),
                            'NetAmount': $thisForm.find('[name="NetAmount"]').val(),
                            'ID_NextAction': $thisForm.find('[name="ID_NextAction"]').val(),

                            'ID_NextActionLead': $thisForm.find('[name="ID_NextActionLead"]').val(),
                            'FK_ActionType': $thisForm.find('[name="FK_ActionType"]').val(),
                            'FK_EmployeeAssign': $thisForm.find('[name="FK_EmployeeAssign"]').val(),
                            'NextActionDateLead': $thisForm.find('[name="NextActionDateLead"]').val(),

                            'ServiceDetails': ServiceDetails1,
                            'ProductDetails': ProductDetails1,
                            'PaymentDetail': paymentdetails1,
                            'BillTypeID': $thisForm.find('[name="BillTypeID"]').val(),
                            'AttendedEmployeeDetails': EmployeeDetails1






                        };


                        console.log('> Update district ajax input', inputData);
                        $.ajax({
                            url: "@Url.Action("UpdateServiceFollowUpDetails", "ServiceList")",
                            type: "POST",
                            // headers: { "token_key": "1234" },
                            data: inputData,//<---- Input json : data passed to controller
                            dataType: "json",
                            contentType: 'application/x-www-form-urlencoded;charset=utf-8',
                            success: function (ajaxOutput) { //<----- if ajax method executed succesfully,  we get the data passed from controller in this variable  => success: function (variable) {

                                if (ajaxOutput.Process.IsProcess) {

                                    $.each(ajaxOutput.Process.Message, function (key, value) {
                                        //toastr.success(value, "Success");
                                        NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': value });
                                        var url = '@Url.Action("Index", "ServiceList")?mgrp='+'@ViewBag.mgrp';
                                        window.location.href = url;
                                    });


                                    let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                                    if (onSuccess) {
                                        window[onSuccess]();
                                    }

                                    //---------- Do stuff if success
                                    //toastr.success("Inside success", "Confirmation Box in table");

                                    console.log('> update new ServiceFollowUp success data', ajaxOutput);
                                }
                                else {
                                    $.each(ajaxOutput.Process.Message, function (key, value) {
                                        //toastr.warning(value, "Error");
                                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                                    });
                                }


                            },
                            complete: function () {
                                $(ele).prop('disabled', false);
                            }

                        });
                    }


                }
                else {
                    $(ele).prop('disabled', false);
                    NotificationMessage({ 'type': 'error', 'heading': 'Warning', 'message': 'In Payment Method Balance Amt. Should be  Zero ' });
                }
            }
        }

        //}

    }

    @*function GetProductDetails(ele, id) {
            let $sidemenu = $sideMenuOptions.body;
            console.log("gfhfgh",$sidemenu);
            $sideMenuOptions.title.find('h4').text('Place ');
        var $thisForm = $(ele).closest('[perfect-class="form-Assign"]');
        var InputData = {
            'ID_Product': id
        }
        $.ajax({
            url: "@Url.Action("GetProductHistoryDetails1", "ServiceList")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {
               // $('[name=FK_Customerserviceregister]').val($(ele).attr('data-id'));
                $TicketHtml = '';
                if (ajaxOutput != null) {


                    if (ajaxOutput != null) {

                        $('#ProductTbody').empty();
                       // var ProductData = ajaxOutput.Data;

                        $ProductHtml = '';

                        if (ajaxOutput.Data.length > 0) {
                            $.each(ajaxOutput.Data, function (i, value) {

                                let rowCount = (i + 1);

                                $ProductHtml += "<tr id=" + rowCount + ">";
                                $ProductHtml += "<td style='text-align: center;'>" + rowCount + "</td>";
                                $ProductHtml += "<td>" + value.Product + "</td>";
                                $ProductHtml += "<td>" + value.ProductComplaint + "</td>";
                                $ProductHtml += "<td>" + value.ProductDescription + "</td>";
                                $ProductHtml += "<td>" + value.Warrenty + "</td>";
                                $ProductHtml += "<td>" + value.WarrentyDate + "</td>";
                                $ProductHtml += "<td>" + value.ModelNo + "</td>";
                                $ProductHtml += "</tr>";
                            });
                        }
                        else {
                            $ProductHtml += "<tr id='0'><td colspan='4' style'text-align:center'>No Records..</td></tr>";
                        }

                        $('#ProductTbody').append($ProductHtml);
                    }



                  //  $('#btnUpdate').css('display', 'none');
                  //  $('#btnSave').css('display', 'block');
                    $('.bd-service-modal-sm').modal('show');
                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
            }
        });

    }*@

    function GetProductDetailsOld(ele, id)
    {

            let $sidemenu = $sideMenuOptions.body;

            $sideMenuOptions.title.find('h4').text('Place ');



        var $thisForm = $(ele).closest('[perfect-class="form"]');
        var InputData = {
            'ID_Product': id,
            'FK_Customer': '@Model.FK_Customer',
            'FK_CustomerOthers':'@Model.FK_CustomerOthers'
        }

        $.ajax({
            url: "@Url.Action("GetProductHistoryDetails1", "ServiceList")",
            type: "Get",
            data: InputData,
            dataType: "json",
            contentType: "application/json",
            success: function (ajaxOutput) {

                $TicketHtml = '';
                if (ajaxOutput != null) {


                    if (ajaxOutput != null) {

                        $('#ProductTbodyhistroy').empty();
                       // var ProductData = ajaxOutput.Data;

                        $ProductHtml = '';

                        if (ajaxOutput.Data.length > 0) {
                            $.each(ajaxOutput.Data, function (i, value) {

                                let rowCount = (i + 1);

                                $ProductHtml += "<tr id=" + rowCount + ">";
                                $ProductHtml += "<td style='text-align: center;'>" + rowCount + "</td>";
                                $ProductHtml += "<td>" + value.TicketNo + "</td>";
                                $ProductHtml += "<td>" + value.Service + "</td>";
                                $ProductHtml += "<td>" + value.Complaint + "</td>";
                                $ProductHtml += "<td>" + value.CurrentStatus + "</td>";
                                $ProductHtml += "<td>" + value.ClosedDate + "</td>";
                                $ProductHtml += "<td>" + value.EmployeeNotes + "</td>";
                                $ProductHtml += "</tr>";
                            });
                        }
                        else {
                            $ProductHtml += "<tr id='0'><td colspan='4' style'text-align:center'>No Records..</td></tr>";
                        }

                        $('#ProductTbodyhistroy').append($ProductHtml);
                    }



                  //  $('#btnUpdate').css('display', 'none');
                  //  $('#btnSave').css('display', 'block');
                    $('.bd-service-modal-sm').modal('show');
                }
                else {
                    $.each(ajaxOutput.Process.Message, function (key, value) {
                        NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                    });
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
            }
        });

        }

    function GetPaymentlists(ele) {
        debugger
        $('#formGroupModalpayment').modal({ backdrop: 'static', keyboard: false })

        $('#formGroupModalpayment').modal('show');

    }


    function Billttlnetchck(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let balamt = $thisForm.find('[name=BalAmt]').text();


        if (parseFloat(balamt) == 0) {
            $('#formGroupModalpayment').modal('hide');
            $thisForm.find('[perfect-tempTable="Payment"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('');
        }
        else {

            $thisForm.find('[perfect-tempTable="Payment"]').closest('[perfect-class="formGroup"]').find('.temptableError').text('Balance Amt. should be Zero');

        }
    }



    var paytableOptionsTempOut = {
        iconButton: {
            buttons: [

                {
                    icon: "fa fa-pencil btnPerfectGridEdit",
                    class: "btnPerfectGridEdit",
                    action: function () {
                        let savedData = $(this).closest('tr').data('pData')

                        let $tablecontainer = $(this).closest('[perfect-tempTable]');
                        let tableKey = $tablecontainer.attr('perfect-tempTable');
                        let $thisForm = $tablecontainer.closest('[perfect-class="form"]');
                        //index attribute name in table row
                        let indexname = tableKey + 'index';

                        //index number in table row
                        let rindex = $(this).closest('tr').attr(indexname);

                        $tablecontainer.attr('perfect-tempTable-action', rindex);

                        console.log('Editclick', savedData);
                        //filling data in available inputs
                        $thisForm.find('[perfect-tempTable-' + tableKey + ']').each(function () {
                            let $thisNode = $(this);
                            let pf_name = $thisNode.attr('name');
                            if ($thisNode.is('select')) {

                                $thisNode.val(savedData[pf_name]).selectpicker('refresh');

                            }
                            else if ($thisNode.is('input')) {
                                let inputType = $thisNode.attr('type').toLocaleLowerCase();
                                if ($thisNode.attr('type').toLocaleLowerCase() == 'checkbox') {

                                    $thisNode.prop('checked', savedData[pf_name]);
                                }

                                else {

                                    $thisNode.val(savedData[pf_name]);
                                }

                            }
                            else {
                                $thisNode.val(savedData[pf_name]);
                            }


                        });



                    }
                },
                {
                    icon: "fa fa-trash btnPerfectGridDelete",
                    class: "btnPerfectGridDelete",
                    action: function () {
                        let $tablecontainer = $(this).closest('[perfect-tempTable]');
                        let $thistbl = $(this).closest('table');
                        let table = $thistbl.DataTable();
                        table.destroy();
                        if ($(this).closest('tbody').find('tr').length > 1) {
                            $(this).closest('tr').remove();
                            pft_table_slreset($thistbl);
                            //$thistbl.dataTable({ paging: true, searchbtn: false });
                        }
                        else {
                            $thistbl.remove();
                        }
                        BillAmountbind($tablecontainer);
                    }
                },
            ]
        },

        rowAttribute: [],
        onlyShowColumn: ['PAmount', 'Refno', 'PaymentMethod_d'],
        renameHeader: { "PAmount": "Amount1R", "Refno": "Ref No", "PaymentMethod_d": "Method" },
        hideColumn: ['BalAmt'],
        serialNo: true,

    };

    function Pamount(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let amtp = $thisForm.find('[name="PAmount"]').val() == "" ? "0" : $thisForm.find('[name="PAmount"]').val();
        $thisForm.find('[name="PAmount"]').val(parseFloat(amtp).toFixed(2));
        //salroundoff(ele);
    }
    function validpaymntdetail(ele, tableKey, errorClass, isValid) {
        debugger

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        if ($thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').val() == 0 || $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').val() == null) {

            isValid = false
            console.log('false', $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').val());
            $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Please Select Payment Method');
        }
        else {
            $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
        }

        if ($thisForm.find('[perfect-tempTable-' + tableKey + '="PAmount"]').val() < 0 || $thisForm.find('[perfect-tempTable-' + tableKey + '="PAmount"]').val() == '' || $thisForm.find('[perfect-tempTable-' + tableKey + '="PAmount"]').val() == null || $thisForm.find('[perfect-tempTable-' + tableKey + '="PAmount"]').val()==undefined) {
            console.log('false', $thisForm.find('[perfect-tempTable-' + tableKey + '="PaymentMethod"]').val());
            isValid = false;

            $thisForm.find('[perfect-tempTable-' + tableKey + '="PAmount"]').closest('[perfect-class="formGroup"]').find(errorClass).text('Please enter a value greater than or equal to 1');
        }
        else {

            $thisForm.find('[perfect-tempTable-' + tableKey + '="PAmount"]').closest('[perfect-class="formGroup"]').find(errorClass).text('');
        }


        return isValid;

    }

    function createtable(ele, tkey, uniq = [], tableOptionsTempOut) {

        debugger
        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let tableKey = tkey;
        let $tblcontainer = $thisForm.find('[perfect-tempTable="' + tableKey + '"]');

        let insertData = {};
        let tableOptionsTemp = tableOptionsTempOut;
        console.log('tableOptionsTemp', tableOptionsTemp)
        let unique = (uniq) ? uniq : [];

        let isValid = true;
        let errorClass = '.temptableError';

        //make index
        console.log('check 1');

        let lastIndex = ($tblcontainer.attr('perfect-tempTable-lastindex')) ? parseInt($tblcontainer.attr('perfect-tempTable-lastindex')) : 0;
        let thisactionIndex = ($tblcontainer.attr('perfect-tempTable-action')) ? parseInt($tblcontainer.attr('perfect-tempTable-action')) : 0;
        let indexname = tkey + 'index';
        tableOptionsTemp.rowAttribute.push(indexname);
        tableOptionsTemp.hideColumn.push(indexname);
        console.log('tableOptionsTemp.rowAttribute', tableOptionsTemp.rowAttribute)
        let updateCond = '';
        let isNew = true;

        if (thisactionIndex > 0) {
            //means update
            insertData[indexname] = thisactionIndex;
            updateCond = '[' + indexname + '="' + thisactionIndex + '"]';
            isNew = false;
        }
        else {
            //insert
            insertData[indexname] = lastIndex + 1;
            $tblcontainer.attr('perfect-tempTable-lastindex', lastIndex + 1);
            isNew = true;
        }
        //
        if (tableKey == 'Warranty') {

            isValid = validwartdetail(ele, tableKey, errorClass, isValid);
        }
        else if (tableKey == 'Payment') {
            isValid = validpaymntdetail(ele, tableKey, errorClass, isValid);
        }
        else if (tableKey == 'Purchase') {
            isValid = validsaledetail(ele, tableKey, errorClass, isValid);
        }

        if (unique.length > 0) {
            //getting previous data
            let prevData = [];
            $tblcontainer.find('table > tbody').find('tr').each(function () {
                if (isNew) {
                    prevData.push($(this).data('pData'));
                }
                else {
                    if (parseInt($(this).attr(indexname)) != thisactionIndex) {
                        prevData.push($(this).data('pData'));
                    }

                }

            })
            console.log('previous data', prevData);

            unique.forEach(function (key, i) {
                console.log('unid -> key:' + key + "| index :" + i);
                let $thisEle = $thisForm.find('[perfect-tempTable-' + tableKey + '="' + key + '"]');
                // let headerEleName = $thisForm.find('[name="lblProName"]').text();
                let atname = $thisEle.attr('name');
                let cvalue;
                console.log('atname', atname);
                console.log('$thisEle.length', $thisEle.length);
                if ($thisEle.length != 0) {
                    console.log('len', $thisEle)
                    let $errorElement = $thisEle.closest('[perfect-class="formGroup"]').find(errorClass);
                    let errmessage = key + " Already exits"

                    //getting current value in cval
                    if ($thisEle.is('select')) {
                        cvalue = $thisEle.val();

                    }
                    else if ($thisEle.is('input')) {

                        let inputEleType = $thisEle.attr('type').toLocaleLowerCase();

                        if (inputEleType == 'checkbox') { cvalue = $thisEle.is(':checked'); }
                        else if (inputEleType == 'hidden') { cvalue = $thisEle.val(); console.log('cvalue ->', cvalue); }
                        else { cvalue = $thisEle.val(); }
                    }
                    else { cvalue = $thisEle.val(); }



                    //searching in previous data
                    if (prevData.find(a => a[atname] == cvalue)) {
                        // console.log('Search =>' + cvalue + '| attr :' + atname)
                        $errorElement.text(errmessage);
                        isValid = false;
                    }
                }
            });

        }

        console.log('isValid', isValid);

        if (isValid) {

            console.log('check 4.1');
            // this section make table column data
            $thisForm.find('[perfect-tempTable-' + tableKey + ']').each(function () {
                let $this = $(this);
                let headerName = $this.attr('perfect-tempTable-' + tableKey);
                let nameAttr = $this.attr('name');
                //console.log('nameAttr', nameAttr);
                console.log('headerName', headerName);

                if ($this.is('select')) {

                    //tableOptionsTemp.renameHeader[nameAttr + '_d'] = headerName;
                    tableOptionsTemp.hideColumn.push(nameAttr)
                    //displat text of select
                    if ($this.val() != null) {
                        let selectText = ($this.val().length == 0) ? '' : $this.children(":selected").text();
                        insertData[nameAttr + '_d'] = selectText;
                    }
                    else {
                        let selectText = ($this.val() == null) ? '' : $this.children(":selected").text();
                        insertData[nameAttr + '_d'] = selectText;
                    }

                    insertData[nameAttr] = $this.val();


                    $this.val('').selectpicker('refresh');


                }
                else if ($this.is('input')) {

                    insertData[nameAttr] = $this.val();
                    console.log('insertData[nameAttr]', insertData[nameAttr])
                    if (nameAttr == "prodtid") { }
                    else if (nameAttr == "stkid") { }
                    else {
                        $this.val('');
                    }
                }

            });
            console.log('check 4.2', insertData);
            console.log('check 4.2 tableoption', tableOptionsTemp);
            if (isNew) {
                console.log('check 4.2.1');
                //this section nake table.table row
                if ($tblcontainer.find('table').length == 0) {
                    console.log('check 4.2.3');
                    console.log(insertData);
                    console.log(',tableOptionsTemp', tableOptionsTemp)
                    $tblcontainer.append(pft_table_createtable([insertData], tableOptionsTemp));

                    //  $tblcontainer.find('table').dataTable({ paging: false, ordering: false });
                }
                else {
                    console.log('check 4.2.1');
                    let table = $tblcontainer.find('table').DataTable()
                    table.destroy()
                    pft_table_addTableRow($tblcontainer.find('table'), insertData, tableOptionsTemp);


                }

            }
            else {

                let table = $tblcontainer.find('table').DataTable()
                table.destroy()

                pft_table_replaceTableRow($tblcontainer.find('table'), updateCond, insertData, tableOptionsTemp);

            }


            $tblcontainer.attr('perfect-tempTable-action', 0);

            if (tableKey == 'Warranty') {


            }
            else if (tableKey == 'Payment') {
                debugger
                BillAmountbind(ele);
            }
            else if (tableKey == 'Purchase') {
                $thisForm.find('[name=prdbtn]').removeAttr("disabled", "disabled")

                $thisForm.data({ pwarranty: warrantydetails });
                console.log('check 123', $thisForm.data('pwarranty'));
                $thisForm.data({ addpImageselect: $thisForm.data('pImageselect') });
                console.log('addpImageselect', $thisForm.data('addpImageselect'))
                BindBilldetails(ele);

            }

        }


        console.log('check 5');
    }


    function BillAmountbind(ele) {


        debugger
        let $thisForm = $('[perfect-class="form"]');

        let netamt = $thisForm.find('[name="ReplaceAmount"]').val() == "" ? 0 : $thisForm.find('[name="ReplaceAmount"]').val();
        let billamt = 0;
        let bilamt = 0;

        if ($thisForm.find('[name=BalAmt]').text() == '') {
            bilamt = 0;
        }
        else {

            bilamt = netamt;
        }



        $('#Paymentdethead').find('tbody tr').each(function (index, ele) {

            billamt += parseFloat($(ele).find('.PAmount').text());

        });

        bilamt = parseFloat(bilamt) - parseFloat(billamt);

        $thisForm.find('[name=BalAmt]').text(bilamt.toFixed(2));

        if (bilamt == 0) {

            return true;

        }
        else {

            return false;

        }
    }

    function clearproduct(ele) {

        let $thisForm = $(ele).closest('[perfect-class="form"]');
        console.log('categoryvalue', $thisForm.find('[name= CategoryNameID]').val());

        $thisForm.find('[name= ProductID]').val(0);

        $thisForm.find('[name=ProductName]').val('');
        GetProserMoreDetails(ele,0);

    }


    function getfunction(ele) {
        GetProserMoreDetails(ele,0);
    }


    function decimalpnt(ele, id, range) {

        let input = $('#' + id);
        ele.value = ele.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');
        let t = ele.value;
        ele.value = (t.indexOf(".") >= 0) ? (t.substr(0, t.indexOf(".")) + t.substr(t.indexOf("."), range)) : t;
        input.on('keydown', function () {
            if (ele.value.includes('.')) {

            }
            var key = event.keyCode || event.charCode;
            if (key == 8 || key == 46) { }
            else {
                if (ele.value.length == 9) {
                    ele.value = ele.value + '.';
                }
            }

        });
    }
    var WarrantytableOptions = {

        onlyShowColumn: [],
        hideColumn: ["ID_CustomerWiseProductDetails"],
       rowClickAction: GetWarrantylist,
        serialNo: true,
            renameHeader: { }
    };
    function fn_WaranttyDetails() {


         var obj = {
             FK_Customer: $("#FK_Customer").val(),
             FK_CustomerOthers: $("#FK_CustomerOthers").val(),
             FK_Product: $("#ID_Product").val(),
             FK_Category: $("#FK_Category").val(),
             Mode: 1
         }
         $.ajax({
                 url: "@Url.Action("getBillList", "Service")",
                type: "POST",
                data: obj ,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
                  success: function (ajaxOutput) {

                 if (ajaxOutput.Process.IsProcess) {

                     let table = JSON.parse(ajaxOutput.Data);
                     $('#warrantyhis').html(pft_table_createtable(table.dtable, WarrantytableOptions))
                     document.getElementById("warrntydt").style.display = 'none';
                 }
                 else {

                     $('#warrantybadge').html(0);
                     document.getElementById("warrntydt").style.display = 'block';
                     document.getElementById("Warrantydet").style.display = 'none';
                     document.getElementById("Warrantyheader").style.display = 'none';
                     $('#warrantyhis').html('')
                     $('#warrntydt').html("<p style='text-align:center;' >No Records..</p>");
                 }

               }
         });
    }
    function GetWarrantylist(ele)
    {

            $('.Divcontact').hide();

          let $thisRow = $(this).closest('tr');
          let savedata = $thisRow.data('pData');


     var obj = {

         Mode: 4,
         MasterID: savedata.ID_CustomerWiseProductDetails
         }


         $.ajax({
                 url: "@Url.Action("getwarrantyList", "Service")",
                type: "POST",
                data: obj ,
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
                  success: function (ajaxOutput) {
                   if (ajaxOutput.Process.IsProcess) {
                    $('#Warrantydetbdy').empty();

                       $('#invoiceno').html("<b>Invoice No</b>" + ":" + " <b>" + savedata.InvoiceNo + "</b>");
                    let dtable = JSON.parse(ajaxOutput.Data).dtable;
                    console.log('dtable', dtable)
                    if (dtable.length > 0) {

                        var warranty = dtable[dtable.length - 1].ID_WarrantyDetails;

                        a = 1;

                        var pdficon ;
                        var viewicon ;
                        var title ;
                        for (var i = dtable.length - 1; i >= 0; i--)
                        {
                            let $tr = $('<tr/>');

                            let isicon = false;
                            var _validFileExtensions = [".jpg", ".jpeg", ".bmp", ".gif", ".png"];
                            if (dtable[i].ImageName != null) {
                                for (var j = 0; j < _validFileExtensions.length; j++) {

                                    if (dtable[i].ImageName.includes(_validFileExtensions[j])) {
                                        pdficon = "fa fa-file-image-o";
                                        viewicon = "fa fa-eye";
                                        title = "View File";
                                        isicon = true;
                                    }

                                }
                                if (!isicon) {
                                    if (dtable[i].ImageName.includes(".xl")) {
                                        pdficon = "fa fa-file-excel-o";
                                    }
                                    else if (dtable[i].ImageName.includes(".pdf")) {
                                        pdficon = "fa fa-file-pdf-o";
                                    }
                                    else { pdficon = "fa fa-file-o"; }
                                    viewicon = "fa fa-download";
                                    title = "Download file";

                                }
                            }

                            if (i == 0 || warranty != dtable[i - 1].ID_WarrantyDetails) {
                                $tr.append("<td  class='nrs' rowspan=\"" + a + "\">" + dtable[i].WarrantyType + "</td>");
                                $tr.append("<td rowspan=\"" + a + "\">" + dtable[i].ReplacementWarrantyExpireDate + "</td>");
                                $tr.append("<td rowspan=\"" + a + "\">" + dtable[i].ServiceWarrantyExpireDate + "</td>");

                                a = 1;
                                if (i > 0) warranty = dtable[i - 1].ID_WarrantyDetails;

                            }
                            else {
                               a++;
                            }
                            if (dtable[i].ImageName != null) {
                                $tr.append("<td class='imagename' style='display:none'>" + dtable[i].ImageName + "</td>");
                                $tr.append("<td class='imageval' style='display:none'>" + dtable[i].Image + "</td>");

                                $tr.append("<td class='imagemode' >" + dtable[i].ImageMode + "</td>");
                                $tr.append("<td > <button type='button' data-toggle='tooltip' onclick='downloadimg(this)' " +
                                    " class= 'btn btn-rounded btn-primary1' > <span class='btn-icon-left text-primary'><i id='imagei' class='" + pdficon + "'></i></span><i  title='" + title + "' class='" + viewicon + "'></i></button ></td >");
                            }
                            $('#Warrantydetbdy').prepend($tr);

                            document.getElementById("Warrantyheader").style.display = 'block';
                            document.getElementById("Warrantydet").style.display = 'block';
                             }
                    }
                    else
                    {
                                let $tr = $('<tr/>');
                                $tr.append("<th colspan='5' style='text-align:center'>No Data to display</th>");
                               $('#Warrantydetbdy').append($tr);
                          }
                }
                   else
                   {
                       document.getElementById("warrntydt").style.display = 'block';
                       document.getElementById("Warrantyheader").style.display = 'none';
                          document.getElementById("Warrantydet").style.display = 'none';
                          $('#warrntydt').html("<p style='text-align:center;' >No Records..</p>");
                }
            },
            complete: function () {
                $(ele).prop('disabled', false);
            }
        });

    }
    function downloadimg(ele) {

        var text = $(ele).closest('tr').find('.imagename').text();
        var imgname = $(ele).closest('tr').find('.imagemode').text();
        var textval = $(ele).closest('tr').find('.imageval').text();
        var isimage = false;
        var _validFileExtensions = [".jpg", ".jpeg", ".bmp", ".gif", ".png"];
        for (var j = 0; j < _validFileExtensions.length; j++) {
            if (text != null) {
                if (text.includes(_validFileExtensions[j])) {

                    $('#imageGrid').modal('show');
                    $('#modaltit').text(imgname);
                    $("#myImg").attr("src", "data:image/;base64," + textval);
                    $("#myImg").attr("name", text);
                    var myImg = document.getElementById("myImg");

                    myImg.style.width = "350px";



                    isimage = true;
                }
            }


        }
        if (!isimage) {

            var a = document.createElement("a");

            a.href = "data:image/;base64," + textval; //Image Base64 Goes here
            a.download = text;//File name Here
            a.click();
        }
    }


    function Showactionlead(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let selectactionstatusval = $thisForm.find('[name="ID_NextAction"]').children(":selected").attr('Status');

        $thisForm.find('[name="FK_ActionStatus"]').val(selectactionstatusval).selectpicker('refresh');

        if (selectactionstatusval == 9) {
            $('.divactionlead').show();

            $thisForm.find('[name="ID_NextActionLead"]').addClass('perfectValidate_numeric');
        }
        else {
            $('.divactionlead').hide();
            $('.divaasignedto').hide();
            $('.divfollowupdate').hide();
            $('.divactiontype').hide();
            $thisForm.find('[name="ID_NextActionLead"]').removeClass('perfectValidate_numeric');
            $thisForm.find('[name="NextActionDateLead"]').removeClass('perfectValidate_date');
            $thisForm.find('[name="FK_ActionType"]').removeClass('perfectValidate_numeric');

        }
        $thisForm.find('[name=ID_NextActionLead]').val('').selectpicker('refresh');
        $thisForm.find('[name=FK_ActionType]').val('').selectpicker('refresh');
        $thisForm.find('[name="NextActionDate"]').val();

 }


    function SetActiontypedropdown(ele) {
        let $thisForm = $(ele).closest('[perfect-class="form"]');

        let selectleadactionstatus = $thisForm.find('[name="ID_NextActionLead"]').children(":selected").attr('Statuslead');

        $thisForm.find('[name="NxtActnStageLead"]').val(selectleadactionstatus).selectpicker('refresh');

        if (selectleadactionstatus == 1) {

            $('.divaasignedto').show();
            $('.divfollowupdate').show();
            $('.divactiontype').show();

            $thisForm.find('[name="NextActionDateLead"]').addClass('perfectValidate_date');
            $thisForm.find('[name="FK_ActionType"]').addClass('perfectValidate_numeric');
        }
        else {
            $('.divaasignedto').hide();
            $('.divfollowupdate').hide();
            $('.divactiontype').hide();
            $thisForm.find('[name="NextActionDateLead"]').removeClass('perfectValidate_date');
            $thisForm.find('[name="FK_ActionType"]').removeClass('perfectValidate_numeric');
        }
        $thisForm.find('[name=FK_ActionType]').val('').selectpicker('refresh');
        $thisForm.find('[name="NextActionDate"]').val();


    }



    function productclear(ele, tablekey) {

        let $thisform = $(ele).closest('[perfect-class="form"]');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="input"]').val('');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="select"]').val('').selectpicker('refresh');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="input"]').val('');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="date"]').val('');
        $thisform.find('[perfect-temptable-' + tablekey + ']').closest('[perfect-ctype="hidden"]').val('');

        let $tblcontainer = $thisform.find('[perfect-tempTable="' + tablekey + '"]');
        $tblcontainer.attr('perfect-tempTable-action', 0);

        if (tablekey = "Payment") {

        }
    }
    </script>
}