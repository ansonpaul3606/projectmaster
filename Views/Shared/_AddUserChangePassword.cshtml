@model PerfectWebERP.Models.UserchangePasswordModel.Userchangepwdlist
<style>
    button > .loaderClass {
        margin-right: 4px;
        display: none;
    }
</style>

<div class="card ">

    <div class="card-header">
        <h4 class="card-title col-12">Change Password<span @*class="badge light badge-success float-right"*@ @*perfect-class="formTitle"*@></span></h4>
    </div>
    <div class="card-body">
        <form id="" class="form-valide" perfect-class="form" action="#" method="post" perfect-onFormSuccess="">
            <div class="">
                @Html.AntiForgeryToken()
                <div class="row">

                    <div class="col-sm-6">
                        <div class="form-group row" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">User Code</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" placeholder="" name="UserCode" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" value="@Model.UserCode" disabled />
                            </div>
                        </div>
                        <div class="form-group row position-relative" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel"> Password</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-8 password__3">
                                <div class="input-group-append changepsweye-input">
                                    <input type="password" class="form-control perfectValidate" placeholder="" id="PresentPassword" name="PresentPassword" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" />

                                    <i id="eyesc" class="fa fa-eye-slash changepsweye"></i>

                                </div>
                            </div>
                        </div>
                        <div class="form-group row position-relative" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">New Password</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-8 password__1">
                                <div class="input-group-append changepsweye-input">
                                    <input type="password" class="form-control perfectValidate" placeholder="" id="NewPassword" name="NewPassword" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="16" />
                                    @*<input type="password" class="form-control" placeholder="" name="NewPassword" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" onkeypress="userpasswordconditionschecking(this)" />*@


                                    <i id="eyes" class="fa fa-eye-slash changepsweye"></i>

                                </div>
                            </div>
                        </div>
                        <div class="form-group row position-relative" perfect-class="formGroup">
                            <label class="col-sm-4 col-form-label">
                                <span perfect-class="formGroupLabel">Confirm Password</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-8 password__2">
                                <div class="input-group-append changepsweye-input">
                                    <input type="password" class="form-control perfectValidate" placeholder="" id="ConfirmPassword" name="ConfirmPassword" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" maxlength="16" />

                                    <i id="eyeReenters" class="fa fa-eye-slash changepsweye"></i>

                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="text-left">
                                <div id="Modall_errormessage" class="Custominvalid animated fadeInUp" style="color:#e94560;display:block;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-6">

                    </div>
                    <div class="col-sm-6">

                    </div>
                    <div class="col-sm-6">

                    </div>
                </div>
            </div>
            <div class="card-footer text-right" perfect-class="formFooter">
                @*<button id="" type="button" class="btn btn-primary mr-3 addcompany-jq-addnewuserUpdate d-none" name="update" perfect-css="button" onclick="fn_OccupationForm_update(this)"><i class="fa fa-refresh fa-spin loaderClass"></i>Update</button>*@
                <button id="addcompany-jq-addnewuser" type="button" class="btn btn-primary mr-3 " name="add" perfect-css="button" onclick="fn_UserchangepasswordForm_add(this)"><i class="fa fa-refresh fa-spin loaderClass "></i>Save</button>
                <button type="button" class="btn btn-light" perfect-css="button" onclick="ResetButtonlogin(this)" name="reset">Clear</button>
            </div>

        </form>
    </div>
</div>
<script src="~/Scripts/jqDOM/searchDOMCreation.js"></script>
<script>

 //on load functions
    (function () {
       jQuery('form').validate();//<-----  Validate/initialize our form on page load
        //jQuery('select').selectpicker();
    })();



    $("#eyeReenters").click(function () {
        debugger
        var ConfirmPassword = document.getElementById("ConfirmPassword");
        if (ConfirmPassword.type === "password") {
            ConfirmPassword.type = "text";
            $('#eyeReenters').toggleClass("fa-eye fa-eye-slash");
        } else {
            ConfirmPassword.type = "password";
            $('#eyeReenters').toggleClass("fa-eye-slash fa-eye");
        }
    });
    $("#eyes").click(function () {
        debugger
        var NewPassword = document.getElementById("NewPassword");
        if (NewPassword.type === "password") {
            NewPassword.type = "text";
            $('#eyes').toggleClass("fa-eye fa-eye-slash");
        } else {
            NewPassword.type = "password";
            $('#eyes').toggleClass("fa-eye-slash fa-eye");
        }
    });
    $("#eyesc").click(function () {
        debugger
        var PresentPassword = document.getElementById("PresentPassword");
        if (PresentPassword.type === "password") {
            PresentPassword.type = "text";
            $('#eyesc').toggleClass("fa-eye fa-eye-slash");
        } else {
            PresentPassword.type = "password";
            $('#eyesc').toggleClass("fa-eye-slash fa-eye");
        }
    });
    function ResetButtonlogin(ele) {


        let $thisForm = $(ele).closest('[perfect-class="form"]');
        let pData = $thisForm.data('pData');
        if (pData) {

            $thisForm.find('[name=UserCode]').val(pData.UserCode),
                $thisForm.find('[name=PresentPassword]').val(pData.PresentPassword),
                $thisForm.find('[name=NewPassword]').val(pData.NewPassword),

                $thisForm.find('[name=ConfirmPassword]').val(pData.ConfirmPassword)

            //$thisForm.find('"]').val('');
            //$thisForm.find('[perfect-ctype="digit"]').val('');

        }
        else {
           // $thisForm.find('[name=UserCode]').val(UserCode),
                $thisForm.find('[name=PresentPassword]').val(""),
                $thisForm.find('[name=NewPassword]').val(""),

                $thisForm.find('[name=ConfirmPassword]').val("")

        }
        $('#eyesc').toggleClass("fa-eye-slash fa-eye");
        $('#eyeReenters').toggleClass("fa-eye-slash fa-eye");
        $('#eyes').toggleClass("fa-eye-slash fa-eye");
        
    }

 // Function to Add Occupation
    function fn_UserchangepasswordForm_add(ele)
 {
	 let $thisForm = $(ele).closest('[perfect-class="form"]');//<------Form element :  Our Form which contain our input elements ,saved in a variable for reusability


            //$(ele).find('i').removeClass();

            console.log('> Add User change password form IS valid', $thisForm.valid())
        if ($thisForm.valid()) {//<---------Validation :  To Check whether the form is vaild(ie; values in the form contrls are valid)

            $(ele).prop('disabled', true); // avoiding form submit the double click


            var inputData = {//<---- Input Json : this is the variable we pass to controller
                __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                UserCode: $thisForm.find('[name=UserCode]').val().trim(),
                PresentPassword: $thisForm.find('[name= PresentPassword]').val().trim(),
                NewPassword: $thisForm.find('[name=NewPassword]').val().trim(),
                ConfirmPassword: $thisForm.find('[name=ConfirmPassword]').val().trim(),
            };


            console.log('> Add User Change password ajax input',inputData);

             $.ajax({
                 url: "@Url.Action("AddNewUserChangepassword", "UserChangepassword")",
                type: "POST",

                 data: inputData,//<---- Input json : data passed to controller
                dataType: "json",
                 contentType: 'application/x-www-form-urlencoded;charset=utf-8',
                 success: function (ajaxOutput) {//<----- if ajax method executed succesfully,  we get the data passed from controller in this variable  => success: function (variable) {

                     if (ajaxOutput.Process.IsProcess) {

                         $.each(ajaxOutput.Process.Message, function (key, value) {

                             NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': value });
                             window.localStorage.clear();
                              var url = '@Url.Action("LogOut", "Security")';
                              window.location.href = url;
                            // window.location("Security/LogOut");

                         });
                         $thisForm.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
                         $thisForm.find('[perfect-ctype="input"]').val('');
                         $thisForm.find('[perfect-ctype="digit"]').val('');

                         let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                         if (onSuccess) {

                              @*url: "@Url.Action("LogOut","Security")",*@
                             window[onSuccess]();
                         }

                         //---------- Do stuff if success

                         console.log('> Add new Occupation success data', ajaxOutput);
                     }
                     else {

                         console.log("Error Message valid>", ajaxOutput.Process.Message[0])

                         $('#Modall_errormessage').html(ajaxOutput.Process.Message[0]);

                         //$.each(ajaxOutput.Process.Message, function (key, value) {
                         //    //toastr.warning(value, "Error");
                         //    NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                         //});
                     }
                },
                complete: function () {
                    $(ele).prop('disabled', false);
                }

            });

        }
 }




    function userpasswordconditionschecking(ele)
 {
	 let $thisForm = $(ele).closest('[perfect-class="form"]');//<------Form element :  Our Form which contain our input elements ,saved in a variable for reusability


            //$(ele).find('i').removeClass();

            console.log('> Add User change password form IS valid', $thisForm.valid())
        if ($thisForm.valid()) {//<---------Validation :  To Check whether the form is vaild(ie; values in the form contrls are valid)

            $(ele).prop('disabled', true); // avoiding form submit the double click


            var inputData = {//<---- Input Json : this is the variable we pass to controller
                __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),

                NewPassword: $thisForm.find('[name=NewPassword]').val().trim(),

            };


            console.log('> Add User Change password ajax input',inputData);

             $.ajax({
                 url: "@Url.Action("Userpasswordcheckcondition", "UserChangepassword")",
                type: "POST",

                 data: inputData,//<---- Input json : data passed to controller
                dataType: "json",
                 contentType: 'application/x-www-form-urlencoded;charset=utf-8',
                 success: function (ajaxOutput) {//<----- if ajax method executed succesfully,  we get the data passed from controller in this variable  => success: function (variable) {

                     if (ajaxOutput.Process.IsProcess) {

                         $.each(ajaxOutput.Process.Message, function (key, value) {

                             NotificationMessage({ 'type': 'success', 'heading': 'Success', 'message': value });

                         });
                         $thisForm.find('[perfect-ctype="select"]').val('').selectpicker('refresh');
                         $thisForm.find('[perfect-ctype="input"]').val('');
                         $thisForm.find('[perfect-ctype="digit"]').val('');



                         let onSuccess = $thisForm.attr('perfect-onFormSuccess')

                         if (onSuccess) {

                              @*url: "@Url.Action("LogOut","Security")",*@
                             window[onSuccess]();
                         }

                         //---------- Do stuff if success

                         console.log('> Add new Occupation success data', ajaxOutput);
                     }
                     else {
                         $.each(ajaxOutput.Process.Message, function (key, value) {
                             //toastr.warning(value, "Error");
                             NotificationMessage({ 'type': 'error', 'heading': 'Error', 'message': value });
                         });
                     }
                },
                complete: function () {
                    $(ele).prop('disabled', false);
                }

            });

        }
 }

</script>