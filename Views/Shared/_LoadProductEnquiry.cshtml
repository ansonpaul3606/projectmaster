

@model PerfectWebERP.Models.ProductModel.ProductEnquiry
<style type="text/css">
    .popup-link {
        display: flex;
        flex-wrap: wrap;
    }

        .popup-link a {
            background: #333;
            color: #fff;
            padding: 10px 30px;
            border-radius: 5px;
            font-size: 17px;
            cursor: pointer;
            margin: 20px;
            text-decoration: none;
        }

    .popup-container {
        visibility: hidden;
        opacity: 0;
        transition: all 0.3s ease-in-out;
        transform: scale(1.3);
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(21, 17, 17, 0.61);
        display: flex;
        align-items: center;
    }

    .popup-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 50%;
    }

        .popup-content p {
            font-size: 17px;
            padding: 10px;
            line-height: 20px;
        }

        .popup-content a.close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            background: none;
            padding: 0;
            margin: 0;
            text-decoration: none;
        }

            .popup-content a.close:hover {
                color: #333;
            }

        .popup-content span:hover,
        .popup-content span:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

    .popup-container:target {
        visibility: visible;
        opacity: 1;
        transform: scale(1);
    }

    .popup-container h3 {
        margin: 10px;
    }
    /*End popup styles*/

    /* Additional styles */
    .popup-style-2 {
        transform: scale(0.3);
    }

        .popup-style-2:target {
            transform: scale(1);
        }

    .popup-style-3 {
        left: 100%;
    }

        .popup-style-3:target {
            left: 0;
        }

    .popup-style-4 {
        transform: rotate(180deg);
    }

        .popup-style-4:target {
            transform: rotate(0deg);
        }

    .popup-style-5 {
        top: 100%;
    }

        .popup-style-5:target {
            top: 0;
        }

    .popup-style-6 {
        transform: scale(15.3);
    }

        .popup-style-6:target {
            transform: scale(1);
        }

    .popup-style-7 {
        transform: skewY(180deg);
        transition: all 0.7s ease-in-out;
    }

        .popup-style-7:target {
            transform: skewY(0deg);
        }

    .divHeader {
        border-color: #dadce0;
        position: relative;
        background: transparent;
        /*display: flex;*/
        justify-content: space-between;
        align-items: center;
    }

    .divBody {
        overflow-y: auto;
        max-height: calc(100vh - 14rem);
        overflow-x: hidden;
        flex: 1 1 auto;
    }
    /*new section*/
    .shape {
        border-style: solid;
        border-width: 0 70px 40px 0;
        float: right;
        height: 0px;
        width: 0px;
        -ms-transform: rotate(360deg); /* IE 9 */
        -o-transform: rotate(360deg); /* Opera 10.5 */
        -webkit-transform: rotate(360deg); /* Safari and Chrome */
        transform: rotate(360deg);
    }

    .offer {
        background: #fff;
        border: 1px solid #ddd;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        margin: 15px 0;
        overflow: hidden;
    }

    .offer-radius {
        border-radius: 7px;
    }

    /*.offer-danger {
        border-color: #d9534f;
    }

        .offer-danger .shape {
            border-color: transparent #d9534f transparent transparent;
            border-color: rgba(255,255,255,0) #d9534f rgba(255,255,255,0) rgba(255,255,255,0);
        }*/

    /*.offer-success {
        border-color: #5cb85c;
    }

        .offer-success .shape {
            border-color: transparent #5cb85c transparent transparent;
            border-color: rgba(255,255,255,0) #5cb85c rgba(255,255,255,0) rgba(255,255,255,0);
        }*/

    /*.offer-default {
        border-color: #999999;
    }

        .offer-default .shape {
            border-color: transparent #999999 transparent transparent;
            border-color: rgba(255,255,255,0) #999999 rgba(255,255,255,0) rgba(255,255,255,0);
        }*/

    /*.offer-primary {
        border-color: #428bca;
    }

        .offer-primary .shape {
            border-color: transparent #428bca transparent transparent;
            border-color: rgba(255,255,255,0) #428bca rgba(255,255,255,0) rgba(255,255,255,0);
        }*/

    /*.offer-info {
        border-color: #5bc0de;
    }

        .offer-info .shape {
            border-color: transparent #5bc0de transparent transparent;
            border-color: rgba(255,255,255,0) #5bc0de rgba(255,255,255,0) rgba(255,255,255,0);
        }*/

    .offer-warning {
        border-color: #f0ad4e;
    }

        .offer-warning .shape {
            border-color: transparent #f0ad4e transparent transparent;
            border-color: rgba(255,255,255,0) #f0ad4e rgba(255,255,255,0) rgba(255,255,255,0);
        }

    .shape-text {
        color: #fff;
        font-size: 12px;
        font-weight: bold;
        position: relative;
        right: -40px;
        top: 2px;
        white-space: nowrap;
        -ms-transform: rotate(30deg); /* IE 9 */
        -o-transform: rotate(360deg); /* Opera 10.5 */
        -webkit-transform: rotate(30deg); /* Safari and Chrome */
        transform: rotate(30deg);
    }

    .offer-content {
        padding: 0 20px 10px;
    }
</style>

<div class="card">
    <div class="card-header">
        <h4 class="card-title col-12">Product Enquiry</h4>
    </div>
    <div class="card-body" style="min-height: 500px;">
        <form id="" class="form-valide" perfect-class="form" action="#" method="post" perfect-onFormSuccess="">
            <div class="">
                @Html.AntiForgeryToken()
                <div class="divHeader">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="form-group row" perfect-class="formGroup">
                                <label class="col-sm-4 col-form-label">
                                    <span perfect-class="formGroupLabel">Category</span>
                                </label>
                                <div class="col-sm-8">
                                    <select class="form-control" name="FK_Category" id="FK_Category" perfect-class="formGroupControl" perfect-ctype="select" perfect-css="select" data-live-search="true" onchange="fn_loadProductListData(this)">
                                        <option value="">Please Select </option>
                                        @if (!(Model.CategoryList is null))
                                        {
                                            foreach (var categorylist in Model.CategoryList)
                                            {
                                                <option value="@categorylist.FK_Category">@categorylist.Category</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group row" perfect-class="formGroup">
                                <label class="col-sm-4 col-form-label">
                                    <span perfect-class="formGroupLabel">Product</span>
                                </label>
                                <div class="col-sm-8">
                                    <div class="input-group">
                                        <input type="text" class="form-control " name="Product" perfect-class="formGroupControl" perfect-ctype="input" perfect-css="input" disabled />
                                        <input type="hidden" name="FK_Product" class="" perfect-class="formGroupControl" perfect-ctype="hidden" perfect-css="input" />
                                        <div class="input-group-append">
                                            <button id="addproduct-jq-searchButton3" class="btn btn-primary fa fa-search" type="button" perfect-css="button" onclick="GetCmnPopUpSearchValAssign(this,85,'Product List',[],['MinRate','MaxRate'])" Criterea1="FK_Category" Criterea2="0" BindName="Product" BindVal="FK_Product" Function="1"></button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            

                                <div class="custom-control custom-switch toggle-switch text-right mr-5 mb-2" style="float: left;margin-top: 10px;width:100%;display:flex">

                                    <input type="checkbox" class="custom-control-input" id="switchAllOrOffer" onclick="fn_getOfferCheckbox(this)">

                                    <label class="custom-control-label" for="switchAllOrOffer"><span id="lblswitchAllOrOffer">All Stock</span></label>

                                    <label for="myLabel" style="padding-left:20%"><span>Offers Only</span></label>

                                </div>
                                @*<div class="custom-control custom-switch toggle-switch text-right mr-5 mb-2" style="float: left;margin-top: 10px;">
                <input type="checkbox"  class="custom-control-input" id="switchAllOrOffer" onclick="fn_getOfferCheckbox(this)">
                <label class="custom-control-label" for="switchAllOrOfferonly"><span id="lblswitchAllOrOfferonly">Offers Only</span></label>
            </div>*@
                           
                        </div>
                        <div class="col-sm-1">
                            <button type="button" id="clear" class="btn btn-light1" perfect-css="button" onclick="loadProductEnquiryForm()" title="To reset"><i class="fa fa-refresh" aria-hidden="true"></i></button>
                        </div>
                        </div>
                </div>
                <div class="divBody">
                    <div class="row" id="contentPanel" name="contentPanel"></div>
                </div>
            </div>
        </form>


        @*<div class="row">
                <div class="col-sm-3">
                    <div class="offer offer-warning">
                        <div class="shape">
                            <div class="shape-text">
                                Offer
                            </div>
                        </div>
                        <div class="offer-content">
                            <div class="card-header" style="color: var(--perfect-primary);font-weight: bold;">Solar Light</div>
                            <div class="card-body" style="padding: 0rem"></div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="offer offer-warning">
                        <div class="shape">
                            <div class="shape-text">
                                Offer
                            </div>
                        </div>
                        <div class="offer-content">
                            <div class="card-header" style="color: var(--perfect-primary);font-weight: bold;">Solar Light</div>
                            <div class="card-body" style="padding: 0rem"><table class="table table-bordered"><tbody><tr style="display:none"><td>Rank</td><td style="text-align: center;">undefined</td></tr><tr><td>Code</td><td>SLT</td></tr><tr><td>MRP</td><td>0</td></tr><tr><td>Price</td><td>0</td></tr><tr><td>Stock</td><td>-89879778.879</td></tr></tbody></table></div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="offer offer-warning">
                        <div class="shape">
                            <div class="shape-text" title="Click on offer details">
                                Offer
                            </div>
                        </div>
                        <div class="offer-content">
                            <div class="card-header" style="color: var(--perfect-primary);font-weight: bold;">Solar Light</div>
                            <div class="card-body" style="padding: 0rem"><table class="table table-bordered"><tbody><tr style="display:none"><td>Rank</td><td style="text-align: center;">undefined</td></tr><tr><td>Code</td><td>SLT</td></tr><tr><td>MRP</td><td>0</td></tr><tr><td>Price</td><td>0</td></tr><tr><td>Stock</td><td>-89879778.879</td></tr></tbody></table></div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="offer offer-warning1">
                        <div class="offer-content"><div class="card-header" style="color: var(--perfect-primary);font-weight: bold;"></div><div class="card-body" style="padding: 0rem"></div></div>
                    </div>
                </div>
            </div>*@
    </div>
</div>

<script>
 //on load functions
    $(document).ready(function () {
        initFunctions('form');
        var labelElementss = $("label[for='switchAllOrOffer']");
        labelElementss.css("font-weight", "bold");
        fn_loadProductListData(labelElementss);
    });
    function fn_getOfferCheckbox(ele) {

        debugger
        var labelElement = $("label[for='myLabel']");
        var labelElementss = $("label[for='switchAllOrOffer']");

        if ($("#switchAllOrOffer").is(':checked')) {
            //$("#lblswitchAllOrOffer").text('All')
            labelElement.css("font-weight", "bold");
            labelElementss.css("font-weight", "normal");
        }
        else {
            //$("#lblswitchAllOrOffer").text('All')

            labelElementss.css("font-weight", "bold");
            labelElement.css("font-weight", "normal");
        }
        fn_loadProductListData(ele);
    }
    //fn_loadProductListData(this);
      function fn_loadProductListData_old(ele)
      {
          let $thisForm = $(ele).closest('[perfect-class="form"]');
          $thisForm.find('[name=contentPanel]').empty();
          if ($thisForm.find('[name=FK_Category]').val() == 0) {
              NotificationMessage({ 'type': 'warning', 'heading': 'warning', 'message': 'Please Select Category' });
              return;
          }
          let pageUrl = '@Url.Action("GetProductList", "Product")';
          $.ajax({
                 url: pageUrl,
                 type: "POST",
                 data: {
                     __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                     'FK_Category': $thisForm.find('[name=FK_Category]').val(),
                     'Name': $thisForm.find('[name=Product]').val(),
                     'FK_Product': $thisForm.find('[name=FK_Product]').val(),
                     'Offer': $("#switchAllOrOffer").is(':checked')?1:0
                 },
                 dataType: "json",
                 contentType: "application/x-www-form-urlencoded; charset=utf-8",
                 success: function (ajaxOutput) {

                     if (ajaxOutput.proDtls.Process.IsProcess) {
                         $.each(ajaxOutput.proDtls.Data, function (key, value) {
                             let rankDisplay = "none";
                             let myCol = $('<div class="col-sm-3 col-md-3 pb-2"></div>');
                             let offerButton =""
                             if (value.OFFER == 1) {
                                 offerButton = `<button type="button" class="btn btn-warning float-right" dataProduct="' + value.Name + '" onClick="fn_getOfferData(${value.ID_Category},${value.ID_Product},${key});"> <a href="#popup${key}" style="color: white;">Offer</a></button> <div id="popup${key}" class="popup-container" style="z-index: 1000;"><div class="popup-content"><a href="#" class="close">&times;</a><h5><span style="color: var(--perfect-primary);">${value.Name}</span></h5><div id="offerDetails${key}"></div></div></div>`;
                             }

                             let myPanel = $('<div class="card" style="border: solid 0.25px;"><div class="card-header" style="color: var(--perfect-primary);font-weight: bold;">' + value.Name + '</div><div class="card-body" style="padding: 0rem"><table class="table table-bordered"><tbody><tr style="display:' + rankDisplay + '"><td>Rank</td><td style="text-align: center;">' + value.RankData + '</td></tr><tr><td>Code</td><td>' + value.Code + '</td></tr><tr><td>MRP</td><td>' + value.MRP + '</td></tr><tr><td>Price</td><td>' + value.SalPrice + '</td></tr><tr><td>Stock</td><td>' + value.CurrentQuantity + '</td></tr></tbody></table></div><div class="card-footer" style="padding:0.99;">' + offerButton+'</div></div>');
                             myPanel.appendTo(myCol);
                             myCol.appendTo('#contentPanel');
                         });
                     }
                 },
                 complete: function () {

                 }
             });
      }

    function fn_getOfferData(ID_Category, ID_Product,Key) {
        let offerButton = "";
          let pageUrlOffer = '@Url.Action("GetProductOffersList", "Product")';
                                    $.ajax({
                                        url: pageUrlOffer,
                                        type: "POST",
                                        data: {
                                            __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                                            'FK_Category': ID_Category,
                                            'FK_Product': ID_Product,
                                        },
                                        dataType: "json",
                                        contentType: "application/x-www-form-urlencoded; charset=utf-8",
                                        success: function (ajaxOutputOffer) {
                                            if (ajaxOutputOffer.offerDtls.Process.IsProcess) {
                                                $.each(ajaxOutputOffer.offerDtls.Data, function (keyOffer, value) {
                                                    offerButton = offerButton + `<p>${value.OfrName}:&nbsp;&nbsp;${value.OfrDescription}</p> <br/> <div class="float-right" style="color: #f15656;">Expiry on ${value.ExpireDate}</div>`;
                                                });
                                                $(`#offerDetails${Key}`).empty();
                                                $(`#offerDetails${Key}`).append(offerButton)

                                            }
                                        },
                                        complete: function () {

                                        }
                                    });
    }
     function getfunction(ele) {
         fn_loadProductListData(ele)
    }

    function fn_loadProductListData(ele)
      {
          let $thisForm = $(ele).closest('[perfect-class="form"]');
          $thisForm.find('[name=contentPanel]').empty();
          //if ($thisForm.find('[name=FK_Category]').val() == 0) {
          //    NotificationMessage({ 'type': 'warning', 'heading': 'warning', 'message': 'Please Select Category' });
          //    return;
          //}
          let pageUrl = '@Url.Action("GetProductList", "Product")';
          $.ajax({
                 url: pageUrl,
                 type: "POST",
                 data: {
                     __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val(),
                     'FK_Category': $thisForm.find('[name=FK_Category]').val(),
                     'Name': $thisForm.find('[name=Product]').val(),
                     'FK_Product': $thisForm.find('[name=FK_Product]').val(),
                     'Offer': $("#switchAllOrOffer").is(':checked')?1:0
                 },
                 dataType: "json",
                 contentType: "application/x-www-form-urlencoded; charset=utf-8",
                 success: function (ajaxOutput) {
                    
                     if (ajaxOutput.proDtls.Process.IsProcess) {
                         $.each(ajaxOutput.proDtls.Data, function (key, value) {

                             let myCol = $('<div class="col-sm-3"></div>');
                             let myPanel = "";
                             if (value.OFFER == 1) {
                                 myPanel = $(`<div class="offer offer-warning">
                                                    <div class="shape">
                                                        <div class="shape-text">
                                                            Offer
                                                        </div>
                                                    </div>
                                                    <div class="offer-content">
                                                        <div class="card-header" style="color: var(--perfect-primary);font-weight: bold;">${value.Name}</div>
                                                        <div class="card-body" style="padding: 0rem"><table class="table table-bordered"><tbody><tr><td>Code</td><td>${value.Code}</td></tr><tr><td>MRP</td><td>${value.MRP}</td></tr><tr><td>Price</td><td>${value.SalPrice}</td></tr><tr><td>Stock</td><td>${value.CurrentQuantity}</td></tr><tr><td colspan="2"><p>${value.OfrName}:&nbsp;&nbsp;${value.OfrDescription}</p><div class="float-right" style="color: #f15656;">Expiry on ${value.OfrExpireDate}</div></td></tr></tbody></table></div>
                                                    </div>
                                                </div>`);
                             }
                             else {
                                 myPanel = $(`<div class="offer">
                                                    <div class="offer-content">
                                                        <div class="card-header" style="color: var(--perfect-primary);font-weight: bold;">${value.Name}</div>
                                                        <div class="card-body" style="padding: 0rem"><table class="table table-bordered"><tbody><tr><td>Code</td><td>${value.Code}</td></tr><tr><td>MRP</td><td>${value.MRP}</td></tr><tr><td>Price</td><td>${value.SalPrice}</td></tr><tr><td>Stock</td><td>${value.CurrentQuantity}</td></tr></tbody></table></div>
                                                    </div>
                                                </div>`);
                             }

                             myPanel.appendTo(myCol);
                             myCol.appendTo('#contentPanel');

                         });
                     } else {
                         var offer = $("#switchAllOrOffer").is(':checked');
                         if (offer) {
                             let myCol = $('<div class="col-sm-12" style="text-align:center;color:#FF6746 !important;">No offers are available right now</div>');
                             myCol.appendTo('#contentPanel');
                         }
                     }
                 },
                 complete: function () {
                     let myCol = $('<div class="col-sm-3"></div>');
                 }
             });
      }
</script>



